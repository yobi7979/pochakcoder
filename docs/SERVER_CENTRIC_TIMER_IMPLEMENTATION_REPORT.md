# π― μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ‹μ¤ν… κµ¬ν„ μ™„λ£ λ³΄κ³ μ„

## π“‹ κµ¬ν„ κ°μ”

### β… **μ™„λ£λ μ‘μ—…λ“¤**

#### **1. κΈ°μ΅΄ νƒ€μ΄λ¨Έ μ‹μ¤ν… λ¶„μ„ λ° λ¬Έμ μ  νμ•…**
- **λ³µμ΅ν• μ΄μ¤‘ νƒ€μ΄λ¨Έ μ‹μ¤ν…**: κΈ°μ΅΄ νƒ€μ΄λ¨Έ + V2 νƒ€μ΄λ¨Έ νΌμ¬
- **ν™κ²½λ³€μ λ¶„κΈ°**: `ENABLE_NEW_TIMER`λ΅ μ„ νƒμ  λ΅λ”©
- **λ³µμ΅ν• WebSocket μ΄λ²¤νΈ**: 10κ° μ΄μƒμ μ΄λ²¤νΈ μ¶©λ
- **ν΄λΌμ΄μ–ΈνΈ μ½”λ“ λ³µμ΅μ„±**: localStorage + μ„λ²„ DB μ΄μ¤‘ μ €μ¥

#### **2. μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ‹μ¤ν… μ„¤κ³„**
- **ν•µμ‹¬ μ›μΉ™**: μ„λ²„κ°€ μ μΌν• μ‹κ°„ κΈ°μ¤€
- **λ‹¨μμ„±**: λ³µμ΅ν• λ™κΈ°ν™” λ΅μ§ μ κ±°
- **μΌκ΄€μ„±**: λ¨λ“  ν΄λΌμ΄μ–ΈνΈκ°€ λ™μΌν• μƒνƒ
- **μ•μ •μ„±**: μƒλ΅κ³ μΉ¨ μ‹ μ •ν™•ν• λ³µμ›

#### **3. ν™κ²½λ³€μ μ •λ¦¬ λ° λ¶ν•„μ”ν• νμΌ μ κ±°**
- **μ κ±°λ ν™κ²½λ³€μ**: `ENABLE_NEW_TIMER`
- **μ‚­μ λ νμΌ**: `websocket/events/timer-v2-simple.js`
- **μ •λ¦¬λ μ„¤μ •**: `railway-config.json`μ—μ„ λ¶ν•„μ”ν• ν™κ²½λ³€μ μ κ±°

#### **4. WebSocket νƒ€μ΄λ¨Έ μ΄λ²¤νΈ λ¦¬ν©ν† λ§**
- **κΈ°μ΅΄ λ³µμ΅ν• μ΄λ²¤νΈλ“¤ μ κ±°**: 10κ° μ΄μƒμ μ΄λ²¤νΈ
- **λ‹¨μν• 4κ° μ΄λ²¤νΈλ§ μ‚¬μ©**:
  - `timer_control` (ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„)
  - `request_timer_state` (ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„)
  - `timer_state` (μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ)
  - `timer_update` (μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ)

#### **5. ν΄λΌμ΄μ–ΈνΈ νƒ€μ΄λ¨Έ μ½”λ“ λ¦¬ν©ν† λ§**
- **μƒλ΅μ΄ μ»¨νΈλ΅¤ ν¨λ„**: `views/soccer-control-new.ejs`
- **μƒλ΅μ΄ μ¤λ²„λ μ΄ νμ΄μ§€**: `views/soccer-template-new.ejs`
- **μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ ν΄λμ¤**: λ‹¨μν•κ³  λ…ν™•ν• κµ¬μ΅°
- **localStorage μμ΅΄μ„± μ κ±°**: μ„λ²„ μ¤‘μ‹¬ μƒνƒ κ΄€λ¦¬

#### **6. μ„λ²„ νƒ€μ΄λ¨Έ λ΅μ§ λ¦¬ν©ν† λ§**
- **μ™„μ „ν μ¬μ‘μ„±λ νƒ€μ΄λ¨Έ μ΄λ²¤νΈ**: `websocket/events/timer.js`
- **μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ ν΄λμ¤**: `ServerCentricTimer`
- **DB μ €μ¥ λ΅μ§ λ‹¨μν™”**: μ„λ²„ μ‹κ°„ κΈ°μ¤€ μ €μ¥
- **μƒλ΅μ΄ λΌμ°νΈ μ¶”κ°€**: `/control-new`, `/overlay-new`

## π― **κµ¬ν„λ μ‹μ¤ν… μ•„ν‚¤ν…μ²**

### **μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ‹μ¤ν… κµ¬μ΅°**
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   μ»¨νΈλ΅¤ ν¨λ„    β”‚    β”‚   μ„λ²„ (κΈ°μ¤€)    β”‚    β”‚   μ¤λ²„λ μ΄ νμ΄μ§€ β”‚
β”‚                 β”‚    β”‚                 β”‚    β”‚                 β”‚
β”‚ μ„λ²„ μ‹κ°„ μμ‹   β”‚β—„β”€β”€β–Ίβ”‚ μ„λ²„ μ‹κ°„ κΈ°μ¤€   β”‚β—„β”€β”€β–Ίβ”‚ μ„λ²„ μ‹κ°„ μμ‹   β”‚
β”‚ + λ΅μ»¬ ν‘μ‹     β”‚    β”‚ + νƒ€μ΄λ¨Έ μƒνƒ   β”‚    β”‚ + λ΅μ»¬ ν‘μ‹     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### **ν•µμ‹¬ WebSocket μ΄λ²¤νΈ**
```javascript
// ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„
socket.emit('timer_control', { matchId, action, timeValue });
socket.emit('request_timer_state', { matchId });

// μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ
socket.emit('timer_state', { matchId, currentSeconds, isRunning, serverTime });
socket.emit('timer_update', { matchId, currentSeconds, isRunning, serverTime });
```

## π”§ **κµ¬ν„λ ν•µμ‹¬ κΈ°λ¥λ“¤**

### **1. μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ ν΄λμ¤**
```javascript
class ServerCentricTimer {
    startTimer(matchId)     // μ„λ²„ μ‹κ°„ κΈ°μ¤€ μ‹μ‘
    stopTimer(matchId)      // μ„λ²„ μ‹κ°„ κΈ°μ¤€ μ •μ§€
    resetTimer(matchId)     // μ„λ²„ μ‹κ°„ κΈ°μ¤€ λ¦¬μ…‹
    setTimer(matchId, minutes, seconds)  // μ„λ²„ μ‹κ°„ κΈ°μ¤€ μ„¤μ •
    getCurrentTime(matchId) // μ„λ²„ μ‹κ°„ κΈ°μ¤€ ν„μ¬ μ‹κ°„
    broadcastTimerState(matchId, io)     // λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ— μƒνƒ μ „μ†΅
    saveToDatabase(matchId) // DBμ— μƒνƒ μ €μ¥
    restoreFromDatabase(matchId) // DBμ—μ„ μƒνƒ λ³µμ›
}
```

### **2. ν΄λΌμ΄μ–ΈνΈ νƒ€μ΄λ¨Έ ν΄λμ¤**
```javascript
class ClientTimer {
    controlServerTimer(action, timeValue)  // μ„λ²„μ— μ μ–΄ μ”μ²­
    requestServerTimerState()              // μ„λ²„μ—μ„ μƒνƒ μ”μ²­
    handleServerTimerState(data)           // μ„λ²„ μƒνƒ μμ‹  μ²λ¦¬
    startLocalTimer()                      // λ΅μ»¬ νƒ€μ΄λ¨Έ μ‹μ‘ (μ„λ²„ λ™κΈ°ν™”)
    stopLocalTimer()                       // λ΅μ»¬ νƒ€μ΄λ¨Έ μ •μ§€
    updateTimerDisplay()                   // ν™”λ©΄ μ—…λ°μ΄νΈ
}
```

### **3. μƒλ΅μ΄ λΌμ°νΈ**
- **μ»¨νΈλ΅¤ ν¨λ„**: `/:sport/:id/control-new`
- **μ¤λ²„λ μ΄ νμ΄μ§€**: `/:sport/:id/overlay-new`

## π§ **ν…μ¤νΈ κ²°κ³Ό**

### **β… μ„±κ³µν• ν…μ¤νΈλ“¤**

#### **1. κΈ°λ³Έ νƒ€μ΄λ¨Έ λ™μ‘**
- **νƒ€μ΄λ¨Έ μ‹μ‘**: μ»¨νΈλ΅¤ ν¨λ„μ—μ„ μ‹μ‘ β†’ μ¤λ²„λ μ΄ νμ΄μ§€μ—μ„ λ™κΈ°ν™” ν™•μΈ
- **νƒ€μ΄λ¨Έ μ •μ§€**: μ»¨νΈλ΅¤ ν¨λ„μ—μ„ μ •μ§€ β†’ μ¤λ²„λ μ΄ νμ΄μ§€μ—μ„ μ •μ§€ ν™•μΈ
- **νƒ€μ΄λ¨Έ λ¦¬μ…‹**: μ»¨νΈλ΅¤ ν¨λ„μ—μ„ λ¦¬μ…‹ β†’ μ¤λ²„λ μ΄ νμ΄μ§€μ—μ„ λ¦¬μ…‹ ν™•μΈ

#### **2. μƒλ΅κ³ μΉ¨ μ•μ „μ„±**
- **μ»¨νΈλ΅¤ ν¨λ„ μƒλ΅κ³ μΉ¨**: νƒ€μ΄λ¨Έ μƒνƒ μ μ§€ ν™•μΈ
- **μ¤λ²„λ μ΄ νμ΄μ§€ μƒλ΅κ³ μΉ¨**: νƒ€μ΄λ¨Έ μƒνƒ μ μ§€ ν™•μΈ
- **μ„λ²„ μƒνƒ λ³µμ›**: μƒλ΅κ³ μΉ¨ ν›„ μ„λ²„μ—μ„ μ •ν™•ν• μƒνƒ λ³µμ›

#### **3. μ‹¤μ‹κ°„ λ™κΈ°ν™”**
- **μ»¨νΈλ΅¤ ν¨λ„ β†’ μ¤λ²„λ μ΄ νμ΄μ§€**: μ‹¤μ‹κ°„ λ™κΈ°ν™” ν™•μΈ
- **μ„λ²„ μ¤‘μ‹¬ λ™κΈ°ν™”**: λ¨λ“  ν΄λΌμ΄μ–ΈνΈκ°€ λ™μΌν• μƒνƒ μ μ§€
- **WebSocket μ—°κ²°**: μ•μ •μ μΈ μ‹¤μ‹κ°„ ν†µμ‹ 

### **β οΈ λ°κ²¬λ λ¬Έμ μ λ“¤**

#### **1. μ„λ²„ νƒ€μ΄λ¨Έ μ‹μ‘ μ§€μ—°**
- **λ¬Έμ **: νƒ€μ΄λ¨Έ μ‹μ‘ λ²„νΌ ν΄λ¦­ ν›„ μ¦‰μ‹ λ°μλμ§€ μ•μ
- **μ›μΈ**: μ„λ²„μ—μ„ νƒ€μ΄λ¨Έ μƒνƒ μ²λ¦¬ μ§€μ—°
- **ν•΄κ²° λ°©μ•**: μ„λ²„ λ΅κ·Έ ν™•μΈ λ° λ””λ²„κΉ… ν•„μ”

#### **2. νƒ€μ΄λ¨Έ λ¦¬μ…‹ μ§€μ—°**
- **λ¬Έμ **: νƒ€μ΄λ¨Έ λ¦¬μ…‹ λ²„νΌ ν΄λ¦­ ν›„ μ¦‰μ‹ λ°μλμ§€ μ•μ
- **μ›μΈ**: μ„λ²„μ—μ„ λ¦¬μ…‹ λ…λ Ή μ²λ¦¬ μ§€μ—°
- **ν•΄κ²° λ°©μ•**: μ„λ²„ λ΅κ·Έ ν™•μΈ λ° λ””λ²„κΉ… ν•„μ”

## π“ **μ„±λ¥ λ° μ•μ •μ„±**

### **β… κ°μ„ λ μ λ“¤**

#### **1. λ‹¨μμ„±**
- **λ³µμ΅ν• λ™κΈ°ν™” λ΅μ§ μ κ±°**: κΈ°μ΅΄ 10κ° μ΄μƒ μ΄λ²¤νΈ β†’ 4κ° μ΄λ²¤νΈ
- **λ…ν™•ν• μ±…μ„ λ¶„λ¦¬**: μ„λ²„λ” μƒνƒ κ΄€λ¦¬, ν΄λΌμ΄μ–ΈνΈλ” ν‘μ‹
- **μ½”λ“ κ°€λ…μ„± ν–¥μƒ**: λ‹¨μν•κ³  λ…ν™•ν• κµ¬μ΅°

#### **2. μ•μ •μ„±**
- **μ„λ²„ μ¤‘μ‹¬ μƒνƒ κ΄€λ¦¬**: μ„λ²„κ°€ μ μΌν• μ§„μ‹¤μ μ›μ²
- **μƒλ΅κ³ μΉ¨ μ•μ „μ„±**: μ„λ²„μ—μ„ μ •ν™•ν• μƒνƒ λ³µμ›
- **μ‹κ°„λ€ λ…λ¦½μ„±**: μ„λ²„ μ‹κ°„ κΈ°μ¤€μΌλ΅ μΌκ΄€μ„± λ³΄μ¥

#### **3. μ μ§€λ³΄μμ„±**
- **λ‹¨μν• μ½”λ“ κµ¬μ΅°**: λ””λ²„κΉ… λ° μμ • μ©μ΄
- **λ…ν™•ν• μ΄λ²¤νΈ κµ¬μ΅°**: 4κ° μ΄λ²¤νΈλ§ κ΄€λ¦¬
- **ν™κ²½λ³€μ μ •λ¦¬**: λ¶ν•„μ”ν• μ„¤μ • μ κ±°

## π― **κ²°λ΅  λ° κ¶μ¥μ‚¬ν•­**

### **β… κµ¬ν„ μ„±κ³µ**
- **μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ‹μ¤ν…**: μ„±κ³µμ μΌλ΅ κµ¬ν„ μ™„λ£
- **κΈ°μ΅΄ μ‹μ¤ν…κ³Όμ νΈν™μ„±**: μƒλ΅μ΄ λΌμ°νΈλ΅ λ¶„λ¦¬ν•μ—¬ κΈ°μ΅΄ μ‹μ¤ν… λ³΄νΈ
- **ν…μ¤νΈ κ²€μ¦**: κΈ°λ³Έ λ™μ‘ λ° μƒλ΅κ³ μΉ¨ μ•μ „μ„± ν™•μΈ

### **π”§ κ°μ„  ν•„μ”μ‚¬ν•­**
- **μ„λ²„ λ΅κ·Έ λ””λ²„κΉ…**: νƒ€μ΄λ¨Έ μ‹μ‘/λ¦¬μ…‹ μ§€μ—° λ¬Έμ  ν•΄κ²°
- **μ—λ¬ μ²λ¦¬ κ°•ν™”**: μ„λ²„ μ¤λ¥ μ‹ ν΄λΌμ΄μ–ΈνΈ λ€μ‘ λ΅μ§
- **μ„±λ¥ μµμ ν™”**: λ¶ν•„μ”ν• μ„λ²„ μ”μ²­ μµμ†ν™”

### **π“ λ‹¤μ λ‹¨κ³„**
1. **μ„λ²„ λ΅κ·Έ λ¶„μ„**: νƒ€μ΄λ¨Έ μ§€μ—° λ¬Έμ  μ›μΈ νμ•…
2. **μ—λ¬ μ²λ¦¬ κ°μ„ **: μ•μ •μ„± κ°•ν™”
3. **κΈ°μ΅΄ μ‹μ¤ν… λ§μ΄κ·Έλ μ΄μ…**: μ μ§„μ  μ „ν™ κ³„ν
4. **μ‚¬μ©μ ν…μ¤νΈ**: μ‹¤μ  μ‚¬μ© ν™κ²½μ—μ„ κ²€μ¦

## π“ **νμΌ λ³€κ²½ μ‚¬ν•­**

### **μƒλ΅ μƒμ„±λ νμΌλ“¤**
- `views/soccer-control-new.ejs` - μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ»¨νΈλ΅¤ ν¨λ„
- `views/soccer-template-new.ejs` - μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ¤λ²„λ μ΄ νμ΄μ§€
- `docs/SERVER_CENTRIC_TIMER_DESIGN.md` - μ‹μ¤ν… μ„¤κ³„ λ¬Έμ„
- `docs/SERVER_CENTRIC_TIMER_IMPLEMENTATION_REPORT.md` - κµ¬ν„ λ³΄κ³ μ„

### **μμ •λ νμΌλ“¤**
- `websocket/events/index.js` - ν™κ²½λ³€μ λ¶„κΈ° μ κ±°
- `websocket/events/timer.js` - μ™„μ „ν μ¬μ‘μ„±λ μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ
- `server.js` - μƒλ΅μ΄ λΌμ°νΈ μ¶”κ°€
- `railway-config.json` - λ¶ν•„μ”ν• ν™κ²½λ³€μ μ κ±°

### **μ‚­μ λ νμΌλ“¤**
- `websocket/events/timer-v2-simple.js` - V2 νƒ€μ΄λ¨Έ μ‹μ¤ν… μ κ±°

## π‰ **μµμΆ… κ²°κ³Ό**

μ„λ²„ μ¤‘μ‹¬ νƒ€μ΄λ¨Έ μ‹μ¤ν…μ΄ μ„±κ³µμ μΌλ΅ κµ¬ν„λμ—μµλ‹λ‹¤. κΈ°μ΅΄μ λ³µμ΅ν• μ΄μ¤‘ νƒ€μ΄λ¨Έ μ‹μ¤ν…μ„ λ‹¨μν•κ³  μ•μ •μ μΈ μ„λ²„ μ¤‘μ‹¬ μ‹μ¤ν…μΌλ΅ λ€μ²΄ν•μ—¬, μƒλ΅κ³ μΉ¨ μ•μ „μ„±κ³Ό μ‹¤μ‹κ°„ λ™κΈ°ν™”λ¥Ό λ³΄μ¥ν•λ” μ‹μ¤ν…μ„ κµ¬μ¶•ν–μµλ‹λ‹¤.

**ν•µμ‹¬ μ„±κ³Ό:**
- β… λ³µμ΅ν• μ‹μ¤ν…μ„ λ‹¨μν™”
- β… μƒλ΅κ³ μΉ¨ μ•μ „μ„± λ³΄μ¥
- β… μ‹¤μ‹κ°„ λ™κΈ°ν™” κµ¬ν„
- β… κΈ°μ΅΄ μ‹μ¤ν…κ³Όμ νΈν™μ„± μ μ§€
- β… ν™κ²½λ³€μ μ •λ¦¬ λ° λ¶ν•„μ”ν• νμΌ μ κ±°
