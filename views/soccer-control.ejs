<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï∂ïÍµ¨ Í≤ΩÍ∏∞ Ïª®Ìä∏Î°§ Ìå®ÎÑê</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        body {
            background-color: var(--light-color);
            padding: 10px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .control-panel {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .panel-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .score-section {
            margin: 15px 0;
        }
        
        .score-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-input::-webkit-inner-spin-button,
        .score-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .score-input {
            appearance: textfield;
            -moz-appearance: textfield;
            width: 80px;
            height: 40px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            border-radius: 8px;
            border: 2px solid #ddd;
            padding: 5px;
        }
        
        .score-controls {
            display: flex;
            gap: 5px;
        }
        
        .score-btn {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 20px;
        }
        
        .team-color-section {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
        }
        
        .team-color-section .form-control {
            flex: 1;
        }
        
        .team-color-section .form-control-color {
            width: 35px;
            height: 30px;
            border: none;
            background: none;
            padding: 0;
            box-shadow: none;
            outline: none;
        }
        
        .team-color-section .form-control-color::-webkit-color-swatch-wrapper {
            padding: 0;
            border: none;
        }
        
        .team-color-section .form-control-color::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }
        
        .time-edit-container {
            margin-left: 10px;
            padding: 8px 12px;
            background-color: rgba(0, 123, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 123, 255, 0.3);
        }
        
        .time-edit-input {
            width: 120px;
            text-align: center;
            border-radius: 6px;
            border: 1px solid var(--primary-color);
            padding: 4px 8px;
            font-size: 0.9rem;
        }
        
        .apply-time-btn {
            border-radius: 6px;
            padding: 4px 12px;
                font-size: 0.9rem;
            }
            
            
        .team-color-section .save-team-color {
            white-space: nowrap;
        }
        
        /* ÌåÄ Í¥ÄÎ¶¨ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .team-management-section {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .team-management-section > div {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .team-logo-bg-section {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .team-management-section .form-control-color {
            width: 35px;
            height: 30px;
            border: none;
            background: none;
            padding: 0;
            box-shadow: none;
            outline: none;
        }
        
        .team-management-section .form-control-color::-webkit-color-swatch-wrapper {
            padding: 0;
            border: none;
        }
        
        .team-management-section .form-control-color::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }
        
        .team-management-section .form-label {
            font-size: 0.9rem;
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        .team-management-section .btn {
            font-size: 0.8rem;
            padding: 4px 8px;
        }
        
        /* Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº ÌÜµÏùº */
        .team-color-container,
        .team-logo-bg-container {
            flex: 1;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin: 0 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .team-color-container .team-color-section,
        .team-logo-bg-container .team-logo-bg-section {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 0;
        }
        
        .team-color-container .form-label,
        .team-logo-bg-container .form-label {
            font-size: 0.9rem;
            margin-bottom: 0;
            white-space: nowrap;
            min-width: 60px;
        }
        
        /* ÌåÄÎ°úÍ≥† Í¥ÄÎ¶¨ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .team-logo-section {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin: 10px 5px 0 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .logo-controls {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 10px;
        }
        
        .logo-controls .form-control-color {
            width: 35px;
            height: 30px;
            border: none;
            background: none;
            padding: 0;
            box-shadow: none;
            outline: none;
        }
        
        .logo-controls .form-control-color::-webkit-color-swatch-wrapper {
            padding: 0;
            border: none;
        }
        
        .logo-controls .form-control-color::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }
        
        /* Ï†êÏàò Î∞è Î°úÍ≥† Í¥ÄÎ¶¨ ÏÑπÏÖò */
        .score-logo-section {
            display: flex;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .score-logo-section .score-section {
            flex: 1;
        }
        
        .logo-preview-section {
            flex: 0 0 auto;
        }
        
        .logo-preview-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
        }
        
        .logo-preview {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60px;
        }
        
        .logo-preview-container .logo-controls {
            display: flex;
            flex-direction: column;
            gap: 4px;
            width: 100%;
            max-width: 80px;
        }
        
        .logo-preview-container .logo-controls .btn {
            font-size: 0.75rem;
            padding: 4px 8px;
            width: 100%;
        }
        
        .preview-bg {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #dee2e6;
            position: relative;
            overflow: hidden;
        }
        
        .preview-bg img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .no-logo-text {
            font-size: 0.7rem;
            color: #6c757d;
            text-align: center;
        }
        
        .team-logo-section .form-label {
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        .team-logo-section .btn {
            font-size: 0.8rem;
            padding: 4px 8px;
        }
        
        /* URL ÏÑπÏÖò ÎÇ¥ ÌåÄÎ°úÍ≥† Ï†úÏñ¥ */
        .logo-control-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .logo-control-item .url-type {
            min-width: 30px;
        }
        
        .logo-control-item .btn {
            font-size: 0.75rem;
            padding: 4px 8px;
        }
        
        .logo-control-buttons .btn {
            font-size: 0.8rem;
            padding: 6px 12px;
        }
        
        /* Ìó§Îçî ÏÑπÏÖò */
            .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .panel-title {
            margin: 0;
            color: #2c3e50;
            font-weight: 600;
        }
        
        /* Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú Ïä§ÌÉÄÏùº */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-indicator.connected {
            background-color: #28a745;
            box-shadow: 0 0 8px rgba(40, 167, 69, 0.5);
        }
        
        .status-indicator.disconnected {
            background-color: #dc3545;
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.5);
        }
        
        .back-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }
        
        /* URL Î≥µÏÇ¨ ÏÑπÏÖò (Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ) */
        .url-section-compact {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
        }
        
        .url-label {
            font-weight: 600;
            color: #495057;
            white-space: nowrap;
        }
        
        .url-item {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .url-type {
            font-size: 0.8rem;
            font-weight: 500;
            color: #6c757d;
            min-width: 50px;
            text-align: center;
        }
        
        .url-input-compact {
            font-size: 0.85rem;
            padding: 4px 8px;
            height: 32px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }

        .url-input-compact:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        /* ÏäπÎ∂ÄÏ∞®Í∏∞ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .penalty-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
        }
        
        
        .penalty-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .penalty-label {
            font-size: 0.8rem;
            font-weight: 500;
            color: #6c757d;
            min-width: 40px;
            text-align: center;
        }
        
        /* ÎìùÏ†ê Ï†ïÎ≥¥ ÏûÖÎ†• ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .goal-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .goal-input-row input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .goal-input-row .btn-sm {
            padding: 4px 8px;
            font-size: 0.8rem;
        }
        
        .goal-input-row .time-input {
            width: 80px;
            text-align: center;
        }
        
        .goal-input-row .player-input {
            flex: 2;
        }
        
        /* ÏÉàÎ°úÏö¥ ÎìùÏ†ê Ï†ïÎ≥¥ ÏûÖÎ†• Ïä§ÌÉÄÏùº */
        .goal-input-form {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
        }
        
        .goals-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            background: #ffffff;
        }
        
        .goal-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin-bottom: 2px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .goal-item:last-child {
            margin-bottom: 0;
        }
        
        .goal-item .goal-text {
            flex: 1;
            font-weight: 500;
        }
        
        .goal-item .goal-time {
            color: #6c757d;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .goal-item .btn-sm {
            padding: 2px 6px;
            font-size: 0.7rem;
        }
        
        /* Ìé∏Ïßë Í∞ÄÎä•Ìïú ÎìùÏ†ê Ï†ïÎ≥¥ ÏûÖÎ†• ÌïÑÎìú Ïä§ÌÉÄÏùº */
        .goal-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 2px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .goal-player-input, .goal-time-input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
            background: #ffffff;
        }
        
        .goal-player-input:focus, .goal-time-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }
        
        .goal-time-input {
            width: 80px;
            text-align: center;
        }
        
        /* ÏûÖÎ†• Ìèº ÌÖçÏä§Ìä∏ Î∞ïÏä§ ÌÅ¨Í∏∞ Ï°∞Ï†ï */
        .goal-input-form .form-control {
            font-size: 1rem;
            padding: 10px 12px;
            height: auto;
        }
        
        .goal-input-form .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ÌåÄÎ≥Ñ ÎìùÏ†ê ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .team-goals-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            height: 100%;
            min-height: 300px;
        }
        
        .team-goals-section h6 {
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }
        
        .team-goals-section .goal-input-form {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
        }
        
        .team-goals-section .goals-list {
            max-height: 180px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 8px;
            background: #ffffff;
        }
        
        /* ÌôàÌåÄ/Ïñ¥Ïõ®Ïù¥ÌåÄ Íµ¨Î∂ÑÏÑ† */
        .team-goals-section:first-child {
            border-right: 2px solid #dee2e6;
            margin-right: 10px;
        }
        
        .team-goals-section:last-child {
            margin-left: 10px;
        }
        
        .timer-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: 900;
            font-family: 'Noto Sans KR', sans-serif;
            margin-bottom: 20px;
            color: #2c3e50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .url-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .url-input {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <!-- Ìó§Îçî -->
        <div class="panel-header">
            <h2 class="panel-title">
                <i class="bi bi-trophy"></i> Ï∂ïÍµ¨ Í≤ΩÍ∏∞ Ïª®Ìä∏Î°§ Ìå®ÎÑê
            </h2>
            <div class="d-flex align-items-center gap-3">
                <div class="connection-status">
                    <span id="connection-indicator" class="status-indicator"></span>
                    <span id="connection-text">ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ï§ë...</span>
                </div>
                <!-- ÏÉàÎ°úÏö¥ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú v2 ÌÜ†Í∏Ä (Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ) -->
                <div class="d-flex align-items-center gap-2">
                    <span class="text-muted small">ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="timer-v2-toggle" onchange="toggleTimerV2()">
                        <label class="form-check-label" for="timer-v2-toggle"></label>
                    </div>
                </div>
            <a href="/matches" class="btn btn-outline-secondary back-btn">
                <i class="bi bi-arrow-left"></i> Î™©Î°ù
            </a>
        </div>
        </div>
        
        <!-- URL Î≥µÏÇ¨ ÏÑπÏÖò (Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ) -->
        <div class="url-section-compact">
            <div class="d-flex align-items-center gap-3">
                <span class="url-label">
                    <i class="bi bi-link-45deg"></i> URL:
                </span>
                <div class="url-item">
                    <span class="url-type">Î™®Î∞îÏùº</span>
                    <input type="text" id="mobile-url" class="form-control url-input-compact" readonly>
                    <button class="btn btn-sm btn-outline-secondary" onclick="copyMobileUrl()">
                        <i class="bi bi-copy"></i>
                        </button>
                    </div>
                <div class="url-item">
                    <span class="url-type">Ïò§Î≤ÑÎ†àÏù¥</span>
                    <input type="text" id="overlay-url" class="form-control url-input-compact" readonly>
                    <button class="btn btn-sm btn-outline-secondary" onclick="copyOverlayUrl()">
                        <i class="bi bi-copy"></i>
                                </button>
                </div>
                <!-- ÌåÄÎ°úÍ≥† ÏÇ¨Ïö©Ïú†Î¨¥ Ï†úÏñ¥ -->
                <div class="url-item logo-control-item">
                    <span class="url-type">Î°úÍ≥†</span>
                    <button class="btn btn-sm btn-success" id="toggle-team-logos">
                        <i class="bi bi-eye"></i> ÌëúÏãú
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" id="toggle-logo-display" style="display: none;">
                        <i class="bi bi-palette"></i> Î∞∞Í≤ΩÎßå
                    </button>
                </div>
            </div>
        </div>


        <!-- ÌÉÄÏù¥Î®∏ ÏÑπÏÖò -->
                    <div class="timer-section">
            <div class="timer-display" id="timer-display">00:00</div>
                        <div class="timer-controls">
                <button class="btn btn-success" onclick="startTimer()">
                            <i class="bi bi-play-fill"></i> ÏãúÏûë
                        </button>
                <button class="btn btn-warning" onclick="stopTimer()">
                    <i class="bi bi-pause-fill"></i> Ï†ïÏßÄ
                        </button>
                <button class="btn btn-secondary" onclick="resetTimer()">
                    <i class="bi bi-arrow-clockwise"></i> Î¶¨ÏÖã
                        </button>
                <button class="btn btn-primary" onclick="toggleTimeEdit()">
                            <i class="bi bi-pencil"></i> ÏàòÏ†ï
                        </button>
                        
                        <!-- ÏãúÍ∞Ñ ÏàòÏ†ï ÏûÖÎ†• ÌïÑÎìú (ÏàòÏ†ï Î≤ÑÌäº ÏòÜÏóê Í≥†Ï†ï ÌëúÏãú) -->
                    <div id="time-edit-container" class="time-edit-container" style="display: none;">
                        <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <input type="text" id="time-edit-input" class="form-control time-edit-input" placeholder="Ïà´Ïûê ÏûÖÎ†• (Ïòà: 1, 11, 111, 1111)" maxlength="6">
                            </div>
                            <div>
                                <button id="apply-time-btn" class="btn btn-success apply-time-btn">
                                    <i class="bi bi-check-lg"></i> Ï†ÅÏö©
                                </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Î≤ÑÌäº -->
            <div class="text-center mt-3">
                <button class="btn btn-warning btn-sm" onclick="swapTeams()">
                    <i class="bi bi-arrow-left-right"></i> ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω
                            </button>
                <small class="text-muted d-block mt-1">ÌôàÌåÄÍ≥º Ïñ¥Ïõ®Ïù¥ÌåÄÏùò Ï†ïÎ≥¥Î•º ÏÑúÎ°ú Î∞îÍøâÎãàÎã§</small>
                        </div>
            </div>
            
        <!-- ÌôàÌåÄ ÏÑπÏÖò -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-house"></i> <%= match.home_team %></h5>
                    </div>
                    <div class="card-body">
                        <!-- ÌåÄÎ™Ö ÏàòÏ†ï -->
                        <div class="mb-3">
                            <div class="input-group">
                                <input type="text" id="home-team-name" class="form-control" value="<%= match.home_team %>">
                        <button class="btn btn-success btn-sm save-team-name" data-team="home">
                            <i class="bi bi-check-lg"></i> ÌåÄÎ™Ö Ï†ÄÏû•
                            </button>
                        </div>
                                    </div>
            
                        <!-- ÌåÄ Ïª¨Îü¨ Î∞è Î°úÍ≥† Í¥ÄÎ¶¨ -->
                        <div class="team-management-section">
                            <!-- ÌåÄ Ïª¨Îü¨ -->
                            <div class="team-color-container">
                                <div class="team-color-section">
                                    <label class="form-label">ÌåÄ Ïª¨Îü¨</label>
                                    <input type="color" id="home-team-color" class="form-control form-control-color" value="<%= match.home_team_color || '#1e40af' %>">
                                    <button class="btn btn-primary save-team-color" data-team="home">
                                        <i class="bi bi-save"></i> Ï†ÄÏû•
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ -->
                            <div class="team-logo-bg-container">
                                <div class="team-logo-bg-section">
                                    <label class="form-label">Î∞∞Í≤ΩÏÉâ</label>
                                    <input type="color" id="home-team-logo-bg" class="form-control form-control-color" value="#FFFFFF" title="Î°úÍ≥† Î∞∞Í≤ΩÏÉâ">
                                    <button class="btn btn-success save-team-logo-bg" data-team="home">
                                        <i class="bi bi-save"></i> Ï†ÄÏû•
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ï†êÏàò Î∞è Î°úÍ≥† Í¥ÄÎ¶¨ ÏÑπÏÖò -->
                        <div class="score-logo-section">
                            <!-- Ï†êÏàò Ïª®Ìä∏Î°§ -->
                            <div class="score-section">
                                <label class="form-label">Ï†êÏàò</label>
                                <div class="score-input-group">
                                    <button class="btn btn-danger score-btn" onclick="updateScore('home', -1)">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <input type="number" id="home-score" class="score-input" value="<%= match.home_score || 0 %>" readonly>
                                    <button class="btn btn-success score-btn" onclick="updateScore('home', 1)">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ÌåÄÎ°úÍ≥† ÎØ∏Î¶¨Î≥¥Í∏∞ Î∞è Ïª®Ìä∏Î°§ -->
                            <div class="logo-preview-section">
                                <div class="logo-preview-container">
                                    <div class="logo-preview" id="home-logo-preview">
                                        <div class="preview-bg" id="home-preview-bg" style="background-color: #FFFFFF;">
                                            <img id="home-preview-logo" src="" alt="ÌôàÌåÄ Î°úÍ≥†" style="display: none;">
                                            <span class="no-logo-text">Î°úÍ≥† ÏóÜÏùå</span>
                                        </div>
                                    </div>
                                    <div class="logo-controls">
                                        <input type="file" id="home-team-logo" class="form-control" accept="image/*" style="display: none;">
                                        <button class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('home-team-logo').click()">
                                            <i class="bi bi-upload"></i> ÏóÖÎ°úÎìú
                                        </button>
                                        <button class="btn btn-success btn-sm save-team-logo" data-team="home">
                                            <i class="bi bi-save"></i> Ï†ÄÏû•
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ïñ¥Ïõ®Ïù¥ÌåÄ ÏÑπÏÖò -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-airplane"></i> <%= match.away_team %></h5>
                    </div>
                    <div class="card-body">
                        <!-- ÌåÄÎ™Ö ÏàòÏ†ï -->
                        <div class="mb-3">
                            <div class="input-group">
                                <input type="text" id="away-team-name" class="form-control" value="<%= match.away_team %>">
                                <button class="btn btn-success btn-sm save-team-name" data-team="away">
                                    <i class="bi bi-check-lg"></i> ÌåÄÎ™Ö Ï†ÄÏû•
                                            </button>
                                        </div>
                                    </div>
                            
                        <!-- ÌåÄ Ïª¨Îü¨ Î∞è Î°úÍ≥† Í¥ÄÎ¶¨ -->
                        <div class="team-management-section">
                            <!-- ÌåÄ Ïª¨Îü¨ -->
                            <div class="team-color-container">
                                <div class="team-color-section">
                                    <label class="form-label">ÌåÄ Ïª¨Îü¨</label>
                                    <input type="color" id="away-team-color" class="form-control form-control-color" value="<%= match.away_team_color || '#1e40af' %>">
                                    <button class="btn btn-primary save-team-color" data-team="away">
                                        <i class="bi bi-save"></i> Ï†ÄÏû•
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ -->
                            <div class="team-logo-bg-container">
                                <div class="team-logo-bg-section">
                                    <label class="form-label">Î∞∞Í≤ΩÏÉâ</label>
                                    <input type="color" id="away-team-logo-bg" class="form-control form-control-color" value="#FFFFFF" title="Î°úÍ≥† Î∞∞Í≤ΩÏÉâ">
                                    <button class="btn btn-success save-team-logo-bg" data-team="away">
                                        <i class="bi bi-save"></i> Ï†ÄÏû•
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        
                        <!-- Ï†êÏàò Î∞è Î°úÍ≥† Í¥ÄÎ¶¨ ÏÑπÏÖò -->
                        <div class="score-logo-section">
                            <!-- Ï†êÏàò Ïª®Ìä∏Î°§ -->
                            <div class="score-section">
                                <label class="form-label">Ï†êÏàò</label>
                                <div class="score-input-group">
                                    <button class="btn btn-danger score-btn" onclick="updateScore('away', -1)">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <input type="number" id="away-score" class="score-input" value="<%= match.away_score || 0 %>" readonly>
                                    <button class="btn btn-success score-btn" onclick="updateScore('away', 1)">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ÌåÄÎ°úÍ≥† ÎØ∏Î¶¨Î≥¥Í∏∞ Î∞è Ïª®Ìä∏Î°§ -->
                            <div class="logo-preview-section">
                                <div class="logo-preview-container">
                                    <div class="logo-preview" id="away-logo-preview">
                                        <div class="preview-bg" id="away-preview-bg" style="background-color: #FFFFFF;">
                                            <img id="away-preview-logo" src="" alt="Ïñ¥Ïõ®Ïù¥ÌåÄ Î°úÍ≥†" style="display: none;">
                                            <span class="no-logo-text">Î°úÍ≥† ÏóÜÏùå</span>
                                        </div>
                                    </div>
                                    <div class="logo-controls">
                                        <input type="file" id="away-team-logo" class="form-control" accept="image/*" style="display: none;">
                                        <button class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('away-team-logo').click()">
                                            <i class="bi bi-upload"></i> ÏóÖÎ°úÎìú
                                        </button>
                                        <button class="btn btn-success btn-sm save-team-logo" data-team="away">
                                            <i class="bi bi-save"></i> Ï†ÄÏû•
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏäπÎ∂ÄÏ∞®Í∏∞ ÏÑπÏÖòÍ≥º Í∑∏ÎûòÌîΩ ÌÜ†Í∏Ä ÏÑπÏÖò (ÎÇòÎûÄÌûà Î∞∞Ïπò) -->
        <div class="row mb-3">
            <!-- ÏäπÎ∂ÄÏ∞®Í∏∞ ÏÑπÏÖò -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-trophy"></i> ÏäπÎ∂ÄÏ∞®Í∏∞
                        </h6>
                        </div>
                    <div class="card-body">
                        <div class="penalty-section">
                            <div class="penalty-text-display mb-3">
                                <div class="form-control text-center" id="penalty-text-display" style="background-color: #f8f9fa; border: 1px solid #dee2e6; font-weight: 600; color: #495057;">
                                    0 (ÏäπÎ∂ÄÏ∞®Í∏∞) 0
                        </div>
                                <small class="text-muted">ÌòÑÏû¨ ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏</small>
                        </div>
                            <div class="d-flex align-items-center justify-content-center gap-4 mb-3">
                                <div class="penalty-controls">
                                    <button class="btn btn-sm btn-outline-danger" onclick="updatePenaltyScore('home', -1)">
                                        <i class="bi bi-dash"></i>
                    </button>
                                    <span class="penalty-label">ÌôàÌåÄ</span>
                                    <button class="btn btn-sm btn-outline-success" onclick="updatePenaltyScore('home', 1)">
                                        <i class="bi bi-plus"></i>
                        </button>
                    </div>
                                <div class="penalty-controls">
                                    <button class="btn btn-sm btn-outline-danger" onclick="updatePenaltyScore('away', -1)">
                                        <i class="bi bi-dash"></i>
                    </button>
                                    <span class="penalty-label">Ïñ¥Ïõ®Ïù¥ÌåÄ</span>
                                    <button class="btn btn-sm btn-outline-success" onclick="updatePenaltyScore('away', 1)">
                                        <i class="bi bi-plus"></i>
                        </button>
                    </div>
                    </div>
                            <div class="text-center">
                                <button class="btn btn-info btn-sm" onclick="togglePenaltyDisplay()">
                                    <i class="bi bi-eye"></i> ÌëúÏãú
                        </button>
                </div>
            </div>
        </div>
                        </div>
            </div>
            
            <!-- Í∑∏ÎûòÌîΩ ÌÜ†Í∏Ä ÏÑπÏÖò -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-palette"></i> Í∑∏ÎûòÌîΩ ÌëúÏãú
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- ÎåÄÌöåÎ™Ö ÏûÖÎ†• ÏÑπÏÖò -->
                        <div class="mb-3">
                            <label for="tournamentText" class="form-label">
                                <i class="bi bi-trophy"></i> ÎåÄÌöåÎ™Ö
                            </label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="tournamentText" placeholder="ÎåÄÌöåÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                                <button class="btn btn-outline-primary" type="button" onclick="updateTournamentText()">
                                    <i class="bi bi-check"></i> Ï†ÅÏö©
                                </button>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-2">
                                <button class="btn btn-success btn-sm w-100" id="toggle-top-scoreboard" onclick="toggleGraphic('top-scoreboard')">
                                    <i class="bi bi-eye"></i> ÏÉÅÎã® Ïä§ÏΩîÏñ¥Î≥¥Îìú
                                </button>
                            </div>
                            <div class="col-12 mb-2">
                                <button class="btn btn-outline-secondary btn-sm w-100" id="toggle-vs-graphic" onclick="toggleGraphic('vs')">
                                    <i class="bi bi-eye-slash"></i> VS Í∑∏ÎûòÌîΩ
                                </button>
                            </div>
                            <div class="col-12 mb-2">
                                <button class="btn btn-outline-secondary btn-sm w-100" id="toggle-bottom-strip" onclick="toggleGraphic('bottom-strip')">
                                    <i class="bi bi-eye-slash"></i> ÌïòÎã® Ïä§Ìä∏Î¶Ω
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÎìùÏ†ê Ï†ïÎ≥¥ ÏûÖÎ†• ÏÑπÏÖò -->
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-trophy-fill"></i> ÎìùÏ†ê Ï†ïÎ≥¥ Í¥ÄÎ¶¨
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- ÌôàÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥ (Ï¢åÏ∏°) -->
                            <div class="col-md-6">
                                <div class="team-goals-section">
                                    <h6 class="text-primary mb-3">
                                        <i class="bi bi-house"></i> ÌôàÌåÄ ÎìùÏ†ê
                                    </h6>
                                    
                                    <!-- ÏûÖÎ†• Ìèº -->
                                    <div class="goal-input-form mb-3">
                                        <div class="row">
                                            <div class="col-8">
                                                <input type="text" class="form-control" id="home-player-input" placeholder="ÏÑ†Ïàò Ïù¥Î¶Ñ">
                                            </div>
                                            <div class="col-3">
                                                <input type="text" class="form-control" id="home-time-input" placeholder="ÏãúÍ∞Ñ (Ïòà: 15')">
                                            </div>
                                            <div class="col-1">
                                                <button class="btn btn-primary btn-sm" onclick="addHomeGoalFromInput()">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Í≤∞Í≥º Î¶¨Ïä§Ìä∏ -->
                                    <div id="home-goals-list" class="goals-list">
                                        <!-- ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÎäî ÎìùÏ†ê Ï†ïÎ≥¥Îì§ -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥ (Ïö∞Ï∏°) -->
                            <div class="col-md-6">
                                <div class="team-goals-section">
                                    <h6 class="text-danger mb-3">
                                        <i class="bi bi-arrow-right"></i> Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê
                                    </h6>
                                    
                                    <!-- ÏûÖÎ†• Ìèº -->
                                    <div class="goal-input-form mb-3">
                                        <div class="row">
                                            <div class="col-8">
                                                <input type="text" class="form-control" id="away-player-input" placeholder="ÏÑ†Ïàò Ïù¥Î¶Ñ">
                                            </div>
                                            <div class="col-3">
                                                <input type="text" class="form-control" id="away-time-input" placeholder="ÏãúÍ∞Ñ (Ïòà: 15')">
                                            </div>
                                            <div class="col-1">
                                                <button class="btn btn-danger btn-sm" onclick="addAwayGoalFromInput()">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Í≤∞Í≥º Î¶¨Ïä§Ìä∏ -->
                                    <div id="away-goals-list" class="goals-list">
                                        <!-- ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÎäî ÎìùÏ†ê Ï†ïÎ≥¥Îì§ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        const matchId = '<%= match.id %>';
        const socket = io();
        
        // ÏÜåÏºì Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
        socket.on('connect', function() {
            console.log('‚úÖ Ïª®Ìä∏Î°§ ÌéòÏù¥ÏßÄ ÏÜåÏºì Ïó∞Í≤∞Îê®');
            console.log('ÏÜåÏºì ID:', socket.id);
            updateConnectionStatus(true);
        });

        socket.on('disconnect', function() {
            console.log('‚ùå Ïª®Ìä∏Î°§ ÌéòÏù¥ÏßÄ ÏÜåÏºì Ïó∞Í≤∞ ÎÅäÏñ¥Ïßê');
            updateConnectionStatus(false);
        });

        socket.on('connect_error', function(error) {
            console.error('‚ùå Ïª®Ìä∏Î°§ ÌéòÏù¥ÏßÄ ÏÜåÏºì Ïó∞Í≤∞ Ïò§Î•ò:', error);
            updateConnectionStatus(false);
        });

        // Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ Î°úÏßÅ
        socket.on('reconnect', function(attemptNumber) {
            console.log(`üîÑ ÏÜåÏºì Ïû¨Ïó∞Í≤∞ ÏÑ±Í≥µ (ÏãúÎèÑ ${attemptNumber}Î≤àÏß∏)`);
            updateConnectionStatus(true);
            
            // Ïû¨Ïó∞Í≤∞ Ïãú ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ (ÏÑúÎ≤ÑÏôÄ ÎèôÍ∏∞Ìôî)
            console.log('=== Ïû¨Ïó∞Í≤∞ ÌõÑ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ ===');
            socket.emit('request_timer_state', { matchId: matchId });
        });

        socket.on('reconnect_attempt', function(attemptNumber) {
            console.log(`üîÑ ÏÜåÏºì Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ Ï§ë... (${attemptNumber}Î≤àÏß∏)`);
            updateConnectionStatus(false);
        });

        socket.on('reconnect_error', function(error) {
            console.error('‚ùå ÏÜåÏºì Ïû¨Ïó∞Í≤∞ Ïã§Ìå®:', error);
            updateConnectionStatus(false);
        });

        socket.on('reconnect_failed', function() {
            console.error('‚ùå ÏÜåÏºì Ïû¨Ïó∞Í≤∞ ÏôÑÏ†Ñ Ïã§Ìå®');
            updateConnectionStatus(false);
        });
        
        // ÏÜåÏºì Ï¥àÍ∏∞Ìôî ÏßÅÌõÑ ÏÉÅÌÉú ÌôïÏù∏
        console.log('=== Ïª®Ìä∏Î°§ ÌéòÏù¥ÏßÄ ÏÜåÏºì Ï¥àÍ∏∞Ìôî ÏßÅÌõÑ ÏÉÅÌÉú ===');
        console.log('socket.connected:', socket.connected);
        console.log('matchId:', matchId);
        
        
        // ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú (Î∞±ÏóÖ Ìè¥ÎçîÏùò ÏòàÏ†Ñ Î∞©Ïãù - ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ÏôÄ ÏôÑÏ†Ñ ÎèÖÎ¶Ω)
        const timerState = {
            startTime: Date.now(),
            pausedTime: 0,
            currentSeconds: 0,
            isRunning: false,
            lastServerTime: 0,
            lastUpdateTime: 0,
            localTimer: null
        };
        
        // ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉú
        let currentTimerMode = 'legacy-timer'; // Í∏∞Î≥∏Í∞í: Î°úÏª¨ ÌÉÄÏù¥Î®∏
        
        // ÏÜåÏºì Ïó∞Í≤∞
        socket.on('connect', function() {
            console.log('ÏÜåÏºì Ïó∞Í≤∞Îê®');
            socket.emit('join_match', { matchId: matchId });
            
            // Ïó∞Í≤∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            updateConnectionStatus(true);
            
            // Ïó∞Í≤∞ Ïãú ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ (Ïû¨Ïó∞Í≤∞ Ïãú Ï†ïÌôïÌïú ÎèôÍ∏∞Ìôî)
            console.log('=== ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ ===');
            socket.emit('request_timer_state', { matchId: matchId });
        });

        socket.on('disconnect', function() {
            console.log('ÏÑúÎ≤ÑÏôÄÏùò Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§.');
            updateConnectionStatus(false);
        });
        
        // ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú ÏùëÎãµ Ïù¥Î≤§Ìä∏
        socket.on('goalsLoaded', function(data) {
            console.log('=== ÏÑúÎ≤ÑÏóêÏÑú ÎìùÏ†ê Ï†ïÎ≥¥ ÏàòÏã† ===');
            console.log('ÏàòÏã†Îêú ÎìùÏ†ê Ï†ïÎ≥¥:', data);
            
            if (data.goals) {
                // ÌôàÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥Î•º Î∞∞Ïó¥Ïóê Ï†ÄÏû•
                homeGoals = [];
                if (data.goals.home && data.goals.home.length > 0) {
                    data.goals.home.forEach((goal, index) => {
                        const goalId = `home_goal_${++goalIdCounter}`;
                        homeGoals.push({
                            id: goalId,
                            player: goal.player,
                            time: goal.time
                        });
                    });
                }
                
                // Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥Î•º Î∞∞Ïó¥Ïóê Ï†ÄÏû•
                awayGoals = [];
                if (data.goals.away && data.goals.away.length > 0) {
                    data.goals.away.forEach((goal, index) => {
                        const goalId = `away_goal_${++goalIdCounter}`;
                        awayGoals.push({
                            id: goalId,
                            player: goal.player,
                            time: goal.time
                        });
                    });
                }
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                renderHomeGoalsList();
                renderAwayGoalsList();
                
                console.log('‚úÖ ÎìùÏ†ê Ï†ïÎ≥¥ UI ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
            } else {
                console.log('Ï†ÄÏû•Îêú ÎìùÏ†ê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
                homeGoals = [];
                awayGoals = [];
                renderHomeGoalsList();
                renderAwayGoalsList();
            }
        });
        
        // Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏùëÎãµ Ïù¥Î≤§Ìä∏
        socket.on('matchDataLoaded', function(data) {
            console.log('=== ÏÑúÎ≤ÑÏóêÏÑú Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏàòÏã† ===');
            console.log('ÏàòÏã†Îêú Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data) {
                // Ï†êÏàò Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                if (data.home_score !== undefined) {
                    document.getElementById('home-score').value = data.home_score;
                    console.log('ÌôàÌåÄ Ï†êÏàò Î°úÎìú:', data.home_score);
                }
                if (data.away_score !== undefined) {
                    document.getElementById('away-score').value = data.away_score;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ï†êÏàò Î°úÎìú:', data.away_score);
                }
                
                // ÌåÄÎ™Ö Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                if (data.home_team) {
                    document.getElementById('home-team-name').value = data.home_team;
                    console.log('ÌôàÌåÄ Ïù¥Î¶Ñ Î°úÎìú:', data.home_team);
                }
                if (data.away_team) {
                    document.getElementById('away-team-name').value = data.away_team;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ïù¥Î¶Ñ Î°úÎìú:', data.away_team);
                }
                
                // ÌåÄ Ïª¨Îü¨ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                if (data.home_team_color) {
                    document.getElementById('home-team-color').value = data.home_team_color;
                    console.log('ÌôàÌåÄ Ïª¨Îü¨ Î°úÎìú:', data.home_team_color);
                }
                if (data.away_team_color) {
                    document.getElementById('away-team-color').value = data.away_team_color;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ïª¨Îü¨ Î°úÎìú:', data.away_team_color);
                }
                
                console.log('‚úÖ Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ UI ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
            } else {
                console.log('Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
            }
        });
        
        // ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• ÏÑ±Í≥µ ÏùëÎãµ Ïù¥Î≤§Ìä∏
        socket.on('goalsSaved', function(data) {
            console.log('=== ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• ÏÑ±Í≥µ ===');
            console.log('ÏÑúÎ≤Ñ ÏùëÎãµ:', data);
            if (data.success) {
                console.log('‚úÖ ÎìùÏ†ê Ï†ïÎ≥¥ DB Ï†ÄÏû• ÏôÑÎ£å');
            }
        });
        
        // ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• Ïã§Ìå® ÏùëÎãµ Ïù¥Î≤§Ìä∏
        socket.on('goalsSaveError', function(data) {
            console.error('=== ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• Ïã§Ìå® ===');
            console.error('ÏÑúÎ≤Ñ Ïò§Î•ò:', data.error);
            alert('ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + data.error);
        });

        // ÏÉàÎ°úÏö¥ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú v2 ÌÜ†Í∏Ä
        function toggleTimerV2() {
            const isV2Enabled = document.getElementById('timer-v2-toggle').checked;
            const newMode = isV2Enabled ? 'server-timer' : 'legacy-timer';
            
            console.log('=== ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú v2 ÌÜ†Í∏Ä ===');
            console.log('V2 ÌôúÏÑ±Ìôî:', isV2Enabled);
            console.log('ÏÉàÎ°úÏö¥ Î™®Îìú:', newMode);
            
            // ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ Î™®Îìú ÏóÖÎç∞Ïù¥Ìä∏
            currentTimerMode = newMode;
            
            // ÌÉÄÏù¥Î®∏ Î™®Îìú Î≥ÄÍ≤Ω Ïãú Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ
            if (newMode === 'server-timer') {
                console.log('ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Î™®ÎìúÎ°ú Î≥ÄÍ≤Ω - Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ');
                stopLocalTimer();
                timerState.isRunning = false;
                timerState.startTime = null;
                timerState.pausedTime = 0;
                timerState.currentSeconds = 0;
                updateTimerDisplay();
                saveTimerState();
            } else if (newMode === 'legacy-timer') {
                console.log('Î°úÏª¨ÌÉÄÏù¥Î®∏ Î™®ÎìúÎ°ú Î≥ÄÍ≤Ω - ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ');
                // ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ ÏöîÏ≤≠
                socket.emit('server_timer_control', {
                    matchId: matchId,
                    action: 'stop'
                });
            }
            
            // ÏÑúÎ≤ÑÏóê ÌÉÄÏù¥Î®∏ Î™®Îìú Î≥ÄÍ≤Ω ÏöîÏ≤≠
            socket.emit('timer_mode_change', { 
                matchId: matchId, 
                newMode: newMode 
            });
            
            console.log('ÌÉÄÏù¥Î®∏ Î™®Îìú Î≥ÄÍ≤Ω ÏöîÏ≤≠ Ï†ÑÏÜ°:', newMode);
        }

        // ÌÉÄÏù¥Î®∏ ÏãúÏûë (Î™®ÎìúÏóê Îî∞Î•∏ Î∂ÑÍ∏∞ Ï≤òÎ¶¨)
        function startTimer() {
            console.log('=== ÌÉÄÏù¥Î®∏ ÏãúÏûë ===');
            console.log('matchId:', matchId);
            console.log('ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ Î™®Îìú:', currentTimerMode);
            
            if (currentTimerMode === 'server-timer') {
                // ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Î™®Îìú
                console.log('ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ ÏãúÏûë ÏöîÏ≤≠');
                socket.emit('server_timer_control', {
                    matchId: matchId,
                    action: 'start'
                });
            } else {
                // Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î™®Îìú
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûë');
                if (!timerState.isRunning) {
                    timerState.isRunning = true;
                    timerState.startTime = Date.now();
                    
                    // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûë
                    startLocalTimer();
                    
                    // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû•
                    saveTimerState();
                    
                    // Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏóê Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÑÏÜ°
                    socket.emit('local_timer_update', {
                        matchId: matchId,
                        currentSeconds: timerState.currentSeconds,
                        isRunning: timerState.isRunning,
                        startTime: timerState.startTime,
                        pausedTime: timerState.pausedTime
                    });
                    
                    console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûëÎê®:', {
                        startTime: timerState.startTime,
                        pausedTime: timerState.pausedTime,
                        isRunning: timerState.isRunning
                    });
                }
            }
        }

        // ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ (Î™®ÎìúÏóê Îî∞Î•∏ Î∂ÑÍ∏∞ Ï≤òÎ¶¨)
        function stopTimer() {
            console.log('=== ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ ===');
            console.log('matchId:', matchId);
            console.log('ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ Î™®Îìú:', currentTimerMode);
            
            if (currentTimerMode === 'server-timer') {
                // ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Î™®Îìú
                console.log('ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ ÏöîÏ≤≠');
                socket.emit('server_timer_control', {
                    matchId: matchId,
                    action: 'stop'
                });
            } else {
                // Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î™®Îìú
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ');
                if (timerState.isRunning) {
                    timerState.isRunning = false;
                    const currentTime = Math.floor((Date.now() - timerState.startTime) / 1000);
                    timerState.pausedTime += currentTime;
                    
                    // Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ
                    stopLocalTimer();
                    
                    // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû•
                    saveTimerState();
                    
                    // Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏóê Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÑÏÜ°
                    socket.emit('local_timer_update', {
                        matchId: matchId,
                        currentSeconds: timerState.currentSeconds,
                        isRunning: timerState.isRunning,
                        startTime: timerState.startTime,
                        pausedTime: timerState.pausedTime
                    });
                    
                    console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄÎê®:', {
                        pausedTime: timerState.pausedTime,
                        isRunning: timerState.isRunning
                    });
                }
            }
        }

        // ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã (Î™®ÎìúÏóê Îî∞Î•∏ Î∂ÑÍ∏∞ Ï≤òÎ¶¨)
        function resetTimer() {
            console.log('=== ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã ===');
            console.log('matchId:', matchId);
            console.log('ÌòÑÏû¨ ÌÉÄÏù¥Î®∏ Î™®Îìú:', currentTimerMode);
            
            if (currentTimerMode === 'server-timer') {
                // ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Î™®Îìú
                console.log('ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã ÏöîÏ≤≠');
                socket.emit('server_timer_control', {
                    matchId: matchId,
                    action: 'reset'
                });
            } else {
                // Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î™®Îìú
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã');
                timerState.isRunning = false;
                timerState.currentSeconds = 0;
                timerState.startTime = Date.now();
                timerState.pausedTime = 0;
                
                // Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ
                stopLocalTimer();
                updateTimerDisplay();
                
                // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû•
                saveTimerState();
                
                // Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏóê Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÑÏÜ°
                socket.emit('local_timer_update', {
                    matchId: matchId,
                    currentSeconds: timerState.currentSeconds,
                    isRunning: timerState.isRunning,
                    startTime: timerState.startTime,
                    pausedTime: timerState.pausedTime
                });
                
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î¶¨ÏÖãÎê®:', {
                    startTime: timerState.startTime,
                    pausedTime: timerState.pausedTime,
                    isRunning: timerState.isRunning
                });
            }
        }

        // ÏãúÍ∞Ñ ÏàòÏ†ï ÌÜ†Í∏Ä (Í∏∞Ï°¥ Î∞©Ïãù)
        function toggleTimeEdit() {
            console.log('=== ÏãúÍ∞Ñ ÏàòÏ†ï ÌÜ†Í∏Ä ===');
            const timeEditContainer = document.getElementById('time-edit-container');
            const timeEditInput = document.getElementById('time-edit-input');
            
            // ÌòÑÏû¨ ÏãúÍ∞ÑÏùÑ 00:00 ÌòïÏãùÏúºÎ°ú ÏÑ§Ï†ï
            const minutes = Math.floor(timerState.currentSeconds / 60);
            const seconds = timerState.currentSeconds % 60;
            timeEditInput.value = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú/Ïà®ÍπÄ ÌÜ†Í∏Ä
            if (timeEditContainer.style.display === 'none') {
                timeEditContainer.style.display = 'block';
                timeEditInput.focus();
                timeEditInput.select();
            } else {
                timeEditContainer.style.display = 'none';
            }
        }
        

        // Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ìï®Ïàò (WebSocket Î∞©Ïãù)
        function loadMatchData() {
            try {
                console.log('=== Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë (WebSocket Î∞©Ïãù) ===');
                console.log('matchId:', matchId);
                
                // WebSocketÏùÑ ÌÜµÌï¥ ÏÑúÎ≤ÑÏóêÏÑú Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏöîÏ≤≠
                socket.emit('loadMatchData', {
                    matchId: matchId
                });
                
                console.log('‚úÖ Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏöîÏ≤≠ Ï†ÑÏÜ° ÏôÑÎ£å');
            } catch (error) {
                console.error('Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
            }
        }

        // ÌÉÄÏù¥Î®∏ ÎîîÏä§ÌîåÎ†àÏù¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateTimerDisplay(overrideSeconds = null) {
            // ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ Î™®ÎìúÏùº ÎïåÎäî Ï†ÑÎã¨Î∞õÏùÄ Í∞íÏùÑ ÏÇ¨Ïö©, Í∑∏Î†áÏßÄ ÏïäÏúºÎ©¥ timerState ÏÇ¨Ïö©
            const targetSeconds = overrideSeconds !== null ? overrideSeconds : timerState.currentSeconds;
            
            // NaN Í∞í Î∞©ÏßÄ Î∞è Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            let safeSeconds = 0;
            if (typeof targetSeconds === 'number' && !isNaN(targetSeconds) && isFinite(targetSeconds)) {
                safeSeconds = Math.max(0, targetSeconds);
            }
            
            const minutes = Math.floor(safeSeconds / 60);
            const seconds = safeSeconds % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû• Ìï®Ïàò (Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ + DB Ï†ÄÏû•)
        function saveTimerState() {
            const stateToSave = {
                currentSeconds: timerState.currentSeconds,
                isRunning: timerState.isRunning,
                startTime: timerState.startTime,
                pausedTime: timerState.pausedTime,
                lastSaveTime: Date.now()
            };
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            localStorage.setItem(`timer_state_${matchId}`, JSON.stringify(stateToSave));
            console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû•Îê® (localStorage):', stateToSave);
            
            // ÏÑúÎ≤ÑÏóê Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû• ÏöîÏ≤≠
            socket.emit('save_local_timer_state', {
                matchId: matchId,
                timerState: stateToSave
            });
        }

        // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûë (Î∞±ÏóÖ Ìè¥ÎçîÏùò ÏòàÏ†Ñ Î∞©Ïãù - ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ÏôÄ ÏôÑÏ†Ñ ÎèÖÎ¶Ω)
        function startLocalTimer() {
            if (timerState.localTimer) {
                clearInterval(timerState.localTimer);
            }
            
            timerState.localTimer = setInterval(() => {
                if (timerState.isRunning) {
                    const now = Date.now();
                    const elapsed = Math.floor((now - timerState.startTime) / 1000);
                    timerState.currentSeconds = timerState.pausedTime + elapsed;
                    updateTimerDisplay();
                    
                    // Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏóê Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï£ºÍ∏∞Ï†Å Ï†ÑÏÜ° (1Ï¥àÎßàÎã§)
                    socket.emit('local_timer_update', {
                        matchId: matchId,
                        currentSeconds: timerState.currentSeconds,
                        isRunning: timerState.isRunning,
                        startTime: timerState.startTime,
                        pausedTime: timerState.pausedTime
                    });
                }
            }, 1000);
            
            console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûëÎê® (ÎèÖÎ¶Ω Î™®Îìú):', {
                startTime: timerState.startTime,
                pausedTime: timerState.pausedTime,
                isRunning: timerState.isRunning
            });
        }

        // Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ
        function stopLocalTimer() {
            if (timerState.localTimer) {
                clearInterval(timerState.localTimer);
                timerState.localTimer = null;
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄÎê®');
            }
        }

        // Ïó∞Í≤∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connection-indicator');
            const text = document.getElementById('connection-text');
            
            if (connected) {
                indicator.className = 'status-indicator connected';
                text.textContent = 'ÏÑúÎ≤Ñ Ïó∞Í≤∞Îê®';
            } else {
                indicator.className = 'status-indicator disconnected';
                text.textContent = 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÎÅäÍπÄ';
            }
        }

        // ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ìï®Ïàò
        async function swapTeams() {
            if (!confirm('ÌôàÌåÄÍ≥º Ïñ¥Ïõ®Ïù¥ÌåÄÏùò Ï†ïÎ≥¥Î•º ÏÑúÎ°ú Î∞îÍæ∏ÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }
            
            try {
                console.log('=== ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω ÏãúÏûë ===');
                
                // ÏÑúÎ≤ÑÏóê ÏúÑÏπò Î≥ÄÍ≤Ω ÏöîÏ≤≠
                const response = await fetch(`/api/matches/${matchId}/swap-teams`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ïã§Ìå®');
                }
                
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ïã§Ìå®');
                }
                
                console.log('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω API Ìò∏Ï∂ú ÏÑ±Í≥µ');
                
                // Ï¶âÏãú UI ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉàÎ°úÍ≥†Ïπ® ÏóÜÏù¥)
                await updateTeamsAfterSwap();
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                alert('ÌåÄ ÏúÑÏπòÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.');
                
                console.log('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω ÏôÑÎ£å');
                
            } catch (error) {
                console.error('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
                alert('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // ÏäπÎ∂ÄÏ∞®Í∏∞ Ï†êÏàò Í¥ÄÎ¶¨
        let currentPenaltyText = '0 (ÏäπÎ∂ÄÏ∞®Í∏∞) 0';
        
        function updatePenaltyScore(team, change) {
            console.log('=== ÏäπÎ∂ÄÏ∞®Í∏∞ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏ (Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ) ===');
            console.log('team:', team, 'change:', change);
            
            // Ï†ïÍ∑úÏãùÏúºÎ°ú ÌôàÌåÄÍ≥º Ïñ¥Ïõ®Ïù¥ÌåÄ Ï†êÏàò Ï∂îÏ∂ú
            const match = currentPenaltyText.match(/(\d+)\s*\(ÏäπÎ∂ÄÏ∞®Í∏∞\)\s*(\d+)/);
            if (!match) {
                console.log('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌòïÏãùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            let homeScore = parseInt(match[1]);
            let awayScore = parseInt(match[2]);
            
            // Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏
            if (team === 'home') {
                homeScore = Math.max(0, homeScore + change);
            } else if (team === 'away') {
                awayScore = Math.max(0, awayScore + change);
            }
            
            console.log('ÏóÖÎç∞Ïù¥Ìä∏Îêú Ï†êÏàò - Ìôà:', homeScore, 'Ïñ¥Ïõ®Ïù¥:', awayScore);
            
            // ÏÉàÎ°úÏö¥ ÌÖçÏä§Ìä∏ ÏÉùÏÑ±
            const newText = `${homeScore} (ÏäπÎ∂ÄÏ∞®Í∏∞) ${awayScore}`;
            console.log('ÏÉàÎ°úÏö¥ ÌÖçÏä§Ìä∏:', newText);
            
            // ÌòÑÏû¨ ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            currentPenaltyText = newText;
            document.getElementById('penalty-text-display').textContent = newText;
            
            // ÏÑúÎ≤ÑÏóê Ï†ÄÏû• (Î™®Î∞îÏùºÍ≥º ÎèôÏùº)
            savePenaltyScoreToServer(newText);
            
            // Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî (Î™®Î∞îÏùºÍ≥º ÎèôÏùº)
            socket.emit('updateExtraBoxText', {
                matchId: matchId,
                text: newText
            });
            
            console.log('ÏäπÎ∂ÄÏ∞®Í∏∞ Ï†êÏàò Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ï†ÄÏû• ÏôÑÎ£å');
        }

        // ÏäπÎ∂ÄÏ∞®Í∏∞ ÏÑúÎ≤Ñ Ï†ÄÏû• Ìï®Ïàò (Î™®Î∞îÏùºÍ≥º ÎèôÏùº)
        async function savePenaltyScoreToServer(text) {
            try {
                console.log('=== ÏäπÎ∂ÄÏ∞®Í∏∞ ÏÑúÎ≤Ñ Ï†ÄÏû• ===');
                const response = await fetch('/api/extra-box-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        matchId: matchId,
                        sportType: 'soccer',
                        text: text
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    console.log('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ ÏÑúÎ≤Ñ Ï†ÄÏû• ÏôÑÎ£å:', text);
            } else {
                    console.error('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ ÏÑúÎ≤Ñ Ï†ÄÏû• Ïã§Ìå®:', data.error);
                }
            } catch (error) {
                console.error('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ ÏÑúÎ≤Ñ Ï†ÄÏû• Ïò§Î•ò:', error);
            }
        }


        // ÏäπÎ∂ÄÏ∞®Í∏∞ ÌëúÏãú ÌÜ†Í∏Ä Ìï®Ïàò (Î™®Î∞îÏùº Ïª®Ìä∏Î°§Í≥º ÎèôÏùº)
        function togglePenaltyDisplay() {
            console.log('=== ÏäπÎ∂ÄÏ∞®Í∏∞ ÌëúÏãú ÌÜ†Í∏Ä Î≤ÑÌäº ÌÅ¥Î¶≠ ===');
            
            // ÏÑúÎ≤ÑÏóê ÏäπÎ∂ÄÏ∞®Í∏∞ ÌëúÏãú ÌÜ†Í∏Ä ÏöîÏ≤≠
            socket.emit('toggleExtraBox', {
                matchId: matchId
            });
            
            // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω ÌîºÎìúÎ∞±
            const toggleButton = event.target.closest('button');
            const originalHTML = toggleButton.innerHTML;
            
            if (toggleButton.innerHTML.includes('ÌëúÏãú')) {
                toggleButton.innerHTML = '<i class="bi bi-eye-slash"></i> Ïà®ÍπÄ';
                toggleButton.classList.remove('btn-info');
                toggleButton.classList.add('btn-warning');
            } else {
                toggleButton.innerHTML = '<i class="bi bi-eye"></i> ÌëúÏãú';
                toggleButton.classList.remove('btn-warning');
                toggleButton.classList.add('btn-info');
            }
            
            console.log('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌëúÏãú ÌÜ†Í∏Ä ÏöîÏ≤≠ Ï†ÑÏÜ° ÏôÑÎ£å');
        }

        // ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ Î°úÎìú Ìï®Ïàò
        async function loadPenaltyText() {
            try {
                console.log('=== ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ Î°úÎìú ÏãúÏûë ===');
                
                const response = await fetch(`/api/extra-box-text/soccer/${matchId}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.text) {
                        currentPenaltyText = data.text;
                        document.getElementById('penalty-text-display').textContent = data.text;
                        console.log('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ Î°úÎìú ÏÑ±Í≥µ:', data.text);
            } else {
                        console.log('Ï†ÄÏû•Îêú ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§. Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©');
                    }
            } else {
                    console.log('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ Î°úÎìú Ïã§Ìå®, Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©');
                    }
                } catch (error) {
                console.error('ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ Î°úÎìú Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
            }
        }

        // ÎåÄÌöåÎ™Ö Î°úÎìú Ìï®Ïàò
        async function loadTournamentText() {
            try {
                console.log('=== ÎåÄÌöåÎ™Ö Î°úÎìú ÏãúÏûë ===');
                console.log('matchId:', matchId);
                console.log('API URL:', `/api/tournament-text/${matchId}`);
                
                const response = await fetch(`/api/tournament-text/${matchId}`);
                console.log('API ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('API ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:', data);
                    
                    if (data.success && data.tournamentText !== undefined) {
                        const tournamentTextElement = document.getElementById('tournamentText');
                        console.log('ÎåÄÌöåÎ™Ö ÌÖçÏä§Ìä∏ Î∞ïÏä§ ÏóòÎ¶¨Î®ºÌä∏:', tournamentTextElement);
                        
                        if (tournamentTextElement) {
                            tournamentTextElement.value = data.tournamentText || '';
                            console.log('ÎåÄÌöåÎ™Ö Î°úÎìú ÏÑ±Í≥µ:', data.tournamentText);
                            console.log('ÌÖçÏä§Ìä∏ Î∞ïÏä§ Í∞í ÏÑ§Ï†ï ÌõÑ:', tournamentTextElement.value);
                        } else {
                            console.error('ÎåÄÌöåÎ™Ö ÌÖçÏä§Ìä∏ Î∞ïÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        }
                    } else {
                        console.log('Ï†ÄÏû•Îêú ÎåÄÌöåÎ™ÖÏù¥ ÏóÜÏäµÎãàÎã§. ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:', data);
                    }
                } else {
                    console.log('ÎåÄÌöåÎ™Ö Î°úÎìú Ïã§Ìå®. ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                    const errorText = await response.text();
                    console.log('Ïò§Î•ò ÏùëÎãµ:', errorText);
                }
            } catch (error) {
                console.error('ÎåÄÌöåÎ™Ö Î°úÎìú Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
            }
        }

        // ÎìùÏ†ê Ï†ïÎ≥¥ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        let homeGoals = [];
        let awayGoals = [];
        let goalIdCounter = 0;

        // ÌôàÌåÄ ÎìùÏ†ê Ï∂îÍ∞Ä (ÏÉàÎ°úÏö¥ ÏûÖÎ†• Î∞©Ïãù)
        async function addHomeGoalFromInput() {
            const playerInput = document.getElementById('home-player-input');
            const timeInput = document.getElementById('home-time-input');
            
            const player = playerInput.value.trim();
            const time = timeInput.value.trim();
            
            if (!player || !time) {
                alert('ÏÑ†Ïàò Ïù¥Î¶ÑÍ≥º ÏãúÍ∞ÑÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const goalId = `home_goal_${++goalIdCounter}`;
            const goal = { id: goalId, player, time };
            
            homeGoals.push(goal);
            renderHomeGoalsList();
            
            // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            playerInput.value = '';
            timeInput.value = '';
            
            console.log('ÌôàÌåÄ ÎìùÏ†ê Ï∂îÍ∞Ä:', goal);
            
            // ÏûêÎèôÏúºÎ°ú ÏÑúÎ≤ÑÏóê Ï†ÄÏû•
            await saveGoalsToServer();
        }

        // Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï∂îÍ∞Ä (ÏÉàÎ°úÏö¥ ÏûÖÎ†• Î∞©Ïãù)
        async function addAwayGoalFromInput() {
            const playerInput = document.getElementById('away-player-input');
            const timeInput = document.getElementById('away-time-input');
            
            const player = playerInput.value.trim();
            const time = timeInput.value.trim();
            
            if (!player || !time) {
                alert('ÏÑ†Ïàò Ïù¥Î¶ÑÍ≥º ÏãúÍ∞ÑÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const goalId = `away_goal_${++goalIdCounter}`;
            const goal = { id: goalId, player, time };
            
            awayGoals.push(goal);
            renderAwayGoalsList();
            
            // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            playerInput.value = '';
            timeInput.value = '';
            
            console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï∂îÍ∞Ä:', goal);
            
            // ÏûêÎèôÏúºÎ°ú ÏÑúÎ≤ÑÏóê Ï†ÄÏû•
            await saveGoalsToServer();
        }
        
        // ÌôàÌåÄ ÎìùÏ†ê Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ
        function renderHomeGoalsList() {
            const container = document.getElementById('home-goals-list');
            container.innerHTML = '';
            
            if (homeGoals.length === 0) {
                container.innerHTML = '<div class="text-muted text-center py-3">Îì±Î°ùÎêú ÎìùÏ†êÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            homeGoals.forEach(goal => {
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';
                goalItem.innerHTML = `
                    <input type="text" class="form-control goal-player-input" value="${goal.player}" 
                           data-goal-id="${goal.id}" data-field="player" placeholder="ÏÑ†Ïàò Ïù¥Î¶Ñ">
                    <input type="text" class="form-control goal-time-input" value="${goal.time}" 
                           data-goal-id="${goal.id}" data-field="time" placeholder="ÏãúÍ∞Ñ">
                    <button class="btn btn-outline-danger btn-sm" onclick="removeHomeGoal('${goal.id}')">
                        <i class="bi bi-trash"></i>
                    </button>
                `;
                container.appendChild(goalItem);
            });
            
            // Ìé∏Ïßë Í∞ÄÎä•Ìïú ÏûÖÎ†• ÌïÑÎìúÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            addGoalEditListeners();
        }
        
        // Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ
        function renderAwayGoalsList() {
            const container = document.getElementById('away-goals-list');
            container.innerHTML = '';
            
            if (awayGoals.length === 0) {
                container.innerHTML = '<div class="text-muted text-center py-3">Îì±Î°ùÎêú ÎìùÏ†êÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            awayGoals.forEach(goal => {
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';
                goalItem.innerHTML = `
                    <input type="text" class="form-control goal-player-input" value="${goal.player}" 
                           data-goal-id="${goal.id}" data-field="player" placeholder="ÏÑ†Ïàò Ïù¥Î¶Ñ">
                    <input type="text" class="form-control goal-time-input" value="${goal.time}" 
                           data-goal-id="${goal.id}" data-field="time" placeholder="ÏãúÍ∞Ñ">
                    <button class="btn btn-outline-danger btn-sm" onclick="removeAwayGoal('${goal.id}')">
                        <i class="bi bi-trash"></i>
                    </button>
                `;
                container.appendChild(goalItem);
            });
            
            // Ìé∏Ïßë Í∞ÄÎä•Ìïú ÏûÖÎ†• ÌïÑÎìúÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            addGoalEditListeners();
        }
        
        // ÌôàÌåÄ ÎìùÏ†ê Ï†úÍ±∞
        async function removeHomeGoal(goalId) {
            homeGoals = homeGoals.filter(goal => goal.id !== goalId);
            renderHomeGoalsList();
            console.log('ÌôàÌåÄ ÎìùÏ†ê Ï†úÍ±∞:', goalId);
            
            // ÏûêÎèôÏúºÎ°ú ÏÑúÎ≤ÑÏóê Ï†ÄÏû•
            await saveGoalsToServer();
        }
        
        // Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï†úÍ±∞
        async function removeAwayGoal(goalId) {
            awayGoals = awayGoals.filter(goal => goal.id !== goalId);
            renderAwayGoalsList();
            console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï†úÍ±∞:', goalId);
            
            // ÏûêÎèôÏúºÎ°ú ÏÑúÎ≤ÑÏóê Ï†ÄÏû•
            await saveGoalsToServer();
        }

        // ÎìùÏ†ê Ï†ïÎ≥¥ ÏàòÏßë (ÏÉàÎ°úÏö¥ Î∞©Ïãù)
        function collectGoals() {
            // Ïù¥ÎØ∏ homeGoals, awayGoals Î∞∞Ïó¥Ïóê Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏùå
            console.log('ÏàòÏßëÎêú ÌôàÌåÄ ÎìùÏ†ê:', homeGoals);
            console.log('ÏàòÏßëÎêú Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê:', awayGoals);
        }
        
        // Ìé∏Ïßë Í∞ÄÎä•Ìïú ÏûÖÎ†• ÌïÑÎìúÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
        function addGoalEditListeners() {
            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞ (Ï§ëÎ≥µ Î∞©ÏßÄ)
            document.querySelectorAll('.goal-player-input, .goal-time-input').forEach(input => {
                input.removeEventListener('blur', handleGoalEdit);
                input.removeEventListener('keypress', handleGoalKeypress);
            });
            
            // ÏÉàÎ°úÏö¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            document.querySelectorAll('.goal-player-input, .goal-time-input').forEach(input => {
                input.addEventListener('blur', handleGoalEdit);
                input.addEventListener('keypress', handleGoalKeypress);
            });
        }
        
        // ÎìùÏ†ê Ï†ïÎ≥¥ Ìé∏Ïßë Ï≤òÎ¶¨
        async function handleGoalEdit(event) {
            const input = event.target;
            const goalId = input.getAttribute('data-goal-id');
            const field = input.getAttribute('data-field');
            const newValue = input.value.trim();
            
            console.log(`ÎìùÏ†ê Ï†ïÎ≥¥ Ìé∏Ïßë: ${goalId} - ${field} = ${newValue}`);
            
            // ÌôàÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            const homeGoal = homeGoals.find(goal => goal.id === goalId);
            if (homeGoal) {
                homeGoal[field] = newValue;
                console.log('ÌôàÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏:', homeGoal);
                await saveGoalsToServer();
                return;
            }
            
            // Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            const awayGoal = awayGoals.find(goal => goal.id === goalId);
            if (awayGoal) {
                awayGoal[field] = newValue;
                console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏:', awayGoal);
                await saveGoalsToServer();
                return;
            }
        }
        
        // ÏóîÌÑ∞ ÌÇ§ Ï≤òÎ¶¨
        function handleGoalKeypress(event) {
            if (event.key === 'Enter') {
                event.target.blur(); // Ìè¨Ïª§Ïä§ Ìï¥Ï†úÌïòÏó¨ ÏûêÎèô Ï†ÄÏû• Ìä∏Î¶¨Í±∞
            }
        }

        // ÎìùÏ†ê Ï†ïÎ≥¥ ÏÑúÎ≤Ñ Ï†ÄÏû•
        async function saveGoalsToServer() {
            try {
                console.log('=== ÎìùÏ†ê Ï†ïÎ≥¥ ÏÑúÎ≤Ñ Ï†ÄÏû• ÏãúÏûë ===');
                
                // ÎìùÏ†ê Ï†ïÎ≥¥ ÏàòÏßë
                collectGoals();
                
                // WebSocketÏùÑ ÌÜµÌï¥ ÏÑúÎ≤ÑÏóê ÏßÅÏ†ë ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• ÏöîÏ≤≠
                console.log('=== WebSocketÏùÑ ÌÜµÌïú ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• ===');
                console.log('ÌôàÌåÄ ÎìùÏ†ê:', homeGoals);
                console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ ÎìùÏ†ê:', awayGoals);
                
                // WebSocket Ïù¥Î≤§Ìä∏Î°ú ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• ÏöîÏ≤≠
                socket.emit('saveGoals', {
                    matchId: matchId,
                    homeGoals: homeGoals,
                    awayGoals: awayGoals
                });
                
                console.log('‚úÖ ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• ÏöîÏ≤≠ Ï†ÑÏÜ° ÏôÑÎ£å');
            } catch (error) {
                console.error('ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• Ï§ë Ïò§Î•ò:', error);
                alert('ÎìùÏ†ê Ï†ïÎ≥¥ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Ï†ÄÏû•Îêú ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú (DBÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞)
        async function loadGoalsFromServer() {
            try {
                console.log('=== Ï†ÄÏû•Îêú ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú ÏãúÏûë ===');
                
                // WebSocketÏùÑ ÌÜµÌï¥ ÏÑúÎ≤ÑÏóêÏÑú ÎìùÏ†ê Ï†ïÎ≥¥ ÏöîÏ≤≠
                console.log('=== WebSocketÏùÑ ÌÜµÌïú ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú ===');
                
                // WebSocket Ïù¥Î≤§Ìä∏Î°ú ÎìùÏ†ê Ï†ïÎ≥¥ ÏöîÏ≤≠
                socket.emit('loadGoals', {
                    matchId: matchId
                });
                
                console.log('‚úÖ ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú ÏöîÏ≤≠ Ï†ÑÏÜ° ÏôÑÎ£å');
            } catch (error) {
                console.error('ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú Ï§ë Ïò§Î•ò:', error);
                homeGoals = [];
                awayGoals = [];
                renderHomeGoalsList();
                renderAwayGoalsList();
            }
        }

        // Í∑∏ÎûòÌîΩ ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleGraphic(graphicType) {
            console.log(`=== Í∑∏ÎûòÌîΩ ÌÜ†Í∏Ä: ${graphicType} ===`);
            
            // graphicTypeÏóê Îî∞Îùº Ïò¨Î∞îÎ•∏ Î≤ÑÌäº ID Îß§Ìïë
            let buttonId;
            switch (graphicType) {
                case 'top-scoreboard':
                    buttonId = 'toggle-top-scoreboard';
                    break;
                case 'vs':
                    buttonId = 'toggle-vs-graphic';
                    break;
                case 'bottom-strip':
                    buttonId = 'toggle-bottom-strip';
                    break;
                default:
                    console.error('Ïïå Ïàò ÏóÜÎäî Í∑∏ÎûòÌîΩ ÌÉÄÏûÖ:', graphicType);
                    return;
            }
            
            const button = document.getElementById(buttonId);
            if (!button) {
                console.error(`Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§: ${buttonId}`);
                return;
            }
            
            const isVisible = button.classList.contains('btn-success');
            const newState = !isVisible;
            
            console.log('ÌòÑÏû¨ ÏÉÅÌÉú:', isVisible ? 'ÌëúÏãú' : 'Ïà®ÍπÄ');
            console.log('ÏÉàÎ°úÏö¥ ÏÉÅÌÉú:', newState ? 'ÌëúÏãú' : 'Ïà®ÍπÄ');
            
            // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            if (newState) {
                button.classList.remove('btn-outline-secondary');
                button.classList.add('btn-success');
                button.innerHTML = `<i class="bi bi-eye"></i> ${getGraphicName(graphicType)}`;
            } else {
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-secondary');
                button.innerHTML = `<i class="bi bi-eye-slash"></i> ${getGraphicName(graphicType)}`;
            }
            
            // WebSocket Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°
            const eventData = {
                matchId: matchId,
                graphicType: graphicType,
                visible: newState
            };
            
            // VS Í∑∏ÎûòÌîΩÏù¥ÎÇò ÌïòÎã® Ïä§Ìä∏Î¶ΩÏù¥ ÌëúÏãúÎê† Îïå ÎåÄÌöåÎ™Ö ÏûêÎèô Ï†ÅÏö©
            if ((graphicType === 'vs' || graphicType === 'bottom-strip') && newState) {
                console.log(`=== ${graphicType} ÌÜ†Í∏Ä: ÎåÄÌöåÎ™Ö ÏûêÎèô Ï†ÅÏö© ===`);
                applyTournamentTextAutomatically();
            }
            
            // ÌïòÎã® Ïä§Ìä∏Î¶ΩÏùò Í≤ΩÏö∞ DBÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï†ÑÏÜ°
            if (graphicType === 'bottom-strip' && newState) {
                console.log('=== ÌïòÎã® Ïä§Ìä∏Î¶Ω ÌÜ†Í∏Ä: DBÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Î°úÎìú ===');
                
                // WebSocketÏùÑ ÌÜµÌï¥ ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ÏôÄ ÎìùÏ†ê Ï†ïÎ≥¥ ÏöîÏ≤≠
                socket.emit('loadMatchData', { matchId: matchId });
                socket.emit('loadGoals', { matchId: matchId });
                
                // ÏÑúÎ≤ÑÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∞õÏùÄ ÌõÑ ÌÜ†Í∏Ä Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°
                socket.once('matchDataLoaded', function(matchData) {
                    socket.once('goalsLoaded', function(goalsData) {
                        console.log('=== ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ ÏàòÏã† ÏôÑÎ£å ===');
                        console.log('Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞:', matchData);
                        console.log('ÎìùÏ†ê Ï†ïÎ≥¥:', goalsData);
                        
                        // ÏµúÏã† Ïä§ÏΩîÏñ¥ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                        if (matchData) {
                            eventData.score = {
                                home: matchData.home_score || 0,
                                away: matchData.away_score || 0
                            };
                        }
                        
                        // ÏµúÏã† ÎìùÏ†ê Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                        if (goalsData && goalsData.goals) {
                            eventData.goals = {
                                home: goalsData.goals.home || [],
                                away: goalsData.goals.away || []
                            };
                        } else {
                            eventData.goals = {
                                home: [],
                                away: []
                            };
                        }
                        
                        console.log('ÌïòÎã® Ïä§Ìä∏Î¶ΩÍ≥º Ìï®Íªò Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞:', eventData);
                        
                        // WebSocket Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°
                        socket.emit('toggleGraphic', eventData);
                        console.log(`‚úÖ Ïª®Ìä∏Î°§: Í∑∏ÎûòÌîΩ ÌÜ†Í∏Ä Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å: ${graphicType} = ${newState}`);
                    });
                });
                return; // Ïó¨Í∏∞ÏÑú Ìï®Ïàò Ï¢ÖÎ£å
            }
            
            console.log('=== Ïª®Ìä∏Î°§: WebSocket Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ===');
            console.log('socket.connected:', socket.connected);
            console.log('Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞:', eventData);
            console.log('Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏãúÍ∞Ñ:', new Date().toISOString());
            
            socket.emit('toggleGraphic', eventData);
            
            console.log(`‚úÖ Ïª®Ìä∏Î°§: Í∑∏ÎûòÌîΩ ÌÜ†Í∏Ä Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å: ${graphicType} = ${newState}`);
        }
        
        // Í∑∏ÎûòÌîΩ Ïù¥Î¶Ñ Î∞òÌôò Ìï®Ïàò
        function getGraphicName(graphicType) {
            const names = {
                'top-scoreboard': 'ÏÉÅÎã® Ïä§ÏΩîÏñ¥Î≥¥Îìú',
                'vs': 'VS Í∑∏ÎûòÌîΩ',
                'bottom-strip': 'ÌïòÎã® Ïä§Ìä∏Î¶Ω'
            };
            return names[graphicType] || graphicType;
        }

        // ÎåÄÌöåÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateTournamentText() {
            const tournamentText = document.getElementById('tournamentText').value.trim();
            console.log('=== ÎåÄÌöåÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ ===');
            console.log('ÏûÖÎ†•Îêú ÎåÄÌöåÎ™Ö:', tournamentText);
            
            if (!tournamentText) {
                alert('ÎåÄÌöåÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // WebSocketÏùÑ ÌÜµÌï¥ ÎåÄÌöåÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°
            socket.emit('updateTournamentText', {
                matchId: matchId,
                tournamentText: tournamentText
            });
            
            console.log('‚úÖ ÎåÄÌöåÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å');
        }

        // ÎåÄÌöåÎ™Ö ÏûêÎèô Ï†ÅÏö© Ìï®Ïàò
        function applyTournamentTextAutomatically() {
            const tournamentText = document.getElementById('tournamentText').value.trim();
            console.log('=== ÎåÄÌöåÎ™Ö ÏûêÎèô Ï†ÅÏö© ===');
            console.log('ÌòÑÏû¨ ÎåÄÌöåÎ™Ö:', tournamentText);
            
            if (tournamentText) {
                // WebSocketÏùÑ ÌÜµÌï¥ ÎåÄÌöåÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°
                socket.emit('updateTournamentText', {
                    matchId: matchId,
                    tournamentText: tournamentText
                });
                console.log('‚úÖ ÎåÄÌöåÎ™Ö ÏûêÎèô Ï†ÅÏö© ÏôÑÎ£å');
            } else {
                console.log('ÎåÄÌöåÎ™ÖÏù¥ ÎπÑÏñ¥ÏûàÏñ¥ ÏûêÎèô Ï†ÅÏö©ÌïòÏßÄ ÏïäÏùå');
            }
        }

        // ÌÉÄÏù¥Î®∏ ÏóÖÎç∞Ïù¥Ìä∏ Î£®ÌîÑ (ÏÑúÎ≤Ñ ÏãúÏûë ÏãúÍ∞Ñ Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÌôïÌïú Í≥ÑÏÇ∞)
        setInterval(() => {
                if (timerState.isRunning) {
                    // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ ÏãúÏûë ÏãúÍ∞ÑÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÌôïÌïú Í≥ÑÏÇ∞ (Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏôÄ ÎèôÏùºÌïú Î∞©Ïãù)
                    const currentTime = Date.now();
                    const elapsedTime = Math.floor((currentTime - timerState.startTime) / 1000);
                    timerState.currentSeconds = timerState.pausedTime + elapsedTime;
                    updateTimerDisplay();
                }
            }, 1000);

        // Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateScore(team, change) {
            console.log(`=== ${team}ÌåÄ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏ ===`);
            console.log('Î≥ÄÍ≤ΩÎüâ:', change);
            
            const scoreElement = document.getElementById(`${team}-score`);
            const currentScore = parseInt(scoreElement.value) || 0;
            const newScore = Math.max(0, currentScore + change);
            
            console.log('ÌòÑÏû¨ Ï†êÏàò:', currentScore, '‚Üí ÏÉàÎ°úÏö¥ Ï†êÏàò:', newScore);
            
            scoreElement.value = newScore;
            
            // Í∏∞Ï°¥ Î∞©ÏãùÍ≥º ÎèôÏùºÌïòÍ≤å emitScoreUpdate Ìï®Ïàò ÏÇ¨Ïö©
            emitScoreUpdate();
            
            console.log(`${team}ÌåÄ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å: ${newScore}`);
        }

        // Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° Ìï®Ïàò (Í∏∞Ï°¥ ÏΩîÎìúÏôÄ ÎèôÏùº)
        function emitScoreUpdate() {
            const homeScore = document.getElementById('home-score').value || '0';
            const awayScore = document.getElementById('away-score').value || '0';
            
            console.log('=== Ï†êÏàò Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ===');
            console.log('ÌòÑÏû¨ Ï†êÏàò:', { homeScore, awayScore });
            console.log('Î≥ÄÌôòÎêú Ï†êÏàò:', { homeScore: parseInt(homeScore), awayScore: parseInt(awayScore) });
            console.log('matchId:', matchId);
            
            // match_updated Ïù¥Î≤§Ìä∏Î°ú ÌÜµÏùº (Í∏∞Ï°¥ ÏΩîÎìúÏôÄ ÎèôÏùº)
            socket.emit('match_updated', {
                    matchId: matchId,
                home_score: parseInt(homeScore),
                away_score: parseInt(awayScore),
                state: 'Ï†ÑÎ∞ò'
            });
            
            console.log('Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å');
        }

        // ÌåÄÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏
        async function updateTeamName(team) {
            console.log(`=== ${team}ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ ===`);
            const nameInput = document.getElementById(`${team}-team-name`);
            const newName = nameInput.value;
            
            console.log('ÏÉàÎ°úÏö¥ ÌåÄÎ™Ö:', newName);
            
            try {
                // ÎùºÏö∞ÌÑ∞Ïóê Ï†ïÏùòÎêú Ïò¨Î∞îÎ•∏ API Ìò∏Ï∂ú
                const response = await fetch(`/api/matches/${matchId}/team-name`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        team: team,
                        teamName: newName
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log(`${team}ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ:`, result);
                    
                    // Ìó§Îçî Î†àÏù¥Î∏î Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                    console.log(`Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÎèÑ: ${team}ÌåÄ, ÏÉà Ïù¥Î¶Ñ: ${newName}`);
                    
                    // Í∞Å ÌåÄ ÏÑπÏÖòÏùò Ìó§ÎçîÎ•º ÏßÅÏ†ë ÏÑ†ÌÉù
                    let headerElement = null;
                    if (team === 'home') {
                        // ÌôàÌåÄ Ìó§Îçî ÏÑ†ÌÉù (Ï≤´ Î≤àÏß∏ .card-header h5)
                        headerElement = document.querySelector('.card-header.bg-primary h5');
                    } else if (team === 'away') {
                        // Ïñ¥Ïõ®Ïù¥ÌåÄ Ìó§Îçî ÏÑ†ÌÉù (Îëê Î≤àÏß∏ .card-header h5)
                        headerElement = document.querySelector('.card-header.bg-info h5');
                    }
                    
                    if (headerElement) {
                        if (team === 'home') {
                            headerElement.innerHTML = `<i class="bi bi-house"></i> ${newName}`;
                        } else if (team === 'away') {
                            headerElement.innerHTML = `<i class="bi bi-airplane"></i> ${newName}`;
                        }
                        console.log(`${team}ÌåÄ Ìó§Îçî Î†àÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ: ${newName}`);
                    } else {
                        console.error(`${team}ÌåÄ Ìó§Îçî ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`);
                    }
                    
                    // ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú
                    const button = document.querySelector(`[data-team="${team}"].save-team-name`);
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="bi bi-check-lg"></i> Ï†ÄÏû•Îê®';
                    button.classList.add('btn-success');
                    button.classList.remove('btn-outline-success');
                    
                    // 2Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.classList.remove('btn-success');
                        button.classList.add('btn-outline-success');
                    }, 2000);
                } else {
                    console.error(`${team}ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:`, response.status);
                    alert('ÌåÄÎ™Ö Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error(`${team}ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•ò Î∞úÏÉù:`, error);
                alert('ÌåÄÎ™Ö Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
            
            console.log(`${team}ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å: ${newName}`);
        }

        // Í≤ΩÍ∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (Í∏∞Ï°¥ ÏΩîÎìúÏôÄ ÎèôÏùº)
        async function updateMatchInfo() {
            try {
                console.log('=== Í≤ΩÍ∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë ===');
                
                const homeTeam = document.getElementById('home-team-name').value;
                const awayTeam = document.getElementById('away-team-name').value;
                const homeScore = document.getElementById('home-score').value;
                const awayScore = document.getElementById('away-score').value;
                
                console.log('ÏóÖÎç∞Ïù¥Ìä∏Ìï† Îç∞Ïù¥ÌÑ∞:', {
                    homeTeam, awayTeam, homeScore, awayScore
                });
                
                const response = await fetch(`/api/matches/${matchId}`, {
                    method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                        home_team: homeTeam,
                        away_team: awayTeam,
                        home_score: parseInt(homeScore),
                        away_score: parseInt(awayScore)
                        })
                    });
                    
                if (response.ok) {
                    console.log('Í≤ΩÍ∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ');
                    } else {
                    console.error('Í≤ΩÍ∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', response.status);
                }
            } catch (error) {
                console.error('Í≤ΩÍ∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•ò:', error);
            }
        }

        // ÌåÄ Ïª¨Îü¨ Ï†ÄÏû•
        async function saveTeamColor(team) {
            console.log(`=== ${team}ÌåÄ Ïª¨Îü¨ Ï†ÄÏû• ===`);
            const colorInput = document.getElementById(`${team}-team-color`);
            const headerInput = document.getElementById(`${team}-team-header`);
            const color = colorInput.value;
            const headerText = headerInput ? headerInput.value : '';
            
            console.log('ÏÉàÎ°úÏö¥ ÌåÄ Ïª¨Îü¨:', color);
            console.log('ÌåÄ ÌÉÄÏûÖ:', team);
            console.log('Îß§Ïπò ID:', matchId);
            
            try {
                // 1. API Ìò∏Ï∂úÎ°ú DB ÏóÖÎç∞Ïù¥Ìä∏
                const response = await fetch(`/api/matches/${matchId}/team-color`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        team: team,
                        teamColor: color,
                        headerText: headerText
                    })
                });
                
                if (response.ok) {
                    console.log(`${team}ÌåÄ Ïª¨Îü¨ API ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ: ${color}`);
                } else {
                    console.error(`${team}ÌåÄ Ïª¨Îü¨ API ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: ${response.status}`);
                }
            } catch (error) {
                console.error(`${team}ÌåÄ Ïª¨Îü¨ API ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:`, error);
            }
            
            // 2. WebSocket Ïù¥Î≤§Ìä∏Î°ú DB Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º
            if (socket.connected) {
                socket.emit('dataChanged', {
                    matchId: matchId,
                    type: 'teamColor',
                    teamType: team
                });
                console.log('‚úÖ dataChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å');
            } else {
                console.error('‚ùå ÏÜåÏºì Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùå - dataChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° Ïã§Ìå®');
            }
            
            console.log(`${team}ÌåÄ Ïª¨Îü¨ Ï†ÄÏû• Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å: ${color}`);
        }
        
        // ÌåÄÎ°úÍ≥† ÏóÖÎ°úÎìú Ï≤òÎ¶¨
        function handleLogoUpload(team) {
            const fileInput = document.getElementById(`${team}-team-logo`);
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImg = document.getElementById(`${team}-preview-logo`);
                    const previewBg = document.getElementById(`${team}-preview-bg`);
                    const noLogoText = previewBg.querySelector('.no-logo-text');
                    
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                    noLogoText.style.display = 'none';
                    
                    console.log(`${team}ÌåÄ Î°úÍ≥† ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏`);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ Î≥ÄÍ≤Ω Ï≤òÎ¶¨
        function handleLogoBgChange(team) {
            const bgColor = document.getElementById(`${team}-team-logo-bg`).value;
            const previewBg = document.getElementById(`${team}-preview-bg`);
            
            previewBg.style.backgroundColor = bgColor;
            console.log(`${team}ÌåÄ Î°úÍ≥† Î∞∞Í≤ΩÏÉâ Î≥ÄÍ≤Ω: ${bgColor}`);
        }
        
        // ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ Ï†ÄÏû•
        async function saveTeamLogoBg(team) {
            const bgColor = document.getElementById(`${team}-team-logo-bg`).value;
            
            try {
                const response = await fetch(`/api/matches/${matchId}/team-logo-bg`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        team: team,
                        logoBgColor: bgColor
                    })
                });
                
                if (response.ok) {
                    console.log(`${team}ÌåÄ Î°úÍ≥† Î∞∞Í≤ΩÏÉâ Ï†ÄÏû• ÏÑ±Í≥µ: ${bgColor}`);
                    
                    // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
                    const previewBg = document.getElementById(`${team}-preview-bg`);
                    previewBg.style.backgroundColor = bgColor;
                    
                    // WebSocket Ïù¥Î≤§Ìä∏Î°ú DB Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º
                    if (socket.connected) {
                        socket.emit('dataChanged', {
                            matchId: matchId,
                            type: 'teamLogo',
                            teamType: team
                        });
                        console.log('‚úÖ dataChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å');
                    } else {
                        console.error('‚ùå ÏÜåÏºì Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùå - dataChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° Ïã§Ìå®');
                    }
                    
                    console.log(`${team}ÌåÄ Î°úÍ≥† Î∞∞Í≤ΩÏÉâÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.`);
                } else {
                    console.error(`${team}ÌåÄ Î°úÍ≥† Î∞∞Í≤ΩÏÉâ Ï†ÄÏû• Ïã§Ìå®: ${response.status}`);
                }
            } catch (error) {
                console.error(`${team}ÌåÄ Î°úÍ≥† Î∞∞Í≤ΩÏÉâ Ï†ÄÏû• Ïò§Î•ò:`, error);
            }
        }
        
        // ÌåÄÎ°úÍ≥† Ï†ÄÏû•
        async function saveTeamLogo(team) {
            const fileInput = document.getElementById(`${team}-team-logo`);
            const bgColor = document.getElementById(`${team}-team-logo-bg`).value;
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Î°úÍ≥† ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const formData = new FormData();
            formData.append('logo', file);
            formData.append('matchId', matchId);
            formData.append('teamType', team);
            formData.append('teamName', team === 'home' ? '<%= match.home_team %>' : '<%= match.away_team %>');
            formData.append('bgColor', bgColor);
            formData.append('sportType', '<%= match.sport_type %>'); // Ï¢ÖÎ™© ÌÉÄÏûÖ Ï∂îÍ∞Ä
            
            try {
                const response = await fetch(`/api/overlay-images/TEAMLOGO/<%= match.sport_type %>`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    let result;
                    try {
                        const responseText = await response.text();
                        console.log(`${team}ÌåÄ Î°úÍ≥† ÏóÖÎ°úÎìú ÏùëÎãµ ÌÖçÏä§Ìä∏:`, responseText);
                        result = JSON.parse(responseText);
                        console.log(`${team}ÌåÄ Î°úÍ≥† ÏóÖÎ°úÎìú ÏÑ±Í≥µ:`, result);
                    } catch (jsonError) {
                        console.error(`${team}ÌåÄ Î°úÍ≥† ÏóÖÎ°úÎìú JSON ÌååÏã± Ïò§Î•ò:`, jsonError);
                        console.error('ÏùëÎãµ ÌÖçÏä§Ìä∏:', await response.text());
                        alert(`${team}ÌåÄ Î°úÍ≥† ÏóÖÎ°úÎìú ÏùëÎãµ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.`);
                        return;
                    }
                    
                    // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏ - Ïò¨Î∞îÎ•∏ API Í≤ΩÎ°ú ÏÇ¨Ïö©
                    const previewImg = document.getElementById(`${team}-preview-logo`);
                    previewImg.src = result.logoPath; // API Í≤ΩÎ°ú Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
                    previewImg.style.display = 'block';
                    
                    const previewBg = document.getElementById(`${team}-preview-bg`);
                    // ÌòÑÏû¨ ÏÑ§Ï†ïÎêú Î°úÍ≥† Î∞∞Í≤ΩÏÉâ ÏÇ¨Ïö©
                    const currentBgColor = document.getElementById(`${team}-team-logo-bg`).value;
                    previewBg.style.backgroundColor = currentBgColor;
                    
                    const noLogoText = previewBg.querySelector('.no-logo-text');
                    noLogoText.style.display = 'none';
                    
                    // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
                    fileInput.value = '';
                    
                    // WebSocket Ïù¥Î≤§Ìä∏Î°ú DB Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º
                    if (socket.connected) {
                        socket.emit('dataChanged', {
                            matchId: matchId,
                            type: 'teamLogo',
                            teamType: team
                        });
                        console.log('‚úÖ dataChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å');
                    } else {
                        console.error('‚ùå ÏÜåÏºì Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùå - dataChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° Ïã§Ìå®');
                    }
                    
                    console.log(`${team}ÌåÄ Î°úÍ≥†Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§.`);
                } else {
                    console.error(`${team}ÌåÄ Î°úÍ≥† ÏóÖÎ°úÎìú Ïã§Ìå®: ${response.status}`);
                }
            } catch (error) {
                console.error(`${team}ÌåÄ Î°úÍ≥† ÏóÖÎ°úÎìú Ïò§Î•ò:`, error);
            }
        }

        // ÌåÄÎ°úÍ≥† ÏÇ¨Ïö©Ïú†Î¨¥ ÌÜ†Í∏Ä Ìï®Ïàò
        async function toggleTeamLogos() {
            try {
                const toggleButton = document.getElementById('toggle-team-logos');
                const isCurrentlyVisible = toggleButton.classList.contains('btn-success');
                const newState = !isCurrentlyVisible;
                
                console.log(`=== ÌåÄÎ°úÍ≥† ÌÜ†Í∏Ä: ${newState ? 'ÌëúÏãú' : 'Ïà®ÍπÄ'} ===`);
                
                const response = await fetch(`/api/soccer-team-logo-visibility/${matchId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        useLogos: newState
                    })
                });
                
                if (response.ok) {
                    console.log(`ÌåÄÎ°úÍ≥† ÌÜ†Í∏Ä ÏÑ±Í≥µ: ${newState ? 'ÌëúÏãú' : 'Ïà®ÍπÄ'}`);
                    
                    // WebSocket Ïù¥Î≤§Ìä∏Î°ú Ïã§ÏãúÍ∞Ñ ÏÉÅÌÉú Î≥ÄÍ≤Ω ÏïåÎ¶º
                    socket.emit('teamLogoVisibilityChanged', {
                        matchId: matchId,
                        useLogos: newState
                    });
                    
                    // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    const logoDisplayButton = document.getElementById('toggle-logo-display');
                    
                    if (newState) {
                        toggleButton.classList.add('btn-success');
                        toggleButton.classList.remove('btn-outline-secondary');
                        toggleButton.innerHTML = '<i class="bi bi-eye"></i> ÌëúÏãú';
                        
                        // ÌåÄÎ°úÍ≥†Í∞Ä ÌëúÏãúÎê† ÎïåÎßå Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÌôúÏÑ±Ìôî
                        logoDisplayButton.style.display = 'inline-block';
                        logoDisplayButton.classList.remove('btn-warning');
                        logoDisplayButton.classList.add('btn-outline-secondary');
                        logoDisplayButton.innerHTML = '<i class="bi bi-image"></i> Î°úÍ≥†';
                    } else {
                        toggleButton.classList.remove('btn-success');
                        toggleButton.classList.add('btn-outline-secondary');
                        toggleButton.innerHTML = '<i class="bi bi-eye-slash"></i> Ïà®ÍπÄ';
                        
                        // ÌåÄÎ°úÍ≥†Í∞Ä Ïà®Í≤®Ïßà ÎïåÎäî Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                        logoDisplayButton.style.display = 'none';
                    }
                    
                    console.log(`ÌåÄÎ°úÍ≥†Í∞Ä ${newState ? 'ÌëúÏãú' : 'Ïà®Í≤®ÏßëÎãàÎã§'}.`);
                } else {
                    console.error('ÌåÄÎ°úÍ≥† ÌÜ†Í∏Ä Ïã§Ìå®:', response.status);
                }
            } catch (error) {
                console.error('ÌåÄÎ°úÍ≥† ÌÜ†Í∏Ä Ïò§Î•ò:', error);
            }
        }
        
        // ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâÎßå ÌëúÏãú ÌÜ†Í∏Ä Ìï®Ïàò
        async function toggleLogoDisplay() {
            try {
                const toggleButton = document.getElementById('toggle-logo-display');
                const isCurrentlyBackgroundOnly = toggleButton.classList.contains('btn-warning');
                const newState = !isCurrentlyBackgroundOnly;
                
                console.log(`=== ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä: ${newState ? 'Î∞∞Í≤ΩÏÉâÎßå' : 'Î°úÍ≥† ÌëúÏãú'} ===`);
                
                // ÏÑúÎ≤ÑÏóê ÌëúÏãú Î™®Îìú Ï†ÄÏû•
                const displayMode = newState ? 'background' : 'logo';
                const saveResponse = await fetch(`/api/matches/${matchId}/team-logo-display-mode`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ displayMode: displayMode })
                });
                
                if (saveResponse.ok) {
                    console.log(`ÌåÄÎ°úÍ≥† ÌëúÏãú Î™®Îìú Ï†ÄÏû• ÏÑ±Í≥µ: ${displayMode}`);
                } else {
                    console.error('ÌåÄÎ°úÍ≥† ÌëúÏãú Î™®Îìú Ï†ÄÏû• Ïã§Ìå®:', saveResponse.status);
                }
                
                // WebSocket Ïù¥Î≤§Ìä∏Î°ú Ïã§ÏãúÍ∞Ñ ÏÉÅÌÉú Î≥ÄÍ≤Ω ÏïåÎ¶º
                console.log('=== ÌåÄÎ°úÍ≥† ÌëúÏãú Î™®Îìú Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ===');
                console.log('displayMode:', displayMode);
                console.log('ÏÜåÏºì Ïó∞Í≤∞ ÏÉÅÌÉú:', socket.connected);
                
                if (socket.connected) {
                    socket.emit('teamLogoDisplayModeChanged', {
                        matchId: matchId,
                        displayMode: displayMode
                    });
                    console.log('‚úÖ teamLogoDisplayModeChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° ÏôÑÎ£å');
                } else {
                    console.error('‚ùå ÏÜåÏºì Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùå - teamLogoDisplayModeChanged Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° Ïã§Ìå®');
                }
                
                // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (newState) {
                    toggleButton.classList.add('btn-warning');
                    toggleButton.classList.remove('btn-outline-secondary');
                    toggleButton.innerHTML = '<i class="bi bi-palette"></i> Î∞∞Í≤ΩÎßå';
                } else {
                    toggleButton.classList.remove('btn-warning');
                    toggleButton.classList.add('btn-outline-secondary');
                    toggleButton.innerHTML = '<i class="bi bi-image"></i> Î°úÍ≥†';
                }
                
                console.log(`ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä ÏÑ±Í≥µ: ${newState ? 'Î∞∞Í≤ΩÏÉâÎßå' : 'Î°úÍ≥† ÌëúÏãú'}`);
            } catch (error) {
                console.error('ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Ïò§Î•ò:', error);
            }
        }
        
        async function loadTeamLogoVisibility() {
            try {
                const response = await fetch(`/api/soccer-team-logo-visibility/${matchId}`, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // API ÏùëÎãµ Íµ¨Ï°∞: { success: true, useLogos: false }
                    const useLogos = data.useLogos;
                    
                    // ÌÜ†Í∏Ä Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    const toggleButton = document.getElementById('toggle-team-logos');
                    const logoDisplayButton = document.getElementById('toggle-logo-display');
                    
                    if (useLogos) {
                        toggleButton.classList.add('btn-success');
                        toggleButton.classList.remove('btn-outline-secondary');
                        toggleButton.innerHTML = '<i class="bi bi-eye"></i> ÌëúÏãú';
                        
                        // ÌåÄÎ°úÍ≥†Í∞Ä ÌëúÏãúÎê† ÎïåÎßå Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÌôúÏÑ±Ìôî
                        logoDisplayButton.style.display = 'inline-block';
                        
                        // Í∏∞Î≥∏Í∞íÏúºÎ°ú Î°úÍ≥† ÌëúÏãú Î™®Îìú ÏÑ§Ï†ï
                        logoDisplayButton.classList.remove('btn-warning');
                        logoDisplayButton.classList.add('btn-outline-secondary');
                        logoDisplayButton.innerHTML = '<i class="bi bi-image"></i> Î°úÍ≥†';
                    } else {
                        toggleButton.classList.remove('btn-success');
                        toggleButton.classList.add('btn-outline-secondary');
                        toggleButton.innerHTML = '<i class="bi bi-eye-slash"></i> Ïà®ÍπÄ';
                        
                        // ÌåÄÎ°úÍ≥†Í∞Ä Ïà®Í≤®Ïßà ÎïåÎäî Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                        logoDisplayButton.style.display = 'none';
                    }
                } else {
                    console.log('ÌåÄÎ°úÍ≥† ÏÇ¨Ïö© ÏÉÅÌÉú Î°úÎìú Ïã§Ìå®, Í∏∞Î≥∏Í∞í(true) ÏÇ¨Ïö©');
                    // Í∏∞Î≥∏Í∞íÏúºÎ°ú Î°úÍ≥† ÌëúÏãú ÌôúÏÑ±Ìôî
                    const toggleButton = document.getElementById('toggle-team-logos');
                    const logoDisplayButton = document.getElementById('toggle-logo-display');
                    
                    if (toggleButton) {
                        toggleButton.classList.add('btn-success');
                        toggleButton.classList.remove('btn-outline-secondary');
                        toggleButton.innerHTML = '<i class="bi bi-eye"></i> ÌëúÏãú';
                    }
                    
                    // ÌåÄÎ°úÍ≥†Í∞Ä ÌëúÏãúÎê† ÎïåÎßå Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÌôúÏÑ±Ìôî
                    if (logoDisplayButton) {
                        logoDisplayButton.style.display = 'inline-block';
                        logoDisplayButton.classList.remove('btn-warning');
                        logoDisplayButton.classList.add('btn-outline-secondary');
                        logoDisplayButton.innerHTML = '<i class="bi bi-image"></i> Î°úÍ≥†';
                    }
                }
            } catch (error) {
                console.error('ÌåÄÎ°úÍ≥† ÏÇ¨Ïö© ÏÉÅÌÉú Î°úÎìú Ïò§Î•ò:', error);
                // Í∏∞Î≥∏Í∞íÏúºÎ°ú Î°úÍ≥† ÌëúÏãú ÌôúÏÑ±Ìôî
                const toggleButton = document.getElementById('toggle-team-logos');
                const logoDisplayButton = document.getElementById('toggle-logo-display');
                
                toggleButton.classList.add('btn-success');
                toggleButton.classList.remove('btn-outline-secondary');
                toggleButton.innerHTML = '<i class="bi bi-eye"></i> ÌëúÏãú';
                
                // ÌåÄÎ°úÍ≥†Í∞Ä ÌëúÏãúÎê† ÎïåÎßå Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÌôúÏÑ±Ìôî
                logoDisplayButton.style.display = 'inline-block';
                logoDisplayButton.classList.remove('btn-warning');
                logoDisplayButton.classList.add('btn-outline-secondary');
                logoDisplayButton.innerHTML = '<i class="bi bi-image"></i> Î°úÍ≥†';
            }
        }
        
        // ÌåÄÎ°úÍ≥† ÌëúÏãú Î™®Îìú ÏÉÅÌÉú Î°úÎìú
        async function loadTeamLogoDisplayMode() {
            try {
                const response = await fetch(`/api/matches/${matchId}/team-logo-display-mode`);
                
                if (response.ok) {
                    const data = await response.json();
                    const displayMode = data.displayMode;
                    
                    // Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    const logoDisplayButton = document.getElementById('toggle-logo-display');
                    
                    if (logoDisplayButton) {
                        if (displayMode === 'background') {
                            logoDisplayButton.classList.add('btn-warning');
                            logoDisplayButton.classList.remove('btn-outline-secondary');
                            logoDisplayButton.innerHTML = '<i class="bi bi-palette"></i> Î∞∞Í≤ΩÎßå';
                        } else {
                            logoDisplayButton.classList.remove('btn-warning');
                            logoDisplayButton.classList.add('btn-outline-secondary');
                            logoDisplayButton.innerHTML = '<i class="bi bi-image"></i> Î°úÍ≥†';
                        }
                    }
                }
            } catch (error) {
                console.error('ÌåÄÎ°úÍ≥† ÌëúÏãú Î™®Îìú Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        // URL Î≥µÏÇ¨ Ìï®ÏàòÎì§ (Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ)
        function copyMobileUrl() {
            const input = document.getElementById('mobile-url');
            input.select();
            document.execCommand('copy');
            
            // Í∞ÑÎã®Ìïú ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º
            const button = event.target.closest('button');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="bi bi-check"></i>';
            button.classList.add('btn-success');
            button.classList.remove('btn-outline-secondary');
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-secondary');
            }, 1500);
        }

        function copyOverlayUrl() {
            const input = document.getElementById('overlay-url');
            input.select();
            document.execCommand('copy');
            
            // Í∞ÑÎã®Ìïú ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º
            const button = event.target.closest('button');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="bi bi-check"></i>';
            button.classList.add('btn-success');
            button.classList.remove('btn-outline-secondary');
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-secondary');
            }, 1500);
        }

        // ÌåÄÎ°úÍ≥† Ï†ïÎ≥¥ Î°úÎìú Ìï®Ïàò
        async function loadTeamLogos() {
            try {
                console.log('ÌåÄÎ°úÍ≥† Ï†ïÎ≥¥ Î°úÎìú ÏãúÏûë...');
                const response = await fetch(`/api/matches/${matchId}/team-logos`);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('ÌåÄÎ°úÍ≥† Ï†ïÎ≥¥ Î°úÎìú ÏÑ±Í≥µ:', result.teamLogos);
                    
                    // Í∞Å ÌåÄÏùò Î°úÍ≥† Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                    result.teamLogos.forEach(teamInfo => {
                        const teamType = teamInfo.team_type;
                        console.log(`${teamType}ÌåÄ Î°úÍ≥† Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏:`, teamInfo);
                        
                        // Î°úÍ≥† Î∞∞Í≤ΩÏÉâ ÏóÖÎç∞Ïù¥Ìä∏
                        const logoBgInput = document.getElementById(`${teamType}-team-logo-bg`);
                        if (logoBgInput && teamInfo.logo_bg_color) {
                            logoBgInput.value = teamInfo.logo_bg_color;
                        }
                        
                        // Î°úÍ≥† ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
                        const previewBg = document.getElementById(`${teamType}-preview-bg`);
                        const previewImg = document.getElementById(`${teamType}-preview-logo`);
                        const noLogoText = previewBg.querySelector('.no-logo-text');
                        
                        if (teamInfo.logo_path) {
                            // Î°úÍ≥†Í∞Ä ÏûàÎäî Í≤ΩÏö∞ - API Í≤ΩÎ°ú Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
                            previewImg.src = teamInfo.logo_path;
                            previewImg.style.display = 'block';
                            previewBg.style.backgroundColor = teamInfo.logo_bg_color || '#FFFFFF';
                            noLogoText.style.display = 'none';
                        } else {
                            // Î°úÍ≥†Í∞Ä ÏóÜÎäî Í≤ΩÏö∞
                            previewImg.style.display = 'none';
                            previewBg.style.backgroundColor = teamInfo.logo_bg_color || '#FFFFFF';
                            noLogoText.style.display = 'block';
                        }
                    });
                } else {
                    console.error('ÌåÄÎ°úÍ≥† Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', response.status);
                }
            } catch (error) {
                console.error('ÌåÄÎ°úÍ≥† Ï†ïÎ≥¥ Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú URL ÏÑ§Ï†ï
        document.addEventListener('DOMContentLoaded', async function() {
            const baseUrl = window.location.origin;
            document.getElementById('mobile-url').value = `${baseUrl}/soccer/${matchId}/control-mobile`;
            document.getElementById('overlay-url').value = `${baseUrl}/soccer/${matchId}/overlay`;
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠
            console.log('=== ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ ===');
            socket.emit('request_timer_state', { matchId: matchId });
            
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê (Î∞±ÏóÖ Ìè¥ÎçîÏùò ÏòàÏ†Ñ Î∞©Ïãù - ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ÏôÄ ÏôÑÏ†Ñ ÎèÖÎ¶Ω)
        console.log('=== ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê (ÎèÖÎ¶Ω Î™®Îìú) ===');
        
        // Î°úÏª¨ ÌÉÄÏù¥Î®∏Îßå ÏÇ¨Ïö©ÌïòÎØÄÎ°ú ÏÑúÎ≤Ñ ÏÉÅÌÉú ÏöîÏ≤≠ Ï†úÍ±∞
        // localStorageÏóêÏÑú ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê
        const savedTimerState = localStorage.getItem(`timer_state_${matchId}`);
        if (savedTimerState) {
            try {
                const parsedState = JSON.parse(savedTimerState);
                const currentTime = Date.now();
                const timeDiff = currentTime - parsedState.lastSaveTime;
                
                // ÌÉÄÏù¥Î®∏Í∞Ä Ïã§Ìñâ Ï§ëÏù¥ÏóàÎã§Î©¥ Í≤ΩÍ≥º ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                if (parsedState.isRunning && parsedState.startTime) {
                    const elapsedSeconds = Math.floor(timeDiff / 1000);
                    timerState.currentSeconds = parsedState.currentSeconds + elapsedSeconds;
                    timerState.isRunning = true;
                    timerState.startTime = parsedState.startTime; // ÏõêÎûò startTime Ïú†ÏßÄ
                    timerState.pausedTime = parsedState.pausedTime;
                    
                    console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê (ÎèÖÎ¶Ω Î™®Îìú):', {
                        currentSeconds: timerState.currentSeconds,
                        isRunning: timerState.isRunning,
                        elapsedSeconds: elapsedSeconds,
                        originalStartTime: parsedState.startTime,
                        currentStartTime: timerState.startTime
                    });
                    
                    // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûë
                    startLocalTimer();
                } else {
                    timerState.currentSeconds = parsedState.currentSeconds;
                    timerState.isRunning = false;
                    timerState.startTime = Date.now();
                    timerState.pausedTime = parsedState.pausedTime;
                    
                    console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ ÏÉÅÌÉú Î≥µÏõê (ÎèÖÎ¶Ω Î™®Îìú):', {
                        currentSeconds: timerState.currentSeconds,
                        isRunning: timerState.isRunning
                    });
                }
                
                updateTimerDisplay();
            } catch (error) {
                console.error('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê Ïã§Ìå®:', error);
            }
        }
        
        // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ (Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î™®ÎìúÏùº Îïå)
        console.log('=== ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ ===');
        socket.emit('request_local_timer_state', { matchId: matchId });
        
        // ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉú ÏöîÏ≤≠
        console.log('=== ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉú ÏöîÏ≤≠ ===');
        socket.emit('request_timer_mode', { matchId: matchId });
            
        // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ Ï≤òÎ¶¨
        socket.on('request_local_timer_state', function(data) {
            console.log('=== Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏöîÏ≤≠ ÏàòÏã† ===');
            console.log('ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                // ÌòÑÏû¨ Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÑÏÜ°
                socket.emit('local_timer_update', {
                    matchId: matchId,
                    currentSeconds: timerState.currentSeconds,
                    isRunning: timerState.isRunning,
                    startTime: timerState.startTime,
                    pausedTime: timerState.pausedTime
                });
                
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÑÏÜ°:', {
                    currentSeconds: timerState.currentSeconds,
                    isRunning: timerState.isRunning,
                    startTime: timerState.startTime,
                    pausedTime: timerState.pausedTime
                });
            }
        });

        // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê Ïù¥Î≤§Ìä∏
        socket.on('local_timer_state_restored', function(data) {
            console.log('=== Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê ÏàòÏã† ===');
            console.log('Î≥µÏõêÎêú Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                // Î≥µÏõêÎêú Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÅÏö©
                timerState.currentSeconds = data.timerState.currentSeconds;
                timerState.isRunning = data.timerState.isRunning;
                timerState.startTime = data.timerState.startTime;
                timerState.pausedTime = data.timerState.pausedTime;
                
                console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê ÏôÑÎ£å:', {
                    currentSeconds: timerState.currentSeconds,
                    isRunning: timerState.isRunning,
                    startTime: timerState.startTime,
                    pausedTime: timerState.pausedTime
                });
                
                // ÎîîÏä§ÌîåÎ†àÏù¥ ÏóÖÎç∞Ïù¥Ìä∏
                updateTimerDisplay();
                
                // Ïã§Ìñâ Ï§ëÏù¥ÏóàÎã§Î©¥ Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûë
                if (timerState.isRunning) {
                    startLocalTimer();
                }
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        loadMatchData();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏäπÎ∂ÄÏ∞®Í∏∞ ÌÖçÏä§Ìä∏ Î°úÎìú
            loadPenaltyText();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎåÄÌöåÎ™Ö Î°úÎìú
            console.log('=== ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎåÄÌöåÎ™Ö Î°úÎìú Ìò∏Ï∂ú ===');
            loadTournamentText();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎìùÏ†ê Ï†ïÎ≥¥ Î°úÎìú
            loadGoalsFromServer();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎìùÏ†ê Ï†ïÎ≥¥ Î¶¨Ïä§Ìä∏ Ï¥àÍ∏∞Ìôî
            renderHomeGoalsList();
            renderAwayGoalsList();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌåÄÎ°úÍ≥† Ï†ïÎ≥¥ Î°úÎìú
            loadTeamLogos();
            
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉúÎäî ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏïÑÏò¥ (request_timer_mode Ïù¥Î≤§Ìä∏Î°ú Ï≤òÎ¶¨)
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌåÄÎ°úÍ≥† ÏÇ¨Ïö© ÏÉÅÌÉú Î°úÎìú (Î®ºÏ†Ä Ïã§Ìñâ)
            await loadTeamLogoVisibility();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌåÄÎ°úÍ≥† ÌëúÏãú Î™®Îìú ÏÉÅÌÉú Î°úÎìú (ÎÇòÏ§ëÏóê Ïã§Ìñâ)
            await loadTeamLogoDisplayMode();
            
            // ÏãúÍ∞Ñ Ï†ÅÏö© Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (Ïà´Ïûê ÏûêÎèô Î≥ÄÌôò Ìè¨Ìï®)
            document.getElementById('apply-time-btn').addEventListener('click', function() {
                console.log('=== ÏãúÍ∞Ñ Ï†ÅÏö© Î≤ÑÌäº ÌÅ¥Î¶≠ ===');
                const timeEditInput = document.getElementById('time-edit-input');
                let timeValue = timeEditInput.value.trim();
                
                console.log('ÏûÖÎ†•Îêú Í∞í:', timeValue);
                
                // Îπà Í∞í Ï≤¥ÌÅ¨
                if (!timeValue) {
                    alert('ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                let minutes, seconds;
                
                // 00:00 ÌòïÏãùÏù∏ÏßÄ ÌôïÏù∏
                const timeRegex = /^([0-9]{2}):([0-9]{2})$/;
                if (timeRegex.test(timeValue)) {
                    // 00:00 ÌòïÏãùÏù∏ Í≤ΩÏö∞
                    [minutes, seconds] = timeValue.split(':').map(Number);
                                    } else {
                    // Ïà´ÏûêÎßå ÏûÖÎ†•Îêú Í≤ΩÏö∞ ÏûêÎèô Î≥ÄÌôò
                    const numericValue = parseInt(timeValue);
                    if (isNaN(numericValue) || numericValue < 0) {
                        alert('Ïò¨Î∞îÎ•∏ Ïà´ÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
                    // Ïà´ÏûêÎ•º ÏãúÍ∞ÑÏúºÎ°ú Î≥ÄÌôò
                    if (numericValue < 100) {
                        // 1-99: Ï¥àÎ°ú Ï≤òÎ¶¨
                        minutes = 0;
                        seconds = numericValue;
                    } else if (numericValue < 10000) {
                        // 100-9999: ÎßàÏßÄÎßâ Îëê ÏûêÎ¶¨Îäî Ï¥à, ÎÇòÎ®∏ÏßÄÎäî Î∂Ñ
                        minutes = Math.floor(numericValue / 100);
                        seconds = numericValue % 100;
                        } else {
                        // 10000 Ïù¥ÏÉÅ: ÎßàÏßÄÎßâ Îëê ÏûêÎ¶¨Îäî Ï¥à, ÎÇòÎ®∏ÏßÄÎäî Î∂Ñ
                        minutes = Math.floor(numericValue / 100);
                        seconds = numericValue % 100;
                    }
                    
                    console.log('Î≥ÄÌôòÎêú ÏãúÍ∞Ñ:', `${minutes}:${seconds}`);
                }
                
                // 0 ÎòêÎäî 0000 ÏûÖÎ†• Ï†úÌïú
                if (minutes === 0 && seconds === 0) {
                    alert('0 ÎòêÎäî 00:00ÏùÄ ÏûÖÎ†•Ìï† Ïàò ÏóÜÏäµÎãàÎã§. ÏµúÏÜå 00:01 Ïù¥ÏÉÅÏùò ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                                return;
                            }
                            
                // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                if (minutes > 90 || seconds > 59) {
                    alert('Ïò¨Î∞îÎ•∏ ÏãúÍ∞Ñ Î≤îÏúÑÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (Î∂Ñ: 0-90, Ï¥à: 0-59)');
                    return;
                }
                
                // ÏÑúÎ≤ÑÏóê ÏãúÍ∞Ñ ÏÑ§Ï†ï ÏöîÏ≤≠
                const isV2Enabled = document.getElementById('timer-v2-toggle').checked;
                const totalSeconds = minutes * 60 + seconds;
                
                if (isV2Enabled) {
                    // ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú ÏÇ¨Ïö©
                    console.log('ÏÑúÎ≤Ñ ÌÉÄÏù¥Î®∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï');
                    socket.emit('server_timer_control', {
                        matchId: matchId,
                        action: 'set',
                        timeValue: totalSeconds
                    });
                } else {
                    // Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú ÏÇ¨Ïö©
                    console.log('Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú ÏãúÍ∞Ñ ÏÑ§Ï†ï');
                    socket.emit('timer_control', {
                        matchId: matchId,
                        action: 'set',
                        minutes: minutes,
                        seconds: seconds
                    });
                }
                
                // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Î°úÏª¨ ÌÉÄÏù¥Î®∏ Î™®ÎìúÏùº ÎïåÎßå)
                if (currentTimerMode === 'legacy-timer') {
                    timerState.currentSeconds = minutes * 60 + seconds;
                    timerState.isRunning = false;
                    timerState.startTime = null;
                    timerState.pausedTime = timerState.currentSeconds;
                    
                    // Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÄÏû•
                    saveTimerState();
                    
                    // Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏóê Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Ï†ÑÏÜ°
                    socket.emit('local_timer_update', {
                        matchId: matchId,
                        currentSeconds: timerState.currentSeconds,
                        isRunning: timerState.isRunning,
                        startTime: timerState.startTime,
                        pausedTime: timerState.pausedTime
                    });
                }
                
                // ÎîîÏä§ÌîåÎ†àÏù¥ ÏóÖÎç∞Ïù¥Ìä∏
                updateTimerDisplay();
                
                // ÏûÖÎ†• ÌïÑÎìú Ïà®Í∏∞Í∏∞
                document.getElementById('time-edit-container').style.display = 'none';
                
                console.log('ÏãúÍ∞Ñ ÏÑ§Ï†ï ÏôÑÎ£å:', `${minutes}:${seconds}`);
            });
            
            // ÌåÄÎ™Ö Ï†ÄÏû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            document.querySelectorAll('.save-team-name').forEach(button => {
            button.addEventListener('click', function() {
                    const team = this.getAttribute('data-team');
                    console.log(`=== ${team}ÌåÄÎ™Ö Ï†ÄÏû• Î≤ÑÌäº ÌÅ¥Î¶≠ ===`);
                    updateTeamName(team);
            });
        });

            // ÌåÄ Ïª¨Îü¨ Ï†ÄÏû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            document.querySelectorAll('.save-team-color').forEach(button => {
            button.addEventListener('click', function() {
                    const team = this.getAttribute('data-team');
                    console.log(`=== ${team}ÌåÄ Ïª¨Îü¨ Ï†ÄÏû• Î≤ÑÌäº ÌÅ¥Î¶≠ ===`);
                    saveTeamColor(team);
            });
        });
        
        
        // ÌåÄÎ°úÍ≥† Í¥ÄÎ†® Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', function() {
                const team = this.id.replace('-team-logo', '');
                handleLogoUpload(team);
            });
        });
        
        document.querySelectorAll('input[type="color"]').forEach(input => {
            if (input.id.includes('logo-bg')) {
                input.addEventListener('change', function() {
                    const team = this.id.replace('-team-logo-bg', '');
                    handleLogoBgChange(team);
                });
            }
        });
        
        document.querySelectorAll('.save-team-logo').forEach(button => {
            button.addEventListener('click', function() {
                const team = this.getAttribute('data-team');
                console.log(`=== ${team}ÌåÄ Î°úÍ≥† Ï†ÄÏû• Î≤ÑÌäº ÌÅ¥Î¶≠ ===`);
                saveTeamLogo(team);
            });
        });
        
        document.querySelectorAll('.save-team-logo-bg').forEach(button => {
            button.addEventListener('click', function() {
                const team = this.getAttribute('data-team');
                console.log(`=== ${team}ÌåÄ Î°úÍ≥† Î∞∞Í≤ΩÏÉâ Ï†ÄÏû• Î≤ÑÌäº ÌÅ¥Î¶≠ ===`);
                saveTeamLogoBg(team);
            });
        });
        
        // ÌåÄÎ°úÍ≥† ÏÇ¨Ïö©Ïú†Î¨¥ ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.getElementById('toggle-team-logos').addEventListener('click', function() {
            console.log('=== ÌåÄÎ°úÍ≥† ÌÜ†Í∏Ä Î≤ÑÌäº ÌÅ¥Î¶≠ ===');
            toggleTeamLogos();
        });
        
        // ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.getElementById('toggle-logo-display').addEventListener('click', function() {
            console.log('=== ÌåÄÎ°úÍ≥† Î∞∞Í≤ΩÏÉâ ÌÜ†Í∏Ä Î≤ÑÌäº ÌÅ¥Î¶≠ ===');
            toggleLogoDisplay();
        });
        });

        // ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        socket.on('timer_state', function(data) {
            console.log('=== ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú ÏàòÏã† ===');
            console.log('ÏàòÏã†Îêú Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                // ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê
                timerState.currentSeconds = data.currentSeconds || 0;
                timerState.isRunning = data.isRunning || false;
                timerState.startTime = data.startTime || null;
                timerState.pausedTime = data.pausedTime || 0;
                
                console.log('ÌÉÄÏù¥Î®∏ ÏÉÅÌÉú Î≥µÏõê:', {
                    currentSeconds: timerState.currentSeconds,
                    isRunning: timerState.isRunning,
                    startTime: timerState.startTime,
                    pausedTime: timerState.pausedTime
                });
                
                // ÌÉÄÏù¥Î®∏ ÎîîÏä§ÌîåÎ†àÏù¥ ÏóÖÎç∞Ïù¥Ìä∏
                updateTimerDisplay();
                
                // ÌÉÄÏù¥Î®∏Í∞Ä Ïã§Ìñâ Ï§ëÏù¥Î©¥ ÏÑúÎ≤Ñ ÏãúÏûë ÏãúÍ∞ÑÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏûë
                if (timerState.isRunning && timerState.startTime) {
                    // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ ÏãúÏûë ÏãúÍ∞ÑÏùÑ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö© (Ïò§Î≤ÑÎ†àÏù¥ ÌéòÏù¥ÏßÄÏôÄ ÎèôÏùºÌïú Î∞©Ïãù)
                    console.log('Î°úÏª¨ ÌÉÄÏù¥Î®∏ Ïû¨ÏãúÏûë - ÏÑúÎ≤Ñ ÏãúÏûë ÏãúÍ∞Ñ ÏÇ¨Ïö©:', timerState.startTime);
                }
            }
        });

        // ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉú Î≥µÏõê Î∞è Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        socket.on('timer_mode_response', function(data) {
            console.log('=== ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉú ÏùëÎãµ ===');
            console.log('ÏàòÏã†Îêú Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                const toggleElement = document.getElementById('timer-v2-toggle');
                
                if (toggleElement) {
                    if (data.currentMode === null) {
                        // Ï†ÄÏû•Îêú Î™®ÎìúÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ - Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï (ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Í∏∞Î≥∏ ÌôúÏÑ±Ìôî)
                        toggleElement.checked = true; // ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Í∏∞Î≥∏ ÌôúÏÑ±Ìôî
                        currentTimerMode = 'server-timer'; // ÌòÑÏû¨ Î™®Îìú ÏóÖÎç∞Ïù¥Ìä∏
                        console.log('Ï†ÄÏû•Îêú ÌÉÄÏù¥Î®∏ Î™®Îìú ÏóÜÏùå - ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Í∏∞Î≥∏ ÌôúÏÑ±Ìôî');
                        console.log('Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú: ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Í∏∞Î≥∏ ÌôúÏÑ±Ìôî');
                    } else {
                        // Ï†ÄÏû•Îêú Î™®ÎìúÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ - Ìï¥Îãπ Î™®ÎìúÎ°ú Î≥µÏõê
                        const isServerTimer = data.currentMode === 'server-timer';
                        toggleElement.checked = isServerTimer;
                        currentTimerMode = data.currentMode; // ÌòÑÏû¨ Î™®Îìú ÏóÖÎç∞Ïù¥Ìä∏
                        console.log('ÌÉÄÏù¥Î®∏ Î™®Îìú ÏÉÅÌÉú Î≥µÏõê:', data.currentMode, 'Ï≤¥ÌÅ¨Î∞ïÏä§:', isServerTimer);
                        
                        // UI ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ Î°úÍ∑∏ Ï∂úÎ†•
                        console.log('Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', toggleElement.checked);
                        
                        if (data.currentMode === 'server-timer') {
                            console.log('Î≥µÏõêÎêú ÌÉÄÏù¥Î®∏ Î™®Îìú: ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú');
                        } else if (data.currentMode === 'legacy-timer') {
                            console.log('Î≥µÏõêÎêú ÌÉÄÏù¥Î®∏ Î™®Îìú: Î°úÏª¨ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú');
                        }
                    }
                } else {
                    console.error('timer-v2-toggle ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
            }
        });

        socket.on('timer_mode_updated', function(data) {
            console.log('=== ÌÉÄÏù¥Î®∏ Î™®Îìú Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ ===');
            console.log('ÏàòÏã†Îêú Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                const isServerTimer = data.currentMode === 'server-timer';
                const toggleElement = document.getElementById('timer-v2-toggle');
                
                if (toggleElement) {
                    toggleElement.checked = isServerTimer;
                    console.log('ÌÉÄÏù¥Î®∏ Î™®Îìú Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî:', data.currentMode, 'Ï≤¥ÌÅ¨Î∞ïÏä§:', isServerTimer);
                }
            }
        });

        // ÏÉàÎ°úÏö¥ ÌÉÄÏù¥Î®∏ ÏãúÏä§ÌÖú v2 Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (Í∏∞Ï°¥ Ìò∏ÌôòÏÑ± Ïú†ÏßÄ)
        socket.on('timer_v2_mode_updated', function(data) {
            console.log('=== ÌÉÄÏù¥Î®∏ v2 Î™®Îìú ÏóÖÎç∞Ïù¥Ìä∏ ===');
            console.log('ÏàòÏã†Îêú Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                console.log('ÌÉÄÏù¥Î®∏ v2 Î™®Îìú:', data.newMode);
                // UI ÏóÖÎç∞Ïù¥Ìä∏ (ÌïÑÏöîÏãú)
            }
        });

        // Î°úÏª¨ ÌÉÄÏù¥Î®∏Îßå ÏÇ¨Ïö© (ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ÏôÄ ÏôÑÏ†Ñ ÎèÖÎ¶Ω)
        // ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Í¥ÄÎ†® Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎäî Ï†úÍ±∞ÌïòÏó¨ Í∞ÑÏÑ≠ Î∞©ÏßÄ

        // Î°úÏª¨ ÌÉÄÏù¥Î®∏Îßå ÏÇ¨Ïö© (ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ÏôÄ ÏôÑÏ†Ñ ÎèÖÎ¶Ω)
        // ÏÑúÎ≤ÑÌÉÄÏù¥Î®∏ Í¥ÄÎ†® Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎäî Ï†úÍ±∞ÌïòÏó¨ Í∞ÑÏÑ≠ Î∞©ÏßÄ

        socket.on('match_updated', function(data) {
            console.log('=== Í≤ΩÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ ÏàòÏã† ===');
            console.log('Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                if (data.home_score !== undefined) {
                    document.getElementById('home-score').value = data.home_score;
                    console.log('ÌôàÌåÄ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏:', data.home_score);
                }
                if (data.away_score !== undefined) {
                    document.getElementById('away-score').value = data.away_score;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏:', data.away_score);
                }
                if (data.home_team) {
                    document.getElementById('home-team-name').value = data.home_team;
                    console.log('ÌôàÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏:', data.home_team);
                }
                if (data.away_team) {
                    document.getElementById('away-team-name').value = data.away_team;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏:', data.away_team);
                    }
                }
            });
            
        // ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏùëÎãµ Ï≤òÎ¶¨
        socket.on('teamColorUpdated', function(response) {
            console.log('=== ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏùëÎãµ ÏàòÏã† ===');
            console.log('Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞:', response);
            
            if (response.success) {
                console.log('ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ');
                // ÌåÄ Ïª¨Îü¨ Ï†ÄÏû• ÏÑ±Í≥µ ÌõÑ ÌòÑÏû¨ Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Îã§Ïãú Î°úÎìúÌïòÏó¨ ÌôïÏù∏
                loadMatchData();
                } else {
                console.error('ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', response.message);
            }
        });

        // ÌåÄÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ ÏàòÏã†
        socket.on('teamNameUpdated', function(data) {
            console.log('=== ÌåÄÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏ ÏàòÏã† ===');
            console.log('Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                const team = data.team;
                const teamName = data.teamName;
                
                console.log(`${team}ÌåÄ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏:`, teamName);
                
                // ÌåÄÎ™Ö ÏûÖÎ†• ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
                const nameInput = document.getElementById(`${team}-team-name`);
                if (nameInput) {
                    nameInput.value = teamName;
                    console.log(`${team}ÌåÄ Ïù¥Î¶Ñ ÏûÖÎ†• ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å`);
                }
            }
        });

        // ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        socket.on('teamsSwapped', function(data) {
            console.log('=== ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ ÏàòÏã† ===');
            console.log('Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞:', data);
            
            if (data.matchId === matchId) {
                // ÌåÄ Ï†ïÎ≥¥ Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                updateTeamsAfterSwap();
                console.log('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω UI ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
            }
        });

        // ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω ÌõÑ UI ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        async function updateTeamsAfterSwap() {
            try {
                console.log('=== ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω ÌõÑ UI ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë ===');
                
                // ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const response = await fetch(`/api/matches/${matchId}`);
                if (!response.ok) {
                    throw new Error('Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®');
                }
                
                const matchData = await response.json();
                console.log('Î°úÎìúÎêú Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞:', matchData);
                
                // ÌåÄÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏
                const homeTeamNameInput = document.getElementById('home-team-name');
                const awayTeamNameInput = document.getElementById('away-team-name');
                
                if (homeTeamNameInput && matchData.home_team) {
                    homeTeamNameInput.value = matchData.home_team;
                    console.log('ÌôàÌåÄÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏:', matchData.home_team);
                            } else {
                    console.log('ÌôàÌåÄÎ™Ö ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                }
                
                if (awayTeamNameInput && matchData.away_team) {
                    awayTeamNameInput.value = matchData.away_team;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏:', matchData.away_team);
                } else {
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄÎ™Ö ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                }
                
                // Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏
                const homeScoreInput = document.getElementById('home-score');
                const awayScoreInput = document.getElementById('away-score');
                
                if (homeScoreInput && matchData.home_score !== undefined) {
                    homeScoreInput.value = matchData.home_score;
                    console.log('ÌôàÌåÄ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏:', matchData.home_score);
                            } else {
                    console.log('ÌôàÌåÄ Ï†êÏàò ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                }
                
                if (awayScoreInput && matchData.away_score !== undefined) {
                    awayScoreInput.value = matchData.away_score;
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏:', matchData.away_score);
                } else {
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ï†êÏàò ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                }
                
                // ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ (ÏßÅÏ†ë ÌïÑÎìúÏôÄ match_data Î™®Îëê ÌôïÏù∏)
                console.log('=== ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë ===');
                console.log('ÏßÅÏ†ë ÌïÑÎìú ÌôàÌåÄ Ïª¨Îü¨:', matchData.home_team_color);
                console.log('ÏßÅÏ†ë ÌïÑÎìú Ïñ¥Ïõ®Ïù¥ÌåÄ Ïª¨Îü¨:', matchData.away_team_color);
                
                // ÏßÅÏ†ë ÌïÑÎìúÏóêÏÑú ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏
                const homeColorInput = document.getElementById('home-team-color');
                if (homeColorInput) {
                    if (matchData.home_team_color) {
                        homeColorInput.value = matchData.home_team_color;
                        console.log('ÌôàÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ (ÏßÅÏ†ë ÌïÑÎìú):', matchData.home_team_color);
                    } else {
                        console.log('ÌôàÌåÄ Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§ (ÏßÅÏ†ë ÌïÑÎìú)');
                    }
                } else {
                    console.log('ÌôàÌåÄ Ïª¨Îü¨ ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                
                const awayColorInput = document.getElementById('away-team-color');
                if (awayColorInput) {
                    if (matchData.away_team_color) {
                        awayColorInput.value = matchData.away_team_color;
                        console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ (ÏßÅÏ†ë ÌïÑÎìú):', matchData.away_team_color);
                    } else {
                        console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§ (ÏßÅÏ†ë ÌïÑÎìú)');
                    }
                } else {
                    console.log('Ïñ¥Ïõ®Ïù¥ÌåÄ Ïª¨Îü¨ ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                
                // match_dataÏóêÏÑúÎèÑ ÌåÄ Ïª¨Îü¨ ÌôïÏù∏ (Î∞±ÏóÖÏö©)
                if (matchData.match_data) {
                    const matchDataObj = matchData.match_data;
                    console.log('match_data Í∞ùÏ≤¥:', matchDataObj);
                    console.log('match_data ÌôàÌåÄ Ïª¨Îü¨:', matchDataObj.home_team_color);
                    console.log('match_data Ïñ¥Ïõ®Ïù¥ÌåÄ Ïª¨Îü¨:', matchDataObj.away_team_color);
                }
                
                console.log('=== ÌåÄ Ïª¨Îü¨ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å ===');
                
                console.log('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω UI ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                
            } catch (error) {
                console.error('ÌåÄ ÏúÑÏπò Î≥ÄÍ≤Ω UI ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
            }
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌåÄÎ°úÍ≥† ÏÇ¨Ïö© ÏÉÅÌÉú Î°úÎìú
        loadTeamLogoVisibility();
    </script>
</body>
</html> 