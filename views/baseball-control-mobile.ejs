<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•¼êµ¬ ê²½ê¸° ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ëª¨ë°”ì¼)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 5px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        

        .control-panel {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* íƒœë¸”ë¦¿ ê°€ë¡œëª¨ë“œ ë ˆì´ì•„ì›ƒ */
        .game-controls-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .left-panel {
            flex: 1;
            max-width: 400px;
        }
        
        .right-panel {
            flex: 1;
            max-width: 400px;
        }
        .score-section {
            margin: 15px 0;
        }
        .score-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .score-input {
            width: 70px;
            height: 35px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border-radius: 8px;
            border: 2px solid #ddd;
            padding: 5px;
        }
        .score-controls {
            display: flex;
            gap: 5px;
        }
        .score-btn {
            width: 35px;
            height: 35px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 18px;
        }
        .game-status-section {
            margin: 20px 0 10px 0;
        }
        .status-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .status-btn {
            min-width: 60px;
            border-radius: 8px;
            font-weight: 500;
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .inning-display {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: #28a745;
        }
        
        .team-name-edit-section {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }
        
        .team-name-edit-section input {
            flex: 1;
            font-size: 0.8rem;
        }
        
        .team-name-edit-section .btn {
            padding: 4px 8px;
            font-size: 0.8rem;
        }
        
        /* ë² ì´ìŠ¤ ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .base-controls {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transform: rotate(-45deg);
        }
        
        .diamond {
            width: 80px;
            height: 80px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
        }
        
        .base {
            width: 40px;
            height: 40px;
            position: absolute;
            background-color: #666;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border-radius: 4px;
        }
        
        .base.active {
            background-color: #f59e0b !important;
        }
        
        .base.first {
            right: 0;
            bottom: 50%;
            transform: translate(50%, 50%) rotate(45deg);
        }
        
        .base.second {
            top: 0;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
        }
        
        .base.third {
            left: 0;
            bottom: 50%;
            transform: translate(-50%, 50%) rotate(45deg);
        }
        
        .base.home {
            bottom: 0;
            left: 50%;
            transform: translate(-50%, 50%) rotate(45deg);
            background-color: #fff;
            border: 2px solid #666;
        }
        
        .count-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .count-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .count-label {
            font-size: 18px;
            font-weight: bold;
            width: 30px;
            text-align: center;
        }
        
        .count-dots {
            display: flex;
            gap: 12px;
        }
        
        .count-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #666;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .count-dot.ball.active {
            background-color: #22c55e;
        }
        
        .count-dot.strike.active {
            background-color: #eab308;
        }
        
        .count-dot.out.active {
            background-color: #ef4444;
        }
        
        .count-controls {
            display: flex;
            gap: 5px;
        }
        
        .count-btn {
            width: 30px;
            height: 30px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .reset-button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background-color: #f0f0f0;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .reset-button:hover {
            background-color: #e0e0e0;
        }
        
        /* íƒœë¸”ë¦¿ ê°€ë¡œëª¨ë“œ ìµœì í™” */
        @media (min-width: 768px) {
            .game-controls-container {
                flex-direction: row;
            }
            
            .left-panel, .right-panel {
                flex: 1;
            }
        }
        

    </style>
</head>
<body>
    <div class="control-panel">
        <!-- ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ -->
        <% if (typeof listId !== 'undefined' && listId) { %>
        <div class="row mb-1">
            <div id="list-info-box" class="col-12 text-center" style="background-color: #e9ecef; padding: 5px; border-radius: 8px; margin-bottom: 5px;">
                <div style="font-weight: 600; font-size: 0.9rem; color: #495057;">
                    <%= listName %> (ê²½ê¸° <%= currentMatchIndex + 1 %> / <%= totalMatches %>)
                </div>
            </div>
        </div>
        <% } %>
        
        
        <!-- íŒ€ë¡œê³  ì‚¬ìš© ì²´í¬ë°•ìŠ¤ -->
        <div class="row mb-2">
            <div class="col-12 text-center">
                <div class="form-check d-inline-block">
                    <input type="checkbox" class="form-check-input" id="use-team-logos" <%= match.match_data && match.match_data.use_team_logos ? 'checked' : '' %> style="transform: scale(0.8);">
                    <label class="form-check-label" for="use-team-logos" style="font-size: 0.85em;">
                        íŒ€ë¡œê³  ì‚¬ìš©
                    </label>
                </div>
            </div>
        </div>
        
        
        <!-- íŒ€ëª… í‘œì‹œ ë° ìˆ˜ì • -->
        <div class="row mb-1" style="align-items: center;">
            <!-- í™ˆíŒ€ ì„¹ì…˜ -->
            <div class="col-4 text-center">
                <div class="team-logo-container mb-1" id="home-team-logo-container" style="width: 63px; height: 63px; margin: 0 auto; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px solid #dee2e6;">
                    <span style="font-size: 0.9rem; color: #6c757d;">ë¡œê³ </span>
                </div>
                <div style="font-weight:700; font-size:1.4rem; margin-bottom: 5px;" id="home-team-display">
                    <%= match.home_team || 'HOME' %>
                </div>
                <button class="btn btn-sm btn-outline-primary" onclick="openTeamNameModal('home')" style="font-size: 1rem; padding: 6px 12px;">
                    <i class="bi bi-pencil"></i> ìˆ˜ì •
                </button>
            </div>
            
            <!-- ì´ë‹ ì„¹ì…˜ (ì¤‘ì•™) -->
            <div class="col-4 text-center">
                <div class="inning-display" style="background-color: #f8f9fa; border-radius: 12px; padding: 10px; border: 2px solid #dee2e6;">
                    <!-- ì´ë‹ ì»¨íŠ¸ë¡¤ -->
                    <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
                        <button class="btn btn-outline-success" onclick="updateInning(-1)" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 16px;">
                            <i class="bi bi-dash"></i>
                        </button>
                        <div class="inning-number" style="font-size: 1.5rem; font-weight: bold; color: #333; min-width: 80px;">
                            <span id="current-inning"><%= match.match_data?.current_inning || 1 %></span>íšŒ<span id="inning-type"><%= match.match_data?.inning_type === 'bottom' ? 'ë§' : 'ì´ˆ' %></span>
                        </div>
                        <button class="btn btn-outline-success" onclick="updateInning(1)" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 16px;">
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                    
                    <!-- ì ìˆ˜ ì»¨íŠ¸ë¡¤ -->
                    <div class="score-controls-section mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div style="font-size: 1rem; color: #6c757d; font-weight: 600;">ì ìˆ˜</div>
                            <button class="btn btn-outline-warning btn-sm" onclick="resetAllScores()" title="ëª¨ë“  ì ìˆ˜ ì´ˆê¸°í™”">
                                <i class="bi bi-arrow-clockwise"></i> ì´ˆê¸°í™”
                            </button>
                        </div>
                        <div class="row g-1">
                            <div class="col-6">
                                <div class="text-center mb-2" style="font-size: 1rem; color: #6c757d; font-weight: 600;">í™ˆ</div>
                                <div class="d-flex justify-content-center align-items-center gap-2">
                                    <button class="btn btn-outline-danger" onclick="updateScore('home', -1)" style="width: 36px; height: 36px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 16px;">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="updateScore('home', 1)" style="width: 36px; height: 36px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 16px;">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <input type="number" id="home-score" class="score-input" value="<%= match.home_score || 0 %>" min="0" style="width: 60px; height: 36px; text-align: center; font-size: 18px; font-weight: bold; border-radius: 6px; border: 2px solid #007bff; padding: 4px;">
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center mb-2" style="font-size: 1rem; color: #6c757d; font-weight: 600;">ì›ì •</div>
                                <div class="d-flex justify-content-center align-items-center gap-2">
                                    <input type="number" id="away-score" class="score-input" value="<%= match.away_score || 0 %>" min="0" style="width: 60px; height: 36px; text-align: center; font-size: 18px; font-weight: bold; border-radius: 6px; border: 2px solid #007bff; padding: 4px;">
                                    <button class="btn btn-outline-danger" onclick="updateScore('away', -1)" style="width: 36px; height: 36px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 16px;">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="updateScore('away', 1)" style="width: 36px; height: 36px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 16px;">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì´ë‹ë³„ ì ìˆ˜ ì…ë ¥ í•„ë“œ (ìˆ¨ê¹€ ì²˜ë¦¬) -->
                        <div style="display: none;">
                            <% for(let i = 1; i <= 9; i++) { %>
                                <input type="number" id="home-inning-<%= i %>" value="<%= match.match_data?.innings?.[`home_${i}`] || '0' %>" min="0">
                                <input type="number" id="away-inning-<%= i %>" value="<%= match.match_data?.innings?.[`away_${i}`] || '0' %>" min="0">
                            <% } %>
                        </div>
                    </div>
                    
                    <!-- íŒ€ ìœ„ì¹˜ ë³€ê²½ ë²„íŠ¼ -->
                    <div class="text-center">
                        <button class="btn btn-warning btn-sm" onclick="swapTeams()" style="width: 100%; padding: 8px; font-size: 0.9rem;">
                            <i class="bi bi-arrow-left-right"></i> ìœ„ì¹˜ë³€ê²½
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ì›ì •íŒ€ ì„¹ì…˜ -->
            <div class="col-4 text-center">
                <div class="team-logo-container mb-1" id="away-team-logo-container" style="width: 63px; height: 63px; margin: 0 auto; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px solid #dee2e6;">
                    <span style="font-size: 0.9rem; color: #6c757d;">ë¡œê³ </span>
                </div>
                <div style="font-weight:700; font-size:1.4rem; margin-bottom: 5px;" id="away-team-display">
                    <%= match.away_team || 'AWAY' %>
                </div>
                <button class="btn btn-sm btn-outline-primary" onclick="openTeamNameModal('away')" style="font-size: 1rem; padding: 6px 12px;">
                    <i class="bi bi-pencil"></i> ìˆ˜ì •
                </button>
            </div>
        </div>

        

        

        

        
        <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
        <div class="game-controls-container" style="display: flex; justify-content: center; align-items: center; margin-top: 0px;">
            <div class="row justify-content-center" style="width: 100%; max-width: 800px;">
                <!-- ë² ì´ìŠ¤ ì»¨íŠ¸ë¡¤ -->
                <div class="col-md-6 col-lg-5 mb-2">
                    <div class="game-status-section" style="background-color: #f8f9fa; border-radius: 12px; padding: 45px 15px 25px 15px; border: 2px solid #dee2e6; text-align: center;">

                        <div class="base-controls d-flex justify-content-center mb-3" style="margin-top: -15px;">
                            <div class="diamond">
                                <div class="base first" id="first-base" onclick="toggleBase('first')"></div>
                                <div class="base second" id="second-base" onclick="toggleBase('second')"></div>
                                <div class="base third" id="third-base" onclick="toggleBase('third')"></div>
                                <div class="base home"></div>
                            </div>
                        </div>
                        <button class="reset-button" onclick="clearBases()" style="width: 100%; padding: 8px; font-size: 0.9rem; margin-top: 20px; margin-bottom: 1px;">
                            <i class="bi bi-arrow-counterclockwise"></i> ë² ì´ìŠ¤ í´ë¦¬ì–´
                        </button>
                    </div>
                </div>
                
                <!-- ë³¼ì¹´ìš´íŠ¸ ì»¨íŠ¸ë¡¤ -->
                <div class="col-md-6 col-lg-5 mb-2">
                    <div class="game-status-section" style="background-color: #f8f9fa; border-radius: 12px; padding: 30px 15px 22px 15px; border: 2px solid #dee2e6; text-align: center;">

                        <div class="count-section" style="margin-top: -15px;">
                            <div class="count-row" style="margin-bottom: 0.1rem; display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center;">
                                    <span class="count-label" style="font-size: 1rem; font-weight: 600; color: #495057; margin-right: 10px;">B</span>
                                    <div class="count-dots" style="display: inline-flex; gap: 8px; margin-right: 10px;">
                                        <div class="count-dot ball" id="ball-1" onclick="toggleCount('ball', 0)" style="width: 25px; height: 25px;"></div>
                                        <div class="count-dot ball" id="ball-2" onclick="toggleCount('ball', 1)" style="width: 25px; height: 25px;"></div>
                                        <div class="count-dot ball" id="ball-3" onclick="toggleCount('ball', 2)" style="width: 25px; height: 25px;"></div>
                                    </div>
                                </div>
                                <div class="count-controls" style="display: inline-flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline-warning" onclick="decrementCount('ball')" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="incrementCount('ball')" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="count-row" style="margin-bottom: 0.1rem; display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center;">
                                    <span class="count-label" style="font-size: 1rem; font-weight: 600; color: #495057; margin-right: 10px;">S</span>
                                    <div class="count-dots" style="display: inline-flex; gap: 8px; margin-right: 10px;">
                                        <div class="count-dot strike" id="strike-1" onclick="toggleCount('strike', 0)" style="width: 25px; height: 25px;"></div>
                                        <div class="count-dot strike" id="strike-2" onclick="toggleCount('strike', 1)" style="width: 25px; height: 25px;"></div>
                                    </div>
                                </div>
                                <div class="count-controls" style="display: inline-flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline-danger" onclick="decrementCount('strike')" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="incrementCount('strike')" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="count-row" style="margin-bottom: 0.1rem; display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center;">
                                    <span class="count-label" style="font-size: 1rem; font-weight: 600; color: #495057; margin-right: 10px;">O</span>
                                    <div class="count-dots" style="display: inline-flex; gap: 8px; margin-right: 10px;">
                                        <div class="count-dot out" id="out-1" onclick="toggleCount('out', 0)" style="width: 25px; height: 25px;"></div>
                                        <div class="count-dot out" id="out-2" onclick="toggleCount('out', 1)" style="width: 25px; height: 25px;"></div>
                                        <div class="count-dot out" id="out-3" onclick="toggleCount('out', 2)" style="width: 25px; height: 25px;"></div>
                                    </div>
                                </div>
                                <div class="count-controls" style="display: inline-flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="decrementCount('out')" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="incrementCount('out')" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="reset-button" onclick="resetCounts()" style="width: 100%; padding: 8px; font-size: 0.9rem; margin-top: 5px;">
                                <i class="bi bi-arrow-counterclockwise"></i> ì¹´ìš´íŠ¸ ë¦¬ì…‹
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ë¦¬ìŠ¤íŠ¸ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
        <% if (typeof listId !== 'undefined' && listId) { %>
        <div class="row mt-3">
            <div class="col-12">
                <div class="d-flex justify-content-between gap-2 mb-2">
                    <button class="btn btn-outline-secondary" onclick="prevMatch()" style="flex: 1;">
                        <i class="bi bi-chevron-left"></i> ì´ì „ê²½ê¸°
                    </button>
                    <button class="btn btn-outline-secondary" onclick="nextMatch()" style="flex: 1;">
                        ë‹¤ìŒê²½ê¸° <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-success" onclick="pushToIntegratedOverlay()" style="flex: 1;">
                        <i class="bi bi-display"></i> í†µí•© URLì— í‘¸ì‹œ
                    </button>
                    <button class="btn btn-warning" onclick="forceRefreshOverlay()" style="flex: 1;">
                        <i class="bi bi-arrow-clockwise"></i> ê°•ì œ ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>
        </div>
        <% } %>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const matchId = '<%= match.id %>';
        
        // Socket.IO ì—°ê²° ìƒíƒœ í™•ì¸
        socket.on('connect', () => {
            console.log('=== Socket.IO ì—°ê²°ë¨ (ëª¨ë°”ì¼) ===');
            console.log('Socket ID:', socket.id);
            console.log('Match ID:', matchId);
        });
        
        socket.on('disconnect', () => {
            console.log('=== Socket.IO ì—°ê²° ëŠì–´ì§ (ëª¨ë°”ì¼) ===');
        });
        
        socket.on('connect_error', (error) => {
            console.error('=== Socket.IO ì—°ê²° ì˜¤ë¥˜ (ëª¨ë°”ì¼) ===', error);
        });
        
        // ì ìˆ˜ ë³€ê²½ ì´ë²¤íŠ¸ (ì„œë²„ ìƒíƒœ í™•ì¸ í›„ ì—…ë°ì´íŠ¸)
        async function updateScore(team, change) {
            if (change < 0) {
                // - ë²„íŠ¼: ì—­ìˆœìœ¼ë¡œ ì ìˆ˜ ì‚­ì œ
                await decreaseScoreReverse(team, Math.abs(change));
            } else {
                // + ë²„íŠ¼: ê¸°ì¡´ ë°©ì‹
                await increaseScore(team, change);
            }
        }
        
        // + ë²„íŠ¼ ë™ì‘ (ì¼ë°˜ ì»¨íŠ¸ë¡¤ íŒ¨ë„ê³¼ ì™„ì „íˆ ë™ì¼)
        async function increaseScore(team, change) {
            try {
                console.log(`=== ì ìˆ˜ ì¦ê°€ ì‹œì‘: ${team}íŒ€ +${change} ===`);
                
                // 1. ì„œë²„ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/matches/${matchId}`);
                if (!response.ok) {
                    throw new Error('ì„œë²„ì—ì„œ ê²½ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const matchData = await response.json();
                console.log('ì„œë²„ì—ì„œ ë°›ì€ ìµœì‹  ë°ì´í„°:', matchData);
                
                // 2. ì„œë²„ ìƒíƒœë¡œ UI ë™ê¸°í™” (ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³€ê²½ëœ ê²½ìš°ë§Œ)
                // ëª¨ë°”ì¼ì—ì„œëŠ” ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šê³  ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¼
                
                // 3. í˜„ì¬ ì´ë‹ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const currentInning = parseInt(document.getElementById('current-inning').textContent) || 1;
                const inningType = document.getElementById('inning-type').textContent === 'ë§' ? 'bottom' : 'top';
                
                // 4. í˜„ì¬ ì´ë‹ì˜ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸° (UIì—ì„œ)
                const currentInningElement = document.getElementById(`${team}-inning-${currentInning}`);
                const currentInningScore = parseInt(currentInningElement?.value) || 0;
                const newInningScore = Math.max(0, currentInningScore + change);
                
                console.log(`ì´ë‹ ì ìˆ˜ ë³€ê²½: ${team}íŒ€ ${currentInning}íšŒ ${currentInningScore} + ${change} = ${newInningScore}`);
                
                // 5. UI ì—…ë°ì´íŠ¸ (ì´ë‹ ì ìˆ˜)
                if (currentInningElement) {
                    currentInningElement.value = newInningScore;
                }
                
                // 6. ì´ ì ìˆ˜ ìë™ ê³„ì‚°
                updateTotalScores();
                
                // 7. ì„œë²„ì— ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì „ì†¡
                socket.emit('baseball_inning_score_update', {
                    matchId: matchId,
                    team: team,
                    inning: currentInning,
                    inningType: inningType,
                    score: newInningScore,
                    change: change
                });
                
                updateMatchInfo();
                
                // 6. ë¡œì»¬ ê³„ì‚°ê°’ìœ¼ë¡œ ìµœì¢… ì ìˆ˜ í™•ì • (ì„œë²„ ë°ì´í„°ë³´ë‹¤ ë¡œì»¬ ê³„ì‚° ìš°ì„ )
                setTimeout(() => {
                    // ë¡œì»¬ì—ì„œ ê³„ì‚°í•œ ì ìˆ˜ë¡œ ìµœì¢… ì—…ë°ì´íŠ¸
                    updateTotalScores();
                    console.log('ë¡œì»¬ ê³„ì‚°ê°’ìœ¼ë¡œ ìµœì¢… ì ìˆ˜ í™•ì • ì™„ë£Œ');
                }, 1000); // 1ì´ˆ í›„ ë¡œì»¬ ê³„ì‚°ê°’ìœ¼ë¡œ ìµœì¢… í™•ì •
                
                console.log(`=== ì ìˆ˜ ì¦ê°€ ì™„ë£Œ: ${team}íŒ€ ${currentInning}íšŒ ${newInningScore} ===`);
                
            } catch (error) {
                console.error('ì ìˆ˜ ì¦ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì ìˆ˜ ì¦ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ì–‘íŒ€ ì´ ì ìˆ˜ ìë™ ê³„ì‚° í•¨ìˆ˜ (ì¼ë°˜ ì»¨íŠ¸ë¡¤ í˜ì´ì§€ì™€ ë™ì¼)
        function updateTotalScores() {
            let homeTotal = 0;
            let awayTotal = 0;
            
            // í™ˆíŒ€ ì´ë‹ë³„ ìŠ¤ì½”ì–´ í•©ê³„
            for (let i = 1; i <= 9; i++) {
                const homeInningElement = document.getElementById(`home-inning-${i}`);
                if (homeInningElement) {
                    homeTotal += parseInt(homeInningElement.value) || 0;
                }
            }
            
            // ì›ì •íŒ€ ì´ë‹ë³„ ìŠ¤ì½”ì–´ í•©ê³„
            for (let i = 1; i <= 9; i++) {
                const awayInningElement = document.getElementById(`away-inning-${i}`);
                if (awayInningElement) {
                    awayTotal += parseInt(awayInningElement.value) || 0;
                }
            }
            
            // ì´ ì ìˆ˜ UI ì—…ë°ì´íŠ¸
            const homeScoreElement = document.getElementById('home-score');
            const awayScoreElement = document.getElementById('away-score');
            
            if (homeScoreElement) {
                homeScoreElement.value = homeTotal;
            }
            if (awayScoreElement) {
                awayScoreElement.value = awayTotal;
            }
            
            console.log(`ì´ ì ìˆ˜ ê³„ì‚° ì™„ë£Œ: í™ˆíŒ€ ${homeTotal}, ì›ì •íŒ€ ${awayTotal}`);
        }
        
        // - ë²„íŠ¼ ë™ì‘ (ì—­ìˆœìœ¼ë¡œ ì ìˆ˜ ì‚­ì œ) - ì¼ë°˜ ì»¨íŠ¸ë¡¤ íŒ¨ë„ê³¼ ì™„ì „íˆ ë™ì¼
        async function decreaseScoreReverse(team, amount) {
            try {
                console.log(`=== ì ìˆ˜ ê°ì†Œ ì‹œì‘: ${team}íŒ€ -${amount} (ì—­ìˆœ ì‚­ì œ) ===`);
                
                // 1. ì„œë²„ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/matches/${matchId}`);
                if (!response.ok) {
                    throw new Error('ì„œë²„ì—ì„œ ê²½ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const matchData = await response.json();
                const innings = matchData.match_data?.innings || {};
                
                // 2. ì„œë²„ ìƒíƒœë¡œ UI ë™ê¸°í™” (ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³€ê²½ëœ ê²½ìš°ë§Œ)
                // ëª¨ë°”ì¼ì—ì„œëŠ” ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šê³  ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¼
                
                // 3. ì—­ìˆœìœ¼ë¡œ ì ìˆ˜ ì‚­ì œ
                let remainingAmount = amount;
                const currentInning = parseInt(document.getElementById('current-inning').textContent) || 1;
                
                // í˜„ì¬ ì´ë‹ë¶€í„° ì—­ìˆœìœ¼ë¡œ ì ìˆ˜ ì‚­ì œ
                for (let i = currentInning; i >= 1 && remainingAmount > 0; i--) {
                    const currentInningElement = document.getElementById(`${team}-inning-${i}`);
                    const currentInningScore = parseInt(currentInningElement?.value) || 0;
                    const decreaseAmount = Math.min(remainingAmount, currentInningScore);
                    
                    if (decreaseAmount > 0) {
                        const newInningScore = currentInningScore - decreaseAmount;
                        remainingAmount -= decreaseAmount;
                        
                        console.log(`${team}íŒ€ ${i}íšŒ: ${currentInningScore} - ${decreaseAmount} = ${newInningScore}`);
                        
                        // UI ì—…ë°ì´íŠ¸ (ì´ë‹ ì ìˆ˜)
                        if (currentInningElement) {
                            currentInningElement.value = newInningScore;
                        }
                        
                        // ì„œë²„ì— ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì „ì†¡
                        const inningType = i === currentInning ? 
                            (document.getElementById('inning-type').textContent === 'ë§' ? 'bottom' : 'top') : 
                            (i % 2 === 0 ? 'bottom' : 'top');
                        
                        socket.emit('baseball_inning_score_update', {
                            matchId: matchId,
                            team: team,
                            inning: i,
                            inningType: inningType,
                            score: newInningScore,
                            change: -decreaseAmount
                        });
                    }
                }
                
                // ì´ ì ìˆ˜ ìë™ ê³„ì‚°
                updateTotalScores();
                
                updateMatchInfo();
                
                // ë¡œì»¬ ê³„ì‚°ê°’ìœ¼ë¡œ ìµœì¢… ì ìˆ˜ í™•ì • (ì„œë²„ ë°ì´í„°ë³´ë‹¤ ë¡œì»¬ ê³„ì‚° ìš°ì„ )
                setTimeout(() => {
                    // ë¡œì»¬ì—ì„œ ê³„ì‚°í•œ ì ìˆ˜ë¡œ ìµœì¢… ì—…ë°ì´íŠ¸
                    updateTotalScores();
                    console.log('ë¡œì»¬ ê³„ì‚°ê°’ìœ¼ë¡œ ìµœì¢… ì ìˆ˜ í™•ì • ì™„ë£Œ (ê°ì†Œ)');
                }, 1000); // 1ì´ˆ í›„ ë¡œì»¬ ê³„ì‚°ê°’ìœ¼ë¡œ ìµœì¢… í™•ì •
                
                console.log(`=== ì ìˆ˜ ê°ì†Œ ì™„ë£Œ: ${team}íŒ€ -${amount} ===`);
                
            } catch (error) {
                console.error('ì ìˆ˜ ê°ì†Œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì ìˆ˜ ê°ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ëª¨ë“  ì ìˆ˜ ì´ˆê¸°í™” í•¨ìˆ˜
        async function resetAllScores() {
            if (!confirm('ëª¨ë“  ì ìˆ˜ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì´ë‹ë³„ ì ìˆ˜ì™€ ì´ ì ìˆ˜ê°€ ëª¨ë‘ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)')) {
                return;
            }
            
            try {
                console.log('=== ëª¨ë“  ì ìˆ˜ ì´ˆê¸°í™” ì‹œì‘ ===');
                
                // 1. ì„œë²„ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/matches/${matchId}`);
                if (!response.ok) {
                    throw new Error('ì„œë²„ì—ì„œ ê²½ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const matchData = await response.json();
                console.log('ì„œë²„ì—ì„œ ë°›ì€ ìµœì‹  ë°ì´í„°:', matchData);
                
                // 2. ì„œë²„ ìƒíƒœë¡œ UI ë™ê¸°í™”
                const serverHomeScore = matchData.home_score || 0;
                const serverAwayScore = matchData.away_score || 0;
                
                const homeScoreElement = document.getElementById('home-score');
                const awayScoreElement = document.getElementById('away-score');
                
                if (homeScoreElement) {
                    homeScoreElement.value = serverHomeScore;
                }
                if (awayScoreElement) {
                    awayScoreElement.value = serverAwayScore;
                }
                
                // 3. ëª¨ë“  ì´ë‹ ìŠ¤ì½”ì–´ ì´ˆê¸°í™”
                for (let i = 1; i <= 9; i++) {
                    const homeInningElement = document.getElementById(`home-inning-${i}`);
                    const awayInningElement = document.getElementById(`away-inning-${i}`);
                    
                    if (homeInningElement) {
                        homeInningElement.value = '0';
                    }
                    if (awayInningElement) {
                        awayInningElement.value = '0';
                    }
                }
                
                // 4. ì´ ì ìˆ˜ ì´ˆê¸°í™”
                if (homeScoreElement) {
                    homeScoreElement.value = '0';
                }
                if (awayScoreElement) {
                    awayScoreElement.value = '0';
                }
                
                // 4. ì„œë²„ì— ëª¨ë“  ì´ë‹ ìŠ¤ì½”ì–´ ì´ˆê¸°í™” ì „ì†¡ (ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬)
                for (let i = 1; i <= 9; i++) {
                    // í™ˆíŒ€ ì´ë‹ ì´ˆê¸°í™”
                    socket.emit('baseball_inning_score_update', {
                        matchId: matchId,
                        team: 'home',
                        inning: i,
                        inningType: 'top',
                        score: 0,
                        change: 0
                    });
                    
                    // ì›ì •íŒ€ ì´ë‹ ì´ˆê¸°í™”
                    socket.emit('baseball_inning_score_update', {
                        matchId: matchId,
                        team: 'away',
                        inning: i,
                        inningType: 'bottom',
                        score: 0,
                        change: 0
                    });
                    
                    console.log(`ì´ë‹ ${i} ì´ˆê¸°í™” ì „ì†¡: í™ˆíŒ€=0, ì›ì •íŒ€=0`);
                }
                
                // 5. APIë¥¼ í†µí•´ì„œë„ ì—…ë°ì´íŠ¸ (ëª¨ë“  ì´ë‹ ì´ˆê¸°í™”)
                updateMatchInfo(true);
                
                console.log('=== ëª¨ë“  ì ìˆ˜ ì´ˆê¸°í™” ì™„ë£Œ ===');
                alert('ëª¨ë“  ì ìˆ˜ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('ì ìˆ˜ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì ìˆ˜ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ë² ì´ìŠ¤ í† ê¸€ í•¨ìˆ˜
        function toggleBase(baseId) {
            const base = document.querySelector(`.base.${baseId}`);
            base.classList.toggle('active');
            console.log(`${baseId} ë² ì´ìŠ¤ í† ê¸€:`, base.classList.contains('active'));
            updateMatchInfo();
        }
        
        // ì¹´ìš´íŠ¸ í† ê¸€ í•¨ìˆ˜
        function toggleCount(type, index) {
            const dots = document.querySelectorAll(`.count-dot.${type}`);
            const currentActive = document.querySelectorAll(`.count-dot.${type}.active`).length;
            
            // í´ë¦­í•œ ì¸ë±ìŠ¤ê¹Œì§€ í™œì„±í™”
            dots.forEach((dot, i) => {
                if (i <= index) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
            
            updateMatchInfo();
        }
        
        // ì¹´ìš´íŠ¸ ì¦ê°€ í•¨ìˆ˜
        function incrementCount(type) {
            const dots = document.querySelectorAll(`.count-dot.${type}`);
            const currentActive = document.querySelectorAll(`.count-dot.${type}.active`).length;
            const maxCount = type === 'ball' ? 3 : type === 'strike' ? 2 : 3;
            
            if (currentActive < maxCount) {
                dots[currentActive].classList.add('active');
            }
            updateMatchInfo();
        }
        
        // ì¹´ìš´íŠ¸ ê°ì†Œ í•¨ìˆ˜
        function decrementCount(type) {
            const dots = document.querySelectorAll(`.count-dot.${type}`);
            const currentActive = document.querySelectorAll(`.count-dot.${type}.active`).length;
            
            if (currentActive > 0) {
                dots[currentActive - 1].classList.remove('active');
            }
            updateMatchInfo();
        }
        
        // ì´ë‹ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateInning(change) {
            const inningSpan = document.getElementById('current-inning');
            const typeSpan = document.getElementById('inning-type');
            let currentInning = parseInt(inningSpan.textContent);
            let isBottom = typeSpan.textContent === 'ë§';
            
            if (change > 0) {
                if (isBottom) {
                    currentInning++;
                    isBottom = false;
                } else {
                    isBottom = true;
                }
            } else {
                if (!isBottom) {
                    currentInning--;
                    isBottom = true;
                } else {
                    isBottom = false;
                }
            }
            
            if (currentInning < 1) currentInning = 1;
            
            inningSpan.textContent = currentInning;
            typeSpan.textContent = isBottom ? 'ë§' : 'ì´ˆ';
            
            // ì´ë‹ ë³€ê²½ ì‹œ ë² ì´ìŠ¤ ìƒíƒœì™€ ë³¼ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            resetBases();
            resetCounts();
            
            updateMatchInfo();
        }
        
        // ì´ë‹ íƒ€ì… í† ê¸€
        function toggleInningType() {
            const inningType = document.getElementById('inning-type');
            const currentType = inningType.textContent;
            inningType.textContent = currentType === 'ì´ˆ' ? 'ë§' : 'ì´ˆ';
            
            // ì´ë‹ íƒ€ì… ë³€ê²½ ì‹œ ë² ì´ìŠ¤ ìƒíƒœì™€ ë³¼ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            clearBases();
            resetCounts();
            
            updateMatchInfo();
        }
        

        

        
        // ì¹´ìš´íŠ¸ ë¦¬ì…‹
        function resetCounts() {
            document.querySelectorAll('.count-dot').forEach(dot => {
                dot.classList.remove('active');
            });
            updateMatchInfo();
        }
        
        // ë² ì´ìŠ¤ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetBases() {
            document.getElementById('first-base').classList.remove('active');
            document.getElementById('second-base').classList.remove('active');
            document.getElementById('third-base').classList.remove('active');
        }
        
        // ë² ì´ìŠ¤ í´ë¦¬ì–´
        function clearBases() {
            resetBases();
            updateMatchInfo();
        }
        
        // ì„œë²„ì™€ ì†Œì¼“ ì—°ê²°
        socket.on('connect', () => {
            socket.emit('join', matchId);
            
            // ì•¼êµ¬ ì¢…ëª©ë³„ Room ì°¸ì—¬
            socket.emit('join_sport_room', 'BASEBALL');
            console.log('ğŸ”§ ì•¼êµ¬ ëª¨ë°”ì¼ ì¢…ëª©ë³„ Room ì°¸ì—¬ ìš”ì²­: sport_BASEBALL');
        });
        
        // íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ì €ì¥
        async function saveTeamLogoVisibility() {
            const useLogos = document.getElementById('use-team-logos').checked;
            try {
                const response = await fetch('/api/baseball-team-logo-visibility', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ matchId: matchId, useLogos: useLogos })
                });
                if (!response.ok) throw new Error('íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ì €ì¥ ì‹¤íŒ¨');
                console.log('íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ì €ì¥ ì™„ë£Œ:', useLogos);
            } catch (error) {
                console.error('íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        // íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadTeamLogoVisibility() {
            try {
                const response = await fetch(`/api/baseball-team-logo-visibility/${matchId}`);
                if (response.ok) {
                    const data = await response.json();
                    const useLogos = data.useLogos;
                    console.log('íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°:', useLogos);
                    const checkbox = document.getElementById('use-team-logos');
                    if (checkbox) {
                        checkbox.checked = useLogos;
                    }
                } else {
                    console.log('íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©');
                }
            } catch (error) {
                console.error('íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
            }
        }

        // ì„œë²„ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ë¡œë”© (match_data ê¸°ë°˜)
        async function loadCurrentMatchData() {
            try {
                console.log('=== ì„œë²„ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ë¡œë”© ì‹œì‘ ===');
                
                // 1. Match í…Œì´ë¸”ì—ì„œ ê²½ê¸° ë°ì´í„° ì¡°íšŒ
                const response = await fetch(`/api/matches/${matchId}`);
                
                if (response.ok) {
                    const matchData = await response.json();
                    console.log('Match í…Œì´ë¸”ì—ì„œ ë°›ì€ ë°ì´í„°:', matchData);
                    
                    // Match í…Œì´ë¸”ì˜ ì´ ì ìˆ˜ ì‚¬ìš©
                    const homeScore = matchData.home_score || 0;
                    const awayScore = matchData.away_score || 0;
                    
                    console.log('Match ì´ ì ìˆ˜:', { homeScore, awayScore });
                    
                    // UI ì—…ë°ì´íŠ¸
                    const homeScoreElement = document.getElementById('home-score');
                    const awayScoreElement = document.getElementById('away-score');
                    
                    if (homeScoreElement) {
                        homeScoreElement.value = homeScore;
                        console.log(`í™ˆíŒ€ ì ìˆ˜ ì„¤ì •: ${homeScore}`);
                    }
                    if (awayScoreElement) {
                        awayScoreElement.value = awayScore;
                        console.log(`ì›ì •íŒ€ ì ìˆ˜ ì„¤ì •: ${awayScore}`);
                    }
                    
                    // ì´ë‹ë³„ ìŠ¤ì½”ì–´ ë°ì´í„° í™•ì¸ (match_dataì˜ innings)
                    const innings = matchData.match_data?.innings || {};
                    console.log('Match ì´ë‹ë³„ ìŠ¤ì½”ì–´:', innings);
                    
                    // ìˆ¨ê²¨ì§„ ì´ë‹ë³„ ì ìˆ˜ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                    for (let i = 1; i <= 9; i++) {
                        const homeInningElement = document.getElementById(`home-inning-${i}`);
                        const awayInningElement = document.getElementById(`away-inning-${i}`);
                        
                        if (homeInningElement && innings.home && innings.home[i] !== undefined) {
                            homeInningElement.value = innings.home[i];
                        }
                        if (awayInningElement && innings.away && innings.away[i] !== undefined) {
                            awayInningElement.value = innings.away[i];
                        }
                    }
                    
                    console.log('=== Match í…Œì´ë¸”ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ë¡œë”© ì™„ë£Œ ===');
                } else {
                    console.error('Match ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', response.status);
                }
            } catch (error) {
                console.error('í˜„ì¬ ê²½ê¸° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
            }
        }

        // íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ í•¨ìˆ˜ (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë¡œì§)
        async function loadTeamLogos() {
            try {
                console.log('íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ ì‹œì‘...');
                
                // 1. DBì—ì„œ íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ (ìµœìš°ì„ ìˆœìœ„) - ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹
                try {
                    const response = await fetch(`/api/matches/${matchId}/team-logos`);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ ì„±ê³µ:', result.teamLogos);
                        
                        if (result.teamLogos && result.teamLogos.length > 0) {
                            // ê° íŒ€ì˜ ë¡œê³  ì •ë³´ ì—…ë°ì´íŠ¸ (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹)
                            result.teamLogos.forEach(teamInfo => {
                                const teamType = teamInfo.team_type;
                                console.log(`${teamType}íŒ€ ë¡œê³  ì •ë³´ ì—…ë°ì´íŠ¸:`, teamInfo);
                                
                                // ë¡œê³  ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹)
                                const logoContainer = document.getElementById(`${teamType}-team-logo-container`);
                                if (logoContainer && teamInfo.logo_path) {
                                    logoContainer.style.backgroundColor = teamInfo.logo_bg_color || '#ffffff';
                                    logoContainer.innerHTML = `
                                        <img src="${teamInfo.logo_path}" alt="${teamInfo.team_name} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
                                    `;
                                }
                                
                                // ë°°ê²½ìƒ‰ ì„ íƒê¸° ì—…ë°ì´íŠ¸
                                const colorInput = document.querySelector(`.${teamType}-team-colorbg`);
                                if (colorInput && teamInfo.logo_bg_color) {
                                    colorInput.value = teamInfo.logo_bg_color;
                                }
                            });
                            return; // ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìœ¼ë©´ ì¢…ë£Œ
                        }
                    }
                } catch (dbError) {
                    console.error('íŒ€ë¡œê³  DB ì¡°íšŒ ì˜¤ë¥˜:', dbError);
                }
                
                // 2. íŒ€ ë¡œê³  ë§µ ì •ë³´ ë¡œë“œ (ë°±ì—…) - ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹
                try {
                    const response = await fetch('/api/overlay-images/TEAMLOGO/BASEBALL/');
                    if (response.ok) {
                        const data = await response.json();
                        if (data && data.teamLogoMap) {
                            const homeTeamName = '<%= match.home_team %>';
                            const awayTeamName = '<%= match.away_team %>';
                            
                            console.log('ì‚¬ìš© ê°€ëŠ¥í•œ íŒ€ë“¤:', Object.keys(data.teamLogoMap));
                            console.log('í˜„ì¬ ê²½ê¸° íŒ€ëª…:', { homeTeamName, awayTeamName });
                            
                            // í™ˆíŒ€ ë¡œê³  ì„¤ì • (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹)
                            if (data.teamLogoMap[homeTeamName]) {
                                const homeLogoContainer = document.getElementById('home-team-logo-container');
                                if (homeLogoContainer) {
                                    homeLogoContainer.style.backgroundColor = data.teamLogoMap[homeTeamName].bgColor || '#ffffff';
                                    homeLogoContainer.innerHTML = `
                                        <img src="${data.teamLogoMap[homeTeamName].path}" alt="${homeTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
                                    `;
                                }
                                
                                console.log('í™ˆíŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ (íŒ€ ë§µ):', data.teamLogoMap[homeTeamName]);
                            }
                            
                            // ì–´ì›¨ì´íŒ€ ë¡œê³  ì„¤ì • (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹)
                            if (data.teamLogoMap[awayTeamName]) {
                                const awayLogoContainer = document.getElementById('away-team-logo-container');
                                if (awayLogoContainer) {
                                    awayLogoContainer.style.backgroundColor = data.teamLogoMap[awayTeamName].bgColor || '#ffffff';
                                    awayLogoContainer.innerHTML = `
                                        <img src="${data.teamLogoMap[awayTeamName].path}" alt="${awayTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
                                    `;
                                }
                                
                                console.log('ì–´ì›¨ì´íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ (íŒ€ ë§µ):', data.teamLogoMap[awayTeamName]);
                            }
                        }
                    }
                } catch (mapError) {
                    console.error('íŒ€ ë¡œê³  ë§µ ì¡°íšŒ ì˜¤ë¥˜:', mapError);
                }
                
            } catch (error) {
                console.error('íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ìƒíƒœ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('=== ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ===');
            console.log('í˜„ì¬ matchId:', matchId);
            
            // ì„œë²„ì—ì„œ ìµœì‹  ê²½ê¸° ë°ì´í„° ë¡œë”©
            await loadCurrentMatchData();
            
            // íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°
            await loadTeamLogoVisibility();
            
            // íŒ€ë¡œê³  ì‚¬ìš© ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const useTeamLogosCheckbox = document.getElementById('use-team-logos');
            if (useTeamLogosCheckbox) {
                useTeamLogosCheckbox.addEventListener('change', async function() {
                    console.log('=== ì•¼êµ¬ ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ íŒ¨ë„: íŒ€ë¡œê³  ì‚¬ìš© ìƒíƒœ ë³€ê²½ ===');
                    console.log('ìƒˆë¡œìš´ ìƒíƒœ:', this.checked);
                    await saveTeamLogoVisibility();
                    
                    // ì†Œì¼“ì„ í†µí•´ ì˜¤ë²„ë ˆì´ì— ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì „ì†¡
                    socket.emit('teamLogoVisibilityChanged', {
                        matchId: matchId,
                        useLogos: this.checked
                    });
                });
            }
            
            // íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼í•œ ë°©ì‹)
            await loadTeamLogos();
            
            // í˜„ì¬ ë² ì´ìŠ¤ ìƒíƒœ í‘œì‹œ
            const matchData = <%- JSON.stringify(match.match_data || {}) %>;
            console.log('ì´ˆê¸° ë² ì´ìŠ¤ ìƒíƒœ:', matchData);
            
            if (matchData.first_base) {
                const firstBase = document.querySelector('.base.first');
                if (firstBase) firstBase.classList.add('active');
            }
            if (matchData.second_base) {
                const secondBase = document.querySelector('.base.second');
                if (secondBase) secondBase.classList.add('active');
            }
            if (matchData.third_base) {
                const thirdBase = document.querySelector('.base.third');
                if (thirdBase) thirdBase.classList.add('active');
            }
            
            // í˜„ì¬ ë³¼ì¹´ìš´íŠ¸ í‘œì‹œ
            const balls = matchData.balls || 0;
            const strikes = matchData.strikes || 0;
            const outs = matchData.outs || 0;
            
            // ë³¼ í‘œì‹œ
            for (let i = 0; i < balls; i++) {
                const ballDot = document.getElementById(`ball-${i + 1}`);
                if (ballDot) ballDot.classList.add('active');
            }
            
            // ìŠ¤íŠ¸ë¼ì´í¬ í‘œì‹œ
            for (let i = 0; i < strikes; i++) {
                const strikeDot = document.getElementById(`strike-${i + 1}`);
                if (strikeDot) strikeDot.classList.add('active');
            }
            
            // ì•„ì›ƒ í‘œì‹œ
            for (let i = 0; i < outs; i++) {
                const outDot = document.getElementById(`out-${i + 1}`);
                if (outDot) outDot.classList.add('active');
            }
        });
        
        // ì ìˆ˜/ì¹´ìš´íŠ¸/ì´ë‹ ë³€ê²½ ì‹œ ì„œë²„ì— ì—…ë°ì´íŠ¸ (ì¼ë°˜ ì»¨íŠ¸ë¡¤ íŒ¨ë„ê³¼ ë™ì¼)
        async function updateMatchInfo(resetInnings = false) {
            // ë² ì´ìŠ¤ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            const firstBase = document.getElementById('first-base').classList.contains('active');
            const secondBase = document.getElementById('second-base').classList.contains('active');
            const thirdBase = document.getElementById('third-base').classList.contains('active');
            
            // ë³¼ì¹´ìš´íŠ¸ ê°€ì ¸ì˜¤ê¸°
            const balls = document.querySelectorAll('.count-dot.ball.active').length;
            const strikes = document.querySelectorAll('.count-dot.strike.active').length;
            const outs = document.querySelectorAll('.count-dot.out.active').length;
            
            const formData = {
                // ì´ ì ìˆ˜ëŠ” ì „ì†¡í•˜ì§€ ì•ŠìŒ (ì„œë²„ì—ì„œ ì´ë‹ë³„ ì ìˆ˜ë¡œ ìë™ ê³„ì‚°)
                match_data: {
                    balls: balls,
                    strikes: strikes,
                    outs: outs,
                    first_base: firstBase,
                    second_base: secondBase,
                    third_base: thirdBase,
                    current_inning: parseInt(document.getElementById('current-inning').textContent) || 1,
                    inning_type: document.getElementById('inning-type').textContent === 'ë§' ? 'bottom' : 'top'
                }
            };
            
            // ì ìˆ˜ ì´ˆê¸°í™”ì¸ ê²½ìš° ëª¨ë“  ì´ë‹ì„ 0ìœ¼ë¡œ ì„¤ì •
            if (resetInnings) {
                formData.match_data.innings = {};
                for (let i = 1; i <= 9; i++) {
                    formData.match_data.innings[`home_${i}`] = 0;
                    formData.match_data.innings[`away_${i}`] = 0;
                }
                console.log('ëª¨ë“  ì´ë‹ ì ìˆ˜ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”:', formData.match_data.innings);
            }
            try {
                await fetch(`/api/matches/${matchId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ WebSocket ì´ë²¤íŠ¸ ë°œìƒ (match_updatedë¡œ í†µì¼)
                socket.emit('match_updated', {
                    matchId: matchId,
                    match_data: formData.match_data
                });
                
                console.log('ì•¼êµ¬ ê²½ê¸° ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ:', formData);
            } catch (error) {
                console.error('ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ ê´€ë ¨ ë³€ìˆ˜
        let currentMatchIndex = 0;
        let totalMatches = 0;
        let listId = null;
        let listName = null;
        
        // í˜„ì¬ ê²½ê¸°ê°€ í‘¸ì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë¦¬ìŠ¤íŠ¸ ë°•ìŠ¤ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
        async function checkPushedMatchStatus() {
            if (!listId) return;
            
            try {
                const response = await fetch(`/api/pushed-match/${listId}`);
                const result = await response.json();
                
                const listInfoBox = document.getElementById('list-info-box');
                if (listInfoBox) {
                    if (result.success && result.data && result.data.matchId === matchId) {
                        // í˜„ì¬ ê²½ê¸°ê°€ í‘¸ì‹œë˜ì–´ ìˆìŒ - ë¹¨ê°„ìƒ‰
                        listInfoBox.style.backgroundColor = '#dc3545';
                        listInfoBox.querySelector('div').style.color = '#ffffff';
                    } else {
                        // í˜„ì¬ ê²½ê¸°ê°€ í‘¸ì‹œë˜ì–´ ìˆì§€ ì•ŠìŒ - íšŒìƒ‰
                        listInfoBox.style.backgroundColor = '#e9ecef';
                        listInfoBox.querySelector('div').style.color = '#495057';
                    }
                }
            } catch (error) {
                console.error('í‘¸ì‹œëœ ê²½ê¸° ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
            }
        }
        
        <% if (typeof listId !== 'undefined' && listId) { %>
        // EJS í…œí”Œë¦¿ ë³€ìˆ˜ í• ë‹¹
        currentMatchIndex = <%- currentMatchIndex || 0 %>;
        totalMatches = <%- totalMatches || 0 %>;
        listId = '<%- listId %>';
        listName = '<%- listName %>';
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í‘¸ì‹œëœ ê²½ê¸° ìƒíƒœ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            checkPushedMatchStatus();
        });
        
        // ë‹¤ìŒ ê²½ê¸°ë¡œ ì´ë™
        async function nextMatch() {
            if (currentMatchIndex < totalMatches - 1) {
                currentMatchIndex++;
                window.location.href = `/list/${listId}/control-mobile?index=${currentMatchIndex}`;
            }
        }
        
        // ì´ì „ ê²½ê¸°ë¡œ ì´ë™
        async function prevMatch() {
            if (currentMatchIndex > 0) {
                currentMatchIndex--;
                window.location.href = `/list/${listId}/control-mobile?index=${currentMatchIndex}`;
            }
        }
        
        // ê²½ê¸° ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
        function goToList() {
            window.location.href = '/match-list-manager';
        }
        
        // URL ìƒíƒœ í™•ì¸
        async function checkOverlayStatus() {
            if (!listId) return;
            
            try {
                const response = await fetch(`/api/overlay-status/${listId}`);
                const result = await response.json();
                
                if (result.success) {
                    if (result.isActive) {
                        console.log('ì˜¤ë²„ë ˆì´ URL í™œì„± ìƒíƒœ:', result);
                        return result;
                    } else {
                        console.log('ì˜¤ë²„ë ˆì´ URL ë¹„í™œì„± ìƒíƒœ:', result.message);
                        return null;
                    }
                }
            } catch (error) {
                console.error('URL ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ê°•ì œ ìƒˆë¡œê³ ì¹¨
        async function forceRefreshOverlay() {
            if (!listId) {
                alert('ë¦¬ìŠ¤íŠ¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const response = await fetch(`/api/overlay-refresh/${listId}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ì˜¤ë²„ë ˆì´ URLì´ ê°•ì œ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    console.log('ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ:', result.message);
                } else {
                    alert('ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                console.error('ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                alert('ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í†µí•© URLì— í˜„ì¬ ê²½ê¸° í‘¸ì‹œ (ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì˜µì…˜ í¬í•¨)
        async function pushToIntegratedOverlay(forceRefresh = false) {
            console.log('=== í†µí•© URL í‘¸ì‹œ ì‹œì‘ ===');
            console.log('í˜„ì¬ matchId:', matchId);
            console.log('í˜„ì¬ listId:', listId);
            console.log('í˜„ì¬ matchIndex:', currentMatchIndex);
            console.log('ê°•ì œ ìƒˆë¡œê³ ì¹¨:', forceRefresh);
            
            // listIdê°€ ì—†ìœ¼ë©´ ê²½ê³ 
            if (!listId) {
                alert('ë¦¬ìŠ¤íŠ¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¦¬ìŠ¤íŠ¸ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            // URL ìƒíƒœ í™•ì¸ ë° í†µí•© í™•ì¸
            const status = await checkOverlayStatus();
            
            // í˜„ì¬ ê²½ê¸° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const homeTeam = document.getElementById('home-team-display').textContent.trim();
            const awayTeam = document.getElementById('away-team-display').textContent.trim();
            const homeScore = document.getElementById('home-score').value;
            const awayScore = document.getElementById('away-score').value;
            
            let confirmMessage = `í†µí•© URLì— í˜„ì¬ ê²½ê¸°ë¥¼ í‘¸ì‹œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
                `ê²½ê¸°: ${homeTeam} vs ${awayTeam}\n` +
                `ì ìˆ˜: ${homeScore} - ${awayScore}\n` +
                `ë¦¬ìŠ¤íŠ¸: ${listName} (${currentMatchIndex + 1}/${totalMatches})`;
            
            if (status && !forceRefresh) {
                confirmMessage += `\n\nâš ï¸ í˜„ì¬ ì˜¤ë²„ë ˆì´ì— ë‹¤ë¥¸ ê²½ê¸°ê°€ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤.\nê°•ì œ ìƒˆë¡œê³ ì¹¨ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
            }
            
            const confirmPush = confirm(confirmMessage);
            if (!confirmPush) {
                return;
            }
            
            if (status && !forceRefresh) {
                forceRefresh = true;
            }
            
            // WebSocketì„ í†µí•´ ë¦¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ì— ê²½ê¸° ë³€ê²½ ì•Œë¦¼
            const pushData = {
                listId: listId,
                matchIndex: currentMatchIndex,
                matchId: matchId,  // í˜„ì¬ ì„ íƒëœ ê²½ê¸°ì˜ ID ì¶”ê°€
                forceRefresh: forceRefresh
            };
            
            console.log('ì „ì†¡í•  ë°ì´í„°:', pushData);
            socket.emit('push_to_list_overlay', pushData);
            
            console.log('í†µí•© ì˜¤ë²„ë ˆì´ì— ê²½ê¸° í‘¸ì‹œ ì™„ë£Œ');
        }

        // ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
        socket.on('push_to_list_overlay_response', (response) => {
            console.log('í‘¸ì‹œ ì‘ë‹µ ìˆ˜ì‹ :', response);
            if (response.success) {
                alert('í†µí•© URLì— ê²½ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!');
                // í‘¸ì‹œ ì„±ê³µ í›„ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                checkPushedMatchStatus();
            } else {
                alert('í‘¸ì‹œ ì‹¤íŒ¨: ' + (response.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        });

        // íŒ€ëª… ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function openTeamNameModal(team) {
            // í˜„ì¬ í™”ë©´ì— í‘œì‹œëœ íŒ€ëª…ì„ ê°€ì ¸ì˜¤ê¸°
            const teamDisplay = document.getElementById(`${team}-team-display`);
            const currentName = teamDisplay ? teamDisplay.textContent.trim() : '';
            
            document.getElementById('modal-team-name').value = currentName;
            document.getElementById('teamNameModal').setAttribute('data-team', team);
            new bootstrap.Modal(document.getElementById('teamNameModal')).show();
        }

        // íŒ€ëª… ë³€ê²½ í™•ì¸
        async function confirmTeamNameChange() {
            const team = document.getElementById('teamNameModal').getAttribute('data-team');
            const newTeamName = document.getElementById('modal-team-name').value.trim();
            
            if (newTeamName) {
                await updateTeamName(team, newTeamName);
                bootstrap.Modal.getInstance(document.getElementById('teamNameModal')).hide();
            } else {
                alert('íŒ€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // íŒ€ ìœ„ì¹˜ ë³€ê²½ í•¨ìˆ˜
        async function swapTeams() {
            if (!confirm('í™ˆíŒ€ê³¼ ì–´ì›¨ì´íŒ€ì˜ ì •ë³´ë¥¼ ì„œë¡œ ë°”ê¾¸ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                // í˜„ì¬ íŒ€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const homeTeamName = document.getElementById('home-team-display').textContent;
                const awayTeamName = document.getElementById('away-team-display').textContent;
                const homeScore = document.getElementById('home-score').value;
                const awayScore = document.getElementById('away-score').value;
                
                // ì„œë²„ì— ìœ„ì¹˜ ë³€ê²½ ìš”ì²­
                const response = await fetch(`/api/match/${matchId}/swap-teams`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹¤íŒ¨');
                }
                
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹¤íŒ¨');
                }
                
                // ì„±ê³µ ë©”ì‹œì§€
                alert('íŒ€ ìœ„ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // ì†Œì¼“ì„ í†µí•´ ì˜¤ë²„ë ˆì´ì— ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì „ì†¡
                socket.emit('swapTeams', { matchId: matchId });
                
                // íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ë„ ì „ì†¡
                try {
                    const response = await fetch('/api/team-logo-map/BASEBALL');
                    if (response.ok) {
                        const logoData = await response.json();
                        
                        // í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
                        const homeLogoInfo = logoData.teamLogoMap?.[data.home_team];
                        socket.emit('baseballTeamLogoUpdated', {
                            matchId: matchId,
                            teamType: 'home',
                            path: homeLogoInfo?.path,
                            bgColor: homeLogoInfo?.bgColor,
                            teamColor: null
                        });
                        
                        // ì›ì •íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
                        const awayLogoInfo = logoData.teamLogoMap?.[data.away_team];
                        socket.emit('baseballTeamLogoUpdated', {
                            matchId: matchId,
                            teamType: 'away',
                            path: awayLogoInfo?.path,
                            bgColor: awayLogoInfo?.bgColor,
                            teamColor: null
                        });
                    }
                } catch (error) {
                    console.error('íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
                
            } catch (error) {
                console.error('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // íŒ€ëª… ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateTeamName(team, newTeamName) {
            try {
                const response = await fetch(`/api/matches/${matchId}/team-name`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        team: team,
                        teamName: newTeamName
                    })
                });

                if (!response.ok) {
                    throw new Error('íŒ€ëª… ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                }

                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'íŒ€ëª… ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                }

                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                alert(`${team === 'home' ? 'í™ˆíŒ€' : 'ì›ì •íŒ€'}ëª…ì´ '${newTeamName}'ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // íŒ€ëª… í‘œì‹œ ì—…ë°ì´íŠ¸
                const teamNameDisplay = document.getElementById(`${team}-team-display`);
                if (teamNameDisplay) {
                    teamNameDisplay.textContent = newTeamName;
                }
                
                // íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                try {
                    const response = await fetch('/api/team-logo-map/BASEBALL');
                    if (response.ok) {
                        const data = await response.json();
                        const logoInfo = data.teamLogoMap?.[newTeamName];
                        
                        if (logoInfo) {
                            const logoContainer = document.getElementById(`${team}-team-logo-container`);
                            if (logoContainer) {
                                logoContainer.style.backgroundColor = logoInfo.bgColor || '#ffffff';
                                logoContainer.innerHTML = `
                                    <img src="${logoInfo.path}" alt="${newTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
                                `;
                            }
                        } else {
                            // ë¡œê³ ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìƒíƒœë¡œ ë³µì›
                            const logoContainer = document.getElementById(`${team}-team-logo-container`);
                            if (logoContainer) {
                                logoContainer.style.backgroundColor = '#f8f9fa';
                                logoContainer.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                            }
                        }
                    }
                } catch (error) {
                    console.error('íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
                
                // ì†Œì¼“ì„ í†µí•´ ì˜¤ë²„ë ˆì´ì— ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì „ì†¡
                socket.emit('updateTeamName', {
                    matchId: matchId,
                    team: team,
                    teamName: newTeamName
                });
                
                // íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ë„ ì „ì†¡
                socket.emit('baseballTeamLogoUpdated', {
                    matchId: matchId,
                    teamType: team,
                    path: logoInfo?.path,
                    bgColor: logoInfo?.bgColor,
                    teamColor: null
                });

            } catch (error) {
                console.error('íŒ€ëª… ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('íŒ€ëª… ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²½ê¸° ìˆ˜ì • ì´ë²¤íŠ¸
        socket.on('match_updated', (data) => {
            if (data.matchId === matchId) {
                console.log('ê²½ê¸° ìˆ˜ì • ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
                
                // íŒ€ëª… ì—…ë°ì´íŠ¸
                const homeTeamDisplay = document.getElementById('home-team-display');
                const awayTeamDisplay = document.getElementById('away-team-display');
                
                if (homeTeamDisplay) {
                    homeTeamDisplay.textContent = data.home_team;
                }
                if (awayTeamDisplay) {
                    awayTeamDisplay.textContent = data.away_team;
                }
                
                // ì¢…ëª© ì—…ë°ì´íŠ¸ (í•„ìš”í•œ ê²½ìš°)
                if (data.sport_type && data.sport_type !== currentSportType) {
                    currentSportType = data.sport_type;
                    console.log('ì¢…ëª© ë³€ê²½ë¨:', currentSportType);
                }
                
                // ê²½ê¸° ì •ë³´ ì—…ë°ì´íŠ¸
                updateMatchDisplay(data);
            }
        });

        // ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ëª¨ë°”ì¼)
        socket.on('baseball_inning_score_updated', (data) => {
            console.log('=== ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ìˆ˜ì‹  (ëª¨ë°”ì¼) ===');
            console.log('ìˆ˜ì‹ ëœ ë°ì´í„°:', data);
            console.log('í˜„ì¬ matchId:', matchId);
            console.log('ë°ì´í„° matchId:', data.matchId);
            
            if (data.matchId === matchId) {
                // 1. ë¨¼ì € ì„œë²„ì—ì„œ ë°›ì€ ì´ë‹ë³„ ì ìˆ˜ë¡œ ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                if (data.innings) {
                    console.log('ì„œë²„ì—ì„œ ë°›ì€ ì´ë‹ë³„ ì ìˆ˜:', data.innings);
                    
                    for (let i = 1; i <= 9; i++) {
                        const homeInningElement = document.getElementById(`home-inning-${i}`);
                        const awayInningElement = document.getElementById(`away-inning-${i}`);
                        
                        if (homeInningElement && data.innings[`home_${i}`] !== undefined) {
                            homeInningElement.value = data.innings[`home_${i}`] || 0;
                            console.log(`í™ˆíŒ€ ${i}íšŒ ì ìˆ˜ ì—…ë°ì´íŠ¸: ${data.innings[`home_${i}`]}`);
                        }
                        if (awayInningElement && data.innings[`away_${i}`] !== undefined) {
                            awayInningElement.value = data.innings[`away_${i}`] || 0;
                            console.log(`ì›ì •íŒ€ ${i}íšŒ ì ìˆ˜ ì—…ë°ì´íŠ¸: ${data.innings[`away_${i}`]}`);
                        }
                    }
                }
                
                // 2. ì„œë²„ì—ì„œ ê³„ì‚°ëœ ì´ ì ìˆ˜ ì‚¬ìš©
                const serverHomeTotal = data.home_score;
                const serverAwayTotal = data.away_score;
                
                console.log(`ì„œë²„ì—ì„œ ë°›ì€ ì´ ì ìˆ˜: í™ˆíŒ€ ${serverHomeTotal}, ì›ì •íŒ€ ${serverAwayTotal}`);
                
                // 3. ì„œë²„ ì ìˆ˜ê°€ ìœ íš¨í•œ ê²½ìš° ì‚¬ìš©, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë¡œì»¬ ì¬ê³„ì‚°
                let homeTotal = serverHomeTotal;
                let awayTotal = serverAwayTotal;
                
                if (serverHomeTotal === 0 || serverHomeTotal === undefined || serverAwayTotal === 0 || serverAwayTotal === undefined) {
                    console.log('ì„œë²„ ì´ ì ìˆ˜ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ. ë¡œì»¬ ì¬ê³„ì‚° ìˆ˜í–‰...');
                    
                    // ë¡œì»¬ì—ì„œ ì´ë‹ë³„ ì ìˆ˜ í•©ê³„ ì¬ê³„ì‚°
                    let localHomeTotal = 0;
                    let localAwayTotal = 0;
                    
                    for (let i = 1; i <= 9; i++) {
                        const homeInningElement = document.getElementById(`home-inning-${i}`);
                        const awayInningElement = document.getElementById(`away-inning-${i}`);
                        
                        if (homeInningElement) {
                            localHomeTotal += parseInt(homeInningElement.value) || 0;
                        }
                        if (awayInningElement) {
                            localAwayTotal += parseInt(awayInningElement.value) || 0;
                        }
                    }
                    
                    homeTotal = localHomeTotal;
                    awayTotal = localAwayTotal;
                    
                    console.log(`ë¡œì»¬ ì¬ê³„ì‚° ê²°ê³¼: í™ˆíŒ€ ${homeTotal}, ì›ì •íŒ€ ${awayTotal}`);
                }
                
                // ì´ ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
                const homeScoreElement = document.getElementById('home-score');
                const awayScoreElement = document.getElementById('away-score');
                
                console.log('ì—…ë°ì´íŠ¸ ì „ ì ìˆ˜:', {
                    home: homeScoreElement?.value,
                    away: awayScoreElement?.value
                });
                
                if (homeScoreElement) {
                    homeScoreElement.value = homeTotal;
                    console.log(`í™ˆíŒ€ ì ìˆ˜ ìµœì¢… ì—…ë°ì´íŠ¸: ${homeTotal}`);
                }
                if (awayScoreElement) {
                    awayScoreElement.value = awayTotal;
                    console.log(`ì›ì •íŒ€ ì ìˆ˜ ìµœì¢… ì—…ë°ì´íŠ¸: ${awayTotal}`);
                }
                
                console.log('ì—…ë°ì´íŠ¸ í›„ ì ìˆ˜:', {
                    home: homeScoreElement?.value,
                    away: awayScoreElement?.value
                });
                
                console.log('=== ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì²˜ë¦¬ ì™„ë£Œ (ëª¨ë°”ì¼) ===');
            } else {
                console.log('ë§¤ì¹˜ IDê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ - ì´ë²¤íŠ¸ ë¬´ì‹œ');
            }
        });

        // ê²½ê¸° ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³€ê²½ëœ ê²½ìš°ë§Œ)
        socket.on('match_update', (data) => {
            console.log('=== ê²½ê¸° ì—…ë°ì´íŠ¸ ìˆ˜ì‹  (ëª¨ë°”ì¼) ===');
            console.log('ìˆ˜ì‹ ëœ ë°ì´í„°:', data);
            
            if (data.matchId === matchId) {
                // ì ìˆ˜ ì—…ë°ì´íŠ¸ (ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³€ê²½ëœ ê²½ìš°ë§Œ)
                if (data.data && (data.data.home_score !== undefined || data.data.away_score !== undefined)) {
                    const homeScoreElement = document.getElementById('home-score');
                    const awayScoreElement = document.getElementById('away-score');
                    
                    if (homeScoreElement && data.data.home_score !== undefined) {
                        homeScoreElement.value = data.data.home_score;
                        console.log(`í™ˆíŒ€ ì ìˆ˜ ì—…ë°ì´íŠ¸: ${data.data.home_score}`);
                    }
                    if (awayScoreElement && data.data.away_score !== undefined) {
                        awayScoreElement.value = data.data.away_score;
                        console.log(`ì›ì •íŒ€ ì ìˆ˜ ì—…ë°ì´íŠ¸: ${data.data.away_score}`);
                    }
                }
                console.log('=== ê²½ê¸° ì—…ë°ì´íŠ¸ ì²˜ë¦¬ ì™„ë£Œ (ëª¨ë°”ì¼) ===');
            }
        });

        // ì ìˆ˜ ë™ê¸°í™” ì™„ë£Œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('match_scores_synced', (data) => {
            console.log('ì ìˆ˜ ë™ê¸°í™” ì™„ë£Œ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const { home_score, away_score } = data;
                
                // UI ì—…ë°ì´íŠ¸
                const homeScoreElement = document.getElementById('home-score');
                const awayScoreElement = document.getElementById('away-score');
                
                if (homeScoreElement) {
                    homeScoreElement.value = home_score;
                    console.log(`í™ˆíŒ€ ì ìˆ˜ ë™ê¸°í™”: ${home_score}`);
                }
                if (awayScoreElement) {
                    awayScoreElement.value = away_score;
                    console.log(`ì›ì •íŒ€ ì ìˆ˜ ë™ê¸°í™”: ${away_score}`);
                }
                
                console.log('ì ìˆ˜ ë™ê¸°í™” ì™„ë£Œ: í™ˆíŒ€', home_score, 'ì›ì •íŒ€', away_score);
            }
        });

        // íŒ€ ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸
        socket.on('teamsSwapped', async (data) => {
            if (data.matchId === matchId) {
                console.log('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
                
                // íŒ€ëª… ì—…ë°ì´íŠ¸
                const homeTeamDisplay = document.getElementById('home-team-display');
                const awayTeamDisplay = document.getElementById('away-team-display');
                
                if (homeTeamDisplay) {
                    homeTeamDisplay.textContent = data.home_team;
                }
                if (awayTeamDisplay) {
                    awayTeamDisplay.textContent = data.away_team;
                }
                
                // ì ìˆ˜ ì—…ë°ì´íŠ¸
                const homeScoreInput = document.getElementById('home-score');
                const awayScoreInput = document.getElementById('away-score');
                
                if (homeScoreInput) {
                    homeScoreInput.value = data.home_score;
                }
                if (awayScoreInput) {
                    awayScoreInput.value = data.away_score;
                }
                
                // íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                try {
                    const response = await fetch('/api/team-logo-map/BASEBALL');
                    if (response.ok) {
                        const logoData = await response.json();
                        
                        // í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                        const homeLogoInfo = logoData.teamLogoMap?.[data.home_team];
                        const homeLogoContainer = document.getElementById('home-team-logo-container');
                        if (homeLogoContainer) {
                            if (homeLogoInfo) {
                                homeLogoContainer.style.backgroundColor = homeLogoInfo.bgColor || '#ffffff';
                                homeLogoContainer.innerHTML = `
                                    <img src="${homeLogoInfo.path}" alt="${data.home_team} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
                                `;
                            } else {
                                homeLogoContainer.style.backgroundColor = '#f8f9fa';
                                homeLogoContainer.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                            }
                        }
                        
                        // ì›ì •íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                        const awayLogoInfo = logoData.teamLogoMap?.[data.away_team];
                        const awayLogoContainer = document.getElementById('away-team-logo-container');
                        if (awayLogoContainer) {
                            if (awayLogoInfo) {
                                awayLogoContainer.style.backgroundColor = awayLogoInfo.bgColor || '#ffffff';
                                awayLogoContainer.innerHTML = `
                                    <img src="${awayLogoInfo.path}" alt="${data.away_team} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
                                `;
                            } else {
                                awayLogoContainer.style.backgroundColor = '#f8f9fa';
                                awayLogoContainer.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                            }
                        }
                    }
                } catch (error) {
                    console.error('íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
                
                console.log('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì™„ë£Œ');
            }
        });
        <% } %>
        

    </script>
    
    <!-- íŒ€ëª… ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal fade" id="teamNameModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title">íŒ€ëª… ìˆ˜ì •</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">íŒ€ëª…</label>
                        <input type="text" id="modal-team-name" class="form-control" placeholder="íŒ€ëª… ì…ë ¥">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="confirmTeamNameChange()">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 