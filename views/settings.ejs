<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>설정 - SportsCoder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .settings-container {
            max-width: 1400px;
            margin: 2rem auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .settings-column {
            padding: 1.5rem;
        }
        
        .settings-column-left {
            border-right: 1px solid #e9ecef;
        }
        
        .settings-column-right {
            border-left: 1px solid #e9ecef;
        }
        
        @media (max-width: 768px) {
            .settings-column-left,
            .settings-column-right {
                border: none;
            }
        }
        .settings-header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .settings-body {
            padding: 2rem;
        }
        .setting-item {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .setting-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        .setting-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .color-preview {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .btn-save {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 64, 175, 0.3);
            color: white;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-left: 4px solid #1e40af;
            margin-bottom: 10px;
        }
        .toast.success {
            border-left-color: #10b981;
        }
        .toast.error {
            border-left-color: #ef4444;
        }

        /* 축구 오버레이 디자인 설정 스타일 */
        .soccer-overlay-preview-small {
            width: 320px;
            height: 180px;
            background-color: #000;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid #dee2e6;
            margin: 0 auto;
        }

        .soccer-overlay-preview-small:hover {
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
        }

        .soccer-overlay-preview-full {
            width: 640px;
            height: 360px;
            background-color: #000;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            margin: 0 auto;
        }

        .preview-element {
            position: absolute;
            border: 2px solid;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            padding: 2px;
            word-break: break-word;
        }

        .preview-element:hover {
            opacity: 0.8;
        }

        .preview-element.selected {
            border-width: 3px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .preview-scoreboard {
            background-color: rgba(0, 204, 51, 0.8);
            border-color: #00cc33;
            width: 280px;
            height: 60px;
        }

        .preview-home-logo {
            background-color: rgba(0, 204, 51, 0.6);
            border-color: #00cc33;
            width: 30px;
            height: 30px;
        }

        .preview-away-logo {
            background-color: rgba(255, 255, 255, 0.6);
            border-color: #ffffff;
            width: 30px;
            height: 30px;
        }

        .preview-match-state {
            background-color: rgba(0, 0, 0, 0.8);
            border-color: #333;
            width: 100px;
            height: 25px;
        }

        .preview-lineup {
            background-color: rgba(0, 0, 0, 0.6);
            border-color: #666;
            width: 200px;
            height: 120px;
        }

        .preview-overlay-image {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #fff;
            width: 150px;
            height: 100px;
        }

        .preview-timer {
            background-color: rgba(0, 0, 0, 0.8);
            border-color: #333;
            width: 90px;
            height: 42px;
        }


    </style>
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="bi bi-gear-fill"></i> 시스템 설정</h1>
                    <p class="mb-0">기본 팀 컬러 및 시스템 설정을 관리합니다.</p>
                </div>
                <a href="/matches" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> 경기 목록으로 돌아가기
                </a>
            </div>
        </div>
        
        <div class="settings-body">
            <div class="row">
                <!-- 왼쪽 컬럼: 기본 설정 및 로그 관리 (관리자만) -->
                <% if (typeof userRole !== 'undefined' && userRole === 'admin') { %>
                <div class="col-md-6">
                    <div class="settings-column settings-column-left">
                        <div class="setting-item">
                            <div class="setting-label">기본 팀 컬러 설정</div>
                            <div class="setting-description">
                                새로운 경기 생성 시 적용될 기본 팀 컬러를 설정합니다. 
                                이 설정은 축구와 야구 경기 모두에 적용됩니다.
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">홈팀 기본 컬러</label>
                                    <div class="color-picker-container">
                                        <input type="color" id="default-home-color" class="form-control form-control-color" value="#1e40af">
                                        <div class="color-preview" id="home-color-preview" style="background-color: #1e40af;">#1e40af</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">원정팀 기본 컬러</label>
                                    <div class="color-picker-container">
                                        <input type="color" id="default-away-color" class="form-control form-control-color" value="#1e40af">
                                        <div class="color-preview" id="away-color-preview" style="background-color: #1e40af;">#1e40af</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">설정 저장</div>
                            <div class="setting-description">
                                변경된 설정을 저장합니다. 저장 후 새로운 경기부터 적용됩니다.
                            </div>
                            <button id="save-settings" class="btn btn-save">
                                <i class="bi bi-save"></i> 설정 저장
                            </button>
                        </div>

                        <!-- 로그 관리 섹션 -->
                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="bi bi-file-text"></i> 로그 관리
                            </div>
                            <div class="setting-description">시스템 로그 파일을 확인하고 관리할 수 있습니다. 로그 삭제는 파일을 삭제하는 것이 아니라 로그 내용을 초기화합니다. 자동 백업은 1일마다 실행되며, 로그 크기가 제한을 초과하면 자동으로 백업 후 초기화됩니다.</div>
                
                <!-- 자동 로그 관리 상태 -->
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="bi bi-robot"></i> 자동 로그 관리 상태</h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-2">
                                        <div class="border-end">
                                            <h6 class="text-primary mb-1" id="autoBackupStatus">활성화</h6>
                                            <small class="text-muted">자동 백업</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="border-end">
                                            <h6 class="text-info mb-1" id="backupCount">-</h6>
                                            <small class="text-muted">백업 개수</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="border-end">
                                            <h6 class="text-success mb-1" id="currentLogSize">-</h6>
                                            <small class="text-muted">현재 로그 크기</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="border-end">
                                            <h6 class="text-warning mb-1" id="totalBackupSize">-</h6>
                                            <small class="text-muted">백업 총 크기</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="border-end">
                                            <h6 class="text-secondary mb-1" id="maxLogSize">50MB</h6>
                                            <small class="text-muted">최대 로그 크기</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <h6 class="text-dark mb-1" id="retentionDays">30일</h6>
                                        <small class="text-muted">보관 기간</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 로그 상태 요약 -->
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="card bg-light">
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <div class="border-end">
                                            <h5 id="totalLogFiles" class="text-primary mb-1">-</h5>
                                            <small class="text-muted">총 로그 파일</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border-end">
                                            <h5 id="totalLogSize" class="text-info mb-1">-</h5>
                                            <small class="text-muted">총 크기</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border-end">
                                            <h5 id="oldestLog" class="text-warning mb-1">-</h5>
                                            <small class="text-muted">가장 오래된 로그</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <h5 id="newestLog" class="text-success mb-1">-</h5>
                                        <small class="text-muted">최신 로그</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">로그 파일 목록</h6>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm" onclick="refreshLogData()">
                                        <i class="bi bi-arrow-clockwise"></i> 새로고침
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="viewLogContent()">
                                        <i class="bi bi-eye"></i> 로그 내용 보기
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="logFilesList" class="mb-3">
                                    <div class="text-center text-muted">
                                        <i class="bi bi-hourglass-split"></i> 로그 파일 목록을 불러오는 중...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">빠른 작업</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success btn-sm" onclick="backupLogs()">
                                        <i class="bi bi-download"></i> 로그 백업
                                    </button>
                                    <button class="btn btn-warning btn-sm" onclick="cleanupLogs()">
                                        <i class="bi bi-trash"></i> 오래된 로그 정리
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="downloadAllLogs()">
                                        <i class="bi bi-file-earmark-zip"></i> 모든 로그 다운로드
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="clearAllLogs()">
                                        <i class="bi bi-trash-fill"></i> 모든 로그 초기화
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                <% } %>
            </div>
        </div>

        <!-- 오른쪽 컬럼: 종목별 오버레이 이미지 관리 및 디자인 설정 -->
        <div class="col-md-6">
            <div class="settings-column settings-column-right">
                <!-- 종목별 오버레이 이미지 관리 섹션 -->
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="bi bi-image"></i> 종목별 오버레이 이미지 관리
                    </div>
                    <div class="setting-description">
                        각 종목별로 오버레이 페이지에 표시할 이미지를 업로드하고 관리할 수 있습니다. 
                        업로드된 이미지는 해당 종목의 오버레이 페이지에 표시되며, 변경사항은 실시간으로 반영됩니다.
                    </div>
                
                <!-- 종목 선택 -->
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="bi bi-trophy"></i> 종목 선택</h6>
                            </div>
                            <div class="card-body">
                                <select id="sportSelect" class="form-select" onchange="loadSportOverlayImages()">
                                    <option value="">종목을 선택하세요</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 선택된 종목의 이미지 관리 -->
                <div id="sportImageManagement" style="display: none;">
                    <!-- 현재 사용 중인 이미지 표시 -->
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-star-fill"></i> <span id="selectedSportName"></span> 현재 사용 중인 이미지</h6>
                                </div>
                                <div class="card-body">
                                    <div id="currentActiveImage" class="text-center">
                                        <div class="text-muted">
                                            <i class="bi bi-hourglass-split"></i> 현재 사용 중인 이미지를 불러오는 중...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 이미지 업로드 -->
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-cloud-upload"></i> <span id="selectedSportName3"></span> 이미지 업로드</h6>
                                </div>
                                <div class="card-body">
                                    <form id="sportOverlayImageForm" enctype="multipart/form-data">
                                        <input type="hidden" id="selectedSportCode" name="sportCode">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="mb-3">
                                                    <label for="sportOverlayImage" class="form-label">이미지 파일 선택</label>
                                                    <input type="file" class="form-control" id="sportOverlayImage" name="image" accept="image/*" required>
                                                    <div class="form-text">지원 형식: JPEG, PNG, GIF, WEBP (최대 10MB)</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label class="form-label">&nbsp;</label>
                                                    <button type="submit" class="btn btn-success w-100">
                                                        <i class="bi bi-upload"></i> 업로드
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 업로드된 이미지 목록 -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><span id="selectedSportName2"></span> 이미지 목록 및 선택</h6>
                                    <button class="btn btn-outline-success btn-sm" onclick="loadSportOverlayImagesWithActive()">
                                        <i class="bi bi-arrow-clockwise"></i> 새로고침
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div id="sportOverlayImagesList" class="row">
                                        <div class="col-12 text-center text-muted">
                                            <i class="bi bi-hourglass-split"></i> 이미지 목록을 불러오는 중...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                </div>

                <!-- 종목별 오버레이 디자인 설정 섹션 (관리자만) -->
                <% if (typeof userRole !== 'undefined' && userRole === 'admin') { %>
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="bi bi-layout-text-window"></i> <span id="overlayDesignTitle">축구 오버레이 디자인 설정</span>
                    </div>
                    <div class="setting-description">
                        <span id="overlayDesignDescription">축구 오버레이 페이지의 각 요소들의 위치를 조정할 수 있습니다. 
                        실시간 미리보기로 변경사항을 확인할 수 있습니다.</span>
                    </div>
                
                <!-- 경기 상태 표시 설정 -->
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">경기 상태 표시 설정</h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="showMatchState" checked>
                                    <label class="form-check-label" for="showMatchState">
                                        전반, 후반, 경기종료 등 경기 상태 표시
                                    </label>
                                </div>
                                <small class="text-muted">
                                    이 설정을 변경하면 모든 축구 오버레이 페이지에 실시간으로 반영됩니다.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-12">
                        <!-- 위치 조정 컨트롤 -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">위치 조정</h6>
                                <button class="btn btn-info btn-sm" onclick="openPreviewModal()">
                                    <i class="bi bi-eye"></i> 미리보기 보기
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">요소 선택</label>
                                            <select class="form-select" id="elementSelect" onchange="selectElement()">
                                                <option value="scoreboard">스코어보드</option>
                                                <option value="homeLogo">홈팀 로고</option>
                                                <option value="awayLogo">어웨이팀 로고</option>
                                                <option value="matchState">경기 상태</option>
                                                <option value="homeLineup">홈팀 라인업</option>
                                                <option value="awayLineup">어웨이팀 라인업</option>
                                                <option value="overlayImage">오버레이 이미지</option>
                                                <option value="timer">타이머</option>
                                            </select>
                                        </div>
                                        

                                    </div>
                                    
                                    <div class="col-md-8">
                                        <div class="small-preview-container">
                                            <h6 class="text-muted mb-2">작은 미리보기 (클릭하여 확대)</h6>
                                            <div class="soccer-overlay-preview-small" id="soccerOverlayPreviewSmall" onclick="openPreviewModal()">
                                                <!-- 작은 미리보기 요소들이 여기에 동적으로 생성됩니다 -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 mt-3">
                                    <button class="btn btn-primary btn-sm" onclick="saveDesignSettings()">
                                        <i class="bi bi-save"></i> 설정 저장
                                    </button>
                                    <button class="btn btn-warning btn-sm" onclick="resetDesignSettings()">
                                        <i class="bi bi-arrow-clockwise"></i> 기본값으로 초기화
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <% } %>
    </div>

    <!-- 축구 오버레이 미리보기 모달 -->
            <div class="modal fade" id="soccerOverlayPreviewModal" tabindex="-1">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">축구 오버레이 미리보기</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="soccer-overlay-preview-full" id="soccerOverlayPreviewFull">
                                <!-- 큰 미리보기 요소들이 여기에 동적으로 생성됩니다 -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                            <button type="button" class="btn btn-primary" onclick="refreshPreview()">
                                <i class="bi bi-arrow-clockwise"></i> 새로고침
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 로그 내용 모달 -->
            <div class="modal fade" id="logContentModal" tabindex="-1">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">로그 내용</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <select id="logFileSelect" class="form-select" onchange="loadLogContent()">
                                    <option value="">로그 파일을 선택하세요</option>
                                </select>
                            </div>
                                                         <div class="mb-3">
                                 <div class="input-group">
                                     <input type="text" id="logSearchInput" class="form-control" placeholder="로그 내용 검색..." oninput="searchLogContent()">
                                     <button class="btn btn-outline-secondary" onclick="searchLogContent()">
                                         <i class="bi bi-search"></i> 검색
                                     </button>
                                     <button class="btn btn-outline-danger" onclick="clearSearch()" title="검색 초기화">
                                         <i class="bi bi-x-circle"></i>
                                     </button>
                                 </div>
                                 <small class="text-muted">검색어와 일치하는 라인만 표시됩니다. 실시간으로 필터링됩니다.</small>
                             </div>
                            <div class="border rounded p-3" style="height: 400px; overflow-y: auto; background-color: #f8f9fa; font-family: monospace; font-size: 0.9rem;">
                                <pre id="logContent" class="mb-0"></pre>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                            <button type="button" class="btn btn-primary" onclick="downloadCurrentLog()">다운로드</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 현재 설정 로드
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                if (response.ok) {
                    const settings = await response.json();
                    
                    // 기본 컬러 설정 로드
                    const homeColor = settings.default_home_color || '#1e40af';
                    const awayColor = settings.default_away_color || '#1e40af';
                    
                    document.getElementById('default-home-color').value = homeColor;
                    document.getElementById('default-away-color').value = awayColor;
                    updateColorPreview('home', homeColor);
                    updateColorPreview('away', awayColor);
                }
            } catch (error) {
                console.error('설정 로드 실패:', error);
                showToast('설정 로드에 실패했습니다.', 'error');
            }
        }
        
        // 컬러 미리보기 업데이트
        function updateColorPreview(type, color) {
            const preview = document.getElementById(`${type}-color-preview`);
            preview.style.backgroundColor = color;
            preview.textContent = color.toUpperCase();
        }
        
        // 설정 저장
        async function saveSettings() {
            const homeColor = document.getElementById('default-home-color').value;
            const awayColor = document.getElementById('default-away-color').value;
            
            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        default_home_color: homeColor,
                        default_away_color: awayColor
                    })
                });
                
                if (response.ok) {
                    showToast('설정이 성공적으로 저장되었습니다.', 'success');
                } else {
                    throw new Error('설정 저장 실패');
                }
            } catch (error) {
                console.error('설정 저장 실패:', error);
                showToast('설정 저장에 실패했습니다.', 'error');
            }
        }
        
        // 토스트 메시지 표시
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // 3초 후 제거
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease-in-out';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // 로그 데이터 새로고침 (로그 파일 목록 + 자동 관리 상태)
        async function refreshLogData() {
            await loadLogFiles();
            await loadAutoManagementStatus();
        }

        // 자동 로그 관리 상태 로드
        async function loadAutoManagementStatus() {
            try {
                const response = await fetch('/api/logs/auto-management-status');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        const status = data.data;
                        
                        // 자동 백업 상태 업데이트
                        const backupCountEl = document.getElementById('backupCount');
                        const currentLogSizeEl = document.getElementById('currentLogSize');
                        const totalBackupSizeEl = document.getElementById('totalBackupSize');
                        const maxLogSizeEl = document.getElementById('maxLogSize');
                        const retentionDaysEl = document.getElementById('retentionDays');
                        
                        if (backupCountEl) backupCountEl.textContent = status.current.backupCount;
                        if (currentLogSizeEl) currentLogSizeEl.textContent = `${status.current.currentLogSizeMB} MB`;
                        if (totalBackupSizeEl) totalBackupSizeEl.textContent = `${status.current.totalBackupSizeMB} MB`;
                        if (maxLogSizeEl) maxLogSizeEl.textContent = `${status.config.maxLogSizeMB} MB`;
                        if (retentionDaysEl) retentionDaysEl.textContent = `${status.config.backupRetentionDays}일`;
                        
                        // 자동 백업 상태 표시
                        const autoBackupStatus = document.getElementById('autoBackupStatus');
                        if (autoBackupStatus) {
                            if (status.current.backupCount > 0) {
                                autoBackupStatus.textContent = '활성화';
                                autoBackupStatus.className = 'text-success mb-1';
                            } else {
                                autoBackupStatus.textContent = '대기 중';
                                autoBackupStatus.className = 'text-warning mb-1';
                            }
                        }
                    }
                } else {
                    console.warn('자동 로그 관리 상태 API 응답 오류:', response.status);
                }
            } catch (error) {
                console.warn('자동 로그 관리 상태 로드 실패 (무시됨):', error);
                // 에러가 발생해도 페이지는 정상 작동하도록 무시
            }
        }

        // 로그 파일 목록 로드
        async function loadLogFiles() {
            try {
                const response = await fetch('/api/logs');
                if (response.ok) {
                    const data = await response.json();
                    const logFilesList = document.getElementById('logFilesList');
                    
                    if (data.logs && data.logs.length > 0) {
                        let html = '<div class="list-group">';
                        data.logs.forEach(log => {
                            html += `
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>${log.name}</strong>
                                        <br><small class="text-muted">${log.sizeMB} MB • ${new Date(log.modified).toLocaleString()}</small>
                                    </div>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="downloadLog('${log.name}')">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="clearLog('${log.name}')">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                        logFilesList.innerHTML = html;
                        
                        // 로그 상태 요약 업데이트
                        updateLogSummary(data.logs);
                        
                        // 로그 파일 선택 옵션 업데이트
                        updateLogFileSelect(data.logs);
                    } else {
                        logFilesList.innerHTML = '<div class="text-center text-muted">로그 파일이 없습니다.</div>';
                        updateLogSummary([]);
                        updateLogFileSelect([]);
                    }
                } else {
                    throw new Error('로그 파일 목록 로드 실패');
                }
            } catch (error) {
                console.error('로그 파일 목록 로드 실패:', error);
                showToast('로그 파일 목록 로드에 실패했습니다.', 'error');
            }
        }

        // 로그 상태 요약 업데이트
        function updateLogSummary(logs) {
            if (logs.length === 0) {
                document.getElementById('totalLogFiles').textContent = '0';
                document.getElementById('totalLogSize').textContent = '0 MB';
                document.getElementById('oldestLog').textContent = '-';
                document.getElementById('newestLog').textContent = '-';
                return;
            }

            const totalSize = logs.reduce((sum, log) => sum + parseFloat(log.sizeMB), 0);
            const dates = logs.map(log => new Date(log.modified)).sort((a, b) => a - b);
            
            document.getElementById('totalLogFiles').textContent = logs.length;
            document.getElementById('totalLogSize').textContent = `${totalSize.toFixed(2)} MB`;
            document.getElementById('oldestLog').textContent = dates[0].toLocaleDateString();
            document.getElementById('newestLog').textContent = dates[dates.length - 1].toLocaleDateString();
        }

        // 로그 파일 선택 옵션 업데이트
        function updateLogFileSelect(logs) {
            const select = document.getElementById('logFileSelect');
            select.innerHTML = '<option value="">로그 파일을 선택하세요</option>';
            
            logs.forEach(log => {
                const option = document.createElement('option');
                option.value = log.name;
                option.textContent = `${log.name} (${log.sizeMB} MB)`;
                select.appendChild(option);
            });
        }

        // 로그 파일 다운로드
        async function downloadLog(filename) {
            try {
                window.open(`/api/logs/${filename}`, '_blank');
                showToast(`${filename} 다운로드가 시작되었습니다.`, 'success');
            } catch (error) {
                console.error('로그 다운로드 실패:', error);
                showToast('로그 다운로드에 실패했습니다.', 'error');
            }
        }

        // 로그 파일 초기화
        async function clearLog(filename) {
            if (!confirm(`정말로 ${filename} 파일의 내용을 초기화하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/logs/${filename}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast(`${filename} 파일의 내용이 초기화되었습니다.`, 'success');
                    loadLogFiles(); // 목록 새로고침
                } else {
                    throw new Error('로그 파일 초기화 실패');
                }
            } catch (error) {
                console.error('로그 파일 초기화 실패:', error);
                showToast('로그 파일 초기화에 실패했습니다.', 'error');
            }
        }

        // 로그 백업
        async function backupLogs() {
            try {
                const response = await fetch('/api/logs/backup', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showToast(result.message, 'success');
                } else {
                    throw new Error('로그 백업 실패');
                }
            } catch (error) {
                console.error('로그 백업 실패:', error);
                showToast('로그 백업에 실패했습니다.', 'error');
            }
        }

        // 오래된 로그 정리
        async function cleanupLogs() {
            const days = prompt('몇 일 이전의 로그를 삭제하시겠습니까? (기본값: 30일)', '30');
            if (!days) return;
            
            try {
                const response = await fetch('/api/logs/cleanup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ days: parseInt(days) })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showToast(result.message, 'success');
                    loadLogFiles(); // 목록 새로고침
                } else {
                    throw new Error('로그 정리 실패');
                }
            } catch (error) {
                console.error('로그 정리 실패:', error);
                showToast('로그 정리에 실패했습니다.', 'error');
            }
        }

        // 모든 로그 다운로드
        async function downloadAllLogs() {
            try {
                const response = await fetch('/api/logs');
                if (response.ok) {
                    const data = await response.json();
                    if (data.logs && data.logs.length > 0) {
                        data.logs.forEach(log => {
                            setTimeout(() => {
                                downloadLog(log.name);
                            }, 500); // 0.5초 간격으로 다운로드
                        });
                        showToast('모든 로그 파일 다운로드가 시작되었습니다.', 'success');
                    } else {
                        showToast('다운로드할 로그 파일이 없습니다.', 'warning');
                    }
                } else {
                    throw new Error('로그 파일 목록 로드 실패');
                }
            } catch (error) {
                console.error('모든 로그 다운로드 실패:', error);
                showToast('모든 로그 다운로드에 실패했습니다.', 'error');
            }
        }

        // 모든 로그 초기화
        async function clearAllLogs() {
            if (!confirm('정말로 모든 로그 파일의 내용을 초기화하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                return;
            }
            
            try {
                const response = await fetch('/api/logs/clear-all', {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showToast(result.message, 'success');
                    loadLogFiles(); // 목록 새로고침
                } else {
                    throw new Error('모든 로그 초기화 실패');
                }
            } catch (error) {
                console.error('모든 로그 초기화 실패:', error);
                showToast('모든 로그 초기화에 실패했습니다.', 'error');
            }
        }

        // 로그 내용 보기 모달 열기
        function viewLogContent() {
            const modal = new bootstrap.Modal(document.getElementById('logContentModal'));
            modal.show();
        }

        // 원본 로그 내용 저장 변수
        let originalLogContent = '';

        // 로그 내용 로드
        async function loadLogContent() {
            const filename = document.getElementById('logFileSelect').value;
            if (!filename) {
                document.getElementById('logContent').textContent = '로그 파일을 선택하세요.';
                originalLogContent = '';
                return;
            }
            
            try {
                const response = await fetch(`/api/logs/${filename}/content`);
                if (response.ok) {
                    const data = await response.json();
                    originalLogContent = data.content;
                    document.getElementById('logContent').textContent = originalLogContent;
                    
                    // 검색어가 있으면 필터링 적용
                    const searchTerm = document.getElementById('logSearchInput').value;
                    if (searchTerm) {
                        filterLogContent();
                    }
                } else {
                    document.getElementById('logContent').textContent = '로그 내용을 불러올 수 없습니다.';
                    originalLogContent = '';
                }
            } catch (error) {
                console.error('로그 내용 로드 실패:', error);
                document.getElementById('logContent').textContent = '로그 내용을 불러오는 중 오류가 발생했습니다.';
                originalLogContent = '';
            }
        }

        // 로그 내용 필터링 (검색어와 일치하는 라인만 표시)
        function filterLogContent() {
            const searchTerm = document.getElementById('logSearchInput').value.toLowerCase();
            const logContent = document.getElementById('logContent');
            
            if (!searchTerm) {
                // 검색어가 없으면 전체 내용 표시
                logContent.textContent = originalLogContent;
                return;
            }
            
            if (!originalLogContent) {
                return;
            }
            
            // 라인별로 분리하여 검색어가 포함된 라인만 필터링
            const lines = originalLogContent.split('\n');
            const filteredLines = lines.filter(line => 
                line.toLowerCase().includes(searchTerm)
            );
            
            if (filteredLines.length > 0) {
                // 검색어가 포함된 라인들을 하이라이트하여 표시
                const highlightedLines = filteredLines.map(line => {
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    return line.replace(regex, '<mark>$1</mark>');
                });
                
                logContent.innerHTML = highlightedLines.join('\n');
            } else {
                logContent.innerHTML = '<span class="text-muted">검색어와 일치하는 내용이 없습니다.</span>';
            }
        }

        // 로그 내용 검색 (실시간 필터링)
        function searchLogContent() {
            filterLogContent();
        }

        // 검색 초기화
        function clearSearch() {
            document.getElementById('logSearchInput').value = '';
            filterLogContent();
        }

        // 현재 로그 파일 다운로드
        function downloadCurrentLog() {
            const filename = document.getElementById('logFileSelect').value;
            if (filename) {
                downloadLog(filename);
            } else {
                showToast('다운로드할 로그 파일을 선택하세요.', 'warning');
            }
        }

        // 기존 공통 오버레이 이미지 업로드 이벤트 리스너는 제거됨 (종목별 이미지로 대체)

        // 기존 공통 오버레이 이미지 관련 함수들은 제거됨 (종목별 이미지로 대체)

        // 종목별 오버레이 디자인 설정 관련 변수
        let currentDesign = {};
        let defaultDesign = {};
        let selectedElement = 'scoreboard';
        let currentSportCode = 'SOCCER'; // 기본값

        // 종목별 오버레이 디자인 설정 로드
        async function loadSportOverlayDesign(sportCode = 'SOCCER') {
            try {
                currentSportCode = sportCode;
                const response = await fetch(`/api/sport-overlay-design/${sportCode}`);
                const result = await response.json();
                
                if (result.success) {
                    currentDesign = result.design;
                    defaultDesign = result.default;
                    renderSmallPreview();
                    selectElement();
                    updateOverlayDesignTitle(sportCode);
                }
            } catch (error) {
                console.error(`${sportCode} 오버레이 디자인 설정 로드 오류:`, error);
                showToast('디자인 설정을 불러올 수 없습니다.', 'error');
            }
        }

        // 축구 오버레이 디자인 설정 로드 (기존 호환성 유지)
        async function loadSoccerOverlayDesign() {
            await loadSportOverlayDesign('SOCCER');
        }

        // 오버레이 디자인 제목 업데이트
        function updateOverlayDesignTitle(sportCode) {
            const titleElement = document.getElementById('overlayDesignTitle');
            const descriptionElement = document.getElementById('overlayDesignDescription');
            
            if (titleElement) {
                titleElement.textContent = `${sportCode} 오버레이 디자인 설정`;
            }
            
            if (descriptionElement) {
                descriptionElement.textContent = `${sportCode} 오버레이 페이지의 각 요소들의 위치를 조정할 수 있습니다. 실시간 미리보기로 변경사항을 확인할 수 있습니다.`;
            }
        }

        // 축구 오버레이 미리보기 렌더링 (공통 함수)
        function renderSoccerOverlayPreview(containerId) {
            const preview = document.getElementById(containerId);
            preview.innerHTML = '';
            
            // 경기 상태 표시 설정 확인
            const showMatchState = document.getElementById('showMatchState').checked;
            
            // 각 요소들을 미리보기에 추가
            const elements = [
                { id: 'scoreboard', class: 'preview-scoreboard', text: '스코어보드' },
                { id: 'homeLogo', class: 'preview-home-logo', text: '홈로고' },
                { id: 'awayLogo', class: 'preview-away-logo', text: '어웨이로고' },
                { id: 'matchState', class: 'preview-match-state', text: '경기상태', visible: showMatchState },
                { id: 'homeLineup', class: 'preview-lineup', text: '홈라인업' },
                { id: 'awayLineup', class: 'preview-lineup', text: '어웨이라인업' },
                { id: 'overlayImage', class: 'preview-overlay-image', text: '이미지' },
                { id: 'timer', class: 'preview-timer', text: '타이머' }
            ];
            
            // 비율 계산 (1920x1080 -> 미리보기 크기)
            const scaleX = containerId === 'soccerOverlayPreviewSmall' ? 320 / 1920 : 640 / 1920;
            const scaleY = containerId === 'soccerOverlayPreviewSmall' ? 180 / 1080 : 360 / 1080;
            
            elements.forEach(element => {
                const div = document.createElement('div');
                div.className = `preview-element ${element.class}`;
                div.id = `${containerId}-${element.id}`;
                div.textContent = element.text;
                
                // 경기 상태 요소의 경우 표시 설정에 따라 숨김 처리
                if (element.id === 'matchState' && element.visible === false) {
                    div.style.display = 'none';
                }
                
                const pos = currentDesign[element.id];
                if (pos) {
                    // 타이머는 특별한 위치 처리 (스코어보드 내부)
                    if (element.id === 'timer') {
                        div.style.top = `${(20 + 25) * scaleY}px`; // 스코어보드 아래쪽
                        div.style.left = `${(80 + 420 + (pos.marginLeft || 8)) * scaleX}px`; // 스코어보드 오른쪽
                    } else {
                        // 위치를 비율에 맞게 조정
                        div.style.top = `${pos.top * scaleY}px`;
                        if (pos.left !== undefined) {
                            div.style.left = `${pos.left * scaleX}px`;
                        }
                        if (pos.right !== undefined) {
                            div.style.right = `${pos.right * scaleX}px`;
                        }
                        if (pos.width !== undefined) {
                            div.style.width = `${pos.width * scaleX}px`;
                        }
                        if (pos.height !== undefined) {
                            div.style.height = `${pos.height * scaleY}px`;
                        }
                    }
                }
                
                // 작은 미리보기에서만 클릭 이벤트 추가
                if (containerId === 'soccerOverlayPreviewSmall') {
                    div.onclick = (e) => {
                        e.stopPropagation();
                        document.getElementById('elementSelect').value = element.id;
                        selectElement();
                    };
                }
                
                preview.appendChild(div);
            });
        }

        // 작은 미리보기 렌더링
        function renderSmallPreview() {
            renderSoccerOverlayPreview('soccerOverlayPreviewSmall');
        }

        // 큰 미리보기 렌더링
        function renderFullPreview() {
            renderSoccerOverlayPreview('soccerOverlayPreviewFull');
        }

        // 요소 선택
        function selectElement() {
            selectedElement = document.getElementById('elementSelect').value;
            
            // 모든 요소의 선택 상태 제거
            document.querySelectorAll('.preview-element').forEach(el => {
                el.classList.remove('selected');
            });
            
            // 선택된 요소 하이라이트 (작은 미리보기)
            const selectedPreviewSmall = document.getElementById(`soccerOverlayPreviewSmall-${selectedElement}`);
            if (selectedPreviewSmall) {
                selectedPreviewSmall.classList.add('selected');
            }
            
            // 선택된 요소 하이라이트 (큰 미리보기)
            const selectedPreviewFull = document.getElementById(`soccerOverlayPreviewFull-${selectedElement}`);
            if (selectedPreviewFull) {
                selectedPreviewFull.classList.add('selected');
            }
        }





        // 디자인 설정 저장
        async function saveDesignSettings() {
            try {
                const response = await fetch(`/api/sport-overlay-design/${currentSportCode}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ design: currentDesign })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message, 'success');
                } else {
                    showToast(result.message || '저장에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('디자인 설정 저장 오류:', error);
                showToast('저장 중 오류가 발생했습니다.', 'error');
            }
        }

        // 미리보기 모달 열기
        function openPreviewModal() {
            renderFullPreview();
            const modal = new bootstrap.Modal(document.getElementById('soccerOverlayPreviewModal'));
            modal.show();
        }

        // 미리보기 새로고침
        function refreshPreview() {
            renderFullPreview();
            renderSmallPreview();
        }

        // 디자인 설정 초기화
        async function resetDesignSettings() {
            if (!confirm('정말로 기본값으로 초기화하시겠습니까?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/soccer-overlay-design/reset', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message, 'success');
                    loadSoccerOverlayDesign(); // 설정 다시 로드
                } else {
                    showToast(result.message || '초기화에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('디자인 설정 초기화 오류:', error);
                showToast('초기화 중 오류가 발생했습니다.', 'error');
            }
        }

        // 경기 상태 표시 설정 로드
        async function loadMatchStateSettings() {
            try {
                const response = await fetch('/api/soccer-match-state-visibility');
                const result = await response.json();
                
                if (result.success) {
                    const showMatchState = document.getElementById('showMatchState');
                    showMatchState.checked = result.showMatchState;
                }
            } catch (error) {
                console.error('경기 상태 표시 설정 로드 오류:', error);
            }
        }

        // 경기 상태 표시 설정 저장
        async function saveMatchStateSettings() {
            try {
                const showMatchState = document.getElementById('showMatchState').checked;
                
                const response = await fetch('/api/soccer-match-state-visibility', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ showMatchState: showMatchState })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('경기 상태 표시 설정이 저장되었습니다.', 'success');
                } else {
                    showToast(result.message || '저장에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('경기 상태 표시 설정 저장 오류:', error);
                showToast('저장 중 오류가 발생했습니다.', 'error');
            }
        }

        // 종목 목록 로드
        async function loadSports() {
            try {
                const response = await fetch('/api/sport');
                const sports = await response.json();
                
                const sportSelect = document.getElementById('sportSelect');
                sportSelect.innerHTML = '<option value="">종목을 선택하세요</option>';
                
                // 기본 종목 코드 (일반 사용자는 선택할 수 없음)
                const defaultSports = ['SOCCER', 'VOLLEYBALL', 'BASEBALL'];
                
                // 사용자 권한 확인 (서버에서 렌더링된 값 사용)
                const isAdmin = <% if (typeof userRole !== 'undefined' && userRole === 'admin') { %>true<% } else { %>false<% } %>;
                
                sports.forEach(sport => {
                    // 관리자가 아니고 기본 종목인 경우 제외
                    if (!isAdmin && defaultSports.includes(sport.code)) {
                        return;
                    }
                    
                    const option = document.createElement('option');
                    option.value = sport.code;
                    option.textContent = sport.name;
                    sportSelect.appendChild(option);
                });
            } catch (error) {
                console.error('종목 목록 로드 오류:', error);
            }
        }

        // 종목별 오버레이 이미지 목록과 현재 사용 중인 이미지 함께 로드
        async function loadSportOverlayImagesWithActive() {
            const sportSelect = document.getElementById('sportSelect');
            const sportCode = sportSelect.value;
            
            if (!sportCode) {
                document.getElementById('sportImageManagement').style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`/api/sport-overlay-images-with-active/${sportCode}`);
                const result = await response.json();
                
                if (result.success) {
                    // 종목 이름 업데이트
                    document.getElementById('selectedSportName').textContent = result.sportName;
                    document.getElementById('selectedSportName2').textContent = result.sportName;
                    document.getElementById('selectedSportName3').textContent = result.sportName;
                    document.getElementById('selectedSportCode').value = sportCode;
                    
                    // 이미지 관리 섹션 표시
                    document.getElementById('sportImageManagement').style.display = 'block';
                    
                    // 현재 사용 중인 이미지 표시
                    loadCurrentActiveImage(sportCode);
                    
                    // 이미지 목록 렌더링
                    const imagesList = document.getElementById('sportOverlayImagesList');
                    
                    if (result.images.length === 0) {
                        imagesList.innerHTML = `
                            <div class="col-12 text-center text-muted">
                                <i class="bi bi-image"></i> 업로드된 이미지가 없습니다.
                            </div>
                        `;
                    } else {
                        imagesList.innerHTML = result.images.map(image => `
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 ${image.id == result.activeImageId ? 'border-primary' : ''}">
                                    ${image.id == result.activeImageId ? '<div class="card-header bg-primary text-white text-center"><i class="bi bi-star-fill"></i> 현재 사용 중</div>' : ''}
                                    <img src="${image.file_path}" class="card-img-top" alt="오버레이 이미지" style="height: 150px; object-fit: cover;">
                                    <div class="card-body">
                                        <h6 class="card-title">${image.filename}</h6>
                                        <p class="card-text">
                                            <small class="text-muted">
                                                업로드: ${new Date(image.upload_time).toLocaleString()}
                                            </small>
                                        </p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" 
                                                       ${image.is_active ? 'checked' : ''} 
                                                       onchange="toggleImageStatus('${sportCode}', '${image.filename}', this.checked)">
                                                <label class="form-check-label">활성</label>
                                            </div>
                                            <div>
                                                ${image.id != result.activeImageId ? 
                                                    `<button class="btn btn-primary btn-sm me-1" onclick="setActiveImage('${sportCode}', ${image.id})">
                                                        <i class="bi bi-star"></i> 사용
                                                    </button>` : 
                                                    `<span class="badge bg-success">사용 중</span>`
                                                }
                                                <button class="btn btn-danger btn-sm" onclick="deleteSportOverlayImage('${sportCode}', '${image.filename}')">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    showToast(result.message || '이미지 목록을 불러오는데 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('종목별 오버레이 이미지 목록 로드 오류:', error);
                showToast('이미지 목록을 불러오는데 실패했습니다.', 'error');
            }
        }

        // 현재 사용 중인 이미지 로드
        async function loadCurrentActiveImage(sportCode) {
            try {
                const response = await fetch(`/api/sport-active-overlay-image/${sportCode}`);
                const result = await response.json();
                
                const currentActiveImageDiv = document.getElementById('currentActiveImage');
                
                if (result.success) {
                    if (result.activeImage) {
                        currentActiveImageDiv.innerHTML = `
                            <div class="row">
                                <div class="col-md-6 offset-md-3">
                                    <div class="card border-primary">
                                        <div class="card-header bg-primary text-white text-center">
                                            <i class="bi bi-star-fill"></i> 현재 사용 중인 이미지
                                        </div>
                                        <div class="card-body text-center">
                                            <img src="${result.activeImage.path}" class="img-fluid mb-2" alt="현재 사용 중인 이미지" style="max-height: 200px; object-fit: contain;">
                                            <h6 class="card-title">${result.activeImage.filename}</h6>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="clearActiveImage('${sportCode}')">
                                                <i class="bi bi-x-circle"></i> 사용 중지
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        currentActiveImageDiv.innerHTML = `
                            <div class="text-center text-muted">
                                <i class="bi bi-image"></i> 현재 사용 중인 이미지가 없습니다.
                                <br><small>아래 이미지 목록에서 사용할 이미지를 선택해주세요.</small>
                            </div>
                        `;
                    }
                } else {
                    currentActiveImageDiv.innerHTML = `
                        <div class="text-center text-danger">
                            <i class="bi bi-exclamation-triangle"></i> 현재 사용 중인 이미지 정보를 불러올 수 없습니다.
                        </div>
                    `;
                }
            } catch (error) {
                console.error('현재 사용 중인 이미지 로드 오류:', error);
                document.getElementById('currentActiveImage').innerHTML = `
                    <div class="text-center text-danger">
                        <i class="bi bi-exclamation-triangle"></i> 현재 사용 중인 이미지 정보를 불러올 수 없습니다.
                    </div>
                `;
            }
        }

        // 종목별 오버레이 이미지 목록 로드 (기존 함수 유지)
        async function loadSportOverlayImages() {
            await loadSportOverlayImagesWithActive();
            
            // 선택된 종목의 디자인 설정도 함께 로드
            const sportSelect = document.getElementById('sportSelect');
            const selectedSportCode = sportSelect.value;
            if (selectedSportCode) {
                await loadSportOverlayDesign(selectedSportCode);
            }
        }

        // 종목별 오버레이 이미지 업로드
        document.getElementById('sportOverlayImageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const sportCode = formData.get('sportCode');
            
            if (!sportCode) {
                showToast('종목을 선택해주세요.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/sport-overlay-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message, 'success');
                    this.reset();
                    loadSportOverlayImages(); // 목록 새로고침
                } else {
                    showToast(result.message || '업로드에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('종목별 오버레이 이미지 업로드 오류:', error);
                showToast('업로드 중 오류가 발생했습니다.', 'error');
            }
        });

        // 종목별 오버레이 이미지 삭제
        async function deleteSportOverlayImage(sportCode, filename) {
            if (!confirm('정말로 이 이미지를 삭제하시겠습니까?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/sport-overlay-image/${sportCode}/${filename}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message, 'success');
                    loadSportOverlayImages(); // 목록 새로고침
                } else {
                    showToast(result.message || '삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('종목별 오버레이 이미지 삭제 오류:', error);
                showToast('삭제 중 오류가 발생했습니다.', 'error');
            }
        }

        // 종목별 오버레이 이미지 활성화/비활성화
        async function toggleImageStatus(sportCode, filename, isActive) {
            try {
                const response = await fetch(`/api/sport-overlay-image/${sportCode}/${filename}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ isActive: isActive })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message, 'success');
                } else {
                    showToast(result.message || '상태 변경에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('종목별 오버레이 이미지 상태 변경 오류:', error);
                showToast('상태 변경 중 오류가 발생했습니다.', 'error');
            }
        }

        // 이미지를 현재 사용 중인 이미지로 설정
        async function setActiveImage(sportCode, imageId) {
            try {
                const response = await fetch(`/api/sport-active-overlay-image/${sportCode}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ imageId: imageId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message, 'success');
                    loadSportOverlayImagesWithActive(); // 목록 새로고침
                } else {
                    showToast(result.message || '이미지 설정에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('현재 사용 중인 이미지 설정 오류:', error);
                showToast('이미지 설정 중 오류가 발생했습니다.', 'error');
            }
        }

        // 현재 사용 중인 이미지 사용 중지
        async function clearActiveImage(sportCode) {
            if (!confirm('정말로 현재 사용 중인 이미지를 사용 중지하시겠습니까?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/sport-active-overlay-image/${sportCode}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ imageId: null })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('현재 사용 중인 이미지가 사용 중지되었습니다.', 'success');
                    loadSportOverlayImagesWithActive(); // 목록 새로고침
                } else {
                    showToast(result.message || '이미지 사용 중지에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('현재 사용 중인 이미지 사용 중지 오류:', error);
                showToast('이미지 사용 중지 중 오류가 발생했습니다.', 'error');
            }
        }

        // 이벤트 리스너
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadLogFiles(); // 로그 파일 목록 로드
            loadAutoManagementStatus(); // 자동 로그 관리 상태 로드
            loadSportOverlayDesign('SOCCER'); // 기본 종목(축구) 오버레이 디자인 설정 로드
            loadMatchStateSettings(); // 경기 상태 표시 설정 로드
            loadSports(); // 종목 목록 로드
            
            // 컬러 변경 이벤트
            document.getElementById('default-home-color').addEventListener('change', function() {
                updateColorPreview('home', this.value);
            });
            
            document.getElementById('default-away-color').addEventListener('change', function() {
                updateColorPreview('away', this.value);
            });
            
            // 경기 상태 표시 설정 변경 이벤트
            document.getElementById('showMatchState').addEventListener('change', function() {
                saveMatchStateSettings();
                // 미리보기 업데이트
                renderSmallPreview();
            });
            
            // 저장 버튼 이벤트
            document.getElementById('save-settings').addEventListener('click', saveSettings);
        });
    </script>
</body>
</html> 