<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volleyball Overlay</title>
    <script>
        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.matchId = '<%= match.id %>';
        window.sportType = 'VOLLEYBALL';
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: transparent;
            color: white;
            overflow: hidden;
        }

        .team-logo {
            max-width: 100%;
            max-height: 100%;
            background-color: rgba(255, 255, 255, 0.0);
            padding: 0px;
        }

                /* ì‹¤ì œ ë¡œê³  ì˜ì—­: ì›í˜• í…Œë‘ë¦¬ ì ìš© */
        .team-logo-container {
            width: 40px;
            height: 40px;
            margin-right: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
        }

              /* ë¡œê³ ê°€ ì—†ì„ ë•Œ í‘œì‹œë  í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼ */
        .team-logo-placeholder {
            width: 100%;                                 /* ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤ */
            height: 100%;                                /* ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤ */
            border-radius: 5px;                          /* ì‚´ì§ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            background-color: rgba(0, 0, 0, 0.0);      /* ë°˜íˆ¬ëª… í° ë°°ê²½ */
            display: flex;                               /* í…ìŠ¤íŠ¸ ì •ë ¬ìš© flex */
            align-items: center;                         /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
            justify-content: center;                     /* ê°€ë¡œ ê°€ìš´ë° ì •ë ¬ */
            font-weight: bold;                           /* ê¸€ì”¨ êµµê²Œ */
            color: white;                                /* ê¸€ì”¨ ìƒ‰ í°ìƒ‰ */
            font-size: 24px;                             /* ê¸€ì”¨ í¬ê¸° 24px */
        }

        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', Arial, sans-serif;
        }
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            min-width: 100vw;
            height: 100vh;
            width: 100vw;
            position: relative;
        }
        .overlay-container {
            width: 100vw;
            height: 100vh;
            min-width: 100vw;
            min-height: 100vh;
            position: relative;
        }

        /* ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ ì˜ì—­ */
        .list-info {
            position: absolute;
            top: 20px;
            right: 50px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: none;
        }
        
        .list-info.show {
            display: block;
        }
        
        .list-info .list-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .list-info .match-counter {
            font-size: 12px;
            opacity: 0.8;
        }

        /* ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ (ì¢Œì¸¡ ìƒë‹¨) - ì¢Œìš° ìˆ˜í‰ ë””ìì¸ */
        .main-scoreboard {        
            position: fixed;
            top: 20px;
            left: 20px;
            width: 500px; /* ê³ ì • ë„ˆë¹„ ì„¤ì • (ë°•ìŠ¤ ìš”ì†Œë“¤ì˜ ì´ ë„ˆë¹„ì™€ ì¼ì¹˜) */
            height: 60px; /* í˜„ì¬ ì„¸íŠ¸ ë°•ìŠ¤ì™€ ë™ì¼í•œ ë†’ì´ */
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            color: rgb(255, 255, 255);
            overflow: hidden;            
            border-radius: 10px;
            z-index: 1000;
        }
        
        /* ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ (ì¤‘ì•™ í•˜ë‹¨) */
        .set-scoreboard {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 10px;
            z-index: 1000;
        }
        
        /* ê²½ê¸°ë°©ì‹ì— ë”°ë¥¸ ì„¸íŠ¸ í‘œì‹œ */
        .set-scoreboard.format-3 [data-set="4"],
        .set-scoreboard.format-3 [data-set="5"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .set-scoreboard.format-5 [data-set="4"],
        .set-scoreboard.format-5 [data-set="5"] {
            display: table-cell !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* 4ì„¸íŠ¸, 5ì„¸íŠ¸ ìˆ¨ê¹€ ì²˜ë¦¬ */
        .set-scoreboard.format-3 th:nth-child(5),
        .set-scoreboard.format-3 th:nth-child(6),
        .set-scoreboard.format-3 td:nth-child(5),
        .set-scoreboard.format-3 td:nth-child(6) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .set-header {
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px 10px 0 0;
        }
        
        .tournament-name {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        
        .set-table {
            padding: 10px;
        }
        
        .sets-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .sets-table th,
        .sets-table td {
            padding: 8px 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sets-table th {
            background-color: rgba(255, 255, 255, 0.1);
            font-weight: bold;
        }
        
        .sets-table .team-name {
            font-weight: bold;
            text-align: left;
        }
        
        .sets-table .set-score {
            font-size: 18px;
            font-weight: bold;
        }
        
        .sets-table .total-score {
            font-size: 20px;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .home-row {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .away-row {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .team-section {
            display: flex;
            flex-direction: row;
            width: 100%;
            align-items: center;
            justify-content: flex-start; /* space-between â†’ flex-start (ì™¼ìª½ ì •ë ¬) */
            gap: 0; /* ë°•ìŠ¤ ê°„ ê°„ê²© ì œê±° */
        }
        
        /* ê° ë°•ìŠ¤ë³„ ìŠ¤íƒ€ì¼ */
        .team-name-box, .team-score-box, .serve-indicator-box {
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 !important; /* ëª¨ë“  ë§ˆì§„ ê°•ì œ ì œê±° */
            padding: 2px; /* 5px â†’ 2px (ê°„ê²© ìµœì†Œí™”) */
            height: 100%; /* ë¶€ëª¨ ë†’ì´ì— ë§ì¶¤ */
            flex: 0 0 auto; /* í¬ê¸° ê³ ì • */
        }
        
        /* ê° ë°•ìŠ¤ë³„ ê³ ì • ë„ˆë¹„ ì„¤ì • */
        .team-name-box {
            width: 120px; /* íŒ€ëª… ê³ ì • ë„ˆë¹„ ì¦ê°€ */
            flex: 0 0 120px; /* í¬ê¸° ê³ ì • */
        }
        
        .team-score-box {
            width: 80px; /* ì ìˆ˜ ê³ ì • ë„ˆë¹„ */
            flex: 0 0 80px; /* í¬ê¸° ê³ ì • */
        }
        
        .serve-indicator-box {
            width: 100px; /* ì„œë¸Œê¶Œ ê³ ì • ë„ˆë¹„ */
            flex: 0 0 100px; /* í¬ê¸° ê³ ì • */
            background-color: #FFD700 !important; /* ì§„í•œ ë…¸ë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px 15px;
            border-left: 2px solid rgba(255, 255, 255, 0.3);
            border-right: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        /* ë°•ìŠ¤ ê°„ ê°„ê²© ì™„ì „ ì œê±° */
        .team-section > div {
            margin: 0 !important;
            padding: 2px;
        }
        
        /* ì²« ë²ˆì§¸ ë°•ìŠ¤ë§Œ ì™¼ìª½ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
        .team-section > div:first-child {
            border-top-left-radius: 10px;
            border-bottom-left-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ë§ˆì§€ë§‰ ë°•ìŠ¤ë§Œ ì˜¤ë¥¸ìª½ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
        .team-section > div:last-child {
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ì¤‘ê°„ ë°•ìŠ¤ë“¤ì€ í…Œë‘ë¦¬ ì™„ì „ ì œê±° */
        .team-section > div:not(:first-child):not(:last-child) {
            border: none !important;
        }
        
        .team-name {
            font-size: 18px;
            font-weight: bold;
            color: white;
            padding: 10px 15px;
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .team-score {
            font-size: 36px;
            font-weight: bold;
            color: white;
            padding: 10px 20px;
            min-width: 60px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* í˜„ì¬ ì„¸íŠ¸ í‘œì‹œ ë°•ìŠ¤ (ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ì˜†) */
        .current-set-box {
            position: fixed;
            top: 20px;
            left: calc(500px + 20px + 5px); /* ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ë„ˆë¹„(500px) + ì™¼ìª½ ì—¬ë°±(20px) + ê°„ê²©(5px) */
            width: 80px;
            height: 60px; /* ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œì™€ ë™ì¼í•œ ë†’ì´ */
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .current-set-number {
            font-size: 40px;
            font-weight: bold;
            color: white;
            margin-bottom: 2px; /* 0px â†’ 2px (2px ê°„ê²©) */
            line-height: 1; /* ì¤„ ê°„ê²© ìµœì†Œí™” */
            transform: translateY(-1px); /* ìœ„ë¡œ 1px ì´ë™ */
        }
        
        .current-set-text {
            font-size: 14px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 0px; /* ìœ„ìª½ ë§ˆì§„ ì œê±° */
            line-height: 1; /* ì¤„ ê°„ê²© ìµœì†Œí™” */
            transform: translateY(-1px); /* ìœ„ë¡œ 1px ì´ë™ */
        }
        
        
       
       .serve-arrow {
           font-size: 24px;
           font-weight: bold;
           color: white;
       }
        
        
        
        
        
        
        
        /* ì´ë‹ ìŠ¤ì½”ì–´ */
        .innings-scoreboard {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            background-color: rgba(0, 0, 0, 1.0);
            border-radius: 8px;
            color: white;
            overflow: hidden;
        }
        .innings-title {
            background-color: rgb(0, 126, 52);
            padding: 8px 12px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
        .innings-table {
            width: 100%;
            border-collapse: collapse;
        }
        .innings-table th, .innings-table td {
            padding: 8px;
            text-align: center;
            font-size: 14px;
        }
        .innings-table th {
            color: rgba(255, 255, 255, 0.7);
            background-color: rgba(255, 255, 255, 0.1);
        }
        .innings-table td {
            font-weight: bold;
        }
        .innings-table td.team-name {
            text-align: left;
            width: 120px;
        }
        .innings-table td.total {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ */
        .overlay-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 1920px;
            height: 1080px;
            z-index: 1000;
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        }

        .overlay-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
            box-shadow: none;
        }

        .overlay-image.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="overlay-container">
        <!-- ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ -->
        <% if (typeof listId !== 'undefined' && listId) { %>
        <div class="list-info" id="listInfo">
            <div class="list-name" id="listName"></div>
            <div class="match-counter" id="matchCounter"></div>
        </div>
        <% } %>
        
        <!-- ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ -->
        <div class="overlay-image" id="overlayImage">
            <!-- ì´ë¯¸ì§€ëŠ” JavaScriptë¡œ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
        
        <!-- ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ (ì¢Œì¸¡ ìƒë‹¨) - ì¢Œìš° ìˆ˜í‰ ë””ìì¸ -->
        <div class="main-scoreboard">
            <div class="team-section">
                <!-- í™ˆíŒ€ëª… ë°•ìŠ¤ -->
                <div class="team-name-box home-team-name-box">
                    <div class="team-name home-team-name">
                        <%= match.home_team || 'HOME' %>
                    </div>
                    </div>
                
                <!-- í™ˆíŒ€ ì ìˆ˜ ë°•ìŠ¤ -->
                <div class="team-score-box home-team-score-box">
                    <div class="team-score home-team-score">
                        <%= match.match_data?.innings?.home?.[match.match_data?.current_inning || 1] || '0' %>
                </div>
                    </div>
                
                <!-- ì„œë¸Œê¶Œ ë°•ìŠ¤ -->
                <div class="serve-indicator-box">
                   <span class="serve-arrow" id="serve-arrow">
                       <%= match.match_data?.serve_team === 'home' ? 'â–¶' : 'â—€' %>
                   </span>
                </div>
                
                <!-- ì–´ì›¨ì´íŒ€ ì ìˆ˜ ë°•ìŠ¤ -->
                <div class="team-score-box away-team-score-box">
                    <div class="team-score away-team-score">
                        <%= match.match_data?.innings?.away?.[match.match_data?.current_inning || 1] || '0' %>
            </div>
        </div>

                <!-- ì–´ì›¨ì´íŒ€ëª… ë°•ìŠ¤ -->
                <div class="team-name-box away-team-name-box">
                    <div class="team-name away-team-name">
                        <%= match.away_team || 'AWAY' %>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- í˜„ì¬ ì„¸íŠ¸ í‘œì‹œ ë°•ìŠ¤ (ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ì˜†) -->
        <div class="current-set-box">
            <div class="current-set-number">
                <span id="current-set-display"><%= match.match_data?.current_inning || 1 %></span>
            </div>
            <div class="current-set-text">SET</div>
        </div>

        <!-- ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ (ì¤‘ì•™ í•˜ë‹¨) -->
        <div class="set-scoreboard">
            <div class="set-header">
                <div class="tournament-name"><span id="tournament-display"><%= match.match_data?.tournament_name || 'ëŒ€íšŒëª…ì„ ì…ë ¥í•˜ì„¸ìš”' %></span></div>
            </div>
            <div class="set-table">
                <table class="sets-table">
                    <thead>
                        <tr>
                            <th>íŒ€</th>
                            <th>1ì„¸íŠ¸</th>
                            <th>2ì„¸íŠ¸</th>
                            <th>3ì„¸íŠ¸</th>
                            <th style="<%= (match.match_data?.match_format || 3) === 3 ? 'display: none !important;' : '' %>">4ì„¸íŠ¸</th>
                            <th style="<%= (match.match_data?.match_format || 3) === 3 ? 'display: none !important;' : '' %>">5ì„¸íŠ¸</th>
                            <th>ì´ì </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="home-row">
                            <td class="team-name"><%= match.home_team || 'HOME' %></td>
                            <td class="set-score" id="home-set-1" data-set="1"><%= match.match_data?.innings?.home?.[1] || '0' %></td>
                            <td class="set-score" id="home-set-2" data-set="2"><%= match.match_data?.innings?.home?.[2] || '0' %></td>
                            <td class="set-score" id="home-set-3" data-set="3"><%= match.match_data?.innings?.home?.[3] || '0' %></td>
                            <td class="set-score" id="home-set-4" data-set="4" style="<%= (match.match_data?.match_format || 3) === 3 ? 'display: none !important;' : '' %>"><%= match.match_data?.innings?.home?.[4] || '0' %></td>
                            <td class="set-score" id="home-set-5" data-set="5" style="<%= (match.match_data?.match_format || 3) === 3 ? 'display: none !important;' : '' %>"><%= match.match_data?.innings?.home?.[5] || '0' %></td>
                            <td class="total-score" id="home-total">0</td>
                        </tr>
                        <tr class="away-row">
                            <td class="team-name"><%= match.away_team || 'AWAY' %></td>
                            <td class="set-score" id="away-set-1" data-set="1"><%= match.match_data?.innings?.away?.[1] || '0' %></td>
                            <td class="set-score" id="away-set-2" data-set="2"><%= match.match_data?.innings?.away?.[2] || '0' %></td>
                            <td class="set-score" id="away-set-3" data-set="3"><%= match.match_data?.innings?.away?.[3] || '0' %></td>
                            <td class="set-score" id="away-set-4" data-set="4" style="<%= (match.match_data?.match_format || 3) === 3 ? 'display: none !important;' : '' %>"><%= match.match_data?.innings?.away?.[4] || '0' %></td>
                            <td class="set-score" id="away-set-5" data-set="5" style="<%= (match.match_data?.match_format || 3) === 3 ? 'display: none !important;' : '' %>"><%= match.match_data?.innings?.away?.[5] || '0' %></td>
                            <td class="total-score" id="away-total">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


        
        
        
    </div>

    <script>
        const socket = io();
        const matchId = '<%= match.id %>';
        
        // ê²½ê¸° ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadMatchData() {
            try {
                const response = await fetch(`/api/matches/${matchId}`);
                const matchData = await response.json();
                window.matchData = matchData;  // ì „ì—­ ë³€ìˆ˜ë¡œ ì €ì¥
                console.log('ğŸ”§ ê²½ê¸° ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', matchData.sport_type);
                return matchData;
            } catch (error) {
                console.error('ğŸ”§ ê²½ê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ì„œë¸Œê¶Œ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹  (ì „ì—­ìœ¼ë¡œ ì´ë™)
        socket.on('serve_changed', function(data) {
            console.log('ğŸ ì„œë¸Œê¶Œ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            const serveArrow = document.getElementById('serve-arrow');
            if (serveArrow) {
                const arrow = data.serve_team === 'home' ? 'â–¶' : 'â—€';
                serveArrow.textContent = arrow;
                console.log('ğŸ ì„œë¸Œê¶Œ ë„í˜• ë³€ê²½:', arrow);
            }
        });

        // ì†Œì¼“ ì—°ê²°
        socket.on('connect', async () => {
            console.log('=== Socket.IO ì—°ê²°ë¨ (ì˜¤ë²„ë ˆì´) ===');
            console.log('Socket ID:', socket.id);
            console.log('Match ID:', matchId);
            socket.emit('join', matchId);
            
            // ê²½ê¸° ë°ì´í„° ë¡œë“œ í›„ ì¢…ëª©ë³„ Roomì— ì°¸ì—¬ ìš”ì²­
            const matchData = await loadMatchData();
            if (matchData) {
                // ì„œë²„ì— ì¢…ëª©ë³„ Room ì°¸ì—¬ ìš”ì²­
                socket.emit('join_sport_room', matchData.sport_type);
                console.log(`ğŸ”§ ì¢…ëª©ë³„ Room ì°¸ì—¬ ìš”ì²­: sport_${matchData.sport_type}`);
            }
            
            // ì¢…ëª©ë³„ Room ì°¸ì—¬ í™•ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            socket.on('joined_sport_room', (data) => {
                if (data.success) {
                    console.log(`ğŸ”§ ì•¼êµ¬ ì¢…ëª©ë³„ Room ì°¸ì—¬ ì™„ë£Œ: ${data.roomName}`);
                    console.log(`ğŸ”§ Room ì°¸ì—¬ì ìˆ˜: ${data.clientCount}`);
                    // Room ì°¸ì—¬ ì™„ë£Œ í›„ ê¸°ì¡´ í™œì„± ì´ë¯¸ì§€ ë¡œë“œ
                    loadOverlayImage();
                    
                    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ (Room ì°¸ì—¬ ì™„ë£Œ í›„)
                    console.log('ğŸ”§ ì•¼êµ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ ì‹œì‘');
                    registerOverlayImageEventListeners();
                } else {
                    console.error(`ğŸ”§ ì•¼êµ¬ ì¢…ëª©ë³„ Room ì°¸ì—¬ ì‹¤íŒ¨: ${data.error}`);
                }
            });
            
            if (typeof isListMode !== 'undefined' && isListMode && typeof listId !== 'undefined' && listId) { 
            // ë¦¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ëª¨ë“œì¼ ë•Œ ë¦¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ë°©ì—ë„ ì°¸ê°€
            socket.emit('join_list_overlay', '<%= listId %>');
            } 
        });
        
        socket.on('disconnect', () => {
            console.log('=== Socket.IO ì—°ê²° ëŠì–´ì§ (ì˜¤ë²„ë ˆì´) ===');
            updateConnectionStatus(false);
        });

        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateConnectionStatus(connected) {
            // ì˜¤ë²„ë ˆì´ í˜ì´ì§€ì—ì„œëŠ” ì—°ê²° ìƒíƒœ í‘œì‹œê°€ ì—†ìœ¼ë¯€ë¡œ ì½˜ì†” ë¡œê·¸ë§Œ ì¶œë ¥
            if (connected) {
                console.log('âœ… ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì„œë²„ ì—°ê²°ë¨');
            } else {
                console.log('âŒ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì„œë²„ ì—°ê²° ëŠê¹€');
            }
        }
        
        socket.on('connect_error', (error) => {
            console.error('=== Socket.IO ì—°ê²° ì˜¤ë¥˜ (ì˜¤ë²„ë ˆì´) ===', error);
        });

        // ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì¬ì—°ê²° ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('reconnect_attempt', (attemptNumber) => {
            console.log(`ğŸ”„ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì†Œì¼“ ì¬ì—°ê²° ì‹œë„ ì¤‘... (${attemptNumber}ë²ˆì§¸)`);
            updateConnectionStatus(false);
        });

        socket.on('reconnect_error', (error) => {
            console.error('âŒ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì†Œì¼“ ì¬ì—°ê²° ì‹¤íŒ¨:', error);
            updateConnectionStatus(false);
        });

        socket.on('reconnect_failed', () => {
            console.error('âŒ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì†Œì¼“ ì¬ì—°ê²° ì™„ì „ ì‹¤íŒ¨');
            updateConnectionStatus(false);
        });

        // ì†Œì¼“ ì¬ì—°ê²° ì´ë²¤íŠ¸
        socket.on('reconnect', (attemptNumber) => {
            console.log(`ğŸ”„ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ì†Œì¼“ ì¬ì—°ê²° ì„±ê³µ (ì‹œë„ ${attemptNumber}ë²ˆì§¸)`);
            updateConnectionStatus(true);
            
            // ì¬ì—°ê²° ì‹œ ì¢…ëª©ë³„ ë£¸ ì¬ì¡°ì¸
            if (window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ì¬ì—°ê²° í›„ ì¢…ëª©ë³„ ë£¸ ì¬ì¡°ì¸:', window.matchData.sport_type);
                socket.emit('join_sport_room', window.matchData.sport_type);
            }
            
            // ğŸ”„ ì¬ì—°ê²° ì‹œ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìë™ ìƒˆë¡œê³ ì¹¨ (ì„œë²„ ë¦¬ì…‹ í›„ ì»¨íŠ¸ë¡¤ í˜ì´ì§€ ë‚´ìš© ë°˜ì˜)
            console.log('ğŸ”„ ì•¼êµ¬ ì¬ì—°ê²° ê°ì§€ - ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰');
            console.log('ğŸ”„ ìƒˆë¡œê³ ì¹¨ ì´ìœ : ì„œë²„ ì¬ì—°ê²° í›„ ì»¨íŠ¸ë¡¤ í˜ì´ì§€ ë‚´ìš© ë™ê¸°í™”');
            
            // DB ì €ì¥ ì™„ë£Œë¥¼ ìœ„í•´ 1ì´ˆ ì§€ì—° í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                console.log('ğŸ”„ 1ì´ˆ ì§€ì—° í›„ ì•¼êµ¬ ì¬ì—°ê²° ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰');
                location.reload();
            }, 1000);
        });

                // match_update ì´ë²¤íŠ¸ ì œê±°ë¨ - match_updated ì´ë²¤íŠ¸ë¡œ í†µí•©

        // ê²½ê¸°ë°©ì‹ ë³€ê²½ ì´ë²¤íŠ¸
        socket.on('match_format_updated', (data) => {
            console.log('ğŸ ê²½ê¸°ë°©ì‹ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ ë¨:', data);
            console.log('ğŸ í˜„ì¬ matchId:', matchId);
            console.log('ğŸ ì´ë²¤íŠ¸ match_id:', data.match_id);
            
            if (data.match_id === matchId) {
                console.log('ğŸ ê²½ê¸°ë°©ì‹ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬:', data.match_format + 'ì„¸íŠ¸ì œ');
                updateOverlaySetDisplay(data.match_format);
            } else {
                console.log('ğŸ ê²½ê¸°ë°©ì‹ ë³€ê²½ ì´ë²¤íŠ¸ ë¬´ì‹œë¨ (ë‹¤ë¥¸ ê²½ê¸°)');
            }
        });

// ê²½ê¸° ìˆ˜ì • ì´ë²¤íŠ¸
        socket.on('match_updated', (data) => {
            if (data.matchId === matchId) {
                console.log('ê²½ê¸° ìˆ˜ì • ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
                
                // íŒ€ëª… ì—…ë°ì´íŠ¸
                const homeTeamNameElement = document.querySelector('.home-team-name');
                const awayTeamNameElement = document.querySelector('.away-team-name');
                
                if (homeTeamNameElement && data.home_team) {
                    homeTeamNameElement.textContent = data.home_team;
                    console.log('í™ˆíŒ€ëª… ì—…ë°ì´íŠ¸:', data.home_team);
                }
                if (awayTeamNameElement && data.away_team) {
                    awayTeamNameElement.textContent = data.away_team;
                    console.log('ì›ì •íŒ€ëª… ì—…ë°ì´íŠ¸:', data.away_team);
                }
                
                // ì¢…ëª© ì—…ë°ì´íŠ¸ (í•„ìš”í•œ ê²½ìš°)
                if (data.sport_type && data.sport_type !== currentSportType) {
                    currentSportType = data.sport_type;
                    console.log('ì¢…ëª© ë³€ê²½ë¨:', currentSportType);
                }
                
                // ê²½ê¸°ë°©ì‹ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš©)
                if (data.match_data?.match_format) {
                    console.log('ğŸ ê²½ê¸°ë°©ì‹ ì—…ë°ì´íŠ¸:', data.match_data.match_format + 'ì„¸íŠ¸ì œ');
                    updateOverlaySetDisplay(data.match_data.match_format);
                }
                
       // ì„œë¸Œê¶Œ ì •ë³´ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš©) - ë„í˜•ìœ¼ë¡œ ë³€ê²½
       if (data.match_data?.serve_team) {
           const serveArrow = document.getElementById('serve-arrow');
           if (serveArrow) {
               const arrow = data.match_data.serve_team === 'home' ? 'â–¶' : 'â—€';
               serveArrow.textContent = arrow;
               console.log('ğŸ ì„œë¸Œê¶Œ ë„í˜• ì—…ë°ì´íŠ¸:', arrow);
           }
       }
                
                // í˜„ì¬ ì„¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš©)
                if (data.match_data?.current_inning) {
                    const currentSetDisplay = document.getElementById('current-set-display');
                    if (currentSetDisplay) {
                        currentSetDisplay.textContent = data.match_data.current_inning;
                        console.log('ğŸ í˜„ì¬ ì„¸íŠ¸ ì—…ë°ì´íŠ¸:', data.match_data.current_inning + 'ì„¸íŠ¸');
                    }
                }
                
                // í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš©)
                const currentSet = data.match_data?.current_inning || 1;
                let homeCurrentSetScore = 0;
                let awayCurrentSetScore = 0;
                
                // í˜„ì¬ ì„¸íŠ¸ì˜ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
                if (data.match_data?.innings) {
                    if (data.match_data.innings.home && data.match_data.innings.away) {
                        // ìƒˆë¡œìš´ êµ¬ì¡°: innings.home[1], innings.away[1]
                        homeCurrentSetScore = parseInt(data.match_data.innings.home[currentSet] || '0');
                        awayCurrentSetScore = parseInt(data.match_data.innings.away[currentSet] || '0');
                    } else {
                        // ê¸°ì¡´ êµ¬ì¡°: innings.home_1, innings.away_1
                        homeCurrentSetScore = parseInt(data.match_data.innings[`home_${currentSet}`] || '0');
                        awayCurrentSetScore = parseInt(data.match_data.innings[`away_${currentSet}`] || '0');
                    }
                }
                
                // ğŸ ì´ˆê¸°í™” ê°ì§€: ëª¨ë“  ì ìˆ˜ê°€ 0ì´ê³  current_inningì´ 1ì¸ ê²½ìš°
                const isReset = data.home_score === 0 && data.away_score === 0 && 
                               data.match_data?.current_inning === 1 &&
                               homeCurrentSetScore === 0 && awayCurrentSetScore === 0;
                
                if (isReset) {
                    console.log('ğŸ ì´ˆê¸°í™” ê°ì§€ - ëª¨ë“  UI ê°•ì œ ì—…ë°ì´íŠ¸');
                    
                    // ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ê°•ì œ ì—…ë°ì´íŠ¸
                    const homeScoreEl = document.querySelector('.home-team-score');
                    const awayScoreEl = document.querySelector('.away-team-score');
                    if (homeScoreEl) homeScoreEl.textContent = '0';
                    if (awayScoreEl) awayScoreEl.textContent = '0';
                    
                    // í˜„ì¬ ì„¸íŠ¸ í‘œì‹œ ê°•ì œ ì—…ë°ì´íŠ¸
                    const currentSetDisplay = document.getElementById('current-set-display');
                    if (currentSetDisplay) currentSetDisplay.textContent = '1';
                    
                    // ì´ì  ê°•ì œ ì—…ë°ì´íŠ¸
                    const homeTotalElement = document.getElementById('home-total');
                    const awayTotalElement = document.getElementById('away-total');
                    if (homeTotalElement) homeTotalElement.textContent = '0';
                    if (awayTotalElement) awayTotalElement.textContent = '0';
                    
                    // ëª¨ë“  ì„¸íŠ¸ ì ìˆ˜ ê°•ì œ ì—…ë°ì´íŠ¸
                    for (let i = 1; i <= 5; i++) {
                        const homeSetElement = document.querySelector(`[data-set="${i}"].home-set-score`);
                        const awaySetElement = document.querySelector(`[data-set="${i}"].away-set-score`);
                        if (homeSetElement) homeSetElement.textContent = '0';
                        if (awaySetElement) awaySetElement.textContent = '0';
                    }
                    
                    console.log('ğŸ ì´ˆê¸°í™” UI ê°•ì œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                }
                
                console.log('ğŸ”¥ í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ì‚¬ìš©:', { 
                    currentSet: currentSet, 
                    home: homeCurrentSetScore, 
                    away: awayCurrentSetScore 
                });
                
                // ë°°êµ¬ìš©: í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ë§Œ ì‚¬ìš© (ì´ë‹ë³„ ì ìˆ˜ í•©ê³„ ê³„ì‚° ì œê±°)
                
                const homeScoreEl = document.querySelector('.home-team-score');
                if (homeScoreEl && homeScoreEl.textContent !== homeCurrentSetScore) {
                    homeScoreEl.textContent = homeCurrentSetScore;
                }
                const awayScoreEl = document.querySelector('.away-team-score');
                if (awayScoreEl && awayScoreEl.textContent !== awayCurrentSetScore) {
                    awayScoreEl.textContent = awayCurrentSetScore;
                }
                
                console.log('ğŸ”¥ ìµœì¢… ì ìˆ˜ ì—…ë°ì´íŠ¸:', { home: homeCurrentSetScore, away: awayCurrentSetScore });
                
                // ëŒ€íšŒëª… ì—…ë°ì´íŠ¸
                if (data.match_data?.tournament_name) {
                    const tournamentDisplay = document.getElementById('tournament-display');
                    if (tournamentDisplay) {
                        tournamentDisplay.textContent = data.match_data.tournament_name;
                        console.log('ğŸ ëŒ€íšŒëª… ì—…ë°ì´íŠ¸:', data.match_data.tournament_name);
                    }
                }
                
                // ë°°êµ¬ìš©: ì„¸íŠ¸ ìŠ¹ë¦¬ ê³„ì‚° ë° ì´ì  ì—…ë°ì´íŠ¸
                if (data.match_data?.innings) {
                    let homeWins = 0;
                    let awayWins = 0;
                    
                    // í˜„ì¬ ì„¸íŠ¸ ì´ì „ê¹Œì§€ë§Œ ìŠ¹ë¦¬ ê³„ì‚° (ì§„í–‰ ì¤‘ì¸ ì„¸íŠ¸ ì œì™¸)
                    for (let i = 1; i < currentSet; i++) {
                        let homeScore = 0;
                        let awayScore = 0;
                        
                        // ì„¸íŠ¸ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
                        if (data.match_data.innings.home && data.match_data.innings.away) {
                            // ìƒˆë¡œìš´ êµ¬ì¡°: innings.home[1], innings.away[1]
                            homeScore = parseInt(data.match_data.innings.home[i] || '0');
                            awayScore = parseInt(data.match_data.innings.away[i] || '0');
                } else {
                            // ê¸°ì¡´ êµ¬ì¡°: innings.home_1, innings.away_1
                            homeScore = parseInt(data.match_data.innings[`home_${i}`] || '0');
                            awayScore = parseInt(data.match_data.innings[`away_${i}`] || '0');
                        }
                        
                        // ì„¸íŠ¸ê°€ ì§„í–‰ëœ ê²½ìš°ì—ë§Œ ìŠ¹ë¦¬ ê³„ì‚°
                        if (homeScore > 0 || awayScore > 0) {
                            if (homeScore > awayScore) {
                                homeWins++;
                            } else if (awayScore > homeScore) {
                                awayWins++;
                            }
                            // ë™ì ì¸ ê²½ìš°ëŠ” ìŠ¹ë¦¬í•˜ì§€ ì•ŠìŒ
                        }
                    }
                    
                    // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œì˜ ì´ì  ì—…ë°ì´íŠ¸
                    const homeTotalElement = document.getElementById('home-total');
                    const awayTotalElement = document.getElementById('away-total');
                    
                    if (homeTotalElement) homeTotalElement.textContent = homeWins;
                    if (awayTotalElement) awayTotalElement.textContent = awayWins;
                    
                    console.log(`ğŸ ì„¸íŠ¸ ìŠ¹ë¦¬ ê³„ì‚° ì™„ë£Œ (${currentSet}ì„¸íŠ¸ ì§„í–‰ ì¤‘): í™ˆíŒ€ ${homeWins}, ì–´ì›¨ì´íŒ€ ${awayWins}`);
                    
                    // ğŸ ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ ê°œë³„ ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸
                    for (let i = 1; i <= 5; i++) {
                        let homeSetScore = 0;
                        let awaySetScore = 0;
                        
                        // ì„¸íŠ¸ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
                        if (data.match_data.innings.home && data.match_data.innings.away) {
                            // ìƒˆë¡œìš´ êµ¬ì¡°: innings.home[1], innings.away[1]
                            homeSetScore = parseInt(data.match_data.innings.home[i] || '0');
                            awaySetScore = parseInt(data.match_data.innings.away[i] || '0');
                        } else {
                            // ê¸°ì¡´ êµ¬ì¡°: innings.home_1, innings.away_1
                            homeSetScore = parseInt(data.match_data.innings[`home_${i}`] || '0');
                            awaySetScore = parseInt(data.match_data.innings[`away_${i}`] || '0');
                        }
                        
                        // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œì˜ ê°œë³„ ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸
                        const homeSetElement = document.querySelector(`[data-set="${i}"].home-set-score`);
                        const awaySetElement = document.querySelector(`[data-set="${i}"].away-set-score`);
                        
                        if (homeSetElement) {
                            homeSetElement.textContent = homeSetScore;
                        }
                        if (awaySetElement) {
                            awaySetElement.textContent = awaySetScore;
                        }
                        
                        console.log(`ğŸ ${i}ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸: í™ˆíŒ€ ${homeSetScore}, ì–´ì›¨ì´íŒ€ ${awaySetScore}`);
                    }
                }
                
                // ì•¼êµ¬ íŠ¹í™” ë°ì´í„° ì—…ë°ì´íŠ¸ (match_dataê°€ ìˆëŠ” ê²½ìš°)
                if (data.match_data) {
                    console.log('ğŸ”¥ ì•¼êµ¬ match_updated ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data.match_data);
                    console.log('ğŸ”¥ ì´ë‹:', data.match_data.current_inning, 'íƒ€ì…:', data.match_data.inning_type);
                } else {
                    // match_dataê°€ ì—†ëŠ” ê²½ìš° ì„œë²„ ì ìˆ˜ ì‚¬ìš©
                    const homeScoreElement = document.querySelector('.home-team-score');
                    const awayScoreElement = document.querySelector('.away-team-score');
                    
                    if (homeScoreElement) {
                        homeScoreElement.textContent = homeCurrentSetScore;
                    }
                    if (awayScoreElement) {
                        awayScoreElement.textContent = awayCurrentSetScore;
                    }
                }
                
                // ì•¼êµ¬ íŠ¹í™” ë°ì´í„° ì—…ë°ì´íŠ¸ (match_dataê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ)
                if (data.match_data) {
                    // ì´ë‹ ì •ë³´ ì—…ë°ì´íŠ¸
                    const inningElement = document.querySelector('.current-inning');
                    if (inningElement && data.match_data.current_inning) {
                        console.log('ğŸ”¥ ì´ë‹ ìš”ì†Œ ì°¾ìŒ, ì—…ë°ì´íŠ¸:', data.match_data.current_inning);
                        // ì´ë‹ ë²ˆí˜¸ì™€ ì´ˆ/ë§ í‘œì‹œë¥¼ í•¨ê»˜ ì—…ë°ì´íŠ¸
                        inningElement.innerHTML = `
                            ${data.match_data.current_inning}
                            <div class="inning-indicator ${data.match_data.inning_type === 'bottom' ? 'bottom' : 'top'}"></div>
                        `;
                        console.log('ğŸ”¥ ì´ë‹ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸:', data.match_data.inning_type);
                    } else {
                        console.log('âŒ ì´ë‹ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    }
                    
                    
                    
                    
                    // íŒ€ í†µê³„ ì—…ë°ì´íŠ¸
                    if (data.match_data.home_hits !== undefined) {
                        const homeHitsEl = document.querySelector('.home-hits');
                        if (homeHitsEl) homeHitsEl.textContent = data.match_data.home_hits;
                    }
                    if (data.match_data.away_hits !== undefined) {
                        const awayHitsEl = document.querySelector('.away-hits');
                        if (awayHitsEl) awayHitsEl.textContent = data.match_data.away_hits;
                    }
                    if (data.match_data.home_errors !== undefined) {
                        const homeErrorsEl = document.querySelector('.home-errors');
                        if (homeErrorsEl) homeErrorsEl.textContent = data.match_data.home_errors;
                    }
                    if (data.match_data.away_errors !== undefined) {
                        const awayErrorsEl = document.querySelector('.away-errors');
                        if (awayErrorsEl) awayErrorsEl.textContent = data.match_data.away_errors;
                    }
                    
                    // ì´ë‹ë³„ ì ìˆ˜ ì—…ë°ì´íŠ¸
                    if (data.match_data.innings) {
                        for (let i = 1; i <= 9; i++) {
                            const homeInningEl = document.querySelector(`.home-inning-${i}`);
                            const awayInningEl = document.querySelector(`.away-inning-${i}`);
                            
                            if (homeInningEl && data.match_data.innings[`home_${i}`] !== undefined) {
                                homeInningEl.textContent = data.match_data.innings[`home_${i}`];
                            }
                            if (awayInningEl && data.match_data.innings[`away_${i}`] !== undefined) {
                                awayInningEl.textContent = data.match_data.innings[`away_${i}`];
                            }
                        }
                    }
                }
            }
        });

        // ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì•¼êµ¬ëŠ” ì´ë‹ ì •ë³´)
        socket.on('timer_updated', (data) => {
            console.log('=== ì•¼êµ¬ ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ìˆ˜ì‹  ===');
            console.log('íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ë°ì´í„°:', data);
            
            if (data.matchId === matchId) {
                // ì•¼êµ¬ì—ì„œëŠ” ì´ë‹ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŒ
                // í•„ìš”ì— ë”°ë¼ ì´ë‹ ê´€ë ¨ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
                console.log('ì•¼êµ¬ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸:', data);
            }
        });


        // CSV íŒŒì¼ ì²˜ë¦¬ ë° íƒ€ìœ¨, ì¶œë£¨ìœ¨ ê³„ì‚° í•¨ìˆ˜
        function processPlayerCSV(csvData) {
            // CSV íŒŒì¼ íŒŒì‹± (íƒ­ìœ¼ë¡œ êµ¬ë¶„ëœ CSV)
            const lines = csvData.trim().split('\n');
            const headers = lines[0].split('\t').map(h => h.trim());
            const players = [];
            
            // ê° ë¼ì¸ì„ ì²˜ë¦¬í•˜ì—¬ ì„ ìˆ˜ ì •ë³´ ì¶”ì¶œ
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue; // ë¹ˆ ì¤„ ê±´ë„ˆë›°ê¸°
                
                const values = lines[i].split('\t').map(v => v.trim());
                const player = {};
                
                // í—¤ë”ì— ë”°ë¼ ê° ê°’ ë§¤í•‘
                headers.forEach((header, index) => {
                    player[header] = values[index] || '';
                });
                
                // ë°ì´í„° ìˆ«ì í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const atBats = parseInt(player['íƒ€ìˆ˜'] || 0);
                const hits = parseInt(player['ì•ˆíƒ€'] || 0);
                const homeRuns = parseInt(player['í™ˆëŸ°'] || 0);
                const rbi = parseInt(player['íƒ€ì '] || 0);
                const steals = parseInt(player['ë„ë£¨'] || 0);
                
                // ì¶”ê°€ í†µê³„ (CSVì—ëŠ” ì—†ì§€ë§Œ ê³„ì‚°ì— í•„ìš”)
                const walks = parseInt(player['ë³¼ë„·'] || 0);  // ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°€ì •
                const hbp = parseInt(player['ì‚¬êµ¬'] || 0);     // ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°€ì •
                const sf = parseInt(player['í¬ìƒí”Œë¼ì´'] || 0); // ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°€ì •
                
                // íƒ€ìœ¨ ê³„ì‚° (ì•ˆíƒ€ / íƒ€ìˆ˜)
                if (atBats > 0) {
                    player['íƒ€ìœ¨'] = (hits / atBats).toFixed(3).substring(1);  // ì•ì˜ 0 ì œê±°, ì†Œìˆ˜ì  3ìë¦¬ê¹Œì§€
                    if (!player['íƒ€ìœ¨'].startsWith('.')) player['íƒ€ìœ¨'] = '.' + player['íƒ€ìœ¨'];  // ì•ì— ì  ì¶”ê°€
                } else {
                    player['íƒ€ìœ¨'] = '.000';
                }
                
                // ì¶œë£¨ìœ¨ ê³„ì‚° (ì•ˆíƒ€ + ë³¼ë„· + ì‚¬êµ¬) / (íƒ€ìˆ˜ + ë³¼ë„· + ì‚¬êµ¬ + í¬ìƒí”Œë¼ì´)
                const onBaseNumerator = hits + walks + hbp;
                const onBaseDenominator = atBats + walks + hbp + sf;
                
                if (onBaseDenominator > 0) {
                    player['ì¶œë£¨ìœ¨'] = (onBaseNumerator / onBaseDenominator).toFixed(3).substring(1);
                    if (!player['ì¶œë£¨ìœ¨'].startsWith('.')) player['ì¶œë£¨ìœ¨'] = '.' + player['ì¶œë£¨ìœ¨'];
                } else {
                    player['ì¶œë£¨ìœ¨'] = '.000';
                }
                
                // ì¶”ê°€ ê°’ í™•ì¸
                if (!player['ë²ˆí˜¸']) player['ë²ˆí˜¸'] = i.toString();
                if (!player['ì´ë¦„']) player['ì´ë¦„'] = `ì„ ìˆ˜${i}`;
                if (!player['í¬ì§€ì…˜']) player['í¬ì§€ì…˜'] = 'ë¯¸ì •';
                
                players.push(player);
            }
            
            return players;
        }
        
        

        // ë””ìì¸ ì„¤ì • ë¡œë“œ ë° ì ìš© í•¨ìˆ˜
        async function loadDesignSettings() {
            try {
                const response = await fetch('/api/sport-overlay-design/BASEBALL');
                const result = await response.json();
                
                if (result.success) {
                    const design = result.design;
                    
                    // ìŠ¤ì½”ì–´ë³´ë“œ ìœ„ì¹˜ ì ìš© (ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ìœ„ì¹˜ë¡œ ì„¤ì •)
                    const scoreboard = document.querySelector('.scoreboard');
                    if (scoreboard) {
                        scoreboard.style.position = 'fixed';
                        scoreboard.style.bottom = '20px';
                        scoreboard.style.right = '250px';
                        scoreboard.style.top = 'auto';
                        scoreboard.style.left = 'auto';
                    }
                    
                    // í™ˆíŒ€ ë¡œê³  ìœ„ì¹˜ ì ìš© (ì•¼êµ¬ëŠ” team-info.home-team ì‚¬ìš©)
                    const homeLogo = document.querySelector('.team-info.home-team');
                    if (homeLogo && design.homeLogo) {
                        homeLogo.style.top = `${design.homeLogo.top}px`;
                        if (design.homeLogo.left !== undefined) {
                            homeLogo.style.left = `${design.homeLogo.left}px`;
                        }
                        if (design.homeLogo.right !== undefined) {
                            homeLogo.style.right = `${design.homeLogo.right}px`;
                        }
                    }
                    
                    // ì–´ì›¨ì´íŒ€ ë¡œê³  ìœ„ì¹˜ ì ìš© (ì•¼êµ¬ëŠ” team-info.away-team ì‚¬ìš©)
                    const awayLogo = document.querySelector('.team-info.away-team');
                    if (awayLogo && design.awayLogo) {
                        awayLogo.style.top = `${design.awayLogo.top}px`;
                        if (design.awayLogo.left !== undefined) {
                            awayLogo.style.left = `${design.awayLogo.left}px`;
                        }
                        if (design.awayLogo.right !== undefined) {
                            awayLogo.style.right = `${design.awayLogo.right}px`;
                        }
                    }
                    
                    // ê²½ê¸° ìƒíƒœ ìœ„ì¹˜ ì ìš©
                    const matchState = document.querySelector('.current-inning');
                    if (matchState && design.matchState) {
                        matchState.style.top = `${design.matchState.top}px`;
                        if (design.matchState.left !== undefined) {
                            matchState.style.left = `${design.matchState.left}px`;
                        }
                        if (design.matchState.right !== undefined) {
                            matchState.style.right = `${design.matchState.right}px`;
                        }
                    }
                    
                    
                    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìœ„ì¹˜ ì ìš©
                    const overlayImage = document.getElementById('overlayImage');
                    if (overlayImage && design.overlayImage) {
                        overlayImage.style.top = `${design.overlayImage.top}px`;
                        if (design.overlayImage.left !== undefined) {
                            overlayImage.style.left = `${design.overlayImage.left}px`;
                        }
                        if (design.overlayImage.width !== undefined) {
                            overlayImage.style.width = `${design.overlayImage.width}px`;
                        }
                        if (design.overlayImage.height !== undefined) {
                            overlayImage.style.height = `${design.overlayImage.height}px`;
                        }
                    }
                    
                    // íƒ€ì´ë¨¸ ìœ„ì¹˜ ì ìš©
                    const timer = document.querySelector('.match-time');
                    if (timer && design.timer) {
                        if (design.timer.marginLeft !== undefined) {
                            timer.style.marginLeft = `${design.timer.marginLeft}px`;
                        }
                    }
                    
                    console.log('ì•¼êµ¬ ë””ìì¸ ì„¤ì • ì ìš© ì™„ë£Œ');
                }
            } catch (error) {
                console.error('ì•¼êµ¬ ë””ìì¸ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ í•¨ìˆ˜ (í™œì„±í™”ëœ ëª¨ë“  ì´ë¯¸ì§€ í‘œì‹œ)
    // í•œê¸€ íŒŒì¼ëª… ë””ì½”ë”© í•¨ìˆ˜ (ë¸Œë¼ìš°ì € í˜¸í™˜ ë²„ì „)
    function decodeKoreanFilename(filename) {
        try {
            // ê¹¨ì§„ íŒŒì¼ëª…ì¸ì§€ í™•ì¸
            if (filename.includes('Ã¬') || filename.includes('Ã«') || filename.includes('Ã­') || 
                filename.includes('Ã¢') || filename.includes('Ãª') || filename.includes('Ã´')) {
                
                // ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œ í•œê¸€ íŒŒì¼ëª… ë””ì½”ë”©
                let decoded = filename;
                try {
                    // URL ë””ì½”ë”© ì‹œë„
                    decoded = decodeURIComponent(filename);
                } catch (e) {
                    // URL ë””ì½”ë”© ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë°˜í™˜
                    console.log(`ğŸ”§ URL ë””ì½”ë”© ì‹¤íŒ¨, ì›ë³¸ ì‚¬ìš©: ${filename}`);
                    return filename;
                }
                
                console.log(`ğŸ”§ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ëª… ë””ì½”ë”©: ${filename} -> ${decoded}`);
                return decoded;
            }
            return filename;
        } catch (error) {
            console.error('ğŸ”§ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ëª… ë””ì½”ë”© ì‹¤íŒ¨:', error);
            return filename;
        }
    }

    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ í•¨ìˆ˜ (ì•¼êµ¬ìš©)
    function registerOverlayImageEventListeners() {
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡');
        
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        socket.off('overlay_image_status_changed');
        socket.off('overlay_page_refresh');
        
        // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì¬ë“±ë¡)
        socket.on('overlay_image_status_changed', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ (ì¬ë“±ë¡):', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ (window.matchData ì‚¬ìš©)
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ì¼ì¹˜, ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘ (ì¬ë“±ë¡)');
                
                if (data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì¶”ê°€ í‘œì‹œ
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í™œì„±í™” (ì¬ë“±ë¡):', data.imageData);
                    addOverlayImage(data.imageData);
                } else if (!data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ ë¹„í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì œê±°
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¹„í™œì„±í™” (ì¬ë“±ë¡):', data.imageData);
                    removeOverlayImage(data.imageData.id);
                }
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜, Room ì¬ì°¸ì—¬ ì‹œë„ (ì¬ë“±ë¡)');
                // ìŠ¤í¬ì¸  íƒ€ì…ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ Room ì¬ì°¸ì—¬ ì‹œë„
                if (window.matchData?.sport_type) {
                    console.log('ğŸ”§ ì•¼êµ¬ Room ì¬ì°¸ì—¬ ìš”ì²­ (ì¬ë“±ë¡):', window.matchData.sport_type);
                    socket.emit('join_sport_room', window.matchData.sport_type);
                }
            }
        });

        // ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì¬ë“±ë¡)
        socket.on('overlay_page_refresh', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹ í˜¸ ìˆ˜ì‹  (ì¬ë“±ë¡):', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ì¬ë“±ë¡):', data.reason);
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    location.reload();
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ (ì¬ë“±ë¡)');
                // ëŒ€ì•ˆ: window.matchDataê°€ ì—†ì„ ë•Œë„ ìƒˆë¡œê³ ì¹¨ (ë””ë²„ê¹…ìš©)
                if (!window.matchData) {
                    console.log('ğŸ”§ ì•¼êµ¬ window.matchDataê°€ ì—†ì–´ì„œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ì¬ë“±ë¡)');
                        location.reload();
                }
            }
        });
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ ì™„ë£Œ');
    }

    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì¶”ê°€ í•¨ìˆ˜ (ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›) - ì•¼êµ¬ìš©
    function addOverlayImage(imageData) {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì¶”ê°€:', imageData);
        
        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€ì¸ì§€ í™•ì¸
        const existingImg = overlayImageContainer.querySelector(`[data-image-id="${imageData.id}"]`);
        if (existingImg) {
            console.log('ğŸ”§ ì•¼êµ¬ ì´ë¯¸ì§€ê°€ ì´ë¯¸ ì¡´ì¬í•¨:', imageData.id);
            return;
        }
        
        const img = document.createElement('img');
        img.setAttribute('data-image-id', imageData.id);
        
        // íŒŒì¼ ê²½ë¡œì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ ë° ë””ì½”ë”©
        const pathParts = imageData.file_path.split('/');
        const filename = pathParts[pathParts.length - 1];
        const decodedFilename = decodeKoreanFilename(filename);
        const decodedPath = imageData.file_path.replace(filename, decodedFilename);
        
        img.src = decodedPath;
        img.alt = 'ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        img.style.position = 'absolute';
        img.style.top = '0';
        img.style.left = '0';
        img.style.zIndex = '1';
        
        img.onload = () => {
            overlayImageContainer.appendChild(img);
            overlayImageContainer.classList.add('show');
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì¶”ê°€ ì™„ë£Œ:', imageData.id);
        };
        
        img.onerror = (error) => {
            console.error('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
        };
    }
    
    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜ (ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›) - ì•¼êµ¬ìš©
    function removeOverlayImage(imageId) {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì œê±°:', imageId);
        
        const imgToRemove = overlayImageContainer.querySelector(`[data-image-id="${imageId}"]`);
        if (imgToRemove) {
            imgToRemove.remove();
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì œê±° ì™„ë£Œ:', imageId);
            
            // ëª¨ë“  ì´ë¯¸ì§€ê°€ ì œê±°ë˜ì—ˆìœ¼ë©´ ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€
            const remainingImages = overlayImageContainer.querySelectorAll('img');
            if (remainingImages.length === 0) {
                overlayImageContainer.classList.remove('show');
            }
        }
    }
    
    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í‘œì‹œ í•¨ìˆ˜ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©) - ì•¼êµ¬ìš©
    function displayOverlayImage(imageData) {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í‘œì‹œ:', imageData);
        
        // ê¸°ì¡´ ì´ë¯¸ì§€ ì œê±°
        overlayImageContainer.innerHTML = '';
        
        const img = document.createElement('img');
        // íŒŒì¼ ê²½ë¡œì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ ë° ë””ì½”ë”©
        const pathParts = imageData.file_path.split('/');
        const filename = pathParts[pathParts.length - 1];
        const decodedFilename = decodeKoreanFilename(filename);
        const decodedPath = imageData.file_path.replace(filename, decodedFilename);
        
        img.src = decodedPath;
        img.alt = 'ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        img.style.position = 'absolute';
        img.style.top = '0';
        img.style.left = '0';
        img.style.zIndex = '1';
        
        img.onload = () => {
            overlayImageContainer.appendChild(img);
            overlayImageContainer.classList.add('show');
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ');
        };
        
        img.onerror = (error) => {
            console.error('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
            overlayImageContainer.classList.remove('show');
        };
    }
    
    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìˆ¨ê¹€ í•¨ìˆ˜ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©) - ì•¼êµ¬ìš©
    function hideOverlayImage() {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìˆ¨ê¹€');
        overlayImageContainer.classList.remove('show');
        overlayImageContainer.innerHTML = '';
    }

    async function loadOverlayImage() {
        try {
            console.log('ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘...');
                
                // ê²½ê¸° ì •ë³´ì—ì„œ ì¢…ëª© ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
                const matchResponse = await fetch(`/api/matches/${matchId}`);
                if (!matchResponse.ok) {
                    console.error('ê²½ê¸° ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const matchData = await matchResponse.json();
                const sportCode = matchData.sport_type.toUpperCase();
                console.log('ì¢…ëª© ì½”ë“œ:', sportCode);
                
                // ì¢…ëª©ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì¢…ëª©ëª… ëŒ€ì‹ )
                const sportCodeForPath = sportCode;
                console.log('ì¢…ëª©ì½”ë“œ:', sportCodeForPath);
                
                // í•´ë‹¹ ì¢…ëª©ì˜ í™œì„±í™”ëœ ì´ë¯¸ì§€ ì¡°íšŒ
                const response = await fetch(`/api/overlay-images/active/${sportCode}`);
                const result = await response.json();
                
                console.log('ì•¼êµ¬ í™œì„±í™”ëœ ì´ë¯¸ì§€ ëª©ë¡ ì¡°íšŒ ê²°ê³¼:', result);
                
                const overlayImageContainer = document.getElementById('overlayImage');
                
                if (result.success && result.images && result.images.length > 0) {
                    console.log('ğŸ”§ ì•¼êµ¬ í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤:', result.images);
                    
                    // ëª¨ë“  í™œì„±í™”ëœ ì´ë¯¸ì§€ë¥¼ í‘œì‹œ
                    overlayImageContainer.innerHTML = '';
                    
                    result.images.forEach((image, index) => {
                        const img = document.createElement('img');
                        img.setAttribute('data-image-id', image.id);
                        
                        // ì¢…ëª©ì½”ë“œ ê¸°ë°˜ ê²½ë¡œë¡œ ì§ì ‘ êµ¬ì„±
                        const filename = image.filename;
                        const decodedFilename = decodeKoreanFilename(filename);
                        const imagePath = `/overlay-images/${sportCodeForPath}/${decodedFilename}`;
                        
                        console.log(`ğŸ”§ ì•¼êµ¬ ì´ë¯¸ì§€ ê²½ë¡œ êµ¬ì„±: ${imagePath}`);
                        img.src = imagePath;
                        img.alt = `ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ${index + 1}`;
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.objectFit = 'cover';
                        img.style.position = 'absolute';
                        img.style.top = '0';
                        img.style.left = '0';
                        img.style.zIndex = 1000 + index;
                        
                        img.onload = () => {
                            overlayImageContainer.appendChild(img);
                            overlayImageContainer.style.display = 'block';
                            console.log(`ì•¼êµ¬ í™œì„±í™”ëœ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ${index + 1} ë¡œë“œë¨:`, image.file_path);
                        };
                        
                        img.onerror = (error) => {
                            console.error(`ì•¼êµ¬ í™œì„±í™”ëœ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ${index + 1} ë¡œë“œ ì‹¤íŒ¨:`, error);
                        };
                    });
                } else {
                    overlayImageContainer.style.display = 'none';
                    console.log('ì•¼êµ¬ í™œì„±í™”ëœ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
        } catch (error) {
            console.error('ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
            document.getElementById('overlayImage').style.display = 'none';
        }
    }

        // ì´ˆê¸° íŒ€ ìƒ‰ìƒ ì„¤ì •
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // ë””ìì¸ ì„¤ì • ë¡œë“œ ë° ì ìš©
                await loadDesignSettings();
                
                // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ
                await loadOverlayImage();
                
                // íŒ€ ë¡œê³  ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì¶•êµ¬ì™€ ë™ì¼í•œ ë°©ì‹)
                const response = await fetch(`/api/matches/${matchId}/team-logos`);
                if (!response.ok) {
                    throw new Error(`íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
                }
                const result = await response.json();
                console.log('íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ ì„±ê³µ:', result);
                
                // í™ˆíŒ€ ë¡œê³  ì„¤ì •
                const homeTeamName = '<%= match.home_team %>';
                if (result.success && result.teamLogos) {
                    const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                    if (homeTeamInfo && homeTeamInfo.logo_path) {
                        const homeLogoContainer = document.querySelector('.team-info.home-team .team-logo-container');
                        if (homeLogoContainer) {
                            homeLogoContainer.style.backgroundColor = homeTeamInfo.logo_bg_color || '#ffffff';
                            homeLogoContainer.innerHTML = `
                                <img src="${homeTeamInfo.logo_path}" alt="${homeTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain;">
                            `;
                        }
                    }
                }
                
                // ì›ì •íŒ€ ë¡œê³  ì„¤ì •
                const awayTeamName = '<%= match.away_team %>';
                if (result.success && result.teamLogos) {
                    const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                    if (awayTeamInfo && awayTeamInfo.logo_path) {
                        const awayLogoContainer = document.querySelector('.team-info.away-team .team-logo-container');
                        if (awayLogoContainer) {
                            awayLogoContainer.style.backgroundColor = awayTeamInfo.logo_bg_color || '#ffffff';
                            awayLogoContainer.innerHTML = `
                                <img src="${awayTeamInfo.logo_path}" alt="${awayTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain;">
                            `;
                        }
                    }
                }

                // íŒ€ ì»¬ëŸ¬ ì •ë³´ ë¡œë“œ ë° ì ìš© (DBì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
                const homeTeamSection = document.getElementById('home-team-section');
                const awayTeamSection = document.getElementById('away-team-section');
                
                if (result.success && result.teamLogos) {
                    // í™ˆíŒ€ ì»¬ëŸ¬ ì ìš©
                    const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                    if (homeTeamInfo && homeTeamInfo.team_color && homeTeamSection) {
                        homeTeamSection.style.backgroundColor = homeTeamInfo.team_color;
                        console.log(`ğŸ”§ í™ˆíŒ€ ì»¬ëŸ¬ ì ìš© (ì´ˆê¸° ë¡œë“œ): ${homeTeamName} -> ${homeTeamInfo.team_color}`);
                    }
                    
                    // ì›ì •íŒ€ ì»¬ëŸ¬ ì ìš©
                    const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                    if (awayTeamInfo && awayTeamInfo.team_color && awayTeamSection) {
                        awayTeamSection.style.backgroundColor = awayTeamInfo.team_color;
                        console.log(`ğŸ”§ ì›ì •íŒ€ ì»¬ëŸ¬ ì ìš© (ì´ˆê¸° ë¡œë“œ): ${awayTeamName} -> ${awayTeamInfo.team_color}`);
                    }
                    
                }
                
            } catch (error) {
                console.error('íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        });


        // ìƒ‰ìƒì„ íˆ¬ëª…ë„ê°€ ìˆëŠ” ìƒ‰ìƒìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function convertToTransparentColor(color, alpha) {
            // RGB ë˜ëŠ” RGBA í˜•ì‹ì¸ ê²½ìš°
            if (color.startsWith('rgb')) {
                const rgbValues = color.match(/\d+/g);
                if (rgbValues && rgbValues.length >= 3) {
                    return `rgba(${rgbValues[0]}, ${rgbValues[1]}, ${rgbValues[2]}, ${alpha})`;
                }
            }
            
            // HEX í˜•ì‹ì¸ ê²½ìš°
            if (color.startsWith('#')) {
                const r = parseInt(color.substr(1, 2), 16);
                const g = parseInt(color.substr(3, 2), 16);
                const b = parseInt(color.substr(5, 2), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            // ê¸°ë³¸ê°’ìœ¼ë¡œ ê²€ì€ìƒ‰ ë°˜íˆ¬ëª… ë°°ê²½ ë°˜í™˜
            return `rgba(0, 0, 0, ${alpha})`;
        }

        // íŒ€ëª… ê¸¸ì´ì— ë”°ë¥¸ í°íŠ¸ í¬ê¸° ì¡°ì ˆ
        function adjustTeamNameSize() {
            try {
                const homeTeamHeader = document.querySelector('.team-section .team-info:first-child .team-header');
                const awayTeamHeader = document.querySelector('.team-section .team-info:last-child .team-header');
                
                if (!homeTeamHeader || !awayTeamHeader) {
                    console.error('íŒ€ í—¤ë” ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return;
                }
                
                function adjustSize(element) {
                    const text = element.textContent;
                    console.log('íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ:', {
                        team: element.closest('.team-info').classList.contains('home-team') ? 'í™ˆíŒ€' : 'ì›ì •íŒ€',
                        text,
                        length: text.length
                    });
                    
                    // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
                    element.classList.remove('long', 'very-long');
                    
                    // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ í´ë˜ìŠ¤ ì¶”ê°€
                    if (text.length > 10) {
                        element.classList.add('very-long');
                        console.log('ë§¤ìš° ê¸´ í…ìŠ¤íŠ¸ ì ìš©');
                    } else if (text.length > 8) {
                        element.classList.add('long');
                        console.log('ê¸´ í…ìŠ¤íŠ¸ ì ìš©');
                    }
                }
                
                adjustSize(homeTeamHeader);
                adjustSize(awayTeamHeader);
                
                console.log('íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ ì™„ë£Œ');
            } catch (error) {
                console.error('íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }
        
        // íŒ€ëª… ì—…ë°ì´íŠ¸ ì‹œ í¬ê¸° ì¡°ì ˆ
        socket.on('teamHeaderChanged', function(data) {
            if (data.matchId === matchId) {
                const homeTeamHeader = document.querySelector('.team-section .team-info:first-child .team-header');
                const awayTeamHeader = document.querySelector('.team-section .team-info:last-child .team-header');
                
                if (homeTeamHeader) homeTeamHeader.textContent = data.homeHeader;
                if (awayTeamHeader) awayTeamHeader.textContent = data.awayHeader;
                
                adjustTeamNameSize();
            }
        });
        

        // íŒ€ ë¡œê³  ì‚­ì œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamLogoRemoved', function(data) {
            if (data.matchId === matchId) {
                const teamType = data.teamType || data.team;
                
                console.log('íŒ€ ë¡œê³  ì‚­ì œ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', {
                    teamType,
                    matchId: data.matchId
                });
                
                const logoContainer = document.querySelector(`.team-info.${teamType}-team .team-logo-container`);
                if (logoContainer) {
                    logoContainer.innerHTML = `<div class="team-logo-placeholder"></div>`;
                    console.log(`${teamType}íŒ€ ë¡œê³  ì‚­ì œ ì™„ë£Œ`);
                } else {
                    console.error(`${teamType}íŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
        });
        
        // íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamColorUpdate', function(data) {
            if (data.matchId === matchId) {
                const teamType = data.teamType;
                const teamColor = data.teamColor;
                
                console.log('íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', {
                    teamType,
                    teamColor,
                    matchId: data.matchId
                });
                
                const teamSection = document.getElementById(`${teamType}-team-section`);
                if (teamSection) {
                    teamSection.style.backgroundColor = teamColor;
                    console.log(`${teamType}íŒ€ ì„¹ì…˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸:`, {
                        section: teamSection,
                        color: teamColor,
                        appliedColor: teamSection.style.backgroundColor
                    });
                    
                        } else {
                    console.error(`${teamType}íŒ€ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
        });


        // íŒ€ ì´ë¦„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
        socket.on('teamNameUpdated', function(data) {
            console.log('íŒ€ëª… ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹  (ì²« ë²ˆì§¸ ë¦¬ìŠ¤ë„ˆ):', data);
            
            if (data.matchId === matchId) {
                const team = data.team;
                const teamName = data.teamName;
                
                // íŒ€ í—¤ë” ì—…ë°ì´íŠ¸
                const teamHeader = document.querySelector(`.team-info.${team}-team .team-header`);
                if (teamHeader) {
                    teamHeader.textContent = teamName;
                }
                
                // ì´ë‹ í…Œì´ë¸”ì˜ íŒ€ëª… ì—…ë°ì´íŠ¸
                const teamTableRows = document.querySelectorAll('.innings-table tbody tr');
                if (teamTableRows.length >= 2) {
                    if (team === 'home') {
                        // í™ˆíŒ€ì€ ì²« ë²ˆì§¸ í–‰
                        const homeTeamName = teamTableRows[0].querySelector('.team-name');
                        if (homeTeamName) {
                            homeTeamName.textContent = teamName;
                        }
                    } else if (team === 'away') {
                        // ì›ì •íŒ€ì€ ë‘ ë²ˆì§¸ í–‰
                        const awayTeamName = teamTableRows[1].querySelector('.team-name');
                        if (awayTeamName) {
                            awayTeamName.textContent = teamName;
                        }
                    }
                }
                
                // íŒ€ëª… ìš”ì†Œë“¤ ì—…ë°ì´íŠ¸
                const teamNameElements = document.querySelectorAll(`.team-info.${team}-team .team-name`);
                teamNameElements.forEach(element => {
                    element.textContent = teamName;
                });
                
                // íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ
                adjustTeamNameSize();
                
                
                console.log(`${team}íŒ€ëª… ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${teamName}`);
            }
        });

        // íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamColorUpdated', function(data) {
            console.log('íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const teamType = data.teamType;
                const teamColor = data.teamColor;
                const headerText = data.headerText;
                
                // íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                const teamElements = document.querySelectorAll(`.team-info.${teamType}-team`);
                teamElements.forEach(element => {
                    element.style.backgroundColor = teamColor;
                });
                
                // íŒ€ í—¤ë” í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ìˆëŠ” ê²½ìš°)
                if (headerText) {
                    const headerElements = document.querySelectorAll(`.team-info.${teamType}-team .team-header`);
                    headerElements.forEach(element => {
                        element.textContent = headerText;
                    });
                }
                
                // íŒ€ ì„¹ì…˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                const teamSection = document.getElementById(`${teamType}-team-section`);
                if (teamSection) {
                    teamSection.style.backgroundColor = teamColor;
                    console.log(`${teamType}íŒ€ ì„¹ì…˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸:`, {
                        section: teamSection,
                        color: teamColor,
                        teamType: teamType
                    });
                    
            } else {
                    console.error(`${teamType}íŒ€ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
                
                console.log(`${teamType}íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${teamColor}`);
            }
        });

        // íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (íŒ€ì»¬ëŸ¬ì™€ ë™ì¼í•œ ë°©ì‹)
        socket.on('teamLogoBgUpdated', function(data) {
            console.log('íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const teamType = data.teamType;
                const logoBgColor = data.logoBgColor;
                
                // íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
                const logoContainers = document.querySelectorAll(`.team-info.${teamType}-team .team-logo-container`);
                logoContainers.forEach(container => {
                    container.style.backgroundColor = logoBgColor || '#ffffff';
                });
                
                console.log(`${teamType}íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${logoBgColor}`);
            }
        });


        // ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ (ë°°êµ¬ì—ì„œëŠ” match_updated ì´ë²¤íŠ¸ë¡œ ëŒ€ì²´)
        socket.on('scoreUpdated', (data) => {
            console.log('ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸:', data);
            
            // ë°°êµ¬ì—ì„œëŠ” match_updated ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ ë¬´ì‹œ (ì¤‘ë³µ ì—…ë°ì´íŠ¸ ë°©ì§€)
            console.log('ğŸ ë°°êµ¬ì—ì„œëŠ” scoreUpdated ì´ë²¤íŠ¸ ë¬´ì‹œ (match_updatedë¡œ ëŒ€ì²´)');
            return;
            
            // í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš©)
            const currentSet = data.match_data?.current_inning || 1;
            const homeCurrentSetScore = data.match_data?.innings?.home?.[currentSet] || '0';
            const awayCurrentSetScore = data.match_data?.innings?.away?.[currentSet] || '0';
            
            // ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜)
            document.querySelector('.home-team-score').textContent = homeCurrentSetScore;
            document.querySelector('.away-team-score').textContent = awayCurrentSetScore;
            
            // í˜„ì¬ ì„¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
            const currentSetDisplay = document.getElementById('current-set-display');
            if (currentSetDisplay) {
                currentSetDisplay.textContent = currentSet;
            }
            
            // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸
            if (data.match_data?.innings) {
                for (let i = 1; i <= 5; i++) {
                    const homeSetElement = document.getElementById(`home-set-${i}`);
                    const awaySetElement = document.getElementById(`away-set-${i}`);
                    
                    if (homeSetElement) {
                        homeSetElement.textContent = data.match_data.innings.home?.[i] || '0';
                    }
                    if (awaySetElement) {
                        awaySetElement.textContent = data.match_data.innings.away?.[i] || '0';
                    }
                }
                console.log('ğŸ ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            }
            
            console.log(`=== ë°°êµ¬ ì˜¤ë²„ë ˆì´ í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸ ===`);
            console.log(`í˜„ì¬ ì„¸íŠ¸: ${currentSet}ì„¸íŠ¸`);
            console.log(`í™ˆíŒ€ í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜: ${homeCurrentSetScore}`);
            console.log(`ì–´ì›¨ì´íŒ€ í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜: ${awayCurrentSetScore}`);
            
            
            // ì´ë‹ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.querySelector('.current-inning').innerHTML = `
                ${data.match_data?.current_inning || '1'}
                <div class="inning-indicator ${data.match_data?.inning_type === 'bottom' ? 'bottom' : 'top'}"></div>
            `;
            
            // ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš© ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œë¡œ ëŒ€ì²´ë¨)
            
            // ì´ì (ìŠ¹ë¦¬ ì„¸íŠ¸ ê°œìˆ˜) ê³„ì‚°
            let homeWins = 0;
            let awayWins = 0;
            
            if (data.match_data?.innings) {
                // í˜„ì¬ ì„¸íŠ¸ ì´ì „ê¹Œì§€ë§Œ ìŠ¹ë¦¬ ê³„ì‚°
                for (let i = 1; i < currentSet; i++) {
                    const homeScore = parseInt(data.match_data.innings.home?.[i]) || 0;
                    const awayScore = parseInt(data.match_data.innings.away?.[i]) || 0;
                    
                    if (homeScore > 0 || awayScore > 0) {
                        if (homeScore > awayScore) {
                            homeWins++;
                        } else if (awayScore > homeScore) {
                            awayWins++;
                        }
                    }
                }
            }
            
            // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œì˜ ì´ì  ì—…ë°ì´íŠ¸
            const homeTotalElement = document.getElementById('home-total');
            const awayTotalElement = document.getElementById('away-total');
            
            if (homeTotalElement) homeTotalElement.textContent = homeWins;
            if (awayTotalElement) awayTotalElement.textContent = awayWins;
            
            console.log(`ì´ì (ìŠ¹ë¦¬ ì„¸íŠ¸ ê°œìˆ˜) ì—…ë°ì´íŠ¸: í™ˆíŒ€ ${homeWins}, ì–´ì›¨ì´íŒ€ ${awayWins}`);
            
        });

        // ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('baseball_inning_score_updated', (data) => {
            console.log('=== ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ìˆ˜ì‹  (ì˜¤ë²„ë ˆì´) ===');
            console.log('ìˆ˜ì‹ ëœ ë°ì´í„°:', data);
            console.log('í˜„ì¬ matchId:', matchId);
            console.log('ë°ì´í„° matchId:', data.matchId);
            
            // ë°°êµ¬ì—ì„œëŠ” ì•¼êµ¬ ì´ë²¤íŠ¸ë¥¼ ì„¸íŠ¸ë³„ ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©ìœ¼ë¡œ ì‚¬ìš©
            console.log('ğŸ ë°°êµ¬ì—ì„œ ì„¸íŠ¸ë³„ ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©ìœ¼ë¡œ ì‚¬ìš©');
            
            if (data.matchId === matchId) {
                const { team, inning, score, innings, home_score, away_score } = data;
                
                // ì´ë‹ ìŠ¤ì½”ì–´ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                const teamElementId = team === 'home' ? `teamA-inning-${inning}` : `teamB-inning-${inning}`;
                const inningElement = document.getElementById(teamElementId);
                
                if (inningElement) {
                    inningElement.textContent = score;
                    console.log(`ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸: ${team}íŒ€ ${inning}íšŒ = ${score}`);
                }
                
                // ì „ì²´ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš© ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œë¡œ ëŒ€ì²´ë¨)
                
                // í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ì—…ë°ì´íŠ¸ (ë°°êµ¬ìš©) - match_dataê°€ ì œëŒ€ë¡œ ì „ì†¡ëœ ê²½ìš°ì—ë§Œ
                if (data.match_data?.innings?.home && data.match_data?.innings?.away) {
                    const currentSet = data.match_data?.current_inning || 1;
                    const homeCurrentSetScore = data.match_data?.innings?.home?.[currentSet] || '0';
                    const awayCurrentSetScore = data.match_data?.innings?.away?.[currentSet] || '0';
                    
                    // ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜)
                    const homeScoreElement = document.querySelector('.home-team-score');
                    const awayScoreElement = document.querySelector('.away-team-score');
                    
                    // ì ìˆ˜ê°€ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ë°©ì§€)
                    if (homeScoreElement && homeScoreElement.textContent !== homeCurrentSetScore) {
                        homeScoreElement.textContent = homeCurrentSetScore;
                    }
                    if (awayScoreElement && awayScoreElement.textContent !== awayCurrentSetScore) {
                        awayScoreElement.textContent = awayCurrentSetScore;
                    }
                    
                    console.log('ğŸ baseball_inning_score_updatedì—ì„œ ë©”ì¸ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸:', { home: homeCurrentSetScore, away: awayCurrentSetScore });
                } else {
                    console.log('ğŸ baseball_inning_score_updatedì—ì„œ match_dataê°€ ì—†ì–´ì„œ ë©”ì¸ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€');
                }
                
                // ëŒ€íšŒëª… ì—…ë°ì´íŠ¸ (ì„¸íŠ¸ë³„ ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œ)
                if (data.match_data?.tournament_name) {
                    const tournamentDisplay = document.getElementById('tournament-display');
                    if (tournamentDisplay) {
                        tournamentDisplay.textContent = data.match_data.tournament_name;
                        console.log('ğŸ ì„¸íŠ¸ë³„ ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹œ ëŒ€íšŒëª… ì—…ë°ì´íŠ¸:', data.match_data.tournament_name);
                    }
                }
                
                // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
                if (innings) {
                    for (let i = 1; i <= 5; i++) {
                        const homeSetElement = document.getElementById(`home-set-${i}`);
                        const awaySetElement = document.getElementById(`away-set-${i}`);
                        
                        if (homeSetElement) {
                            homeSetElement.textContent = innings[`home_${i}`] || '0';
                        }
                        if (awaySetElement) {
                            awaySetElement.textContent = innings[`away_${i}`] || '0';
                        }
                    }
                    console.log('ğŸ ì„¸íŠ¸ë³„ ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                }
                
                // ì´ì  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
                if (home_score !== undefined && away_score !== undefined) {
                    const homeTotalElement = document.getElementById('home-total');
                    const awayTotalElement = document.getElementById('away-total');
                    
                    if (homeTotalElement) homeTotalElement.textContent = home_score;
                    if (awayTotalElement) awayTotalElement.textContent = away_score;
                    
                    console.log(`ğŸ ì´ì  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: í™ˆíŒ€ ${home_score}, ì–´ì›¨ì´íŒ€ ${away_score}`);
                }
                
                console.log(`=== ë°°êµ¬ ì˜¤ë²„ë ˆì´ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ===`);
                console.log(`í˜„ì¬ ì„¸íŠ¸: ${data.match_data?.current_inning || 1}ì„¸íŠ¸`);
                
                // í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ê³„ì‚° (ë¡œê¹…ìš©)
                const currentSet = data.match_data?.current_inning || 1;
                let homeCurrentSetScore = 'N/A';
                let awayCurrentSetScore = 'N/A';
                
                if (data.match_data?.innings?.home && data.match_data?.innings?.away) {
                    homeCurrentSetScore = data.match_data.innings.home[currentSet] || '0';
                    awayCurrentSetScore = data.match_data.innings.away[currentSet] || '0';
                }
                
                console.log(`í™ˆíŒ€ í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜: ${homeCurrentSetScore}`);
                console.log(`ì–´ì›¨ì´íŒ€ í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜: ${awayCurrentSetScore}`);
                
                // ì´ì (ìŠ¹ë¦¬ ì„¸íŠ¸ ê°œìˆ˜) ê³„ì‚° ë° í‘œì‹œ
                let homeWins = 0;
                let awayWins = 0;
                
                // í˜„ì¬ ì„¸íŠ¸ ì´ì „ê¹Œì§€ë§Œ ìŠ¹ë¦¬ ê³„ì‚°
                for (let i = 1; i < currentSet; i++) {
                    const homeScore = parseInt(data.match_data?.innings?.home?.[i]) || 0;
                    const awayScore = parseInt(data.match_data?.innings?.away?.[i]) || 0;
                    
                    if (homeScore > 0 || awayScore > 0) {
                        if (homeScore > awayScore) {
                            homeWins++;
                        } else if (awayScore > homeScore) {
                            awayWins++;
                        }
                    }
                }
                
                // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œì˜ ì´ì  ì—…ë°ì´íŠ¸
                const homeTotalElement = document.getElementById('home-total');
                const awayTotalElement = document.getElementById('away-total');
                
                if (homeTotalElement) homeTotalElement.textContent = homeWins;
                if (awayTotalElement) awayTotalElement.textContent = awayWins;
                
                console.log(`ì´ì (ìŠ¹ë¦¬ ì„¸íŠ¸ ê°œìˆ˜) ì—…ë°ì´íŠ¸: í™ˆíŒ€ ${homeWins}, ì–´ì›¨ì´íŒ€ ${awayWins}`);
                console.log('=== ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì²˜ë¦¬ ì™„ë£Œ (ì˜¤ë²„ë ˆì´) ===');
                    } else {
                console.log('ë§¤ì¹˜ IDê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ - ì´ë²¤íŠ¸ ë¬´ì‹œ');
            }
        });

        // ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('baseball_overlay_visibility_updated', (data) => {
            console.log('ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í‘œì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const { overlayType, isVisible, overlay_visibility } = data;
                
                // ê° ì˜¤ë²„ë ˆì´ ìš”ì†Œì˜ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
                if (overlayType === 'innings') {
                    const inningsScoreboard = document.querySelector('.innings-scoreboard');
                    if (inningsScoreboard) {
                        inningsScoreboard.style.display = isVisible ? 'block' : 'none';
                        console.log(`ì´ë‹ ìŠ¤ì½”ì–´ë³´ë“œ ì˜¤ë²„ë ˆì´ ${isVisible ? 'í‘œì‹œ' : 'ìˆ¨ê¹€'}`);
                    }
                }
                
                // ì „ì²´ ì˜¤ë²„ë ˆì´ í‘œì‹œ ìƒíƒœ ì €ì¥
                if (overlay_visibility) {
                    window.overlayVisibility = overlay_visibility;
                }
            }
        });

        // ì•¼êµ¬ ì „ìš© íŒ€ ë¡œê³ /ì»¬ëŸ¬/ë°°ê²½ìƒ‰ ì‹¤ì‹œê°„ ë°˜ì˜

        // íŒ€ ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamsSwapped', async function(data) {
            console.log('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                // íŒ€ëª… ì—…ë°ì´íŠ¸
                const homeTeamElements = document.querySelectorAll('.team-info.home-team .team-header');
                const awayTeamElements = document.querySelectorAll('.team-info.away-team .team-header');
                
                homeTeamElements.forEach(element => {
                    element.textContent = data.home_team;
                });
                awayTeamElements.forEach(element => {
                    element.textContent = data.away_team;
                });
                
                // ì ìˆ˜ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì„¸íŠ¸ ì ìˆ˜ ì‚¬ìš©)
                const currentSet = data.match_data?.current_inning || 1;
                const homeCurrentSetScore = data.match_data?.innings?.home?.[currentSet] || '0';
                const awayCurrentSetScore = data.match_data?.innings?.away?.[currentSet] || '0';
                
                const homeScoreElements = document.querySelectorAll('.home-team-score');
                const awayScoreElements = document.querySelectorAll('.away-team-score');
                
                homeScoreElements.forEach(element => {
                    if (element.textContent !== homeCurrentSetScore) {
                        element.textContent = homeCurrentSetScore;
                    }
                });
                awayScoreElements.forEach(element => {
                    if (element.textContent !== awayCurrentSetScore) {
                        element.textContent = awayCurrentSetScore;
                    }
                });
                
                // ì´ë‹ í…Œì´ë¸”ì˜ íŒ€ëª…ë„ ì—…ë°ì´íŠ¸
                const homeTableNameElements = document.querySelectorAll('.innings-table tbody tr:first-child .team-name');
                const awayTableNameElements = document.querySelectorAll('.innings-table tbody tr:last-child .team-name');
                
                homeTableNameElements.forEach(element => {
                    element.textContent = data.home_team;
                });
                awayTableNameElements.forEach(element => {
                    element.textContent = data.away_team;
                });
                
                // ë°°êµ¬ìš©: ì„¸íŠ¸ ìŠ¹ë¦¬ ê³„ì‚° ë° ì´ì  ì—…ë°ì´íŠ¸
                if (data.match_data?.innings) {
                    let homeWins = 0;
                    let awayWins = 0;
                    
                    // í˜„ì¬ ì„¸íŠ¸ ì´ì „ê¹Œì§€ë§Œ ìŠ¹ë¦¬ ê³„ì‚° (ì§„í–‰ ì¤‘ì¸ ì„¸íŠ¸ ì œì™¸)
                    for (let i = 1; i < currentSet; i++) {
                        let homeScore = 0;
                        let awayScore = 0;
                        
                        // ì„¸íŠ¸ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
                        if (data.match_data.innings.home && data.match_data.innings.away) {
                            // ìƒˆë¡œìš´ êµ¬ì¡°: innings.home[1], innings.away[1]
                            homeScore = parseInt(data.match_data.innings.home[i] || '0');
                            awayScore = parseInt(data.match_data.innings.away[i] || '0');
                        } else {
                            // ê¸°ì¡´ êµ¬ì¡°: innings.home_1, innings.away_1
                            homeScore = parseInt(data.match_data.innings[`home_${i}`] || '0');
                            awayScore = parseInt(data.match_data.innings[`away_${i}`] || '0');
                        }
                        
                        // ì„¸íŠ¸ê°€ ì§„í–‰ëœ ê²½ìš°ì—ë§Œ ìŠ¹ë¦¬ ê³„ì‚°
                        if (homeScore > 0 || awayScore > 0) {
                            if (homeScore > awayScore) {
                                homeWins++;
                            } else if (awayScore > homeScore) {
                                awayWins++;
                            }
                            // ë™ì ì¸ ê²½ìš°ëŠ” ìŠ¹ë¦¬í•˜ì§€ ì•ŠìŒ
                        }
                    }
                    
                    // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œì˜ ì´ì  ì—…ë°ì´íŠ¸
                    const homeTotalElement = document.getElementById('home-total');
                    const awayTotalElement = document.getElementById('away-total');
                    
                    if (homeTotalElement) homeTotalElement.textContent = homeWins;
                    if (awayTotalElement) awayTotalElement.textContent = awayWins;
                    
                    console.log(`ğŸ íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹œ ì„¸íŠ¸ ìŠ¹ë¦¬ ê³„ì‚° ì™„ë£Œ (${currentSet}ì„¸íŠ¸ ì§„í–‰ ì¤‘): í™ˆíŒ€ ${homeWins}, ì–´ì›¨ì´íŒ€ ${awayWins}`);
                }
                
                // ëŒ€íšŒëª… ì—…ë°ì´íŠ¸ (íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹œ)
                if (data.match_data?.tournament_name) {
                    const tournamentDisplay = document.getElementById('tournament-display');
                    if (tournamentDisplay) {
                        tournamentDisplay.textContent = data.match_data.tournament_name;
                        console.log('ğŸ íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹œ ëŒ€íšŒëª… ì—…ë°ì´íŠ¸:', data.match_data.tournament_name);
                    }
                }
                
                // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸ (íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹œ)
                if (data.match_data?.innings) {
                    for (let i = 1; i <= 5; i++) {
                        const homeSetElement = document.getElementById(`home-set-${i}`);
                        const awaySetElement = document.getElementById(`away-set-${i}`);
                        
                        if (homeSetElement) {
                            homeSetElement.textContent = data.match_data.innings.home?.[i] || '0';
                        }
                        if (awaySetElement) {
                            awaySetElement.textContent = data.match_data.innings.away?.[i] || '0';
                        }
                    }
                    console.log('ğŸ íŒ€ ìœ„ì¹˜ ë³€ê²½ ì‹œ ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                }
                
                // íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ (ì¶•êµ¬ì™€ ë™ì¼í•œ ë°©ì‹)
                try {
                    const response = await fetch(`/api/matches/${matchId}/team-logos`);
                    if (response.ok) {
                        const result = await response.json();
                        
                        // í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ (ì¶•êµ¬ì™€ ë™ì¼í•œ ë°©ì‹)
                        if (result.success && result.teamLogos) {
                            const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                            const homeLogoContainers = document.querySelectorAll('.team-info.home-team .team-logo-container');
                            homeLogoContainers.forEach(container => {
                                if (homeTeamInfo && homeTeamInfo.logo_path) {
                                    container.style.backgroundColor = homeTeamInfo.logo_bg_color || '#ffffff';
                                    container.innerHTML = `
                                        <img src="${homeTeamInfo.logo_path}" alt="${data.home_team} ë¡œê³ " class="team-logo">
                                    `;
                } else {
                                    container.style.backgroundColor = '#f8f9fa';
                                    container.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                                }
                            });
                            
                            // ì›ì •íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                            const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                            const awayLogoContainers = document.querySelectorAll('.team-info.away-team .team-logo-container');
                            awayLogoContainers.forEach(container => {
                                if (awayTeamInfo && awayTeamInfo.logo_path) {
                                    container.style.backgroundColor = awayTeamInfo.logo_bg_color || '#ffffff';
                                    container.innerHTML = `
                                        <img src="${awayTeamInfo.logo_path}" alt="${data.away_team} ë¡œê³ " class="team-logo">
                                    `;
                } else {
                                    container.style.backgroundColor = '#f8f9fa';
                                    container.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                                }
                            });
                        }
                    }
                } catch (error) {
                    console.error('íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
                
                console.log('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì™„ë£Œ');
            }
        });

        // ìŠ¤í¬ì¸  ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì•¼êµ¬ìš©)
        socket.on('sport_overlay_image_updated', function(data) {
            console.log('ì•¼êµ¬ ìŠ¤í¬ì¸  ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸:', data);
            
            if (data.action === 'uploaded') {
                // ìƒˆ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                loadOverlayImage();
            } else if (data.action === 'deleted') {
                // ì´ë¯¸ì§€ê°€ ì‚­ì œëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                loadOverlayImage();
            } else if (data.action === 'activated') {
                // ì´ë¯¸ì§€ê°€ í™œì„±í™”ëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                loadOverlayImage();
            } else if (data.action === 'status_changed') {
                // ì´ë¯¸ì§€ ìƒíƒœê°€ ë³€ê²½ëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                console.log('ì•¼êµ¬ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ë¨:', data);
                loadOverlayImage();
            }
        });

        // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë™ì  ì²˜ë¦¬)
        socket.on('overlay_image_status_changed', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸:', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ (window.matchData ì‚¬ìš©)
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ì¼ì¹˜, ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘');
                
                if (data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì¶”ê°€ í‘œì‹œ
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í™œì„±í™”:', data.imageData);
                    addOverlayImage(data.imageData);
                } else if (!data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ ë¹„í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì œê±°
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¹„í™œì„±í™”:', data.imageData);
                    removeOverlayImage(data.imageData.id);
                }
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜, Room ì¬ì°¸ì—¬ ì‹œë„');
                // ìŠ¤í¬ì¸  íƒ€ì…ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ Room ì¬ì°¸ì—¬ ì‹œë„
                if (window.matchData?.sport_type) {
                    console.log('ğŸ”§ ì•¼êµ¬ Room ì¬ì°¸ì—¬ ìš”ì²­:', window.matchData.sport_type);
                    socket.emit('join_sport_room', window.matchData.sport_type);
                }
            }
        });

        // ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('overlay_page_refresh', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹ í˜¸ ìˆ˜ì‹ :', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰:', data.reason);
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    location.reload();
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€');
            }
        });

        // dataChanged ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
        socket.on('dataChanged', async function(data) {
            console.log('ğŸ”§ dataChanged ì´ë²¤íŠ¸ ìˆ˜ì‹  (ì•¼êµ¬):', data);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° ID:', matchId);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ ê²½ê¸° ID:', data.matchId);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ íƒ€ì…:', data.type);
            console.log('ğŸ”§ íŒ€ íƒ€ì…:', data.teamType);
            
            if (data.matchId === matchId) {
                console.log('ğŸ”§ ë™ì¼ ê²½ê¸° dataChanged ì´ë²¤íŠ¸ - ë°ì´í„° ì¬ë¡œë“œ ì‹œì‘');
                setTimeout(async () => {
                    try {
                        console.log('ğŸ”§ 500ms ì§€ì—° í›„ ë°ì´í„° ì¬ë¡œë“œ ì‹¤í–‰');
                        await loadMatchData();
                        
                        // íŒ€ë¡œê³  ì •ë³´ë„ í•¨ê»˜ ë¡œë“œ
                        if (data.type === 'teamLogo' || data.type === 'teamName' || data.type === 'teamColor') {
                            console.log('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ì¬ë¡œë“œ ì‹œì‘');
                            const response = await fetch(`/api/matches/${matchId}/team-logos`);
                            if (response.ok) {
                                const result = await response.json();
                                console.log('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ì‘ë‹µ:', result);
                                
                                // í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                                if (result.teamLogos && result.teamLogos.length > 0) {
                                    const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                                    const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                                    
                                    console.log('ğŸ”§ í™ˆíŒ€ ì •ë³´:', homeTeamInfo);
                                    console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ì •ë³´:', awayTeamInfo);
                                    
                                    if (homeTeamInfo) {
                                        const homeLogoContainers = document.querySelectorAll('.team-info.home-team .team-logo-container');
                                        console.log('ğŸ”§ í™ˆíŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆ ê°œìˆ˜:', homeLogoContainers.length);
                                        homeLogoContainers.forEach(container => {
                                            if (homeTeamInfo.logo_path) {
                                                container.innerHTML = `
                                                    <img src="${homeTeamInfo.logo_path}" alt="í™ˆíŒ€ ë¡œê³ " class="team-logo">
                                                `;
                                                container.style.backgroundColor = homeTeamInfo.logo_bg_color || '#ffffff';
                                                console.log('ğŸ”§ í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ:', homeTeamInfo.logo_path);
                    } else {
                                                container.innerHTML = `<div class="team-logo-placeholder"></div>`;
                                                console.log('ğŸ”§ í™ˆíŒ€ ë¡œê³  ì—†ìŒ - í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ');
                                            }
                                        });
                                        
                                        // í™ˆíŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸
                                        if (homeTeamInfo.team_color) {
                                            const homeTeamSection = document.getElementById('home-team-section');
                                            if (homeTeamSection) {
                                                homeTeamSection.style.backgroundColor = homeTeamInfo.team_color;
                                                console.log('ğŸ”§ í™ˆíŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸:', homeTeamInfo.team_color);
                                            }
                                        }
                                    }
                                    
                                    if (awayTeamInfo) {
                                        const awayLogoContainers = document.querySelectorAll('.team-info.away-team .team-logo-container');
                                        console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆ ê°œìˆ˜:', awayLogoContainers.length);
                                        awayLogoContainers.forEach(container => {
                                            if (awayTeamInfo.logo_path) {
                                                container.innerHTML = `
                                                    <img src="${awayTeamInfo.logo_path}" alt="ì›ì •íŒ€ ë¡œê³ " class="team-logo">
                                                `;
                                                container.style.backgroundColor = awayTeamInfo.logo_bg_color || '#ffffff';
                                                console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ:', awayTeamInfo.logo_path);
                    } else {
                                                container.innerHTML = `<div class="team-logo-placeholder"></div>`;
                                                console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ë¡œê³  ì—†ìŒ - í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ');
                                            }
                                        });
                                        
                                        // ì–´ì›¨ì´íŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸
                                        if (awayTeamInfo.team_color) {
                                            const awayTeamSection = document.getElementById('away-team-section');
                                            if (awayTeamSection) {
                                                awayTeamSection.style.backgroundColor = awayTeamInfo.team_color;
                                                console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸:', awayTeamInfo.team_color);
                                            }
                                        }
                                    }
                                }
                                
                                
                                console.log('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ì¬ë¡œë“œ ì™„ë£Œ');
                } else {
                                console.error('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', response.status);
                            }
                        }
                        
                        console.log('ğŸ”§ ë°ì´í„° ì¬ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                        console.error('ğŸ”§ ë°ì´í„° ì¬ë¡œë“œ ì˜¤ë¥˜:', error);
                    }
                }, 500);
                    } else {
                console.log('ğŸ”§ ë‹¤ë¥¸ ê²½ê¸°ì˜ dataChanged ì´ë²¤íŠ¸ë¡œ ë¬´ì‹œ');
            }
        });

        // íŒ€ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (í†µí•©ëœ ë°©ì‹)
        socket.on('teamLogoUpdated', function(data) {
            if (data.matchId !== matchId) return;
            
            console.log('íŒ€ë¡œê³  ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
            
            const teamType = data.teamType;
            const logoPath = data.logoPath;
            const logoBgColor = data.logoBgColor || '#ffffff';
            
            // í•´ë‹¹ íŒ€ì˜ ë¡œê³  ì»¨í…Œì´ë„ˆ ì°¾ê¸°
            const logoContainer = document.querySelector(`.team-info.${teamType}-team .team-logo-container`);
            if (logoContainer) {
                // ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
                logoContainer.style.backgroundColor = logoBgColor;
                
                // ë¡œê³  ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
                if (logoPath) {
                    logoContainer.innerHTML = `
                        <img src="${logoPath}" alt="${teamType === 'home' ? 'í™ˆ' : 'ì›ì •'}íŒ€ ë¡œê³ " 
                             style="width: 100%; height: 100%; object-fit: contain;">
                    `;
                } else {
                    logoContainer.innerHTML = `<div class="team-logo-placeholder"></div>`;
                }
                
                console.log(`${teamType}íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${logoPath}, ë°°ê²½ìƒ‰: ${logoBgColor}`);
                } else {
                console.error(`${teamType}íŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
            }
        });

        // ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ ê´€ë ¨ ë³€ìˆ˜
        let currentMatchIndex = 0;
        let totalMatches = 0;
        let listId = null;
        
        <% if (typeof listId !== 'undefined' && listId) { %>
        currentMatchIndex = <%- currentMatchIndex || 0 %>;
        totalMatches = <%- totalMatches || 0 %>;
        listId = '<%- listId %>';
        
        // ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ
        function showListInfo() {
            const listInfo = document.getElementById('listInfo');
            const listName = document.getElementById('listName');
            const matchCounter = document.getElementById('matchCounter');
            
            if (listInfo && listName && matchCounter) {
                listName.textContent = 'ë¦¬ìŠ¤íŠ¸: <%= typeof listName !== "undefined" ? listName : "ê²½ê¸° ë¦¬ìŠ¤íŠ¸" %>';
                matchCounter.textContent = `ê²½ê¸° ${currentMatchIndex + 1} / ${totalMatches}`;
                listInfo.classList.add('show');
                
                // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                    listInfo.classList.remove('show');
                }, 3000);
            }
        }
        
        // ë‹¤ìŒ ê²½ê¸°ë¡œ ì´ë™
        async function nextMatch() {
            if (currentMatchIndex < totalMatches - 1) {
                currentMatchIndex++;
                await loadCurrentMatch();
            }
        }
        
        // ì´ì „ ê²½ê¸°ë¡œ ì´ë™
        async function prevMatch() {
            if (currentMatchIndex > 0) {
                currentMatchIndex--;
                await loadCurrentMatch();
            }
        }
        
        // í˜„ì¬ ê²½ê¸° ë¡œë“œ
        async function loadCurrentMatch() {
            try {
                const response = await fetch(`/api/list/${listId}/current-match?index=${currentMatchIndex}`);
                if (!response.ok) throw new Error('ê²½ê¸° ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
                
                    const data = await response.json();
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ê²½ê¸° ë³€ê²½
                window.location.href = `/list/${listId}/overlay?index=${currentMatchIndex}`;
            } catch (error) {
                console.error('ê²½ê¸° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'ArrowLeft':
                    prevMatch();
                    break;
                case 'ArrowRight':
                    nextMatch();
                    break;
                case 'i':
                case 'I':
                    showListInfo();
                    break;
            }
        });
        
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ
        window.addEventListener('load', function() {
            setTimeout(showListInfo, 1000);
            
            // ì´ˆê¸° ê²½ê¸°ë°©ì‹ì— ë”°ë¥¸ ì„¸íŠ¸ í‘œì‹œ ì„¤ì •
            const initialFormat = <%= match.match_data?.match_format || 3 %>;
            console.log('ğŸ ì˜¤ë²„ë ˆì´ ì´ˆê¸° ê²½ê¸°ë°©ì‹:', initialFormat + 'ì„¸íŠ¸ì œ');
            
            // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
            setTimeout(() => {
                updateOverlaySetDisplay(initialFormat);
            }, 100);
        });
        
        // DOMContentLoaded ì´ë²¤íŠ¸ë¡œë„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            const initialFormat = <%= match.match_data?.match_format || 3 %>;
            console.log('ğŸ DOMContentLoaded - ì´ˆê¸° ê²½ê¸°ë°©ì‹:', initialFormat + 'ì„¸íŠ¸ì œ');
            
            // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
            setTimeout(() => {
                updateOverlaySetDisplay(initialFormat);
            }, 200);
        });
        
        // ì¦‰ì‹œ ì‹¤í–‰ë„ ì¶”ê°€
        (function() {
            const initialFormat = <%= match.match_data?.match_format || 3 %>;
            console.log('ğŸ ì¦‰ì‹œ ì‹¤í–‰ - ì´ˆê¸° ê²½ê¸°ë°©ì‹:', initialFormat + 'ì„¸íŠ¸ì œ');
            console.log('ğŸ match.match_data:', <%= JSON.stringify(match.match_data) %>);
            console.log('ğŸ match_format ê°’:', <%= match.match_data?.match_format %>);
            
            // ì¦‰ì‹œ ì‹¤í–‰
            updateOverlaySetDisplay(initialFormat);
            
            // ì§€ì—° ì‹¤í–‰ë„ ì¶”ê°€
            setTimeout(() => {
                updateOverlaySetDisplay(initialFormat);
            }, 100);
            
            setTimeout(() => {
                updateOverlaySetDisplay(initialFormat);
            }, 500);
        })();
        <% } %>
        
        // ì˜¤ë²„ë ˆì´ ì„¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì „ì—­ ìŠ¤ì½”í”„)
        function updateOverlaySetDisplay(matchFormat) {
            console.log('ğŸ ì˜¤ë²„ë ˆì´ ì„¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸:', matchFormat + 'ì„¸íŠ¸ì œ');
            
            // ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œì˜ ê° ì„¸íŠ¸ í‘œì‹œ/ìˆ¨ê¹€
            for (let i = 1; i <= 5; i++) {
                // data-set ì†ì„±ìœ¼ë¡œ ì°¾ê¸°
                const setElements = document.querySelectorAll(`[data-set="${i}"]`);
                console.log(`ğŸ ${i}ì„¸íŠ¸ ìš”ì†Œ ê°œìˆ˜ (data-set):`, setElements.length);
                
                // IDë¡œë„ ì°¾ê¸°
                const homeSetElement = document.getElementById(`home-set-${i}`);
                const awaySetElement = document.getElementById(`away-set-${i}`);
                
                const allElements = [...setElements];
                if (homeSetElement) allElements.push(homeSetElement);
                if (awaySetElement) allElements.push(awaySetElement);
                
                console.log(`ğŸ ${i}ì„¸íŠ¸ ì´ ìš”ì†Œ ê°œìˆ˜:`, allElements.length);
                
                allElements.forEach((element, index) => {
                    if (i <= matchFormat) {
                        element.style.display = 'table-cell';
                        element.style.visibility = 'visible';
                        element.style.opacity = '1';
                        element.removeAttribute('hidden');
                        console.log(`ğŸ ì˜¤ë²„ë ˆì´ ${i}ì„¸íŠ¸ í‘œì‹œ (${index + 1}ë²ˆì§¸)`);
                    } else {
                        element.style.display = 'none';
                        element.style.visibility = 'hidden';
                        element.style.opacity = '0';
                        element.setAttribute('hidden', 'true');
                        console.log(`ğŸ ì˜¤ë²„ë ˆì´ ${i}ì„¸íŠ¸ ìˆ¨ê¹€ (${index + 1}ë²ˆì§¸)`);
                    }
                });
            }
            
            // í…Œì´ë¸” í—¤ë”ì˜ ì„¸íŠ¸ ì—´ë„ í•¨ê»˜ ì²˜ë¦¬
            for (let i = 1; i <= 5; i++) {
                const headerCells = document.querySelectorAll(`th:nth-child(${i + 1})`);
                console.log(`ğŸ ${i}ì„¸íŠ¸ í—¤ë” ê°œìˆ˜:`, headerCells.length);
                
                headerCells.forEach((cell, index) => {
                    if (i <= matchFormat) {
                        cell.style.display = 'table-cell';
                        cell.style.visibility = 'visible';
                        cell.style.opacity = '1';
                        cell.removeAttribute('hidden');
                        console.log(`ğŸ ì˜¤ë²„ë ˆì´ ${i}ì„¸íŠ¸ í—¤ë” í‘œì‹œ (${index + 1}ë²ˆì§¸)`);
                    } else {
                        cell.style.display = 'none';
                        cell.style.visibility = 'hidden';
                        cell.style.opacity = '0';
                        cell.setAttribute('hidden', 'true');
                        console.log(`ğŸ ì˜¤ë²„ë ˆì´ ${i}ì„¸íŠ¸ í—¤ë” ìˆ¨ê¹€ (${index + 1}ë²ˆì§¸)`);
                    }
                });
            }
            
            // CSS í´ë˜ìŠ¤ë¡œë„ ì²˜ë¦¬
            const setScoreboard = document.querySelector('.set-scoreboard');
            if (setScoreboard) {
                // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
                setScoreboard.classList.remove('format-3', 'format-5');
                // ìƒˆ í´ë˜ìŠ¤ ì¶”ê°€
                setScoreboard.classList.add(`format-${matchFormat}`);
                console.log(`ğŸ ì„¸íŠ¸ ìŠ¤ì½”ì–´ë³´ë“œ í´ë˜ìŠ¤ ë³€ê²½: format-${matchFormat}`);
            }
            
            console.log('ğŸ ì˜¤ë²„ë ˆì´ ì„¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }
        
        // ì•¼êµ¬ëŠ” íƒ€ì´ë¨¸ê°€ í•„ìš”ì—†ìœ¼ë¯€ë¡œ í•˜ì´ë¸Œë¦¬ë“œ íƒ€ì´ë¨¸ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        
    </script>
</body>
</html> 
</html> 