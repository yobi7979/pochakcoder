<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Overlay</title>
    <script>
        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.matchId = '<%= match.id %>';
        window.sportType = 'BASEBALL';
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: transparent;
            color: white;
            overflow: hidden;
        }

        .team-logo {
            max-width: 100%;
            max-height: 100%;
            background-color: rgba(255, 255, 255, 0.0);
            padding: 0px;
        }

                /* ì‹¤ì œ ë¡œê³  ì˜ì—­: ì›í˜• í…Œë‘ë¦¬ ì ìš© */
        .team-logo-container {
            width: 40px;
            height: 40px;
            margin-right: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
        }

              /* ë¡œê³ ê°€ ì—†ì„ ë•Œ í‘œì‹œë  í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼ */
        .team-logo-placeholder {
            width: 100%;                                 /* ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤ */
            height: 100%;                                /* ë¶€ëª¨ í¬ê¸°ì— ë§ì¶¤ */
            border-radius: 5px;                          /* ì‚´ì§ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            background-color: rgba(0, 0, 0, 0.0);      /* ë°˜íˆ¬ëª… í° ë°°ê²½ */
            display: flex;                               /* í…ìŠ¤íŠ¸ ì •ë ¬ìš© flex */
            align-items: center;                         /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
            justify-content: center;                     /* ê°€ë¡œ ê°€ìš´ë° ì •ë ¬ */
            font-weight: bold;                           /* ê¸€ì”¨ êµµê²Œ */
            color: white;                                /* ê¸€ì”¨ ìƒ‰ í°ìƒ‰ */
            font-size: 24px;                             /* ê¸€ì”¨ í¬ê¸° 24px */
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', Arial, sans-serif;
        }
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            min-width: 100vw;
            height: 100vh;
            width: 100vw;
            position: relative;
        }
        .overlay-container {
            width: 100vw;
            height: 100vh;
            min-width: 100vw;
            min-height: 100vh;
            position: relative;
        }

        /* ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ ì˜ì—­ */
        .list-info {
            position: absolute;
            top: 20px;
            right: 50px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: none;
        }
        
        .list-info.show {
            display: block;
        }
        
        .list-info .list-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .list-info .match-counter {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* ìš°ì¸¡ í•˜ë‹¨ ìŠ¤ì½”ì–´ë³´ë“œ */
        .scoreboard {        
            position: fixed;
            bottom: 20px;
            right: 250px;
            width: 300px;
            height: 120px;
            background-color: rgb(208, 208, 208);
            display: flex;
            color: rgb(255, 255, 255);
            overflow: hidden;            
            border-top-left-radius: 10px;
            border-bottom-left-radius: 10px;
        }
        .team-section {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        .team-info {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 5px 10px;
        }
        .team-info.home-team {
            background-color: rgb(57, 57, 57);
        }
        .team-info.away-team {
            background-color: rgb(57, 57, 57);
        }
        .team-header {
            width: 180px;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: flex-start;            
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-left: 10px;
        }
        .team-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: flex;
            align-items: center;       /* ìˆ˜ì§ ê°€ìš´ë° ì •ë ¬ */
            justify-content: center;   /* ìˆ˜í‰ ê°€ìš´ë° ì •ë ¬ */
        }
        .team-logo.no-logo {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
        }
        .team-header.long {
            font-size: 18px;
        }
        .team-header.very-long {
            font-size: 16px;
        }
        .team-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 20px;
            min-width: 60px;
        }
        .team-score {
            font-size: 32px;
            font-weight: bold;
            min-width: 40px;
            text-align: right;
            padding-left: 15px; /* ì˜¤ë¥¸ìª½ ì—¬ë°±ì„ ì¤„ì´ê¸° ìœ„í•´ íŒ¨ë”© ì¶”ê°€ */
        }
        
        
        /* ë² ì´ìŠ¤ ìƒíƒœ */
        .base-status {
            position: fixed;
            bottom: 20px;
            right: 130px;
            width: 120px;
            height: 120px;
            background-color: rgba(0, 0, 0, 0.98);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .inning-header {
            font-size: 18px;
            top: 50px;
            left: 70px;
            background-color: transparent;
        }
        .current-inning {
            margin-top: 60px;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .inning-indicator {
            margin-left: 5px;
            font-size: 20px;
        }
        .inning-indicator.top:after {
            content: "â–²";
            color: #3b82f6;
        }
        .inning-indicator.bottom:after {
            content: "â–¼";
            color: #3b82f6;
        }
        
        /* ê²Œì„ ìƒíƒœ (ë³¼/ìŠ¤íŠ¸ë¼ì´í¬/ì•„ì›ƒ ì¹´ìš´íŠ¸) */
        .game-status {
            position: fixed;
            bottom: 20px;
            right: 10px;
            width: 120px;
            height: 120px;
            background-color: rgba(0, 0, 0, 0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 0;
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
        }
        .base-container {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto;
            background-color: transparent;
            transform: rotate(-45deg); /* ì „ì²´ 45ë„ íšŒì „ */
        }
        .diamond {
            width: 80px;
            height: 80px;
            position: absolute; /* ìš”ì†Œë¥¼ ì ˆëŒ€ ìœ„ì¹˜ë¡œ ì„¤ì •í•˜ì—¬ ë¶€ëª¨ ìš”ì†Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤. */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .base {
            width: 35px; /* í¬ê¸°ë¥¼ ì¤„ì—¬ì„œ ê°„ê²©ì„ ì¢í™ë‹ˆë‹¤. */
            height: 35px; /* í¬ê¸°ë¥¼ ì¤„ì—¬ì„œ ê°„ê²©ì„ ì¢í™ë‹ˆë‹¤. */
            position: absolute;
            background-color: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }
        .base.active {
            background-color: #f59e0b;
            border-color: #d97706;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }
        .base.first {
            right: 15%;
            bottom: 50%;
            transform: translate(50%, 50%) rotate(45deg); /* 45ë„ íšŒì „ ì¶”ê°€ */
        }
        .base.second {
            top: 15%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .base.third {
            left: 15%;
            bottom: 50%;
            transform: translate(-50%, 50%) rotate(45deg); /* 45ë„ íšŒì „ ì¶”ê°€ */
        }
        
        .count-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 100%;
            padding: 0 10px;
        }
        .count-row {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .count-label {
            font-size: 20px;
            width: 15px;
            text-align: left;
        }
        .count-indicators {
            display: flex;
            gap: 4px;
            flex: 1;
            justify-content: flex-start;
            margin-left: 0;
            padding-left: 0;
        }
        .count-dot {
            width: 23px;
            height: 23px;
            border-radius: 50%;
            background-color: #666;
            transition: background-color 0.3s ease;
        }
        .count-dot.ball.active {
            background-color: #22c55e;
        }
        .count-dot.strike.active {
            background-color: #eab308;
        }
        .count-dot.out.active {
            background-color: #ef4444;
        }
        
        /* ìŠ¤íŠ¸ë¼ì´í¬ì™€ ì•„ì›ƒì¹´ìš´íŠ¸ ì›ë“¤ì„ ì™¼ìª½ìœ¼ë¡œ ë” ì›€ì§ì„ */
        .count-row:nth-child(1) .count-indicators,
        .count-row:nth-child(2) .count-indicators,
        .count-row:nth-child(3) .count-indicators {
            padding-left: -15px; /* ì™¼ìª½ìœ¼ë¡œ ë” ì´ë™ì‹œí‚¤ê¸° ìœ„í•´ íŒ¨ë”©ì„ ì¶”ê°€ */
        }
        
        /* íƒ€ì ì •ë³´ */
        .batter-info {
            position: absolute;
            left: 50px;
            top: 210px;
            width: 320px;
            height: 320px;
            background-color: rgba(0, 0, 0, 1.0);
            border-radius: 8px;
            color: white;
            overflow: hidden;
        }
        .panel-title {
            background-color: #ffffff;
            padding: 8px 12px;
            font-size: 16px;
            font-weight: bold;
        }
        .player-content {
            padding: 12px 15px;
            display: flex;
            align-items: center;
        }
        .player-number {
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            align-self: flex-start; /* â† ë¶€ëª¨ ì•ˆì—ì„œ ìœ„ë¡œ ë¶™ì´ê¸° */
        }
        .player-info {
            flex: 1;
        }
        .player-name {
            font-size: 32px;
            font-weight: bold;
        }
        .player-position {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 3px;
        }
        .player-stats {
            margin-top: 10px;
            display: flex;
            gap: 15px;
            align-items: flex-start; /* â† ì™¼ìª½ ì •ë ¬ */
            flex-direction: column; /* â† ì„¸ë¡œë¡œ ë‚˜ì—´ */
            gap: 5px; /* í•­ëª© ê°„ ê°„ê²© */
        }
        .stat-item {
            display: flex;
            flex-direction: row; /* â† ê°€ë¡œ ì •ë ¬ */
            align-items: center;
            gap: 6px; /* í•­ëª© ê°„ ê°„ê²© */
        }
        .stat-label {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.6);
        }
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-top: 3px;
        }
        
        /* íˆ¬ìˆ˜ ì •ë³´ */
        .pitcher-info {
            position: absolute;
            left: 420px;
            top: 210px;
            width: 320px;
            height: 320px;
            background-color: rgba(0, 0, 0, 1.0);
            border-radius: 8px;
            color: white;
            overflow: hidden;
        }
        .pitcher-info .panel-title {
            background-color: #ffffff;
        }
        .pitcher-info .player-number {
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        /* ì´ë‹ ìŠ¤ì½”ì–´ */
        .innings-scoreboard {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            background-color: rgba(0, 0, 0, 1.0);
            border-radius: 8px;
            color: white;
            overflow: hidden;
        }
        .innings-title {
            background-color: rgb(0, 126, 52);
            padding: 8px 12px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
        .innings-table {
            width: 100%;
            border-collapse: collapse;
        }
        .innings-table th, .innings-table td {
            padding: 8px;
            text-align: center;
            font-size: 14px;
        }
        .innings-table th {
            color: rgba(255, 255, 255, 0.7);
            background-color: rgba(255, 255, 255, 0.1);
        }
        .innings-table td {
            font-weight: bold;
        }
        .innings-table td.team-name {
            text-align: left;
            width: 120px;
        }
        .innings-table td.total {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ */
        .overlay-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 1920px;
            height: 1080px;
            z-index: 1000;
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        }

        .overlay-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
            box-shadow: none;
        }

        .overlay-image.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="overlay-container">
        <!-- ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ -->
        <% if (typeof listId !== 'undefined' && listId) { %>
        <div class="list-info" id="listInfo">
            <div class="list-name" id="listName"></div>
            <div class="match-counter" id="matchCounter"></div>
        </div>
        <% } %>
        
        <!-- ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ -->
        <div class="overlay-image" id="overlayImage">
            <!-- ì´ë¯¸ì§€ëŠ” JavaScriptë¡œ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="scoreboard">
            <div class="team-section">
                <div class="team-info home-team" id="home-team-section">
                    <div class="team-logo-container">
                        <% if (match.match_data?.home_team_logo) { %>
                            <img src="<%= match.match_data.home_team_logo %>" alt="í™ˆíŒ€ ë¡œê³ " class="team-logo">
                        <% } else { %>
                            <div class="team-logo-placeholder"></div>
                        <% } %>
                    </div>
                    <div class="team-header"><%= match.home_team || 'HOME' %></div>
                    <div class="team-content">
                        <div class="team-score"><%= match.home_score || '0' %></div>
                    </div>
                </div>
                <div class="team-info away-team" id="away-team-section">
                    <div class="team-logo-container">
                        <% if (match.match_data?.away_team_logo) { %>
                            <img src="<%= match.match_data.away_team_logo %>" alt="ì›ì •íŒ€ ë¡œê³ " class="team-logo">
                        <% } else { %>
                            <div class="team-logo-placeholder"></div>
                        <% } %>
                    </div>
                    <div class="team-header"><%= match.away_team || 'AWAY' %></div>
                    <div class="team-content">
                        <div class="team-score"><%= match.away_score || '0' %></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="inning-section">
            
        </div>

        <!-- ë² ì´ìŠ¤ ìƒíƒœ ì„¹ì…˜ -->
        <div class="base-status">
            <div class="base-container">
                <div class="diamond">
                    <div class="base first <%= match.match_data?.first_base ? 'active' : '' %>"></div>
                    <div class="base second <%= match.match_data?.second_base ? 'active' : '' %>"></div>
                    <div class="base third <%= match.match_data?.third_base ? 'active' : '' %>"></div>
                    <div class="inning-header"></div>
                    <div class="current-inning">
                    <%= match.match_data?.current_inning || '1' %>
                    <div class="inning-indicator <%= match.match_data?.inning_type === 'bottom' ? 'bottom' : 'top' %>"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê²Œì„ ìƒíƒœ ì„¹ì…˜ (ë³¼/ìŠ¤íŠ¸ë¼ì´í¬/ì•„ì›ƒ ì¹´ìš´íŠ¸) -->
        <div class="game-status">
            <div class="count-section">
                <div class="count-row">
                    <span class="count-label">B</span>
                    <div class="count-indicators">
                        <div class="count-dot ball <%= (match.match_data?.balls >= 1) ? 'active' : '' %>"></div>
                        <div class="count-dot ball <%= (match.match_data?.balls >= 2) ? 'active' : '' %>"></div>
                        <div class="count-dot ball <%= (match.match_data?.balls >= 3) ? 'active' : '' %>"></div>
                        <!-- <div class="count-dot ball <%= (match.match_data?.balls >= 4) ? 'active' : '' %>"></div> -->
                    </div>
                </div>
                <div class="count-row">
                    <span class="count-label">S</span>
                    <div class="count-indicators">
                        <div class="count-dot strike <%= (match.match_data?.strikes >= 1) ? 'active' : '' %>"></div>
                        <div class="count-dot strike <%= (match.match_data?.strikes >= 2) ? 'active' : '' %>"></div>
                        <!-- <div class="count-dot strike <%= (match.match_data?.strikes >= 3) ? 'active' : '' %>"></div> -->
                    </div>
                </div>
                <div class="count-row">
                    <span class="count-label">O</span>
                    <div class="count-indicators">
                        <div class="count-dot out <%= (match.match_data?.outs >= 1) ? 'active' : '' %>"></div>
                        <div class="count-dot out <%= (match.match_data?.outs >= 2) ? 'active' : '' %>"></div>
                        <div class="count-dot out <%= (match.match_data?.outs >= 3) ? 'active' : '' %>"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- íƒ€ì ì •ë³´ -->
        <div class="batter-info">
            <div class="panel-title">í˜„ì¬ íƒ€ì</div>
            <div class="player-content">
                <div class="player-number"><%= match.match_data?.batter_number || '25' %></div>
                <div class="player-info">
                    <div class="player-name batter-name"><%= match.match_data?.batter_name || 'íƒ€ì' %></div>
                    <div class="player-position"><%= match.match_data?.batter_position || 'ì™¸ì•¼ìˆ˜' %></div>
                    <div class="player-stats">
                        <div class="stat-item">
                            <div class="stat-label">íƒ€ìœ¨</div>
                            <div class="stat-value"><%= match.match_data?.batter_avg || '.342' %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">í™ˆëŸ°</div>
                            <div class="stat-value"><%= match.match_data?.batter_hr || '15' %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">íƒ€ì </div>
                            <div class="stat-value"><%= match.match_data?.batter_rbi || '52' %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ì¶œë£¨ìœ¨</div>
                            <div class="stat-value"><%= match.match_data?.batter_obp || '.412' %></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- íˆ¬ìˆ˜ ì •ë³´ -->
        <div class="pitcher-info">
            <div class="panel-title">í˜„ì¬ íˆ¬ìˆ˜</div>
            <div class="player-content">
                <div class="player-number"><%= match.match_data?.pitcher_number || '18' %></div>
                <div class="player-info">
                    <div class="player-name pitcher-name"><%= match.match_data?.pitcher_name || 'íˆ¬ìˆ˜' %></div>
                    <div class="player-position"><%= match.match_data?.pitcher_position || 'ìš°ì™„ íˆ¬ìˆ˜' %></div>
                    <div class="player-stats">
                        <div class="stat-item">
                            <div class="stat-label">í‰ê· ìì±…ì </div>
                            <div class="stat-value"><%= match.match_data?.pitcher_era || '2.48' %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ìŠ¹íŒ¨</div>
                            <div class="stat-value"><%= match.match_data?.pitcher_wl || '7-3' %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">íˆ¬êµ¬ ìˆ˜</div>
                            <div class="stat-value"><%= match.match_data?.pitcher_pitches || '53' %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">íƒˆì‚¼ì§„</div>
                            <div class="stat-value"><%= match.match_data?.pitcher_so || '5' %></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì´ë‹ ìŠ¤ì½”ì–´ -->
        <div class="innings-scoreboard">
            <div class="innings-title">ì´ë‹ ìŠ¤ì½”ì–´</div>
            <table class="innings-table">
                <thead>
                    <tr>
                        <th>íŒ€</th>
                        <th>1</th>
                        <th>2</th>
                        <th>3</th>
                        <th>4</th>
                        <th>5</th>
                        <th>6</th>
                        <th>7</th>
                        <th>8</th>
                        <th>9</th>
                        <th>R</th>
                        <th>H</th>
                        <th>E</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="team-name"><%= match.home_team %></td>
                        <% for(let i = 1; i <= 9; i++) { %>
                            <td id="teamA-inning-<%= i %>"><%= match.match_data?.innings?.[`home_${i}`] || 0 %></td>
                        <% } %>
                        <td class="total"><%= match.home_score || 0 %></td>
                        <td class="total"><%= match.match_data?.home_hits || 0 %></td>
                        <td class="total"><%= match.match_data?.home_errors || 0 %></td>
                    </tr>
                    <tr>
                        <td class="team-name"><%= match.away_team %></td>
                        <% for(let i = 1; i <= 9; i++) { %>
                            <td id="teamB-inning-<%= i %>"><%= match.match_data?.innings?.[`away_${i}`] || 0 %></td>
                        <% } %>
                        <td class="total"><%= match.away_score || 0 %></td>
                        <td class="total"><%= match.match_data?.away_hits || 0 %></td>
                        <td class="total"><%= match.match_data?.away_errors || 0 %></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const socket = io();
        const matchId = '<%= match.id %>';
        
        // ê²½ê¸° ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadMatchData() {
            try {
                const response = await fetch(`/api/matches/${matchId}`);
                const matchData = await response.json();
                window.matchData = matchData;  // ì „ì—­ ë³€ìˆ˜ë¡œ ì €ì¥
                console.log('ğŸ”§ ê²½ê¸° ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', matchData.sport_type);
                return matchData;
            } catch (error) {
                console.error('ğŸ”§ ê²½ê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ì†Œì¼“ ì—°ê²°
        socket.on('connect', async () => {
            console.log('=== Socket.IO ì—°ê²°ë¨ (ì˜¤ë²„ë ˆì´) ===');
            console.log('Socket ID:', socket.id);
            console.log('Match ID:', matchId);
            socket.emit('join', matchId);
            
            // ê²½ê¸° ë°ì´í„° ë¡œë“œ í›„ ì¢…ëª©ë³„ Roomì— ì°¸ì—¬ ìš”ì²­
            const matchData = await loadMatchData();
            if (matchData) {
                // ì„œë²„ì— ì¢…ëª©ë³„ Room ì°¸ì—¬ ìš”ì²­
                socket.emit('join_sport_room', matchData.sport_type);
                console.log(`ğŸ”§ ì¢…ëª©ë³„ Room ì°¸ì—¬ ìš”ì²­: sport_${matchData.sport_type}`);
            }
            
            // ì¢…ëª©ë³„ Room ì°¸ì—¬ í™•ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            socket.on('joined_sport_room', (data) => {
                if (data.success) {
                    console.log(`ğŸ”§ ì•¼êµ¬ ì¢…ëª©ë³„ Room ì°¸ì—¬ ì™„ë£Œ: ${data.roomName}`);
                    console.log(`ğŸ”§ Room ì°¸ì—¬ì ìˆ˜: ${data.clientCount}`);
                    // Room ì°¸ì—¬ ì™„ë£Œ í›„ ê¸°ì¡´ í™œì„± ì´ë¯¸ì§€ ë¡œë“œ
                    loadOverlayImage();
                    
                    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ (Room ì°¸ì—¬ ì™„ë£Œ í›„)
                    console.log('ğŸ”§ ì•¼êµ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ ì‹œì‘');
                    registerOverlayImageEventListeners();
                } else {
                    console.error(`ğŸ”§ ì•¼êµ¬ ì¢…ëª©ë³„ Room ì°¸ì—¬ ì‹¤íŒ¨: ${data.error}`);
                }
            });
            
            if (typeof isListMode !== 'undefined' && isListMode && typeof listId !== 'undefined' && listId) { 
            // ë¦¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ëª¨ë“œì¼ ë•Œ ë¦¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ë°©ì—ë„ ì°¸ê°€
            socket.emit('join_list_overlay', '<%= listId %>');
            } 
        });
        
        socket.on('disconnect', () => {
            console.log('=== Socket.IO ì—°ê²° ëŠì–´ì§ (ì˜¤ë²„ë ˆì´) ===');
        });
        
        socket.on('connect_error', (error) => {
            console.error('=== Socket.IO ì—°ê²° ì˜¤ë¥˜ (ì˜¤ë²„ë ˆì´) ===', error);
        });

                // match_update ì´ë²¤íŠ¸ ì œê±°ë¨ - match_updated ì´ë²¤íŠ¸ë¡œ í†µí•©

// ê²½ê¸° ìˆ˜ì • ì´ë²¤íŠ¸
        socket.on('match_updated', (data) => {
            if (data.matchId === matchId) {
                console.log('ê²½ê¸° ìˆ˜ì • ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
                
                // íŒ€ëª… ì—…ë°ì´íŠ¸
                const homeTeamElement = document.getElementById('home-team-name');
                const awayTeamElement = document.getElementById('away-team-name');
                
                if (homeTeamElement && data.home_team) {
                    homeTeamElement.textContent = data.home_team;
                    console.log('í™ˆíŒ€ëª… ì—…ë°ì´íŠ¸:', data.home_team);
                }
                if (awayTeamElement && data.away_team) {
                    awayTeamElement.textContent = data.away_team;
                    console.log('ì›ì •íŒ€ëª… ì—…ë°ì´íŠ¸:', data.away_team);
                }
                
                // ì¢…ëª© ì—…ë°ì´íŠ¸ (í•„ìš”í•œ ê²½ìš°)
                if (data.sport_type && data.sport_type !== currentSportType) {
                    currentSportType = data.sport_type;
                    console.log('ì¢…ëª© ë³€ê²½ë¨:', currentSportType);
                }
                
                // ì•¼êµ¬ íŠ¹í™” ë°ì´í„° ì—…ë°ì´íŠ¸ (match_dataê°€ ìˆëŠ” ê²½ìš°)
                if (data.match_data) {
                    console.log('ğŸ”¥ ì•¼êµ¬ match_updated ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data.match_data);
                    console.log('ğŸ”¥ ì´ë‹:', data.match_data.current_inning, 'íƒ€ì…:', data.match_data.inning_type);
                    console.log('ğŸ”¥ ë² ì´ìŠ¤ ìƒíƒœ:', data.match_data.first_base, data.match_data.second_base, data.match_data.third_base);
                    console.log('ğŸ”¥ ë³¼ì¹´ìš´íŠ¸:', data.match_data.balls, 'ìŠ¤íŠ¸ë¼ì´í¬:', data.match_data.strikes, 'ì•„ì›ƒ:', data.match_data.outs);
                    
                    // ì ìˆ˜ ì—…ë°ì´íŠ¸ (ì´ë‹ë³„ ì ìˆ˜ í•©ê³„ë¡œ ê³„ì‚°)
                    let homeTotalScore = 0;
                    let awayTotalScore = 0;
                    
                    if (data.match_data?.innings) {
                        // ì´ë‹ë³„ ì ìˆ˜ í•©ê³„ ê³„ì‚°
                        for (let i = 1; i <= 9; i++) {
                            homeTotalScore += parseInt(data.match_data.innings[`home_${i}`] || '0');
                            awayTotalScore += parseInt(data.match_data.innings[`away_${i}`] || '0');
                        }
                    } else {
                        // ì´ë‹ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì„œë²„ ì ìˆ˜ ì‚¬ìš©
                        homeTotalScore = data.home_score || 0;
                        awayTotalScore = data.away_score || 0;
                    }
                    
                    const homeScoreEl = document.querySelector('.home-team .team-score');
                    if (homeScoreEl) homeScoreEl.textContent = homeTotalScore;
                    const awayScoreEl = document.querySelector('.away-team .team-score');
                    if (awayScoreEl) awayScoreEl.textContent = awayTotalScore;
                } else {
                    // match_dataê°€ ì—†ëŠ” ê²½ìš° ì„œë²„ ì ìˆ˜ ì‚¬ìš©
                    const homeScoreElement = document.querySelector('.home-team .team-score');
                    const awayScoreElement = document.querySelector('.away-team .team-score');
                    
                    if (homeScoreElement && data.home_score !== undefined) {
                        homeScoreElement.textContent = data.home_score;
                    }
                    if (awayScoreElement && data.away_score !== undefined) {
                        awayScoreElement.textContent = data.away_score;
                    }
                }
                
                // ì•¼êµ¬ íŠ¹í™” ë°ì´í„° ì—…ë°ì´íŠ¸ (match_dataê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ)
                if (data.match_data) {
                    // ì´ë‹ ì •ë³´ ì—…ë°ì´íŠ¸
                    const inningElement = document.querySelector('.current-inning');
                    if (inningElement && data.match_data.current_inning) {
                        console.log('ğŸ”¥ ì´ë‹ ìš”ì†Œ ì°¾ìŒ, ì—…ë°ì´íŠ¸:', data.match_data.current_inning);
                        // ì´ë‹ ë²ˆí˜¸ì™€ ì´ˆ/ë§ í‘œì‹œë¥¼ í•¨ê»˜ ì—…ë°ì´íŠ¸
                        inningElement.innerHTML = `
                            ${data.match_data.current_inning}
                            <div class="inning-indicator ${data.match_data.inning_type === 'bottom' ? 'bottom' : 'top'}"></div>
                        `;
                        console.log('ğŸ”¥ ì´ë‹ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸:', data.match_data.inning_type);
                    } else {
                        console.log('âŒ ì´ë‹ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    }
                    
                    // ë² ì´ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                    if (data.match_data.first_base !== undefined) {
                        const firstBase = document.querySelector('.base.first');
                        if (firstBase) {
                            firstBase.classList.toggle('active', data.match_data.first_base);
                            console.log('ğŸ”¥ 1ë£¨ ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸:', data.match_data.first_base);
                        }
                    }
                    if (data.match_data.second_base !== undefined) {
                        const secondBase = document.querySelector('.base.second');
                        if (secondBase) {
                            secondBase.classList.toggle('active', data.match_data.second_base);
                            console.log('ğŸ”¥ 2ë£¨ ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸:', data.match_data.second_base);
                        }
                    }
                    if (data.match_data.third_base !== undefined) {
                        const thirdBase = document.querySelector('.base.third');
                        if (thirdBase) {
                            thirdBase.classList.toggle('active', data.match_data.third_base);
                            console.log('ğŸ”¥ 3ë£¨ ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸:', data.match_data.third_base);
                        }
                    }
                    
                    // ë³¼/ìŠ¤íŠ¸ë¼ì´í¬/ì•„ì›ƒ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                    if (data.match_data.balls !== undefined) {
                        const ballDots = document.querySelectorAll('.count-dot.ball');
                        console.log('ğŸ”¥ ë³¼ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸:', data.match_data.balls, 'ê°œ ìš”ì†Œ:', ballDots.length);
                        ballDots.forEach((el, index) => {
                            el.classList.toggle('active', index < data.match_data.balls);
                        });
                    }
                    if (data.match_data.strikes !== undefined) {
                        const strikeDots = document.querySelectorAll('.count-dot.strike');
                        console.log('ğŸ”¥ ìŠ¤íŠ¸ë¼ì´í¬ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸:', data.match_data.strikes, 'ê°œ ìš”ì†Œ:', strikeDots.length);
                        strikeDots.forEach((el, index) => {
                            el.classList.toggle('active', index < data.match_data.strikes);
                        });
                    }
                    if (data.match_data.outs !== undefined) {
                        const outDots = document.querySelectorAll('.count-dot.out');
                        console.log('ğŸ”¥ ì•„ì›ƒ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸:', data.match_data.outs, 'ê°œ ìš”ì†Œ:', outDots.length);
                        outDots.forEach((el, index) => {
                            el.classList.toggle('active', index < data.match_data.outs);
                        });
                    }
                    
                    // íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ ì œëª© ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ (ì´ë‹ íƒ€ì…ì— ë”°ë¼)
                    const isTopInning = data.match_data.inning_type !== 'bottom';
                    const batterTitlePanel = document.querySelector('.batter-info .panel-title');
                    const pitcherTitlePanel = document.querySelector('.pitcher-info .panel-title');
                    
                    if (batterTitlePanel && pitcherTitlePanel) {
                        // íŒ€ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
                        const homeTeamSection = document.getElementById('home-team-section');
                        const awayTeamSection = document.getElementById('away-team-section');
                        const homeTeamColor = homeTeamSection ? homeTeamSection.style.backgroundColor : null;
                        const awayTeamColor = awayTeamSection ? awayTeamSection.style.backgroundColor : null;
                        
                        // íŒ€ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
                        const homeTeamName = '<%= match.home_team %>';
                        const awayTeamName = '<%= match.away_team %>';
                        
                        // ì´ë‹ íƒ€ì…ì— ë”°ë¼ íŒ¨ë„ ì œëª© ìƒ‰ìƒ ì„¤ì •
                        if (isTopInning) {
                            // ì´ˆ(top) ì´ë‹: í™ˆíŒ€ íƒ€ì, ì–´ì›¨ì´íŒ€ íˆ¬ìˆ˜
                            if (homeTeamColor) batterTitlePanel.style.backgroundColor = homeTeamColor;
                            if (awayTeamColor) pitcherTitlePanel.style.backgroundColor = awayTeamColor;
                            batterTitlePanel.textContent = homeTeamName;  // í™ˆíŒ€ íƒ€ì
                            pitcherTitlePanel.textContent = awayTeamName; // ì–´ì›¨ì´íŒ€ íˆ¬ìˆ˜
                            console.log('ì´ˆ ì´ë‹: í™ˆíŒ€ íƒ€ì, ì–´ì›¨ì´íŒ€ íˆ¬ìˆ˜');
                        } else {
                            // ë§(bottom) ì´ë‹: ì–´ì›¨ì´íŒ€ íƒ€ì, í™ˆíŒ€ íˆ¬ìˆ˜
                            if (awayTeamColor) batterTitlePanel.style.backgroundColor = awayTeamColor;
                            if (homeTeamColor) pitcherTitlePanel.style.backgroundColor = homeTeamColor;
                            batterTitlePanel.textContent = awayTeamName;  // ì–´ì›¨ì´íŒ€ íƒ€ì
                            pitcherTitlePanel.textContent = homeTeamName; // í™ˆíŒ€ íˆ¬ìˆ˜
                            console.log('ë§ ì´ë‹: ì–´ì›¨ì´íŒ€ íƒ€ì, í™ˆíŒ€ íˆ¬ìˆ˜');
                        }
                    }
                    
                    // ì„ ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
                    if (data.match_data.batter_name) {
                        const batterNameEl = document.querySelector('.batter-name');
                        if (batterNameEl) batterNameEl.textContent = data.match_data.batter_name;
                    }
                    if (data.match_data.batter_number) {
                        const batterNumberEl = document.querySelector('.batter-number');
                        if (batterNumberEl) batterNumberEl.textContent = data.match_data.batter_number;
                    }
                    if (data.match_data.pitcher_name) {
                        const pitcherNameEl = document.querySelector('.pitcher-name');
                        if (pitcherNameEl) pitcherNameEl.textContent = data.match_data.pitcher_name;
                    }
                    if (data.match_data.pitcher_number) {
                        const pitcherNumberEl = document.querySelector('.pitcher-number');
                        if (pitcherNumberEl) pitcherNumberEl.textContent = data.match_data.pitcher_number;
                    }
                    
                    // íŒ€ í†µê³„ ì—…ë°ì´íŠ¸
                    if (data.match_data.home_hits !== undefined) {
                        const homeHitsEl = document.querySelector('.home-hits');
                        if (homeHitsEl) homeHitsEl.textContent = data.match_data.home_hits;
                    }
                    if (data.match_data.away_hits !== undefined) {
                        const awayHitsEl = document.querySelector('.away-hits');
                        if (awayHitsEl) awayHitsEl.textContent = data.match_data.away_hits;
                    }
                    if (data.match_data.home_errors !== undefined) {
                        const homeErrorsEl = document.querySelector('.home-errors');
                        if (homeErrorsEl) homeErrorsEl.textContent = data.match_data.home_errors;
                    }
                    if (data.match_data.away_errors !== undefined) {
                        const awayErrorsEl = document.querySelector('.away-errors');
                        if (awayErrorsEl) awayErrorsEl.textContent = data.match_data.away_errors;
                    }
                    
                    // ì´ë‹ë³„ ì ìˆ˜ ì—…ë°ì´íŠ¸
                    if (data.match_data.innings) {
                        for (let i = 1; i <= 9; i++) {
                            const homeInningEl = document.querySelector(`.home-inning-${i}`);
                            const awayInningEl = document.querySelector(`.away-inning-${i}`);
                            
                            if (homeInningEl && data.match_data.innings[`home_${i}`] !== undefined) {
                                homeInningEl.textContent = data.match_data.innings[`home_${i}`];
                            }
                            if (awayInningEl && data.match_data.innings[`away_${i}`] !== undefined) {
                                awayInningEl.textContent = data.match_data.innings[`away_${i}`];
                            }
                        }
                    }
                }
            }
        });

        // ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì•¼êµ¬ëŠ” ì´ë‹ ì •ë³´)
        socket.on('timer_updated', (data) => {
            console.log('=== ì•¼êµ¬ ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ìˆ˜ì‹  ===');
            console.log('íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ë°ì´í„°:', data);
            
            if (data.matchId === matchId) {
                // ì•¼êµ¬ì—ì„œëŠ” ì´ë‹ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŒ
                // í•„ìš”ì— ë”°ë¼ ì´ë‹ ê´€ë ¨ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
                console.log('ì•¼êµ¬ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸:', data);
            }
        });


        // CSV íŒŒì¼ ì²˜ë¦¬ ë° íƒ€ìœ¨, ì¶œë£¨ìœ¨ ê³„ì‚° í•¨ìˆ˜
        function processPlayerCSV(csvData) {
            // CSV íŒŒì¼ íŒŒì‹± (íƒ­ìœ¼ë¡œ êµ¬ë¶„ëœ CSV)
            const lines = csvData.trim().split('\n');
            const headers = lines[0].split('\t').map(h => h.trim());
            const players = [];
            
            // ê° ë¼ì¸ì„ ì²˜ë¦¬í•˜ì—¬ ì„ ìˆ˜ ì •ë³´ ì¶”ì¶œ
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue; // ë¹ˆ ì¤„ ê±´ë„ˆë›°ê¸°
                
                const values = lines[i].split('\t').map(v => v.trim());
                const player = {};
                
                // í—¤ë”ì— ë”°ë¼ ê° ê°’ ë§¤í•‘
                headers.forEach((header, index) => {
                    player[header] = values[index] || '';
                });
                
                // ë°ì´í„° ìˆ«ì í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const atBats = parseInt(player['íƒ€ìˆ˜'] || 0);
                const hits = parseInt(player['ì•ˆíƒ€'] || 0);
                const homeRuns = parseInt(player['í™ˆëŸ°'] || 0);
                const rbi = parseInt(player['íƒ€ì '] || 0);
                const steals = parseInt(player['ë„ë£¨'] || 0);
                
                // ì¶”ê°€ í†µê³„ (CSVì—ëŠ” ì—†ì§€ë§Œ ê³„ì‚°ì— í•„ìš”)
                const walks = parseInt(player['ë³¼ë„·'] || 0);  // ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°€ì •
                const hbp = parseInt(player['ì‚¬êµ¬'] || 0);     // ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°€ì •
                const sf = parseInt(player['í¬ìƒí”Œë¼ì´'] || 0); // ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°€ì •
                
                // íƒ€ìœ¨ ê³„ì‚° (ì•ˆíƒ€ / íƒ€ìˆ˜)
                if (atBats > 0) {
                    player['íƒ€ìœ¨'] = (hits / atBats).toFixed(3).substring(1);  // ì•ì˜ 0 ì œê±°, ì†Œìˆ˜ì  3ìë¦¬ê¹Œì§€
                    if (!player['íƒ€ìœ¨'].startsWith('.')) player['íƒ€ìœ¨'] = '.' + player['íƒ€ìœ¨'];  // ì•ì— ì  ì¶”ê°€
                } else {
                    player['íƒ€ìœ¨'] = '.000';
                }
                
                // ì¶œë£¨ìœ¨ ê³„ì‚° (ì•ˆíƒ€ + ë³¼ë„· + ì‚¬êµ¬) / (íƒ€ìˆ˜ + ë³¼ë„· + ì‚¬êµ¬ + í¬ìƒí”Œë¼ì´)
                const onBaseNumerator = hits + walks + hbp;
                const onBaseDenominator = atBats + walks + hbp + sf;
                
                if (onBaseDenominator > 0) {
                    player['ì¶œë£¨ìœ¨'] = (onBaseNumerator / onBaseDenominator).toFixed(3).substring(1);
                    if (!player['ì¶œë£¨ìœ¨'].startsWith('.')) player['ì¶œë£¨ìœ¨'] = '.' + player['ì¶œë£¨ìœ¨'];
                } else {
                    player['ì¶œë£¨ìœ¨'] = '.000';
                }
                
                // ì¶”ê°€ ê°’ í™•ì¸
                if (!player['ë²ˆí˜¸']) player['ë²ˆí˜¸'] = i.toString();
                if (!player['ì´ë¦„']) player['ì´ë¦„'] = `ì„ ìˆ˜${i}`;
                if (!player['í¬ì§€ì…˜']) player['í¬ì§€ì…˜'] = 'ë¯¸ì •';
                
                players.push(player);
            }
            
            return players;
        }
        
        // ì„ ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('playerDataUpdated', function(data) {
            if (data.matchId === matchId) {
                console.log('ì„ ìˆ˜ ë°ì´í„° ì—…ë°ì´íŠ¸:', data);
                
                if (data.playerDataUrl) {
                    // JSON íŒŒì¼ì—ì„œ ì„ ìˆ˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    fetch(data.playerDataUrl)
                        .then(response => response.json())
                        .then(playerData => {
                            // ì „ì—­ ë³€ìˆ˜ì— ì„ ìˆ˜ ë°ì´í„° ì €ì¥
                            window.playerData = playerData.players;
                            
                            console.log('ì„ ìˆ˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', playerData.players.length, 'ëª…');
                            
                            // í˜„ì¬ íƒ€ì/íˆ¬ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
                            if (data.batterIndex && playerData.players[data.batterIndex - 1]) {
                                const batter = playerData.players[data.batterIndex - 1];
                                updatePlayerInfo('.batter-info', batter);
                            }
                            
                            if (data.pitcherIndex && playerData.players[data.pitcherIndex - 1]) {
                                const pitcher = playerData.players[data.pitcherIndex - 1];
                                updatePlayerInfo('.pitcher-info', pitcher);
                            }
                        })
                        .catch(error => {
                            console.error('ì„ ìˆ˜ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                        });
                } else if (data.csvData) {
                    try {
                        // CSV ë°ì´í„° ì²˜ë¦¬ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
                        const players = processPlayerCSV(data.csvData);
                        
                        // ì „ì—­ ë³€ìˆ˜ì— ì„ ìˆ˜ ë°ì´í„° ì €ì¥ (ë‚˜ì¤‘ì— ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡)
                        window.playerData = players;
                        
                        console.log('ì„ ìˆ˜ ë°ì´í„° íŒŒì‹± ì™„ë£Œ:', players.length, 'ëª…');
                        
                        // í˜„ì¬ íƒ€ì/íˆ¬ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
                        if (data.batterIndex && players[data.batterIndex - 1]) {
                            const batter = players[data.batterIndex - 1];
                            updatePlayerInfo('.batter-info', batter);
                        }
                        
                        if (data.pitcherIndex && players[data.pitcherIndex - 1]) {
                            const pitcher = players[data.pitcherIndex - 1];
                            updatePlayerInfo('.pitcher-info', pitcher);
                        }
                    } catch (error) {
                        console.error('ì„ ìˆ˜ ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    }
                }
            }
        });
        
        // ì„ ìˆ˜ ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePlayerInfo(panelSelector, player) {
            const panel = document.querySelector(panelSelector);
            if (!panel) return;
            
            // ì„ ìˆ˜ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
            const numberElement = panel.querySelector('.player-number');
            if (numberElement) numberElement.textContent = player['ë²ˆí˜¸'] || '';
            
            // ì„ ìˆ˜ ì´ë¦„ ì—…ë°ì´íŠ¸
            const nameElement = panel.querySelector('.player-name');
            if (nameElement) nameElement.textContent = player['ì´ë¦„'] || '';
            
            // í¬ì§€ì…˜ ì—…ë°ì´íŠ¸
            const positionElement = panel.querySelector('.player-position');
            if (positionElement) positionElement.textContent = player['í¬ì§€ì…˜'] || '';
            
            // íƒ€ì ì •ë³´ì¸ ê²½ìš° í†µê³„ ì—…ë°ì´íŠ¸
            if (panelSelector === '.batter-info') {
                const stats = panel.querySelectorAll('.stat-item');
                if (stats.length >= 4) {
                    // íƒ€ìœ¨, í™ˆëŸ°, íƒ€ì , ì¶œë£¨ìœ¨ ì—…ë°ì´íŠ¸
                    stats[0].querySelector('.stat-value').textContent = player['íƒ€ìœ¨'] || '.000';
                    stats[1].querySelector('.stat-value').textContent = player['í™ˆëŸ°'] || '0';
                    stats[2].querySelector('.stat-value').textContent = player['íƒ€ì '] || '0';
                    stats[3].querySelector('.stat-value').textContent = player['ì¶œë£¨ìœ¨'] || '.000';
                }
            } 
            // íˆ¬ìˆ˜ ì •ë³´ì¸ ê²½ìš° í†µê³„ ì—…ë°ì´íŠ¸
            else if (panelSelector === '.pitcher-info') {
                const stats = panel.querySelectorAll('.stat-item');
                if (stats.length >= 4) {
                    // í‰ê· ìì±…ì , ìŠ¹íŒ¨, íˆ¬êµ¬ ìˆ˜, íƒˆì‚¼ì§„ ì—…ë°ì´íŠ¸
                    // íˆ¬ìˆ˜ ê´€ë ¨ í†µê³„ëŠ” CSVì— ì—†ì„ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’ ìœ ì§€
                    if (player['í‰ê· ìì±…ì ']) stats[0].querySelector('.stat-value').textContent = player['í‰ê· ìì±…ì '];
                    if (player['ìŠ¹íŒ¨']) stats[1].querySelector('.stat-value').textContent = player['ìŠ¹íŒ¨'];
                    if (player['íˆ¬êµ¬ìˆ˜']) stats[2].querySelector('.stat-value').textContent = player['íˆ¬êµ¬ìˆ˜'];
                    if (player['íƒˆì‚¼ì§„']) stats[3].querySelector('.stat-value').textContent = player['íƒˆì‚¼ì§„'];
                }
            }
        }

        // í˜„ì¬ íƒ€ì/íˆ¬ìˆ˜ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('currentPlayerChanged', function(data) {
            if (data.matchId === matchId) {
                console.log('í˜„ì¬ íƒ€ì/íˆ¬ìˆ˜ ë³€ê²½:', data);
                
                // ì„ ìˆ˜ ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆëŠ” ê²½ìš° ì²˜ë¦¬
                if (window.playerData) {
                    const players = window.playerData;
                    
                    // íƒ€ì ì •ë³´ ì—…ë°ì´íŠ¸
                    if (data.batterIndex && players[data.batterIndex - 1]) {
                        const batter = players[data.batterIndex - 1];
                        updatePlayerInfo('.batter-info', batter);
                    }
                    
                    // íˆ¬ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
                    if (data.pitcherIndex && players[data.pitcherIndex - 1]) {
                        const pitcher = players[data.pitcherIndex - 1];
                        updatePlayerInfo('.pitcher-info', pitcher);
                    }
                }
            }
        });

        // ë””ìì¸ ì„¤ì • ë¡œë“œ ë° ì ìš© í•¨ìˆ˜
        async function loadDesignSettings() {
            try {
                const response = await fetch('/api/sport-overlay-design/BASEBALL');
                const result = await response.json();
                
                if (result.success) {
                    const design = result.design;
                    
                    // ìŠ¤ì½”ì–´ë³´ë“œ ìœ„ì¹˜ ì ìš© (ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ìœ„ì¹˜ë¡œ ì„¤ì •)
                    const scoreboard = document.querySelector('.scoreboard');
                    if (scoreboard) {
                        scoreboard.style.position = 'fixed';
                        scoreboard.style.bottom = '20px';
                        scoreboard.style.right = '250px';
                        scoreboard.style.top = 'auto';
                        scoreboard.style.left = 'auto';
                    }
                    
                    // í™ˆíŒ€ ë¡œê³  ìœ„ì¹˜ ì ìš© (ì•¼êµ¬ëŠ” team-info.home-team ì‚¬ìš©)
                    const homeLogo = document.querySelector('.team-info.home-team');
                    if (homeLogo && design.homeLogo) {
                        homeLogo.style.top = `${design.homeLogo.top}px`;
                        if (design.homeLogo.left !== undefined) {
                            homeLogo.style.left = `${design.homeLogo.left}px`;
                        }
                        if (design.homeLogo.right !== undefined) {
                            homeLogo.style.right = `${design.homeLogo.right}px`;
                        }
                    }
                    
                    // ì–´ì›¨ì´íŒ€ ë¡œê³  ìœ„ì¹˜ ì ìš© (ì•¼êµ¬ëŠ” team-info.away-team ì‚¬ìš©)
                    const awayLogo = document.querySelector('.team-info.away-team');
                    if (awayLogo && design.awayLogo) {
                        awayLogo.style.top = `${design.awayLogo.top}px`;
                        if (design.awayLogo.left !== undefined) {
                            awayLogo.style.left = `${design.awayLogo.left}px`;
                        }
                        if (design.awayLogo.right !== undefined) {
                            awayLogo.style.right = `${design.awayLogo.right}px`;
                        }
                    }
                    
                    // ê²½ê¸° ìƒíƒœ ìœ„ì¹˜ ì ìš©
                    const matchState = document.querySelector('.current-inning');
                    if (matchState && design.matchState) {
                        matchState.style.top = `${design.matchState.top}px`;
                        if (design.matchState.left !== undefined) {
                            matchState.style.left = `${design.matchState.left}px`;
                        }
                        if (design.matchState.right !== undefined) {
                            matchState.style.right = `${design.matchState.right}px`;
                        }
                    }
                    
                    // í™ˆíŒ€ ë¼ì¸ì—… ìœ„ì¹˜ ì ìš©
                    const homeLineup = document.querySelector('.batter-info');
                    if (homeLineup && design.homeLineup) {
                        homeLineup.style.top = `${design.homeLineup.top}px`;
                        if (design.homeLineup.left !== undefined) {
                            homeLineup.style.left = `${design.homeLineup.left}px`;
                        }
                        if (design.homeLineup.right !== undefined) {
                            homeLineup.style.right = `${design.homeLineup.right}px`;
                        }
                    }
                    
                    // ì–´ì›¨ì´íŒ€ ë¼ì¸ì—… ìœ„ì¹˜ ì ìš©
                    const awayLineup = document.querySelector('.pitcher-info');
                    if (awayLineup && design.awayLineup) {
                        awayLineup.style.top = `${design.awayLineup.top}px`;
                        if (design.awayLineup.left !== undefined) {
                            awayLineup.style.left = `${design.awayLineup.left}px`;
                        }
                        if (design.awayLineup.right !== undefined) {
                            awayLineup.style.right = `${design.awayLineup.right}px`;
                        }
                    }
                    
                    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìœ„ì¹˜ ì ìš©
                    const overlayImage = document.getElementById('overlayImage');
                    if (overlayImage && design.overlayImage) {
                        overlayImage.style.top = `${design.overlayImage.top}px`;
                        if (design.overlayImage.left !== undefined) {
                            overlayImage.style.left = `${design.overlayImage.left}px`;
                        }
                        if (design.overlayImage.width !== undefined) {
                            overlayImage.style.width = `${design.overlayImage.width}px`;
                        }
                        if (design.overlayImage.height !== undefined) {
                            overlayImage.style.height = `${design.overlayImage.height}px`;
                        }
                    }
                    
                    // íƒ€ì´ë¨¸ ìœ„ì¹˜ ì ìš©
                    const timer = document.querySelector('.match-time');
                    if (timer && design.timer) {
                        if (design.timer.marginLeft !== undefined) {
                            timer.style.marginLeft = `${design.timer.marginLeft}px`;
                        }
                    }
                    
                    console.log('ì•¼êµ¬ ë””ìì¸ ì„¤ì • ì ìš© ì™„ë£Œ');
                }
            } catch (error) {
                console.error('ì•¼êµ¬ ë””ìì¸ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ í•¨ìˆ˜ (í™œì„±í™”ëœ ëª¨ë“  ì´ë¯¸ì§€ í‘œì‹œ)
    // í•œê¸€ íŒŒì¼ëª… ë””ì½”ë”© í•¨ìˆ˜ (ë¸Œë¼ìš°ì € í˜¸í™˜ ë²„ì „)
    function decodeKoreanFilename(filename) {
        try {
            // ê¹¨ì§„ íŒŒì¼ëª…ì¸ì§€ í™•ì¸
            if (filename.includes('Ã¬') || filename.includes('Ã«') || filename.includes('Ã­') || 
                filename.includes('Ã¢') || filename.includes('Ãª') || filename.includes('Ã´')) {
                
                // ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œ í•œê¸€ íŒŒì¼ëª… ë””ì½”ë”©
                let decoded = filename;
                try {
                    // URL ë””ì½”ë”© ì‹œë„
                    decoded = decodeURIComponent(filename);
                } catch (e) {
                    // URL ë””ì½”ë”© ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë°˜í™˜
                    console.log(`ğŸ”§ URL ë””ì½”ë”© ì‹¤íŒ¨, ì›ë³¸ ì‚¬ìš©: ${filename}`);
                    return filename;
                }
                
                console.log(`ğŸ”§ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ëª… ë””ì½”ë”©: ${filename} -> ${decoded}`);
                return decoded;
            }
            return filename;
        } catch (error) {
            console.error('ğŸ”§ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ëª… ë””ì½”ë”© ì‹¤íŒ¨:', error);
            return filename;
        }
    }

    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ í•¨ìˆ˜ (ì•¼êµ¬ìš©)
    function registerOverlayImageEventListeners() {
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡');
        
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        socket.off('overlay_image_status_changed');
        socket.off('overlay_page_refresh');
        
        // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì¬ë“±ë¡)
        socket.on('overlay_image_status_changed', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ (ì¬ë“±ë¡):', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ (window.matchData ì‚¬ìš©)
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ì¼ì¹˜, ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘ (ì¬ë“±ë¡)');
                
                if (data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì¶”ê°€ í‘œì‹œ
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í™œì„±í™” (ì¬ë“±ë¡):', data.imageData);
                    addOverlayImage(data.imageData);
                } else if (!data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ ë¹„í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì œê±°
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¹„í™œì„±í™” (ì¬ë“±ë¡):', data.imageData);
                    removeOverlayImage(data.imageData.id);
                }
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜, Room ì¬ì°¸ì—¬ ì‹œë„ (ì¬ë“±ë¡)');
                // ìŠ¤í¬ì¸  íƒ€ì…ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ Room ì¬ì°¸ì—¬ ì‹œë„
                if (window.matchData?.sport_type) {
                    console.log('ğŸ”§ ì•¼êµ¬ Room ì¬ì°¸ì—¬ ìš”ì²­ (ì¬ë“±ë¡):', window.matchData.sport_type);
                    socket.emit('join_sport_room', window.matchData.sport_type);
                }
            }
        });

        // ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì¬ë“±ë¡)
        socket.on('overlay_page_refresh', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹ í˜¸ ìˆ˜ì‹  (ì¬ë“±ë¡):', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ì¬ë“±ë¡):', data.reason);
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                location.reload();
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ (ì¬ë“±ë¡)');
                // ëŒ€ì•ˆ: window.matchDataê°€ ì—†ì„ ë•Œë„ ìƒˆë¡œê³ ì¹¨ (ë””ë²„ê¹…ìš©)
                if (!window.matchData) {
                    console.log('ğŸ”§ ì•¼êµ¬ window.matchDataê°€ ì—†ì–´ì„œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ì¬ë“±ë¡)');
                    location.reload();
                }
            }
        });
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ ì™„ë£Œ');
    }

    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì¶”ê°€ í•¨ìˆ˜ (ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›) - ì•¼êµ¬ìš©
    function addOverlayImage(imageData) {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì¶”ê°€:', imageData);
        
        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€ì¸ì§€ í™•ì¸
        const existingImg = overlayImageContainer.querySelector(`[data-image-id="${imageData.id}"]`);
        if (existingImg) {
            console.log('ğŸ”§ ì•¼êµ¬ ì´ë¯¸ì§€ê°€ ì´ë¯¸ ì¡´ì¬í•¨:', imageData.id);
            return;
        }
        
        const img = document.createElement('img');
        img.setAttribute('data-image-id', imageData.id);
        
        // íŒŒì¼ ê²½ë¡œì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ ë° ë””ì½”ë”©
        const pathParts = imageData.file_path.split('/');
        const filename = pathParts[pathParts.length - 1];
        const decodedFilename = decodeKoreanFilename(filename);
        const decodedPath = imageData.file_path.replace(filename, decodedFilename);
        
        img.src = decodedPath;
        img.alt = 'ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        img.style.position = 'absolute';
        img.style.top = '0';
        img.style.left = '0';
        img.style.zIndex = '1';
        
        img.onload = () => {
            overlayImageContainer.appendChild(img);
            overlayImageContainer.classList.add('show');
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì¶”ê°€ ì™„ë£Œ:', imageData.id);
        };
        
        img.onerror = (error) => {
            console.error('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
        };
    }
    
    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜ (ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›) - ì•¼êµ¬ìš©
    function removeOverlayImage(imageId) {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì œê±°:', imageId);
        
        const imgToRemove = overlayImageContainer.querySelector(`[data-image-id="${imageId}"]`);
        if (imgToRemove) {
            imgToRemove.remove();
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì œê±° ì™„ë£Œ:', imageId);
            
            // ëª¨ë“  ì´ë¯¸ì§€ê°€ ì œê±°ë˜ì—ˆìœ¼ë©´ ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€
            const remainingImages = overlayImageContainer.querySelectorAll('img');
            if (remainingImages.length === 0) {
                overlayImageContainer.classList.remove('show');
            }
        }
    }
    
    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í‘œì‹œ í•¨ìˆ˜ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©) - ì•¼êµ¬ìš©
    function displayOverlayImage(imageData) {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í‘œì‹œ:', imageData);
        
        // ê¸°ì¡´ ì´ë¯¸ì§€ ì œê±°
        overlayImageContainer.innerHTML = '';
        
        const img = document.createElement('img');
        // íŒŒì¼ ê²½ë¡œì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ ë° ë””ì½”ë”©
        const pathParts = imageData.file_path.split('/');
        const filename = pathParts[pathParts.length - 1];
        const decodedFilename = decodeKoreanFilename(filename);
        const decodedPath = imageData.file_path.replace(filename, decodedFilename);
        
        img.src = decodedPath;
        img.alt = 'ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        img.style.position = 'absolute';
        img.style.top = '0';
        img.style.left = '0';
        img.style.zIndex = '1';
        
        img.onload = () => {
            overlayImageContainer.appendChild(img);
            overlayImageContainer.classList.add('show');
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ');
        };
        
        img.onerror = (error) => {
            console.error('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
            overlayImageContainer.classList.remove('show');
        };
    }
    
    // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìˆ¨ê¹€ í•¨ìˆ˜ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©) - ì•¼êµ¬ìš©
    function hideOverlayImage() {
        const overlayImageContainer = document.getElementById('overlayImage');
        if (!overlayImageContainer) return;
        
        console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìˆ¨ê¹€');
        overlayImageContainer.classList.remove('show');
        overlayImageContainer.innerHTML = '';
    }

    async function loadOverlayImage() {
        try {
            console.log('ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘...');
                
                // ê²½ê¸° ì •ë³´ì—ì„œ ì¢…ëª© ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
                const matchResponse = await fetch(`/api/matches/${matchId}`);
                if (!matchResponse.ok) {
                    console.error('ê²½ê¸° ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const matchData = await matchResponse.json();
                const sportCode = matchData.sport_type.toUpperCase();
                console.log('ì¢…ëª© ì½”ë“œ:', sportCode);
                
                // ì¢…ëª©ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì¢…ëª©ëª… ëŒ€ì‹ )
                const sportCodeForPath = sportCode;
                console.log('ì¢…ëª©ì½”ë“œ:', sportCodeForPath);
                
                // í•´ë‹¹ ì¢…ëª©ì˜ í™œì„±í™”ëœ ì´ë¯¸ì§€ ì¡°íšŒ
                const response = await fetch(`/api/overlay-images/active/${sportCode}`);
                const result = await response.json();
                
                console.log('ì•¼êµ¬ í™œì„±í™”ëœ ì´ë¯¸ì§€ ëª©ë¡ ì¡°íšŒ ê²°ê³¼:', result);
                
                const overlayImageContainer = document.getElementById('overlayImage');
                
                if (result.success && result.images && result.images.length > 0) {
                    console.log('ğŸ”§ ì•¼êµ¬ í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤:', result.images);
                    
                    // ëª¨ë“  í™œì„±í™”ëœ ì´ë¯¸ì§€ë¥¼ í‘œì‹œ
                    overlayImageContainer.innerHTML = '';
                    
                    result.images.forEach((image, index) => {
                        const img = document.createElement('img');
                        img.setAttribute('data-image-id', image.id);
                        
                        // ì¢…ëª©ì½”ë“œ ê¸°ë°˜ ê²½ë¡œë¡œ ì§ì ‘ êµ¬ì„±
                        const filename = image.filename;
                        const decodedFilename = decodeKoreanFilename(filename);
                        const imagePath = `/overlay-images/${sportCodeForPath}/${decodedFilename}`;
                        
                        console.log(`ğŸ”§ ì•¼êµ¬ ì´ë¯¸ì§€ ê²½ë¡œ êµ¬ì„±: ${imagePath}`);
                        img.src = imagePath;
                        img.alt = `ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ${index + 1}`;
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.objectFit = 'cover';
                        img.style.position = 'absolute';
                        img.style.top = '0';
                        img.style.left = '0';
                        img.style.zIndex = 1000 + index;
                        
                        img.onload = () => {
                            overlayImageContainer.appendChild(img);
                            overlayImageContainer.style.display = 'block';
                            console.log(`ì•¼êµ¬ í™œì„±í™”ëœ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ${index + 1} ë¡œë“œë¨:`, image.file_path);
                        };
                        
                        img.onerror = (error) => {
                            console.error(`ì•¼êµ¬ í™œì„±í™”ëœ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ${index + 1} ë¡œë“œ ì‹¤íŒ¨:`, error);
                        };
                    });
                } else {
                    overlayImageContainer.style.display = 'none';
                    console.log('ì•¼êµ¬ í™œì„±í™”ëœ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
        } catch (error) {
            console.error('ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
            document.getElementById('overlayImage').style.display = 'none';
        }
    }

        // ì´ˆê¸° íŒ€ ìƒ‰ìƒ ì„¤ì •
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // ë””ìì¸ ì„¤ì • ë¡œë“œ ë° ì ìš©
                await loadDesignSettings();
                
                // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¡œë“œ
                await loadOverlayImage();
                
                // íŒ€ ë¡œê³  ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì¶•êµ¬ì™€ ë™ì¼í•œ ë°©ì‹)
                const response = await fetch(`/api/matches/${matchId}/team-logos`);
                if (!response.ok) {
                    throw new Error(`íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
                }
                const result = await response.json();
                console.log('íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ ì„±ê³µ:', result);
                
                // í™ˆíŒ€ ë¡œê³  ì„¤ì •
                const homeTeamName = '<%= match.home_team %>';
                if (result.success && result.teamLogos) {
                    const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                    if (homeTeamInfo && homeTeamInfo.logo_path) {
                        const homeLogoContainer = document.querySelector('.team-info.home-team .team-logo-container');
                        if (homeLogoContainer) {
                            homeLogoContainer.style.backgroundColor = homeTeamInfo.logo_bg_color || '#ffffff';
                            homeLogoContainer.innerHTML = `
                                <img src="${homeTeamInfo.logo_path}" alt="${homeTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain;">
                            `;
                        }
                    }
                }
                
                // ì›ì •íŒ€ ë¡œê³  ì„¤ì •
                const awayTeamName = '<%= match.away_team %>';
                if (result.success && result.teamLogos) {
                    const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                    if (awayTeamInfo && awayTeamInfo.logo_path) {
                        const awayLogoContainer = document.querySelector('.team-info.away-team .team-logo-container');
                        if (awayLogoContainer) {
                            awayLogoContainer.style.backgroundColor = awayTeamInfo.logo_bg_color || '#ffffff';
                            awayLogoContainer.innerHTML = `
                                <img src="${awayTeamInfo.logo_path}" alt="${awayTeamName} ë¡œê³ " style="width: 100%; height: 100%; object-fit: contain;">
                            `;
                        }
                    }
                }

                // íŒ€ ì»¬ëŸ¬ ì •ë³´ ë¡œë“œ ë° ì ìš© (DBì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
                const homeTeamSection = document.getElementById('home-team-section');
                const awayTeamSection = document.getElementById('away-team-section');
                
                if (result.success && result.teamLogos) {
                    // í™ˆíŒ€ ì»¬ëŸ¬ ì ìš©
                    const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                    if (homeTeamInfo && homeTeamInfo.team_color && homeTeamSection) {
                        homeTeamSection.style.backgroundColor = homeTeamInfo.team_color;
                        console.log(`ğŸ”§ í™ˆíŒ€ ì»¬ëŸ¬ ì ìš© (ì´ˆê¸° ë¡œë“œ): ${homeTeamName} -> ${homeTeamInfo.team_color}`);
                    }
                    
                    // ì›ì •íŒ€ ì»¬ëŸ¬ ì ìš©
                    const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                    if (awayTeamInfo && awayTeamInfo.team_color && awayTeamSection) {
                        awayTeamSection.style.backgroundColor = awayTeamInfo.team_color;
                        console.log(`ğŸ”§ ì›ì •íŒ€ ì»¬ëŸ¬ ì ìš© (ì´ˆê¸° ë¡œë“œ): ${awayTeamName} -> ${awayTeamInfo.team_color}`);
                    }
                    
                    // íŒ€ ì»¬ëŸ¬ ì ìš© í›„ íŒ¨ë„ íƒ€ì´í‹€ ì´ˆê¸°í™”
                    setTimeout(() => {
                        const inningType = document.querySelector('.inning-indicator')?.classList.contains('bottom') ? 'bottom' : 'top';
                        updatePanelTitles(inningType);
                        console.log('ğŸ”§ ì´ˆê¸° ë¡œë“œ í›„ íŒ¨ë„ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    }, 100);
                } else {
                    // íŒ€ ë¡œê³  ì •ë³´ê°€ ì—†ëŠ” ê²½ìš°ì—ë„ íŒ¨ë„ íƒ€ì´í‹€ ì´ˆê¸°í™”
                    const inningType = document.querySelector('.inning-indicator')?.classList.contains('bottom') ? 'bottom' : 'top';
                    updatePanelTitles(inningType);
                }
                
            } catch (error) {
                console.error('íŒ€ ë¡œê³  ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        });


        // ìƒ‰ìƒì„ íˆ¬ëª…ë„ê°€ ìˆëŠ” ìƒ‰ìƒìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function convertToTransparentColor(color, alpha) {
            // RGB ë˜ëŠ” RGBA í˜•ì‹ì¸ ê²½ìš°
            if (color.startsWith('rgb')) {
                const rgbValues = color.match(/\d+/g);
                if (rgbValues && rgbValues.length >= 3) {
                    return `rgba(${rgbValues[0]}, ${rgbValues[1]}, ${rgbValues[2]}, ${alpha})`;
                }
            }
            
            // HEX í˜•ì‹ì¸ ê²½ìš°
            if (color.startsWith('#')) {
                const r = parseInt(color.substr(1, 2), 16);
                const g = parseInt(color.substr(3, 2), 16);
                const b = parseInt(color.substr(5, 2), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            // ê¸°ë³¸ê°’ìœ¼ë¡œ ê²€ì€ìƒ‰ ë°˜íˆ¬ëª… ë°°ê²½ ë°˜í™˜
            return `rgba(0, 0, 0, ${alpha})`;
        }

        // íŒ€ëª… ê¸¸ì´ì— ë”°ë¥¸ í°íŠ¸ í¬ê¸° ì¡°ì ˆ
        function adjustTeamNameSize() {
            try {
                const homeTeamHeader = document.querySelector('.team-section .team-info:first-child .team-header');
                const awayTeamHeader = document.querySelector('.team-section .team-info:last-child .team-header');
                
                if (!homeTeamHeader || !awayTeamHeader) {
                    console.error('íŒ€ í—¤ë” ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return;
                }
                
                function adjustSize(element) {
                    const text = element.textContent;
                    console.log('íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ:', {
                        team: element.closest('.team-info').classList.contains('home-team') ? 'í™ˆíŒ€' : 'ì›ì •íŒ€',
                        text,
                        length: text.length
                    });
                    
                    // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
                    element.classList.remove('long', 'very-long');
                    
                    // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ í´ë˜ìŠ¤ ì¶”ê°€
                    if (text.length > 10) {
                        element.classList.add('very-long');
                        console.log('ë§¤ìš° ê¸´ í…ìŠ¤íŠ¸ ì ìš©');
                    } else if (text.length > 8) {
                        element.classList.add('long');
                        console.log('ê¸´ í…ìŠ¤íŠ¸ ì ìš©');
                    }
                }
                
                adjustSize(homeTeamHeader);
                adjustSize(awayTeamHeader);
                
                console.log('íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ ì™„ë£Œ');
            } catch (error) {
                console.error('íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }
        
        // íŒ€ëª… ì—…ë°ì´íŠ¸ ì‹œ í¬ê¸° ì¡°ì ˆ
        socket.on('teamHeaderChanged', function(data) {
            if (data.matchId === matchId) {
                const homeTeamHeader = document.querySelector('.team-section .team-info:first-child .team-header');
                const awayTeamHeader = document.querySelector('.team-section .team-info:last-child .team-header');
                
                if (homeTeamHeader) homeTeamHeader.textContent = data.homeHeader;
                if (awayTeamHeader) awayTeamHeader.textContent = data.awayHeader;
                
                adjustTeamNameSize();
            }
        });
        

        // íŒ€ ë¡œê³  ì‚­ì œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamLogoRemoved', function(data) {
            if (data.matchId === matchId) {
                const teamType = data.teamType || data.team;
                
                console.log('íŒ€ ë¡œê³  ì‚­ì œ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', {
                    teamType,
                    matchId: data.matchId
                });
                
                const logoContainer = document.querySelector(`.team-info.${teamType}-team .team-logo-container`);
                if (logoContainer) {
                    logoContainer.innerHTML = `<div class="team-logo-placeholder"></div>`;
                    console.log(`${teamType}íŒ€ ë¡œê³  ì‚­ì œ ì™„ë£Œ`);
                } else {
                    console.error(`${teamType}íŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
        });
        
        // íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamColorUpdate', function(data) {
            if (data.matchId === matchId) {
                const teamType = data.teamType;
                const teamColor = data.teamColor;
                
                console.log('íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', {
                    teamType,
                    teamColor,
                    matchId: data.matchId
                });
                
                const teamSection = document.getElementById(`${teamType}-team-section`);
                if (teamSection) {
                    teamSection.style.backgroundColor = teamColor;
                    console.log(`${teamType}íŒ€ ì„¹ì…˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸:`, {
                        section: teamSection,
                        color: teamColor,
                        appliedColor: teamSection.style.backgroundColor
                    });
                    
                    // íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ì˜ ìƒ‰ìƒë„ ì—…ë°ì´íŠ¸
                    const inningType = document.querySelector('.inning-indicator').classList.contains('bottom') ? 'bottom' : 'top';
                    updatePanelTitles(inningType);
                } else {
                    console.error(`${teamType}íŒ€ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
        });

        // ì´ë‹ íƒ€ì…ì— ë”°ë¼ íŒ¨ë„ íƒ€ì´í‹€ ë³€ê²½ í•¨ìˆ˜
        function updatePanelTitles(inningType) {
            try {
                const homeTeamName = document.querySelector('.team-info.home-team .team-header')?.textContent || 'HOME';
                const awayTeamName = document.querySelector('.team-info.away-team .team-header')?.textContent || 'AWAY';
                const batterPanel = document.querySelector('.batter-info .panel-title');
                const pitcherPanel = document.querySelector('.pitcher-info .panel-title');
                
                if (!batterPanel || !pitcherPanel) {
                    console.error('íŒ¨ë„ íƒ€ì´í‹€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return;
                }
                
                // íŒ€ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
                const homeTeamSection = document.getElementById('home-team-section');
                const awayTeamSection = document.getElementById('away-team-section');
                
                if (!homeTeamSection || !awayTeamSection) {
                    console.error('íŒ€ ì„¹ì…˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return;
                }
                
                // íŒ€ ì»¬ëŸ¬ ê°€ì ¸ì˜¤ê¸° (styleì—ì„œ ê°€ì ¸ì˜¤ë˜, ì—†ìœ¼ë©´ computed styleì—ì„œ ê°€ì ¸ì˜¤ê¸°)
                const homeTeamColor = homeTeamSection.style.backgroundColor || 
                                     window.getComputedStyle(homeTeamSection).backgroundColor || 
                                     null;
                const awayTeamColor = awayTeamSection.style.backgroundColor || 
                                     window.getComputedStyle(awayTeamSection).backgroundColor || 
                                     null;
                
                console.log('íŒ¨ë„ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸:', {
                    inningType,
                    homeTeamName,
                    awayTeamName,
                    homeTeamColor,
                    awayTeamColor
                });
                
                if (inningType === 'top') {
                    // ì´ˆ(top) ì´ë‹: í™ˆíŒ€ íƒ€ì, ì–´ì›¨ì´íŒ€ íˆ¬ìˆ˜
                    if (homeTeamColor) batterPanel.style.backgroundColor = homeTeamColor;
                    if (awayTeamColor) pitcherPanel.style.backgroundColor = awayTeamColor;
                    
                    // íŒ¨ë„ ì œëª©ì„ íŒ€ëª…ìœ¼ë¡œ ë³€ê²½
                    batterPanel.textContent = homeTeamName;  // í™ˆíŒ€ íƒ€ì
                    pitcherPanel.textContent = awayTeamName; // ì–´ì›¨ì´íŒ€ íˆ¬ìˆ˜
                    
                    console.log('ì´ˆ ì´ë‹: í™ˆíŒ€ íƒ€ì, ì–´ì›¨ì´íŒ€ íˆ¬ìˆ˜');
                } else {
                    // ë§(bottom) ì´ë‹: ì–´ì›¨ì´íŒ€ íƒ€ì, í™ˆíŒ€ íˆ¬ìˆ˜
                    if (awayTeamColor) batterPanel.style.backgroundColor = awayTeamColor;
                    if (homeTeamColor) pitcherPanel.style.backgroundColor = homeTeamColor;
                    
                    // íŒ¨ë„ ì œëª©ì„ íŒ€ëª…ìœ¼ë¡œ ë³€ê²½
                    batterPanel.textContent = awayTeamName;  // ì–´ì›¨ì´íŒ€ íƒ€ì
                    pitcherPanel.textContent = homeTeamName; // í™ˆíŒ€ íˆ¬ìˆ˜
                    
                    console.log('ë§ ì´ë‹: ì–´ì›¨ì´íŒ€ íƒ€ì, í™ˆíŒ€ íˆ¬ìˆ˜');
                }
            } catch (error) {
                console.error('íŒ¨ë„ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }

        // íŒ€ ì´ë¦„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
        socket.on('teamNameUpdated', function(data) {
            console.log('íŒ€ëª… ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹  (ì²« ë²ˆì§¸ ë¦¬ìŠ¤ë„ˆ):', data);
            
            if (data.matchId === matchId) {
                const team = data.team;
                const teamName = data.teamName;
                
                // íŒ€ í—¤ë” ì—…ë°ì´íŠ¸
                const teamHeader = document.querySelector(`.team-info.${team}-team .team-header`);
                if (teamHeader) {
                    teamHeader.textContent = teamName;
                }
                
                // ì´ë‹ í…Œì´ë¸”ì˜ íŒ€ëª… ì—…ë°ì´íŠ¸
                const teamTableRows = document.querySelectorAll('.innings-table tbody tr');
                if (teamTableRows.length >= 2) {
                    if (team === 'home') {
                        // í™ˆíŒ€ì€ ì²« ë²ˆì§¸ í–‰
                        const homeTeamName = teamTableRows[0].querySelector('.team-name');
                        if (homeTeamName) {
                            homeTeamName.textContent = teamName;
                        }
                    } else if (team === 'away') {
                        // ì›ì •íŒ€ì€ ë‘ ë²ˆì§¸ í–‰
                        const awayTeamName = teamTableRows[1].querySelector('.team-name');
                        if (awayTeamName) {
                            awayTeamName.textContent = teamName;
                        }
                    }
                }
                
                // íŒ€ëª… ìš”ì†Œë“¤ ì—…ë°ì´íŠ¸
                const teamNameElements = document.querySelectorAll(`.team-info.${team}-team .team-name`);
                teamNameElements.forEach(element => {
                    element.textContent = teamName;
                });
                
                // íŒ€ ì´ë¦„ í¬ê¸° ì¡°ì ˆ
                adjustTeamNameSize();
                
                // íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ì˜ ì œëª©ë„ ì—…ë°ì´íŠ¸
                updatePanelTitles(document.querySelector('.inning-indicator').classList.contains('bottom') ? 'bottom' : 'top');
                
                console.log(`${team}íŒ€ëª… ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${teamName}`);
            }
        });

        // íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamColorUpdated', function(data) {
            console.log('íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const teamType = data.teamType;
                const teamColor = data.teamColor;
                const headerText = data.headerText;
                
                // íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                const teamElements = document.querySelectorAll(`.team-info.${teamType}-team`);
                teamElements.forEach(element => {
                    element.style.backgroundColor = teamColor;
                });
                
                // íŒ€ í—¤ë” í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ìˆëŠ” ê²½ìš°)
                if (headerText) {
                    const headerElements = document.querySelectorAll(`.team-info.${teamType}-team .team-header`);
                    headerElements.forEach(element => {
                        element.textContent = headerText;
                    });
                }
                
                // íŒ€ ì„¹ì…˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                const teamSection = document.getElementById(`${teamType}-team-section`);
                if (teamSection) {
                    teamSection.style.backgroundColor = teamColor;
                    console.log(`${teamType}íŒ€ ì„¹ì…˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸:`, {
                        section: teamSection,
                        color: teamColor,
                        teamType: teamType
                    });
                    
                    // íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ì˜ ìƒ‰ìƒë„ ì—…ë°ì´íŠ¸
                    const inningType = document.querySelector('.inning-indicator')?.classList.contains('bottom') ? 'bottom' : 'top';
                    updatePanelTitles(inningType);
                    console.log('ğŸ”§ íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ íŒ€ì»¬ëŸ¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ (teamColorUpdated ì´ë²¤íŠ¸)');
                } else {
                    console.error(`${teamType}íŒ€ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
                
                console.log(`${teamType}íŒ€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${teamColor}`);
            }
        });

        // íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (íŒ€ì»¬ëŸ¬ì™€ ë™ì¼í•œ ë°©ì‹)
        socket.on('teamLogoBgUpdated', function(data) {
            console.log('íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const teamType = data.teamType;
                const logoBgColor = data.logoBgColor;
                
                // íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
                const logoContainers = document.querySelectorAll(`.team-info.${teamType}-team .team-logo-container`);
                logoContainers.forEach(container => {
                    container.style.backgroundColor = logoBgColor || '#ffffff';
                });
                
                console.log(`${teamType}íŒ€ë¡œê³  ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${logoBgColor}`);
            }
        });


        // ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
        socket.on('scoreUpdated', (data) => {
            console.log('ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸:', data);
            
            // ìŠ¤ì½”ì–´ì™€ ê¸°íƒ€ ì •ë³´ ì—…ë°ì´íŠ¸
            document.querySelector('.home-team .team-score').textContent = data.home_score || '0';
            document.querySelector('.away-team .team-score').textContent = data.away_score || '0';
            
            // ë² ì´ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelector('.base.first').classList.toggle('active', data.match_data?.first_base);
            document.querySelector('.base.second').classList.toggle('active', data.match_data?.second_base);
            document.querySelector('.base.third').classList.toggle('active', data.match_data?.third_base);
            
            // ë³¼/ìŠ¤íŠ¸ë¼ì´í¬/ì•„ì›ƒ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.count-dot.ball').forEach((dot, index) => {
                dot.classList.toggle('active', (data.match_data?.balls || 0) >= index + 1);
            });
            document.querySelectorAll('.count-dot.strike').forEach((dot, index) => {
                dot.classList.toggle('active', (data.match_data?.strikes || 0) >= index + 1);
            });
            document.querySelectorAll('.count-dot.out').forEach((dot, index) => {
                dot.classList.toggle('active', (data.match_data?.outs || 0) >= index + 1);
            });
            
            // ì´ë‹ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.querySelector('.current-inning').innerHTML = `
                ${data.match_data?.current_inning || '1'}
                <div class="inning-indicator ${data.match_data?.inning_type === 'bottom' ? 'bottom' : 'top'}"></div>
            `;
            
            // ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸
            if (data.match_data?.innings) {
                for (let i = 1; i <= 9; i++) {
                    document.getElementById(`teamA-inning-${i}`).textContent = data.match_data.innings[`home_${i}`] || '0';
                    document.getElementById(`teamB-inning-${i}`).textContent = data.match_data.innings[`away_${i}`] || '0';
                }
            }
            
            // ì´ë‹ë³„ ì ìˆ˜ í•©ê³„ ê³„ì‚°
            let homeTotalScore = 0;
            let awayTotalScore = 0;
            
            if (data.match_data?.innings) {
                for (let i = 1; i <= 9; i++) {
                    homeTotalScore += parseInt(data.match_data.innings[`home_${i}`] || '0');
                    awayTotalScore += parseInt(data.match_data.innings[`away_${i}`] || '0');
                }
            } else {
                homeTotalScore = data.home_score || 0;
                awayTotalScore = data.away_score || 0;
            }
            
            // íˆíŠ¸ì™€ ì—ëŸ¬ ì—…ë°ì´íŠ¸ (í•©ê³„ ì ìˆ˜ ì‚¬ìš©)
            document.querySelector('.innings-table tbody tr:first-child td.total:nth-child(11)').textContent = homeTotalScore;
            document.querySelector('.innings-table tbody tr:first-child td.total:nth-child(12)').textContent = data.match_data?.home_hits || '0';
            document.querySelector('.innings-table tbody tr:first-child td.total:nth-child(13)').textContent = data.match_data?.home_errors || '0';
            document.querySelector('.innings-table tbody tr:last-child td.total:nth-child(11)').textContent = awayTotalScore;
            document.querySelector('.innings-table tbody tr:last-child td.total:nth-child(12)').textContent = data.match_data?.away_hits || '0';
            document.querySelector('.innings-table tbody tr:last-child td.total:nth-child(13)').textContent = data.match_data?.away_errors || '0';
            
            // ì´ë‹ íƒ€ì…ì— ë”°ë¼ íŒ¨ë„ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
            updatePanelTitles(data.match_data?.inning_type);
        });

        // ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('baseball_inning_score_updated', (data) => {
            console.log('=== ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ìˆ˜ì‹  (ì˜¤ë²„ë ˆì´) ===');
            console.log('ìˆ˜ì‹ ëœ ë°ì´í„°:', data);
            console.log('í˜„ì¬ matchId:', matchId);
            console.log('ë°ì´í„° matchId:', data.matchId);
            
            if (data.matchId === matchId) {
                const { team, inning, score, innings, home_score, away_score } = data;
                
                // ì´ë‹ ìŠ¤ì½”ì–´ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                const teamElementId = team === 'home' ? `teamA-inning-${inning}` : `teamB-inning-${inning}`;
                const inningElement = document.getElementById(teamElementId);
                
                if (inningElement) {
                    inningElement.textContent = score;
                    console.log(`ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸: ${team}íŒ€ ${inning}íšŒ = ${score}`);
                }
                
                // ì „ì²´ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ (ëª¨ë“  ì´ë‹)
                if (innings) {
                    for (let i = 1; i <= 9; i++) {
                        const homeInningElement = document.getElementById(`teamA-inning-${i}`);
                        const awayInningElement = document.getElementById(`teamB-inning-${i}`);
                        
                        if (homeInningElement && innings[`home_${i}`] !== undefined) {
                            homeInningElement.textContent = innings[`home_${i}`] || '0';
                        }
                        if (awayInningElement && innings[`away_${i}`] !== undefined) {
                            awayInningElement.textContent = innings[`away_${i}`] || '0';
                        }
                    }
                }
                
                // ì„œë²„ì—ì„œ ê³„ì‚°ëœ ì´ ì ìˆ˜ ì‚¬ìš© (undefinedì¼ ë•ŒëŠ” ê¸°ì¡´ ê°’ ìœ ì§€)
                const homeTotal = home_score !== undefined ? home_score : (document.querySelector('.home-team .team-score')?.textContent || '0');
                const awayTotal = away_score !== undefined ? away_score : (document.querySelector('.away-team .team-score')?.textContent || '0');
                
                // ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ì—…ë°ì´íŠ¸
                const homeScoreElement = document.querySelector('.home-team .team-score');
                const awayScoreElement = document.querySelector('.away-team .team-score');
                
                if (homeScoreElement) homeScoreElement.textContent = homeTotal;
                if (awayScoreElement) awayScoreElement.textContent = awayTotal;
                
                // ì´ë‹ ìŠ¤ì½”ì–´ë³´ë“œì˜ ì´ ì ìˆ˜ë„ ì—…ë°ì´íŠ¸
                const homeTotalElement = document.querySelector('.innings-table tbody tr:first-child td.total:nth-child(11)');
                const awayTotalElement = document.querySelector('.innings-table tbody tr:last-child td.total:nth-child(11)');
                
                if (homeTotalElement) homeTotalElement.textContent = homeTotal;
                if (awayTotalElement) awayTotalElement.textContent = awayTotal;
                
                console.log(`ì´ ì ìˆ˜ ì—…ë°ì´íŠ¸: í™ˆíŒ€ ${homeTotal}, ì›ì •íŒ€ ${awayTotal}`);
                console.log('=== ì•¼êµ¬ ì´ë‹ ìŠ¤ì½”ì–´ ì—…ë°ì´íŠ¸ ì²˜ë¦¬ ì™„ë£Œ (ì˜¤ë²„ë ˆì´) ===');
            } else {
                console.log('ë§¤ì¹˜ IDê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ - ì´ë²¤íŠ¸ ë¬´ì‹œ');
            }
        });

        // ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('baseball_overlay_visibility_updated', (data) => {
            console.log('ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í‘œì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                const { overlayType, isVisible, overlay_visibility } = data;
                
                // ê° ì˜¤ë²„ë ˆì´ ìš”ì†Œì˜ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
                if (overlayType === 'batter') {
                    const batterInfo = document.querySelector('.batter-info');
                    if (batterInfo) {
                        batterInfo.style.display = isVisible ? 'block' : 'none';
                        console.log(`íƒ€ì ì •ë³´ ì˜¤ë²„ë ˆì´ ${isVisible ? 'í‘œì‹œ' : 'ìˆ¨ê¹€'}`);
                    }
                } else if (overlayType === 'pitcher') {
                    const pitcherInfo = document.querySelector('.pitcher-info');
                    if (pitcherInfo) {
                        pitcherInfo.style.display = isVisible ? 'block' : 'none';
                        console.log(`íˆ¬ìˆ˜ ì •ë³´ ì˜¤ë²„ë ˆì´ ${isVisible ? 'í‘œì‹œ' : 'ìˆ¨ê¹€'}`);
                    }
                } else if (overlayType === 'innings') {
                    const inningsScoreboard = document.querySelector('.innings-scoreboard');
                    if (inningsScoreboard) {
                        inningsScoreboard.style.display = isVisible ? 'block' : 'none';
                        console.log(`ì´ë‹ ìŠ¤ì½”ì–´ë³´ë“œ ì˜¤ë²„ë ˆì´ ${isVisible ? 'í‘œì‹œ' : 'ìˆ¨ê¹€'}`);
                    }
                }
                
                // ì „ì²´ ì˜¤ë²„ë ˆì´ í‘œì‹œ ìƒíƒœ ì €ì¥
                if (overlay_visibility) {
                    window.overlayVisibility = overlay_visibility;
                }
            }
        });

        // ì•¼êµ¬ ì „ìš© íŒ€ ë¡œê³ /ì»¬ëŸ¬/ë°°ê²½ìƒ‰ ì‹¤ì‹œê°„ ë°˜ì˜

        // íŒ€ ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('teamsSwapped', async function(data) {
            console.log('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
            
            if (data.matchId === matchId) {
                // íŒ€ëª… ì—…ë°ì´íŠ¸
                const homeTeamElements = document.querySelectorAll('.team-info.home-team .team-header');
                const awayTeamElements = document.querySelectorAll('.team-info.away-team .team-header');
                
                homeTeamElements.forEach(element => {
                    element.textContent = data.home_team;
                });
                awayTeamElements.forEach(element => {
                    element.textContent = data.away_team;
                });
                
                // ì ìˆ˜ ì—…ë°ì´íŠ¸
                const homeScoreElements = document.querySelectorAll('.team-info.home-team .team-score');
                const awayScoreElements = document.querySelectorAll('.team-info.away-team .team-score');
                
                homeScoreElements.forEach(element => {
                    element.textContent = data.home_score;
                });
                awayScoreElements.forEach(element => {
                    element.textContent = data.away_score;
                });
                
                // ì´ë‹ í…Œì´ë¸”ì˜ íŒ€ëª…ë„ ì—…ë°ì´íŠ¸
                const homeTableNameElements = document.querySelectorAll('.innings-table tbody tr:first-child .team-name');
                const awayTableNameElements = document.querySelectorAll('.innings-table tbody tr:last-child .team-name');
                
                homeTableNameElements.forEach(element => {
                    element.textContent = data.home_team;
                });
                awayTableNameElements.forEach(element => {
                    element.textContent = data.away_team;
                });
                
                // íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ (ì¶•êµ¬ì™€ ë™ì¼í•œ ë°©ì‹)
                try {
                    const response = await fetch(`/api/matches/${matchId}/team-logos`);
                    if (response.ok) {
                        const result = await response.json();
                        
                        // í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ (ì¶•êµ¬ì™€ ë™ì¼í•œ ë°©ì‹)
                        if (result.success && result.teamLogos) {
                            const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                            const homeLogoContainers = document.querySelectorAll('.team-info.home-team .team-logo-container');
                            homeLogoContainers.forEach(container => {
                                if (homeTeamInfo && homeTeamInfo.logo_path) {
                                    container.style.backgroundColor = homeTeamInfo.logo_bg_color || '#ffffff';
                                    container.innerHTML = `
                                        <img src="${homeTeamInfo.logo_path}" alt="${data.home_team} ë¡œê³ " class="team-logo">
                                    `;
                                } else {
                                    container.style.backgroundColor = '#f8f9fa';
                                    container.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                                }
                            });
                            
                            // ì›ì •íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                            const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                            const awayLogoContainers = document.querySelectorAll('.team-info.away-team .team-logo-container');
                            awayLogoContainers.forEach(container => {
                                if (awayTeamInfo && awayTeamInfo.logo_path) {
                                    container.style.backgroundColor = awayTeamInfo.logo_bg_color || '#ffffff';
                                    container.innerHTML = `
                                        <img src="${awayTeamInfo.logo_path}" alt="${data.away_team} ë¡œê³ " class="team-logo">
                                    `;
                                } else {
                                    container.style.backgroundColor = '#f8f9fa';
                                    container.innerHTML = '<span style="font-size: 0.8rem; color: #6c757d;">ë¡œê³ </span>';
                                }
                            });
                        }
                    }
                } catch (error) {
                    console.error('íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
                
                console.log('íŒ€ ìœ„ì¹˜ ë³€ê²½ ì™„ë£Œ');
            }
        });

        // ìŠ¤í¬ì¸  ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì•¼êµ¬ìš©)
        socket.on('sport_overlay_image_updated', function(data) {
            console.log('ì•¼êµ¬ ìŠ¤í¬ì¸  ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸:', data);
            
            if (data.action === 'uploaded') {
                // ìƒˆ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                loadOverlayImage();
            } else if (data.action === 'deleted') {
                // ì´ë¯¸ì§€ê°€ ì‚­ì œëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                loadOverlayImage();
            } else if (data.action === 'activated') {
                // ì´ë¯¸ì§€ê°€ í™œì„±í™”ëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                loadOverlayImage();
            } else if (data.action === 'status_changed') {
                // ì´ë¯¸ì§€ ìƒíƒœê°€ ë³€ê²½ëœ ê²½ìš° - í™œì„±í™”ëœ ì´ë¯¸ì§€ë“¤ ë‹¤ì‹œ ë¡œë“œ
                console.log('ì•¼êµ¬ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ë¨:', data);
                loadOverlayImage();
            }
        });

        // ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë™ì  ì²˜ë¦¬)
        socket.on('overlay_image_status_changed', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ìƒíƒœ ë³€ê²½ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸:', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ (window.matchData ì‚¬ìš©)
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ì¼ì¹˜, ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘');
                
                if (data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì¶”ê°€ í‘œì‹œ
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ í™œì„±í™”:', data.imageData);
                    addOverlayImage(data.imageData);
                } else if (!data.isActive && data.imageData) {
                    // ì´ë¯¸ì§€ ë¹„í™œì„±í™” - í•´ë‹¹ ì´ë¯¸ì§€ë§Œ ì œê±°
                    console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ë¹„í™œì„±í™”:', data.imageData);
                    removeOverlayImage(data.imageData.id);
                }
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜, Room ì¬ì°¸ì—¬ ì‹œë„');
                // ìŠ¤í¬ì¸  íƒ€ì…ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ Room ì¬ì°¸ì—¬ ì‹œë„
                if (window.matchData?.sport_type) {
                    console.log('ğŸ”§ ì•¼êµ¬ Room ì¬ì°¸ì—¬ ìš”ì²­:', window.matchData.sport_type);
                    socket.emit('join_sport_room', window.matchData.sport_type);
                }
            }
        });

        // ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('overlay_page_refresh', function(data) {
            console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹ í˜¸ ìˆ˜ì‹ :', data);
            console.log('ğŸ”§ í˜„ì¬ window.matchData:', window.matchData);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° sport_type:', window.matchData?.sport_type);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ sportCode:', data.sportCode);
            
            // í˜„ì¬ ê²½ê¸°ì˜ ìŠ¤í¬ì¸  íƒ€ì…ê³¼ ë™ì  ë¹„êµ
            if (data.sportCode === window.matchData?.sport_type) {
                console.log('ğŸ”§ ì•¼êµ¬ ì˜¤ë²„ë ˆì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰:', data.reason);
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                location.reload();
            } else {
                console.log('ğŸ”§ ì•¼êµ¬ ìŠ¤í¬ì¸  íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€');
            }
        });

        // dataChanged ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
        socket.on('dataChanged', async function(data) {
            console.log('ğŸ”§ dataChanged ì´ë²¤íŠ¸ ìˆ˜ì‹  (ì•¼êµ¬):', data);
            console.log('ğŸ”§ í˜„ì¬ ê²½ê¸° ID:', matchId);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ ê²½ê¸° ID:', data.matchId);
            console.log('ğŸ”§ ì´ë²¤íŠ¸ íƒ€ì…:', data.type);
            console.log('ğŸ”§ íŒ€ íƒ€ì…:', data.teamType);

            if (data.matchId === matchId) {
                console.log('ğŸ”§ ë™ì¼ ê²½ê¸° dataChanged ì´ë²¤íŠ¸ - ë°ì´í„° ì¬ë¡œë“œ ì‹œì‘');
                setTimeout(async () => {
                    try {
                        console.log('ğŸ”§ 500ms ì§€ì—° í›„ ë°ì´í„° ì¬ë¡œë“œ ì‹¤í–‰');
                        await loadMatchData();
                        
                        // íŒ€ë¡œê³  ì •ë³´ë„ í•¨ê»˜ ë¡œë“œ
                        if (data.type === 'teamLogo' || data.type === 'teamName' || data.type === 'teamColor') {
                            console.log('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ì¬ë¡œë“œ ì‹œì‘');
                            const response = await fetch(`/api/matches/${matchId}/team-logos`);
                            if (response.ok) {
                                const result = await response.json();
                                console.log('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ì‘ë‹µ:', result);
                                
                                // í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸
                                if (result.teamLogos && result.teamLogos.length > 0) {
                                    const homeTeamInfo = result.teamLogos.find(team => team.team_type === 'home');
                                    const awayTeamInfo = result.teamLogos.find(team => team.team_type === 'away');
                                    
                                    console.log('ğŸ”§ í™ˆíŒ€ ì •ë³´:', homeTeamInfo);
                                    console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ì •ë³´:', awayTeamInfo);
                                    
                                    if (homeTeamInfo) {
                                        const homeLogoContainers = document.querySelectorAll('.team-info.home-team .team-logo-container');
                                        console.log('ğŸ”§ í™ˆíŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆ ê°œìˆ˜:', homeLogoContainers.length);
                                        homeLogoContainers.forEach(container => {
                                            if (homeTeamInfo.logo_path) {
                                                container.innerHTML = `
                                                    <img src="${homeTeamInfo.logo_path}" alt="í™ˆíŒ€ ë¡œê³ " class="team-logo">
                                                `;
                                                container.style.backgroundColor = homeTeamInfo.logo_bg_color || '#ffffff';
                                                console.log('ğŸ”§ í™ˆíŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ:', homeTeamInfo.logo_path);
                                            } else {
                                                container.innerHTML = `<div class="team-logo-placeholder"></div>`;
                                                console.log('ğŸ”§ í™ˆíŒ€ ë¡œê³  ì—†ìŒ - í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ');
                                            }
                                        });
                                        
                                        // í™ˆíŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸
                                        if (homeTeamInfo.team_color) {
                                            const homeTeamSection = document.getElementById('home-team-section');
                                            if (homeTeamSection) {
                                                homeTeamSection.style.backgroundColor = homeTeamInfo.team_color;
                                                console.log('ğŸ”§ í™ˆíŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸:', homeTeamInfo.team_color);
                                            }
                                        }
                                    }
                                    
                                    if (awayTeamInfo) {
                                        const awayLogoContainers = document.querySelectorAll('.team-info.away-team .team-logo-container');
                                        console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆ ê°œìˆ˜:', awayLogoContainers.length);
                                        awayLogoContainers.forEach(container => {
                                            if (awayTeamInfo.logo_path) {
                                                container.innerHTML = `
                                                    <img src="${awayTeamInfo.logo_path}" alt="ì›ì •íŒ€ ë¡œê³ " class="team-logo">
                                                `;
                                                container.style.backgroundColor = awayTeamInfo.logo_bg_color || '#ffffff';
                                                console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ:', awayTeamInfo.logo_path);
                                            } else {
                                                container.innerHTML = `<div class="team-logo-placeholder"></div>`;
                                                console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ë¡œê³  ì—†ìŒ - í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ');
                                            }
                                        });
                                        
                                        // ì–´ì›¨ì´íŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸
                                        if (awayTeamInfo.team_color) {
                                            const awayTeamSection = document.getElementById('away-team-section');
                                            if (awayTeamSection) {
                                                awayTeamSection.style.backgroundColor = awayTeamInfo.team_color;
                                                console.log('ğŸ”§ ì–´ì›¨ì´íŒ€ ì„¹ì…˜ ì»¬ëŸ¬ ì—…ë°ì´íŠ¸:', awayTeamInfo.team_color);
                                            }
                                        }
                                    }
                                }
                                
                                // íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ì˜ íŒ€ì»¬ëŸ¬ë„ ì—…ë°ì´íŠ¸
                                const inningType = document.querySelector('.inning-indicator')?.classList.contains('bottom') ? 'bottom' : 'top';
                                updatePanelTitles(inningType);
                                console.log('ğŸ”§ íƒ€ì/íˆ¬ìˆ˜ íŒ¨ë„ íŒ€ì»¬ëŸ¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                                
                                console.log('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ì¬ë¡œë“œ ì™„ë£Œ');
                            } else {
                                console.error('ğŸ”§ íŒ€ë¡œê³  ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', response.status);
                            }
                        }
                        
                        console.log('ğŸ”§ ë°ì´í„° ì¬ë¡œë“œ ì™„ë£Œ');
                    } catch (error) {
                        console.error('ğŸ”§ ë°ì´í„° ì¬ë¡œë“œ ì˜¤ë¥˜:', error);
                    }
                }, 500);
            } else {
                console.log('ğŸ”§ ë‹¤ë¥¸ ê²½ê¸°ì˜ dataChanged ì´ë²¤íŠ¸ë¡œ ë¬´ì‹œ');
            }
        });

        // íŒ€ë¡œê³  ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ (í†µí•©ëœ ë°©ì‹)
        socket.on('teamLogoUpdated', function(data) {
            if (data.matchId !== matchId) return;
            
            console.log('íŒ€ë¡œê³  ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
            
            const teamType = data.teamType;
            const logoPath = data.logoPath;
            const logoBgColor = data.logoBgColor || '#ffffff';
            
            // í•´ë‹¹ íŒ€ì˜ ë¡œê³  ì»¨í…Œì´ë„ˆ ì°¾ê¸°
            const logoContainer = document.querySelector(`.team-info.${teamType}-team .team-logo-container`);
            if (logoContainer) {
                // ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
                logoContainer.style.backgroundColor = logoBgColor;
                
                // ë¡œê³  ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
                if (logoPath) {
                    logoContainer.innerHTML = `
                        <img src="${logoPath}" alt="${teamType === 'home' ? 'í™ˆ' : 'ì›ì •'}íŒ€ ë¡œê³ " 
                             style="width: 100%; height: 100%; object-fit: contain;">
                    `;
                } else {
                    logoContainer.innerHTML = `<div class="team-logo-placeholder"></div>`;
                }
                
                console.log(`${teamType}íŒ€ ë¡œê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${logoPath}, ë°°ê²½ìƒ‰: ${logoBgColor}`);
            } else {
                console.error(`${teamType}íŒ€ ë¡œê³  ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
            }
        });

        // ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ ê´€ë ¨ ë³€ìˆ˜
        let currentMatchIndex = 0;
        let totalMatches = 0;
        let listId = null;
        
        <% if (typeof listId !== 'undefined' && listId) { %>
        currentMatchIndex = <%- currentMatchIndex || 0 %>;
        totalMatches = <%- totalMatches || 0 %>;
        listId = '<%- listId %>';
        
        // ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ
        function showListInfo() {
            const listInfo = document.getElementById('listInfo');
            const listName = document.getElementById('listName');
            const matchCounter = document.getElementById('matchCounter');
            
            if (listInfo && listName && matchCounter) {
                listName.textContent = 'ë¦¬ìŠ¤íŠ¸: <%= typeof listName !== "undefined" ? listName : "ê²½ê¸° ë¦¬ìŠ¤íŠ¸" %>';
                matchCounter.textContent = `ê²½ê¸° ${currentMatchIndex + 1} / ${totalMatches}`;
                listInfo.classList.add('show');
                
                // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
                setTimeout(() => {
                    listInfo.classList.remove('show');
                }, 3000);
            }
        }
        
        // ë‹¤ìŒ ê²½ê¸°ë¡œ ì´ë™
        async function nextMatch() {
            if (currentMatchIndex < totalMatches - 1) {
                currentMatchIndex++;
                await loadCurrentMatch();
            }
        }
        
        // ì´ì „ ê²½ê¸°ë¡œ ì´ë™
        async function prevMatch() {
            if (currentMatchIndex > 0) {
                currentMatchIndex--;
                await loadCurrentMatch();
            }
        }
        
        // í˜„ì¬ ê²½ê¸° ë¡œë“œ
        async function loadCurrentMatch() {
            try {
                const response = await fetch(`/api/list/${listId}/current-match?index=${currentMatchIndex}`);
                if (!response.ok) throw new Error('ê²½ê¸° ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
                
                const data = await response.json();
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ê²½ê¸° ë³€ê²½
                window.location.href = `/list/${listId}/overlay?index=${currentMatchIndex}`;
            } catch (error) {
                console.error('ê²½ê¸° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'ArrowLeft':
                    prevMatch();
                    break;
                case 'ArrowRight':
                    nextMatch();
                    break;
                case 'i':
                case 'I':
                    showListInfo();
                    break;
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ
        window.addEventListener('load', function() {
            setTimeout(showListInfo, 1000);
        });
        <% } %>
        
        // ì•¼êµ¬ëŠ” íƒ€ì´ë¨¸ê°€ í•„ìš”ì—†ìœ¼ë¯€ë¡œ í•˜ì´ë¸Œë¦¬ë“œ íƒ€ì´ë¨¸ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        
    </script>
</body>
</html> 